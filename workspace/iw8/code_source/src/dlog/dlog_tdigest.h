/*
==============
DLogTDigest<20,8>::GetString<double>
==============
*/

unsigned __int64 __fastcall DLogTDigest<20,8>::GetString<double>(DLogTDigest<20,8> *this, const char *tableTitle, const char *rowTitle, const char *unitFormat, const int headerColWidth, const int dataColWidth, unsigned int *percentiles, int percentileCount, char *buffer, unsigned __int64 bufferSize)
{
  return ??$GetString@N@?$DLogTDigest@$0BE@$07@@QEAA_KPEBD00HHPEAIHPEAD_K@Z(this, tableTitle, rowTitle, unitFormat, headerColWidth, dataColWidth, percentiles, percentileCount, buffer, bufferSize);
}

/*
==============
DLogTDigest<16,8>::SerializeToProtobuf
==============
*/

int __fastcall DLogTDigest<16,8>::SerializeToProtobuf(DLogTDigest<16,8> *this, unsigned __int8 *outBuffer, unsigned __int64 bufferSize)
{
  return ?SerializeToProtobuf@?$DLogTDigest@$0BA@$07@@QEAAHPEAE_K@Z(this, outBuffer, bufferSize);
}

/*
==============
DLogTDigest<32,8>::DLogTDigest<32,8>
==============
*/

void __fastcall DLogTDigest<32,8>::DLogTDigest<32,8>(DLogTDigest<32,8> *this)
{
  ??0?$DLogTDigest@$0CA@$07@@QEAA@XZ(this);
}

/*
==============
DLogTDigest<32,8>::Reset
==============
*/

void __fastcall DLogTDigest<32,8>::Reset(DLogTDigest<32,8> *this)
{
  ?Reset@?$DLogTDigest@$0CA@$07@@QEAAXXZ(this);
}

/*
==============
DLogTDigest<16,8>::ProcessBufferedCentroids
==============
*/

void __fastcall DLogTDigest<16,8>::ProcessBufferedCentroids(DLogTDigest<16,8> *this)
{
  ?ProcessBufferedCentroids@?$DLogTDigest@$0BA@$07@@QEAAXXZ(this);
}

/*
==============
DLogTDigest<20,8>::Reset
==============
*/

void __fastcall DLogTDigest<20,8>::Reset(DLogTDigest<20,8> *this)
{
  ?Reset@?$DLogTDigest@$0BE@$07@@QEAAXXZ(this);
}

/*
==============
DLogTDigest<32,8>::ProcessBufferedCentroids
==============
*/

void __fastcall DLogTDigest<32,8>::ProcessBufferedCentroids(DLogTDigest<32,8> *this)
{
  ?ProcessBufferedCentroids@?$DLogTDigest@$0CA@$07@@QEAAXXZ(this);
}

/*
==============
DLogTDigest<20,8>::ProcessBufferedCentroids
==============
*/

void __fastcall DLogTDigest<20,8>::ProcessBufferedCentroids(DLogTDigest<20,8> *this)
{
  ?ProcessBufferedCentroids@?$DLogTDigest@$0BE@$07@@QEAAXXZ(this);
}

/*
==============
DLogTDigest<20,8>::EstimateQuantile
==============
*/

long double __fastcall DLogTDigest<20,8>::EstimateQuantile(DLogTDigest<20,8> *this, long double quantile)
{
  return ?EstimateQuantile@?$DLogTDigest@$0BE@$07@@QEAANN@Z(this, quantile);
}

/*
==============
DLogTDigest<20,8>::Add
==============
*/

void __fastcall DLogTDigest<20,8>::Add(DLogTDigest<20,8> *this, long double value, long double weight)
{
  ?Add@?$DLogTDigest@$0BE@$07@@QEAAXNN@Z(this, value, weight);
}

/*
==============
DLogTDigest<32,8>::Add
==============
*/

void __fastcall DLogTDigest<32,8>::Add(DLogTDigest<32,8> *this, long double value, long double weight)
{
  ?Add@?$DLogTDigest@$0CA@$07@@QEAAXNN@Z(this, value, weight);
}

/*
==============
DLogTDigest<100,8>::SerializeToProtobuf
==============
*/

int __fastcall DLogTDigest<100,8>::SerializeToProtobuf(DLogTDigest<100,8> *this, unsigned __int8 *outBuffer, unsigned __int64 bufferSize)
{
  return ?SerializeToProtobuf@?$DLogTDigest@$0GE@$07@@QEAAHPEAE_K@Z(this, outBuffer, bufferSize);
}

/*
==============
DLogTDigest<100,8>::Reset
==============
*/

void __fastcall DLogTDigest<100,8>::Reset(DLogTDigest<100,8> *this)
{
  ?Reset@?$DLogTDigest@$0GE@$07@@QEAAXXZ(this);
}

/*
==============
DLogTDigest<16,8>::Add
==============
*/

void __fastcall DLogTDigest<16,8>::Add(DLogTDigest<16,8> *this, long double value, long double weight)
{
  ?Add@?$DLogTDigest@$0BA@$07@@QEAAXNN@Z(this, value, weight);
}

/*
==============
DLogTDigest<100,8>::ProcessBufferedCentroids
==============
*/

void __fastcall DLogTDigest<100,8>::ProcessBufferedCentroids(DLogTDigest<100,8> *this)
{
  ?ProcessBufferedCentroids@?$DLogTDigest@$0GE@$07@@QEAAXXZ(this);
}

/*
==============
DLogTDigest<32,8>::SerializeToProtobuf
==============
*/

int __fastcall DLogTDigest<32,8>::SerializeToProtobuf(DLogTDigest<32,8> *this, unsigned __int8 *outBuffer, unsigned __int64 bufferSize)
{
  return ?SerializeToProtobuf@?$DLogTDigest@$0CA@$07@@QEAAHPEAE_K@Z(this, outBuffer, bufferSize);
}

/*
==============
DLogTDigest<16,8>::Reset
==============
*/

void __fastcall DLogTDigest<16,8>::Reset(DLogTDigest<16,8> *this)
{
  ?Reset@?$DLogTDigest@$0BA@$07@@QEAAXXZ(this);
}

/*
==============
DLogTDigestCentroid::DLogTDigestCentroid
==============
*/

void __fastcall DLogTDigestCentroid::DLogTDigestCentroid(DLogTDigestCentroid *this)
{
  ??0DLogTDigestCentroid@@QEAA@XZ(this);
}

/*
==============
DLogTDigest<20,8>::SerializeToProtobuf
==============
*/

int __fastcall DLogTDigest<20,8>::SerializeToProtobuf(DLogTDigest<20,8> *this, unsigned __int8 *outBuffer, unsigned __int64 bufferSize)
{
  return ?SerializeToProtobuf@?$DLogTDigest@$0BE@$07@@QEAAHPEAE_K@Z(this, outBuffer, bufferSize);
}

/*
==============
DLogTDigest<100,8>::Add
==============
*/

void __fastcall DLogTDigest<100,8>::Add(DLogTDigest<100,8> *this, long double value, long double weight)
{
  ?Add@?$DLogTDigest@$0GE@$07@@QEAAXNN@Z(this, value, weight);
}

/*
==============
DLogTDigest<20,8>::DLogTDigest<20,8>
==============
*/

void __fastcall DLogTDigest<20,8>::DLogTDigest<20,8>(DLogTDigest<20,8> *this)
{
  ??0?$DLogTDigest@$0BE@$07@@QEAA@XZ(this);
}

/*
==============
DLogTDigest<20,8>::Add
==============
*/

void __fastcall DLogTDigest<20,8>::Add(DLogTDigest<20,8> *this, double value, long double weight)
{
  int m_unprocessedCentroidBufferIndex; 
  __int64 v11; 
  long double v14; 

  m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
  _XMM6 = *(_OWORD *)&value;
  if ( (unsigned int)m_unprocessedCentroidBufferIndex < 0x8C )
    goto LABEL_4;
  if ( !this->m_disableAutoMerge )
  {
    DLogTDigest<20,8>::ProcessBufferedCentroids(this);
    m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
LABEL_4:
    _XMM1 = *(unsigned __int64 *)&this->m_min;
    __asm
    {
      vcmpltsd xmm0, xmm6, xmm1
      vblendvpd xmm1, xmm1, xmm6, xmm0
    }
    this->m_min = *(double *)&_XMM1;
    _XMM2 = *(unsigned __int64 *)&this->m_max;
    v11 = 2 * (m_unprocessedCentroidBufferIndex + 23i64);
    __asm
    {
      vcmpltsd xmm0, xmm2, xmm6
      vblendvpd xmm1, xmm2, xmm6, xmm0
    }
    this->m_max = *(double *)&_XMM1;
    *((double *)&this->m_min + v11) = *(double *)&_XMM6;
    *(&this->m_max + v11) = weight;
    v14 = weight + this->m_unprocessedWeightTotal;
    ++this->m_unprocessedCentroidBufferIndex;
    this->m_unprocessedWeightTotal = v14;
    return;
  }
  DLog_PrintError("Auto merge disabled - centroid buffer overflow\n");
}

/*
==============
DLogTDigest<20,8>::ProcessBufferedCentroids
==============
*/
void DLogTDigest<20,8>::ProcessBufferedCentroids(DLogTDigest<20,8> *this)
{
  __int64 m_unprocessedCentroidBufferIndex; 
  DLogTDigestCentroid *m_processedCentroids; 
  DLogTDigestCentroid *v5; 
  int v6; 
  long double v7; 
  int v8; 
  double v9; 
  double m_weight; 
  double m_mean; 
  __int128 v12; 
  DLogTDigestCentroid *v18; 
  __int128 v19; 
  double v20; 
  double v21; 
  __int128 v22; 
  __int128 v23; 
  double v24; 
  double v25; 
  __int64 v26; 
  double v27; 
  bool v28; 
  __int128 v29; 
  double v30; 
  double v31; 
  double v32; 
  __int64 v33; 
  DLogTDigestCentroid *v34; 

  m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
  if ( (_DWORD)m_unprocessedCentroidBufferIndex )
  {
    m_processedCentroids = this->m_processedCentroids;
    v5 = &this->m_unprocessedCentroidBuffer[m_unprocessedCentroidBufferIndex];
    std::_Ptr_copy_cat<DLogTDigestCentroid,DLogTDigestCentroid>(&v34, &v34);
    memmove_0(v5, m_processedCentroids, (size_t)this + 16 * (this->m_processedCentroidsIndex + 3i64) - (_QWORD)m_processedCentroids);
    std::_Sort_unchecked<DLogTDigestCentroid *,std::less<void>>(this->m_unprocessedCentroidBuffer, &this->m_unprocessedCentroidBuffer[this->m_processedCentroidsIndex + (__int64)this->m_unprocessedCentroidBufferIndex], (16 * (this->m_processedCentroidsIndex + (__int64)this->m_unprocessedCentroidBufferIndex + 23) - 368) >> 4, (std::less<void>)v34);
    v6 = 1;
    this->m_unprocessedCentroidBufferIndex += this->m_processedCentroidsIndex;
    v7 = this->m_processedWeightTotal + this->m_unprocessedWeightTotal;
    v8 = this->m_unprocessedCentroidBufferIndex;
    v9 = v7 * 0.005000000000000001;
    this->m_processedWeightTotal = v7;
    this->m_unprocessedWeightTotal = 0.0;
    this->m_processedCentroidsIndex = 0;
    m_weight = this->m_unprocessedCentroidBuffer[0].m_weight;
    m_mean = this->m_unprocessedCentroidBuffer[0].m_mean;
    v12 = *(unsigned __int64 *)&m_weight;
    __asm
    {
      vxorpd  xmm14, xmm14, xmm14
      vxorpd  xmm4, xmm4, xmm4
      vxorpd  xmm5, xmm5, xmm5
    }
    if ( v8 - 1 >= 1 )
    {
      v18 = &this->m_unprocessedCentroidBuffer[1];
      v19 = *(unsigned __int64 *)&DOUBLE_2_0;
      do
      {
        v20 = v18->m_weight;
        v21 = v18->m_mean;
        *((_QWORD *)&v22 + 1) = *((_QWORD *)&v12 + 1);
        *(double *)&v22 = *(double *)&v12 + v20;
        v12 = v22;
        if ( *(double *)&v22 > v9 )
        {
          v24 = m_weight + *(double *)&_XMM5;
          v25 = (m_weight * m_mean + *(double *)&_XMM4) / (m_weight + *(double *)&_XMM5);
          DLog_Assert(this->m_processedCentroidsIndex < 0x14u, "m_processedCentroidsIndex < ARRAY_COUNT( m_processedCentroids )", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<20,8>::ProcessBufferedCentroids", 280);
          v26 = 2 * (this->m_processedCentroidsIndex + 3i64);
          v27 = *(double *)&v19 * 0.05;
          _XMM4 = _XMM14;
          *((double *)&this->m_min + v26) = v25;
          *((double *)&this->m_max + v26) = v24;
          ++this->m_processedCentroidsIndex;
          v28 = *(double *)&v19 * 0.05 < 0.5;
          _XMM5 = _XMM14;
          *((_QWORD *)&v29 + 1) = *((_QWORD *)&v19 + 1);
          *(double *)&v29 = *(double *)&v19 + 1.0;
          v19 = v29;
          if ( v28 )
            v30 = v27 * 2.0 * v27;
          else
            v30 = 1.0 - (1.0 - v27) * 2.0 * (1.0 - v27);
          v9 = v30 * this->m_processedWeightTotal;
          m_mean = v21;
          m_weight = v20;
        }
        else
        {
          *((_QWORD *)&v23 + 1) = *((_QWORD *)&_XMM4 + 1);
          *(double *)&v23 = *(double *)&_XMM4 + v20 * v21;
          _XMM4 = v23;
          *((_QWORD *)&v23 + 1) = *((_QWORD *)&_XMM5 + 1);
          *(double *)&v23 = *(double *)&_XMM5 + v20;
          _XMM5 = v23;
        }
        ++v6;
        ++v18;
      }
      while ( v6 <= this->m_unprocessedCentroidBufferIndex - 1 );
    }
    if ( m_weight > *(double *)&_XMM14 )
    {
      v31 = m_weight + *(double *)&_XMM5;
      v32 = (m_weight * m_mean + *(double *)&_XMM4) / (m_weight + *(double *)&_XMM5);
      DLog_Assert(this->m_processedCentroidsIndex < 0x14u, "m_processedCentroidsIndex < ARRAY_COUNT( m_processedCentroids )", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<20,8>::ProcessBufferedCentroids", 299);
      v33 = 2 * (this->m_processedCentroidsIndex + 3i64);
      *((double *)&this->m_min + v33) = v32;
      *((double *)&this->m_max + v33) = v31;
      ++this->m_processedCentroidsIndex;
    }
    this->m_unprocessedCentroidBufferIndex = 0;
  }
}

/*
==============
DLogTDigest<20,8>::Reset
==============
*/
void DLogTDigest<20,8>::Reset(DLogTDigest<20,8> *this)
{
  this->m_min = 1.797693134862316e308;
  this->m_max = 2.225073858507201e-308;
  this->m_processedWeightTotal = 0.0;
  this->m_unprocessedWeightTotal = 0.0;
  *(_QWORD *)&this->m_unprocessedCentroidBufferIndex = 0i64;
  memset_0(this->m_processedCentroids, 0, 0xB40ui64);
}

/*
==============
DLogTDigest<20,8>::SerializeToProtobuf
==============
*/
unsigned __int64 DLogTDigest<20,8>::SerializeToProtobuf(DLogTDigest<20,8> *this, unsigned __int8 *outBuffer, unsigned __int64 bufferSize)
{
  bool v6; 
  int v7; 
  int v8; 
  long double *p_m_weight; 
  DLogTDigestCentroid *m_processedCentroids; 
  ProtobufSerializer v16; 

  DLog_Assert(bufferSize >= 0xBE, "GetSerializedByteSize() <= bufferSize", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<20,8>::SerializeToProtobuf", 398);
  DLogTDigest<20,8>::ProcessBufferedCentroids(this);
  ProtobufSerializer::ProtobufSerializer(&v16, outBuffer, bufferSize);
  v6 = ProtobufSerializer::UInt64(&v16, 1ui64, 1ui64) && ProtobufSerializer::Float64(&v16, 2ui64, this->m_min) && ProtobufSerializer::Float64(&v16, 3ui64, this->m_max) && ProtobufSerializer::Int32(&v16, 4ui64, this->m_processedCentroidsIndex + 1);
  ProtobufSerializer::BeginPacked(&v16, 5ui64);
  v7 = 0;
  v8 = 0;
  if ( this->m_processedCentroidsIndex > 0 )
  {
    p_m_weight = &this->m_processedCentroids[0].m_weight;
    do
    {
      if ( !v6 )
        goto LABEL_12;
      _XMM2 = *(unsigned __int64 *)p_m_weight;
      __asm { vcvtpd2ps xmm2, xmm2; value }
      if ( ProtobufSerializer::Float32(&v16, 5ui64, *(float *)&_XMM2) )
        v6 = 1;
      else
LABEL_12:
        v6 = 0;
      ++v8;
      p_m_weight += 2;
    }
    while ( v8 < this->m_processedCentroidsIndex );
  }
  ProtobufSerializer::EndPacked(&v16);
  ProtobufSerializer::BeginPacked(&v16, 6ui64);
  if ( this->m_processedCentroidsIndex > 0 )
  {
    m_processedCentroids = this->m_processedCentroids;
    do
    {
      if ( !v6 )
        goto LABEL_19;
      _XMM2 = *(unsigned __int64 *)&m_processedCentroids->m_mean;
      __asm { vcvtpd2ps xmm2, xmm2; value }
      if ( ProtobufSerializer::Float32(&v16, 6ui64, *(float *)&_XMM2) )
        v6 = 1;
      else
LABEL_19:
        v6 = 0;
      ++v7;
      ++m_processedCentroids;
    }
    while ( v7 < this->m_processedCentroidsIndex );
  }
  ProtobufSerializer::EndPacked(&v16);
  return ProtobufSerializer::Size(&v16);
}

/*
==============
DLogTDigest<20,8>::GetString<double>
==============
*/
unsigned __int64 DLogTDigest<20,8>::GetString<double>(DLogTDigest<20,8> *this, const char *tableTitle, const char *rowTitle, const char *unitFormat, const int headerColWidth, const int dataColWidth, unsigned int *percentiles, int percentileCount, char *buffer, unsigned __int64 bufferSize)
{
  __int128 v10; 
  unsigned int *v12; 
  DLogTDigest<20,8> *v13; 
  int v14; 
  unsigned __int64 v15; 
  unsigned __int64 v16; 
  unsigned __int64 v17; 
  int v18; 
  unsigned int *v19; 
  __int64 v20; 
  char *v21; 
  unsigned __int64 v22; 
  unsigned __int64 v23; 
  char *v24; 
  unsigned __int64 v25; 
  char *v28; 
  char *v29; 
  unsigned __int64 v30; 
  char v35[64]; 
  char dest[64]; 
  __int128 v37; 

  v12 = percentiles;
  v13 = this;
  v14 = 0;
  v15 = 0i64;
  DLog_sprintf<64>((char (*)[64])dest, "%%-%us", (unsigned int)headerColWidth);
  DLog_sprintf<64>((char (*)[64])v35, "%%-%us", (unsigned int)dataColWidth);
  if ( tableTitle )
  {
    v16 = DLog_sprintf(buffer, bufferSize, dest, tableTitle);
    v17 = DLog_sprintf(&buffer[v16], bufferSize - v16, v35, "min") + v16;
    v18 = 0;
    if ( percentileCount > 0 )
    {
      v19 = percentiles;
      do
      {
        v20 = *v19;
        if ( !(_DWORD)v20 )
          break;
        v21 = j_va("%u%%", v20);
        v17 += DLog_sprintf(&buffer[v17], bufferSize - v17, v35, v21);
        ++v18;
        ++v19;
      }
      while ( v18 < percentileCount );
    }
    v22 = DLog_sprintf(&buffer[v17], bufferSize - v17, v35, "max") + v17;
    v13 = this;
    v15 = DLog_sprintf(&buffer[v22], bufferSize - v22, "\n") + v22;
  }
  v23 = DLog_sprintf(&buffer[v15], bufferSize - v15, dest, rowTitle) + v15;
  v24 = j_va(unitFormat, v13->m_min);
  v25 = DLog_sprintf(&buffer[v23], bufferSize - v23, v35, v24) + v23;
  if ( percentileCount > 0 )
  {
    v37 = v10;
    do
    {
      if ( !*v12 )
        break;
      _XMM0 = 0i64;
      __asm { vcvtsi2sd xmm0, xmm0, rax }
      *(double *)&_XMM0 = DLogTDigest<20,8>::EstimateQuantile(v13, *(double *)&_XMM0 * 0.01);
      v28 = j_va(unitFormat, (_QWORD)_XMM0);
      v25 += DLog_sprintf(&buffer[v25], bufferSize - v25, v35, v28);
      ++v14;
      ++v12;
    }
    while ( v14 < percentileCount );
  }
  v29 = j_va(unitFormat, v13->m_max);
  v30 = DLog_sprintf(&buffer[v25], bufferSize - v25, v35, v29) + v25;
  return v30 + DLog_sprintf(&buffer[v30], bufferSize - v30, "\n");
}

/*
==============
DLogTDigest<20,8>::EstimateQuantile
==============
*/
long double DLogTDigest<20,8>::EstimateQuantile(DLogTDigest<20,8> *this, long double quantile)
{
  __int64 m_processedCentroidsIndex; 
  __int128 v9; 
  int v11; 
  __int64 v12; 
  __int64 v13; 
  long double *v14; 
  __int128 v15; 
  int v16; 
  __int64 v17; 
  long double *p_m_weight; 
  __int128 v19; 
  double m_min; 
  double m_max; 
  __int128 v22; 

  DLogTDigest<20,8>::ProcessBufferedCentroids(this);
  m_processedCentroidsIndex = this->m_processedCentroidsIndex;
  if ( (_DWORD)m_processedCentroidsIndex )
  {
    _XMM1 = *(unsigned __int64 *)&this->m_processedWeightTotal;
    v9 = COERCE_UNSIGNED_INT64(*(double *)&_XMM1 * quantile);
    __asm { vxorpd  xmm4, xmm4, xmm4 }
    if ( quantile <= 0.5 )
    {
      if ( quantile <= *(double *)&_XMM4 )
      {
        *(long double *)&_XMM0 = this->m_min;
        return *(double *)&_XMM0;
      }
      v16 = 0;
      v13 = this->m_processedCentroidsIndex;
      __asm { vxorpd  xmm1, xmm1, xmm1 }
      if ( (int)m_processedCentroidsIndex > 0 )
      {
        v17 = 0i64;
        p_m_weight = &this->m_processedCentroids[0].m_weight;
        while ( 1 )
        {
          *((_QWORD *)&v19 + 1) = *((_QWORD *)&_XMM1 + 1);
          *(double *)&v19 = *(double *)&_XMM1 + *p_m_weight;
          if ( *(double *)&v9 < *(double *)&v19 )
            break;
          ++v16;
          ++v17;
          p_m_weight += 2;
          _XMM1 = v19;
          if ( v17 >= m_processedCentroidsIndex )
            goto LABEL_20;
        }
        v13 = v16;
      }
    }
    else
    {
      if ( quantile >= 1.0 )
      {
        *(long double *)&_XMM0 = this->m_max;
        return *(double *)&_XMM0;
      }
      v11 = m_processedCentroidsIndex - 1;
      v12 = (int)m_processedCentroidsIndex - 1;
      v13 = 0i64;
      if ( (int)m_processedCentroidsIndex - 1 >= 0 )
      {
        v14 = &this->m_processedCentroids[v11].m_weight;
        while ( 1 )
        {
          *((_QWORD *)&v15 + 1) = *((_QWORD *)&_XMM1 + 1);
          *(double *)&v15 = *(double *)&_XMM1 - *v14;
          _XMM1 = v15;
          if ( *(double *)&v9 >= *(double *)&v15 )
            break;
          --v11;
          v14 -= 2;
          if ( --v12 < 0 )
            goto LABEL_20;
        }
        v13 = v11;
      }
    }
LABEL_20:
    m_min = this->m_min;
    m_max = this->m_max;
    if ( (int)m_processedCentroidsIndex > 1 )
    {
      if ( v13 )
      {
        m_min = *((double *)&this->m_unprocessedWeightTotal + 2 * v13);
        if ( v13 == (_DWORD)m_processedCentroidsIndex - 1 )
        {
          *(double *)&_XMM4 = this->m_processedCentroids[v13].m_mean - m_min;
        }
        else
        {
          m_max = this->m_processedCentroids[v13 + 1].m_mean;
          *(double *)&_XMM4 = (m_max - m_min) * 0.5;
        }
      }
      else
      {
        m_max = this->m_processedCentroids[1].m_mean;
        *(double *)&_XMM4 = m_max - this->m_processedCentroids[0].m_mean;
      }
    }
    *((_QWORD *)&v22 + 1) = *((_QWORD *)&v9 + 1);
    *(double *)&v22 = ((*(double *)&v9 - *(double *)&_XMM1) / this->m_processedCentroids[v13].m_weight - 0.5) * *(double *)&_XMM4 + this->m_processedCentroids[v13].m_mean;
    _XMM8 = v22;
    if ( m_min > m_max && CoreAssert_Handler("c:\\workspace\\iw8\\shared\\codware\\core\\core_vector.h", 773, ASSERT_TYPE_SANITY, "( min <= max )", (const char *)&queryFormat, "min <= max") )
      __debugbreak();
    __asm
    {
      vminsd  xmm0, xmm8, xmm6
      vmaxsd  xmm0, xmm0, xmm7
    }
  }
  else
  {
    __asm { vxorpd  xmm0, xmm0, xmm0 }
  }
  return *(double *)&_XMM0;
}

/*
==============
DLogTDigest<20,8>::DLogTDigest<20,8>
==============
*/
void DLogTDigest<20,8>::DLogTDigest<20,8>(DLogTDigest<20,8> *this)
{
  DLogTDigestCentroid *m_processedCentroids; 
  __int64 v3; 
  DLogTDigestCentroid *m_unprocessedCentroidBuffer; 
  __int64 v5; 

  this->m_serializedHeaderByteSize = 22;
  this->m_min = 1.797693134862316e308;
  m_processedCentroids = this->m_processedCentroids;
  this->m_disableAutoMerge = 0;
  this->m_max = 2.225073858507201e-308;
  this->m_processedWeightTotal = 0.0;
  this->m_unprocessedWeightTotal = 0.0;
  *(_QWORD *)&this->m_unprocessedCentroidBufferIndex = 0i64;
  v3 = 20i64;
  do
  {
    DLogTDigestCentroid::DLogTDigestCentroid(m_processedCentroids++);
    --v3;
  }
  while ( v3 );
  m_unprocessedCentroidBuffer = this->m_unprocessedCentroidBuffer;
  v5 = 160i64;
  do
  {
    DLogTDigestCentroid::DLogTDigestCentroid(m_unprocessedCentroidBuffer++);
    --v5;
  }
  while ( v5 );
}

/*
==============
DLogTDigest<32,8>::DLogTDigest<32,8>
==============
*/
void DLogTDigest<32,8>::DLogTDigest<32,8>(DLogTDigest<32,8> *this)
{
  DLogTDigestCentroid *m_processedCentroids; 
  __int64 v3; 
  DLogTDigestCentroid *m_unprocessedCentroidBuffer; 
  __int64 v5; 

  this->m_serializedHeaderByteSize = 22;
  this->m_min = 1.797693134862316e308;
  m_processedCentroids = this->m_processedCentroids;
  this->m_disableAutoMerge = 0;
  this->m_max = 2.225073858507201e-308;
  this->m_processedWeightTotal = 0.0;
  this->m_unprocessedWeightTotal = 0.0;
  *(_QWORD *)&this->m_unprocessedCentroidBufferIndex = 0i64;
  v3 = 32i64;
  do
  {
    DLogTDigestCentroid::DLogTDigestCentroid(m_processedCentroids++);
    --v3;
  }
  while ( v3 );
  m_unprocessedCentroidBuffer = this->m_unprocessedCentroidBuffer;
  v5 = 256i64;
  do
  {
    DLogTDigestCentroid::DLogTDigestCentroid(m_unprocessedCentroidBuffer++);
    --v5;
  }
  while ( v5 );
}

/*
==============
DLogTDigestCentroid::DLogTDigestCentroid
==============
*/
void DLogTDigestCentroid::DLogTDigestCentroid(DLogTDigestCentroid *this)
{
  this->m_mean = 0.0;
  this->m_weight = 0.0;
}

/*
==============
DLogTDigest<16,8>::Add
==============
*/

void __fastcall DLogTDigest<16,8>::Add(DLogTDigest<16,8> *this, double value, long double weight)
{
  int m_unprocessedCentroidBufferIndex; 
  __int64 v11; 
  long double v14; 

  m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
  _XMM6 = *(_OWORD *)&value;
  if ( (unsigned int)m_unprocessedCentroidBufferIndex < 0x70 )
    goto LABEL_4;
  if ( !this->m_disableAutoMerge )
  {
    DLogTDigest<16,8>::ProcessBufferedCentroids(this);
    m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
LABEL_4:
    _XMM1 = *(unsigned __int64 *)&this->m_min;
    __asm
    {
      vcmpltsd xmm0, xmm6, xmm1
      vblendvpd xmm1, xmm1, xmm6, xmm0
    }
    this->m_min = *(double *)&_XMM1;
    _XMM2 = *(unsigned __int64 *)&this->m_max;
    v11 = 2 * (m_unprocessedCentroidBufferIndex + 19i64);
    __asm
    {
      vcmpltsd xmm0, xmm2, xmm6
      vblendvpd xmm1, xmm2, xmm6, xmm0
    }
    this->m_max = *(double *)&_XMM1;
    *((double *)&this->m_min + v11) = *(double *)&_XMM6;
    *(&this->m_max + v11) = weight;
    v14 = weight + this->m_unprocessedWeightTotal;
    ++this->m_unprocessedCentroidBufferIndex;
    this->m_unprocessedWeightTotal = v14;
    return;
  }
  DLog_PrintError("Auto merge disabled - centroid buffer overflow\n");
}

/*
==============
DLogTDigest<32,8>::Add
==============
*/

void __fastcall DLogTDigest<32,8>::Add(DLogTDigest<32,8> *this, double value, long double weight)
{
  int m_unprocessedCentroidBufferIndex; 
  __int64 v11; 
  long double v14; 

  m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
  _XMM6 = *(_OWORD *)&value;
  if ( (unsigned int)m_unprocessedCentroidBufferIndex < 0xE0 )
    goto LABEL_4;
  if ( !this->m_disableAutoMerge )
  {
    DLogTDigest<32,8>::ProcessBufferedCentroids(this);
    m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
LABEL_4:
    _XMM1 = *(unsigned __int64 *)&this->m_min;
    __asm
    {
      vcmpltsd xmm0, xmm6, xmm1
      vblendvpd xmm1, xmm1, xmm6, xmm0
    }
    this->m_min = *(double *)&_XMM1;
    _XMM2 = *(unsigned __int64 *)&this->m_max;
    v11 = 2 * (m_unprocessedCentroidBufferIndex + 35i64);
    __asm
    {
      vcmpltsd xmm0, xmm2, xmm6
      vblendvpd xmm1, xmm2, xmm6, xmm0
    }
    this->m_max = *(double *)&_XMM1;
    *((double *)&this->m_min + v11) = *(double *)&_XMM6;
    *(&this->m_max + v11) = weight;
    v14 = weight + this->m_unprocessedWeightTotal;
    ++this->m_unprocessedCentroidBufferIndex;
    this->m_unprocessedWeightTotal = v14;
    return;
  }
  DLog_PrintError("Auto merge disabled - centroid buffer overflow\n");
}

/*
==============
DLogTDigest<16,8>::ProcessBufferedCentroids
==============
*/
void DLogTDigest<16,8>::ProcessBufferedCentroids(DLogTDigest<16,8> *this)
{
  __int64 m_unprocessedCentroidBufferIndex; 
  DLogTDigestCentroid *m_processedCentroids; 
  DLogTDigestCentroid *v5; 
  int v6; 
  long double v7; 
  int v8; 
  double v9; 
  double m_weight; 
  double m_mean; 
  __int128 v12; 
  DLogTDigestCentroid *v18; 
  __int128 v19; 
  double v20; 
  double v21; 
  __int128 v22; 
  __int128 v23; 
  double v24; 
  double v25; 
  __int64 v26; 
  double v27; 
  bool v28; 
  __int128 v29; 
  double v30; 
  double v31; 
  double v32; 
  __int64 v33; 
  DLogTDigestCentroid *v34; 

  m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
  if ( (_DWORD)m_unprocessedCentroidBufferIndex )
  {
    m_processedCentroids = this->m_processedCentroids;
    v5 = &this->m_unprocessedCentroidBuffer[m_unprocessedCentroidBufferIndex];
    std::_Ptr_copy_cat<DLogTDigestCentroid,DLogTDigestCentroid>(&v34, &v34);
    memmove_0(v5, m_processedCentroids, (size_t)this + 16 * (this->m_processedCentroidsIndex + 3i64) - (_QWORD)m_processedCentroids);
    std::_Sort_unchecked<DLogTDigestCentroid *,std::less<void>>(this->m_unprocessedCentroidBuffer, &this->m_unprocessedCentroidBuffer[this->m_processedCentroidsIndex + (__int64)this->m_unprocessedCentroidBufferIndex], (16 * (this->m_processedCentroidsIndex + (__int64)this->m_unprocessedCentroidBufferIndex + 19) - 304) >> 4, (std::less<void>)v34);
    v6 = 1;
    this->m_unprocessedCentroidBufferIndex += this->m_processedCentroidsIndex;
    v7 = this->m_processedWeightTotal + this->m_unprocessedWeightTotal;
    v8 = this->m_unprocessedCentroidBufferIndex;
    v9 = v7 * 0.0078125;
    this->m_processedWeightTotal = v7;
    this->m_unprocessedWeightTotal = 0.0;
    this->m_processedCentroidsIndex = 0;
    m_weight = this->m_unprocessedCentroidBuffer[0].m_weight;
    m_mean = this->m_unprocessedCentroidBuffer[0].m_mean;
    v12 = *(unsigned __int64 *)&m_weight;
    __asm
    {
      vxorpd  xmm14, xmm14, xmm14
      vxorpd  xmm4, xmm4, xmm4
      vxorpd  xmm5, xmm5, xmm5
    }
    if ( v8 - 1 >= 1 )
    {
      v18 = &this->m_unprocessedCentroidBuffer[1];
      v19 = *(unsigned __int64 *)&DOUBLE_2_0;
      do
      {
        v20 = v18->m_weight;
        v21 = v18->m_mean;
        *((_QWORD *)&v22 + 1) = *((_QWORD *)&v12 + 1);
        *(double *)&v22 = *(double *)&v12 + v20;
        v12 = v22;
        if ( *(double *)&v22 > v9 )
        {
          v24 = m_weight + *(double *)&_XMM5;
          v25 = (m_weight * m_mean + *(double *)&_XMM4) / (m_weight + *(double *)&_XMM5);
          DLog_Assert(this->m_processedCentroidsIndex < 0x10u, "m_processedCentroidsIndex < ARRAY_COUNT( m_processedCentroids )", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<16,8>::ProcessBufferedCentroids", 280);
          v26 = 2 * (this->m_processedCentroidsIndex + 3i64);
          v27 = *(double *)&v19 * 0.0625;
          _XMM4 = _XMM14;
          *((double *)&this->m_min + v26) = v25;
          *((double *)&this->m_max + v26) = v24;
          ++this->m_processedCentroidsIndex;
          v28 = *(double *)&v19 * 0.0625 < 0.5;
          _XMM5 = _XMM14;
          *((_QWORD *)&v29 + 1) = *((_QWORD *)&v19 + 1);
          *(double *)&v29 = *(double *)&v19 + 1.0;
          v19 = v29;
          if ( v28 )
            v30 = v27 * 2.0 * v27;
          else
            v30 = 1.0 - (1.0 - v27) * 2.0 * (1.0 - v27);
          v9 = v30 * this->m_processedWeightTotal;
          m_mean = v21;
          m_weight = v20;
        }
        else
        {
          *((_QWORD *)&v23 + 1) = *((_QWORD *)&_XMM4 + 1);
          *(double *)&v23 = *(double *)&_XMM4 + v20 * v21;
          _XMM4 = v23;
          *((_QWORD *)&v23 + 1) = *((_QWORD *)&_XMM5 + 1);
          *(double *)&v23 = *(double *)&_XMM5 + v20;
          _XMM5 = v23;
        }
        ++v6;
        ++v18;
      }
      while ( v6 <= this->m_unprocessedCentroidBufferIndex - 1 );
    }
    if ( m_weight > *(double *)&_XMM14 )
    {
      v31 = m_weight + *(double *)&_XMM5;
      v32 = (m_weight * m_mean + *(double *)&_XMM4) / (m_weight + *(double *)&_XMM5);
      DLog_Assert(this->m_processedCentroidsIndex < 0x10u, "m_processedCentroidsIndex < ARRAY_COUNT( m_processedCentroids )", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<16,8>::ProcessBufferedCentroids", 299);
      v33 = 2 * (this->m_processedCentroidsIndex + 3i64);
      *((double *)&this->m_min + v33) = v32;
      *((double *)&this->m_max + v33) = v31;
      ++this->m_processedCentroidsIndex;
    }
    this->m_unprocessedCentroidBufferIndex = 0;
  }
}

/*
==============
DLogTDigest<32,8>::ProcessBufferedCentroids
==============
*/
void DLogTDigest<32,8>::ProcessBufferedCentroids(DLogTDigest<32,8> *this)
{
  __int64 m_unprocessedCentroidBufferIndex; 
  DLogTDigestCentroid *m_processedCentroids; 
  DLogTDigestCentroid *v5; 
  int v6; 
  long double v7; 
  int v8; 
  double v9; 
  double m_weight; 
  double m_mean; 
  __int128 v12; 
  DLogTDigestCentroid *v18; 
  __int128 v19; 
  double v20; 
  double v21; 
  __int128 v22; 
  __int128 v23; 
  double v24; 
  double v25; 
  __int64 v26; 
  double v27; 
  bool v28; 
  __int128 v29; 
  double v30; 
  double v31; 
  double v32; 
  __int64 v33; 
  DLogTDigestCentroid *v34; 

  m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
  if ( (_DWORD)m_unprocessedCentroidBufferIndex )
  {
    m_processedCentroids = this->m_processedCentroids;
    v5 = &this->m_unprocessedCentroidBuffer[m_unprocessedCentroidBufferIndex];
    std::_Ptr_copy_cat<DLogTDigestCentroid,DLogTDigestCentroid>(&v34, &v34);
    memmove_0(v5, m_processedCentroids, (size_t)this + 16 * (this->m_processedCentroidsIndex + 3i64) - (_QWORD)m_processedCentroids);
    std::_Sort_unchecked<DLogTDigestCentroid *,std::less<void>>(this->m_unprocessedCentroidBuffer, &this->m_unprocessedCentroidBuffer[this->m_processedCentroidsIndex + (__int64)this->m_unprocessedCentroidBufferIndex], (16 * (this->m_processedCentroidsIndex + (__int64)this->m_unprocessedCentroidBufferIndex + 35) - 560) >> 4, (std::less<void>)v34);
    v6 = 1;
    this->m_unprocessedCentroidBufferIndex += this->m_processedCentroidsIndex;
    v7 = this->m_processedWeightTotal + this->m_unprocessedWeightTotal;
    v8 = this->m_unprocessedCentroidBufferIndex;
    v9 = v7 * 0.001953125;
    this->m_processedWeightTotal = v7;
    this->m_unprocessedWeightTotal = 0.0;
    this->m_processedCentroidsIndex = 0;
    m_weight = this->m_unprocessedCentroidBuffer[0].m_weight;
    m_mean = this->m_unprocessedCentroidBuffer[0].m_mean;
    v12 = *(unsigned __int64 *)&m_weight;
    __asm
    {
      vxorpd  xmm14, xmm14, xmm14
      vxorpd  xmm4, xmm4, xmm4
      vxorpd  xmm5, xmm5, xmm5
    }
    if ( v8 - 1 >= 1 )
    {
      v18 = &this->m_unprocessedCentroidBuffer[1];
      v19 = *(unsigned __int64 *)&DOUBLE_2_0;
      do
      {
        v20 = v18->m_weight;
        v21 = v18->m_mean;
        *((_QWORD *)&v22 + 1) = *((_QWORD *)&v12 + 1);
        *(double *)&v22 = *(double *)&v12 + v20;
        v12 = v22;
        if ( *(double *)&v22 > v9 )
        {
          v24 = m_weight + *(double *)&_XMM5;
          v25 = (m_weight * m_mean + *(double *)&_XMM4) / (m_weight + *(double *)&_XMM5);
          DLog_Assert(this->m_processedCentroidsIndex < 0x20u, "m_processedCentroidsIndex < ARRAY_COUNT( m_processedCentroids )", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<32,8>::ProcessBufferedCentroids", 280);
          v26 = 2 * (this->m_processedCentroidsIndex + 3i64);
          v27 = *(double *)&v19 * 0.03125;
          _XMM4 = _XMM14;
          *((double *)&this->m_min + v26) = v25;
          *((double *)&this->m_max + v26) = v24;
          ++this->m_processedCentroidsIndex;
          v28 = *(double *)&v19 * 0.03125 < 0.5;
          _XMM5 = _XMM14;
          *((_QWORD *)&v29 + 1) = *((_QWORD *)&v19 + 1);
          *(double *)&v29 = *(double *)&v19 + 1.0;
          v19 = v29;
          if ( v28 )
            v30 = v27 * 2.0 * v27;
          else
            v30 = 1.0 - (1.0 - v27) * 2.0 * (1.0 - v27);
          v9 = v30 * this->m_processedWeightTotal;
          m_mean = v21;
          m_weight = v20;
        }
        else
        {
          *((_QWORD *)&v23 + 1) = *((_QWORD *)&_XMM4 + 1);
          *(double *)&v23 = *(double *)&_XMM4 + v20 * v21;
          _XMM4 = v23;
          *((_QWORD *)&v23 + 1) = *((_QWORD *)&_XMM5 + 1);
          *(double *)&v23 = *(double *)&_XMM5 + v20;
          _XMM5 = v23;
        }
        ++v6;
        ++v18;
      }
      while ( v6 <= this->m_unprocessedCentroidBufferIndex - 1 );
    }
    if ( m_weight > *(double *)&_XMM14 )
    {
      v31 = m_weight + *(double *)&_XMM5;
      v32 = (m_weight * m_mean + *(double *)&_XMM4) / (m_weight + *(double *)&_XMM5);
      DLog_Assert(this->m_processedCentroidsIndex < 0x20u, "m_processedCentroidsIndex < ARRAY_COUNT( m_processedCentroids )", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<32,8>::ProcessBufferedCentroids", 299);
      v33 = 2 * (this->m_processedCentroidsIndex + 3i64);
      *((double *)&this->m_min + v33) = v32;
      *((double *)&this->m_max + v33) = v31;
      ++this->m_processedCentroidsIndex;
    }
    this->m_unprocessedCentroidBufferIndex = 0;
  }
}

/*
==============
DLogTDigest<16,8>::Reset
==============
*/
void DLogTDigest<16,8>::Reset(DLogTDigest<16,8> *this)
{
  this->m_min = 1.797693134862316e308;
  this->m_max = 2.225073858507201e-308;
  this->m_processedWeightTotal = 0.0;
  this->m_unprocessedWeightTotal = 0.0;
  *(_QWORD *)&this->m_unprocessedCentroidBufferIndex = 0i64;
  memset_0(this->m_processedCentroids, 0, 0x900ui64);
}

/*
==============
DLogTDigest<16,8>::SerializeToProtobuf
==============
*/
unsigned __int64 DLogTDigest<16,8>::SerializeToProtobuf(DLogTDigest<16,8> *this, unsigned __int8 *outBuffer, unsigned __int64 bufferSize)
{
  bool v6; 
  int v7; 
  int v8; 
  long double *p_m_weight; 
  DLogTDigestCentroid *m_processedCentroids; 
  ProtobufSerializer v16; 

  DLog_Assert(bufferSize >= 0x9E, "GetSerializedByteSize() <= bufferSize", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<16,8>::SerializeToProtobuf", 398);
  DLogTDigest<16,8>::ProcessBufferedCentroids(this);
  ProtobufSerializer::ProtobufSerializer(&v16, outBuffer, bufferSize);
  v6 = ProtobufSerializer::UInt64(&v16, 1ui64, 1ui64) && ProtobufSerializer::Float64(&v16, 2ui64, this->m_min) && ProtobufSerializer::Float64(&v16, 3ui64, this->m_max) && ProtobufSerializer::Int32(&v16, 4ui64, this->m_processedCentroidsIndex + 1);
  ProtobufSerializer::BeginPacked(&v16, 5ui64);
  v7 = 0;
  v8 = 0;
  if ( this->m_processedCentroidsIndex > 0 )
  {
    p_m_weight = &this->m_processedCentroids[0].m_weight;
    do
    {
      if ( !v6 )
        goto LABEL_12;
      _XMM2 = *(unsigned __int64 *)p_m_weight;
      __asm { vcvtpd2ps xmm2, xmm2; value }
      if ( ProtobufSerializer::Float32(&v16, 5ui64, *(float *)&_XMM2) )
        v6 = 1;
      else
LABEL_12:
        v6 = 0;
      ++v8;
      p_m_weight += 2;
    }
    while ( v8 < this->m_processedCentroidsIndex );
  }
  ProtobufSerializer::EndPacked(&v16);
  ProtobufSerializer::BeginPacked(&v16, 6ui64);
  if ( this->m_processedCentroidsIndex > 0 )
  {
    m_processedCentroids = this->m_processedCentroids;
    do
    {
      if ( !v6 )
        goto LABEL_19;
      _XMM2 = *(unsigned __int64 *)&m_processedCentroids->m_mean;
      __asm { vcvtpd2ps xmm2, xmm2; value }
      if ( ProtobufSerializer::Float32(&v16, 6ui64, *(float *)&_XMM2) )
        v6 = 1;
      else
LABEL_19:
        v6 = 0;
      ++v7;
      ++m_processedCentroids;
    }
    while ( v7 < this->m_processedCentroidsIndex );
  }
  ProtobufSerializer::EndPacked(&v16);
  return ProtobufSerializer::Size(&v16);
}

/*
==============
DLogTDigest<32,8>::SerializeToProtobuf
==============
*/
unsigned __int64 DLogTDigest<32,8>::SerializeToProtobuf(DLogTDigest<32,8> *this, unsigned __int8 *outBuffer, unsigned __int64 bufferSize)
{
  bool v6; 
  int v7; 
  int v8; 
  long double *p_m_weight; 
  DLogTDigestCentroid *m_processedCentroids; 
  ProtobufSerializer v16; 

  DLog_Assert(bufferSize >= 0x11E, "GetSerializedByteSize() <= bufferSize", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<32,8>::SerializeToProtobuf", 398);
  DLogTDigest<32,8>::ProcessBufferedCentroids(this);
  ProtobufSerializer::ProtobufSerializer(&v16, outBuffer, bufferSize);
  v6 = ProtobufSerializer::UInt64(&v16, 1ui64, 1ui64) && ProtobufSerializer::Float64(&v16, 2ui64, this->m_min) && ProtobufSerializer::Float64(&v16, 3ui64, this->m_max) && ProtobufSerializer::Int32(&v16, 4ui64, this->m_processedCentroidsIndex + 1);
  ProtobufSerializer::BeginPacked(&v16, 5ui64);
  v7 = 0;
  v8 = 0;
  if ( this->m_processedCentroidsIndex > 0 )
  {
    p_m_weight = &this->m_processedCentroids[0].m_weight;
    do
    {
      if ( !v6 )
        goto LABEL_12;
      _XMM2 = *(unsigned __int64 *)p_m_weight;
      __asm { vcvtpd2ps xmm2, xmm2; value }
      if ( ProtobufSerializer::Float32(&v16, 5ui64, *(float *)&_XMM2) )
        v6 = 1;
      else
LABEL_12:
        v6 = 0;
      ++v8;
      p_m_weight += 2;
    }
    while ( v8 < this->m_processedCentroidsIndex );
  }
  ProtobufSerializer::EndPacked(&v16);
  ProtobufSerializer::BeginPacked(&v16, 6ui64);
  if ( this->m_processedCentroidsIndex > 0 )
  {
    m_processedCentroids = this->m_processedCentroids;
    do
    {
      if ( !v6 )
        goto LABEL_19;
      _XMM2 = *(unsigned __int64 *)&m_processedCentroids->m_mean;
      __asm { vcvtpd2ps xmm2, xmm2; value }
      if ( ProtobufSerializer::Float32(&v16, 6ui64, *(float *)&_XMM2) )
        v6 = 1;
      else
LABEL_19:
        v6 = 0;
      ++v7;
      ++m_processedCentroids;
    }
    while ( v7 < this->m_processedCentroidsIndex );
  }
  ProtobufSerializer::EndPacked(&v16);
  return ProtobufSerializer::Size(&v16);
}

/*
==============
DLogTDigest<100,8>::ProcessBufferedCentroids
==============
*/
void DLogTDigest<100,8>::ProcessBufferedCentroids(DLogTDigest<100,8> *this)
{
  __int64 m_unprocessedCentroidBufferIndex; 
  DLogTDigestCentroid *m_processedCentroids; 
  DLogTDigestCentroid *v5; 
  int v6; 
  long double v7; 
  int v8; 
  double v9; 
  double m_weight; 
  double m_mean; 
  __int128 v12; 
  DLogTDigestCentroid *v18; 
  __int128 v19; 
  double v20; 
  double v21; 
  __int128 v22; 
  __int128 v23; 
  double v24; 
  double v25; 
  __int64 v26; 
  double v27; 
  bool v28; 
  __int128 v29; 
  double v30; 
  double v31; 
  double v32; 
  __int64 v33; 
  DLogTDigestCentroid *v34; 

  m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
  if ( (_DWORD)m_unprocessedCentroidBufferIndex )
  {
    m_processedCentroids = this->m_processedCentroids;
    v5 = &this->m_unprocessedCentroidBuffer[m_unprocessedCentroidBufferIndex];
    std::_Ptr_copy_cat<DLogTDigestCentroid,DLogTDigestCentroid>(&v34, &v34);
    memmove_0(v5, m_processedCentroids, (size_t)this + 16 * (this->m_processedCentroidsIndex + 3i64) - (_QWORD)m_processedCentroids);
    std::_Sort_unchecked<DLogTDigestCentroid *,std::less<void>>(this->m_unprocessedCentroidBuffer, &this->m_unprocessedCentroidBuffer[this->m_processedCentroidsIndex + (__int64)this->m_unprocessedCentroidBufferIndex], (16 * (this->m_processedCentroidsIndex + (__int64)this->m_unprocessedCentroidBufferIndex + 103) - 1648) >> 4, (std::less<void>)v34);
    v6 = 1;
    this->m_unprocessedCentroidBufferIndex += this->m_processedCentroidsIndex;
    v7 = this->m_processedWeightTotal + this->m_unprocessedWeightTotal;
    v8 = this->m_unprocessedCentroidBufferIndex;
    v9 = v7 * 0.0002;
    this->m_processedWeightTotal = v7;
    this->m_unprocessedWeightTotal = 0.0;
    this->m_processedCentroidsIndex = 0;
    m_weight = this->m_unprocessedCentroidBuffer[0].m_weight;
    m_mean = this->m_unprocessedCentroidBuffer[0].m_mean;
    v12 = *(unsigned __int64 *)&m_weight;
    __asm
    {
      vxorpd  xmm14, xmm14, xmm14
      vxorpd  xmm4, xmm4, xmm4
      vxorpd  xmm5, xmm5, xmm5
    }
    if ( v8 - 1 >= 1 )
    {
      v18 = &this->m_unprocessedCentroidBuffer[1];
      v19 = *(unsigned __int64 *)&DOUBLE_2_0;
      do
      {
        v20 = v18->m_weight;
        v21 = v18->m_mean;
        *((_QWORD *)&v22 + 1) = *((_QWORD *)&v12 + 1);
        *(double *)&v22 = *(double *)&v12 + v20;
        v12 = v22;
        if ( *(double *)&v22 > v9 )
        {
          v24 = m_weight + *(double *)&_XMM5;
          v25 = (m_weight * m_mean + *(double *)&_XMM4) / (m_weight + *(double *)&_XMM5);
          DLog_Assert(this->m_processedCentroidsIndex < 0x64u, "m_processedCentroidsIndex < ARRAY_COUNT( m_processedCentroids )", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<100,8>::ProcessBufferedCentroids", 280);
          v26 = 2 * (this->m_processedCentroidsIndex + 3i64);
          v27 = *(double *)&v19 * 0.01;
          _XMM4 = _XMM14;
          *((double *)&this->m_min + v26) = v25;
          *((double *)&this->m_max + v26) = v24;
          ++this->m_processedCentroidsIndex;
          v28 = *(double *)&v19 * 0.01 < 0.5;
          _XMM5 = _XMM14;
          *((_QWORD *)&v29 + 1) = *((_QWORD *)&v19 + 1);
          *(double *)&v29 = *(double *)&v19 + 1.0;
          v19 = v29;
          if ( v28 )
            v30 = v27 * 2.0 * v27;
          else
            v30 = 1.0 - (1.0 - v27) * 2.0 * (1.0 - v27);
          v9 = v30 * this->m_processedWeightTotal;
          m_mean = v21;
          m_weight = v20;
        }
        else
        {
          *((_QWORD *)&v23 + 1) = *((_QWORD *)&_XMM4 + 1);
          *(double *)&v23 = *(double *)&_XMM4 + v20 * v21;
          _XMM4 = v23;
          *((_QWORD *)&v23 + 1) = *((_QWORD *)&_XMM5 + 1);
          *(double *)&v23 = *(double *)&_XMM5 + v20;
          _XMM5 = v23;
        }
        ++v6;
        ++v18;
      }
      while ( v6 <= this->m_unprocessedCentroidBufferIndex - 1 );
    }
    if ( m_weight > *(double *)&_XMM14 )
    {
      v31 = m_weight + *(double *)&_XMM5;
      v32 = (m_weight * m_mean + *(double *)&_XMM4) / (m_weight + *(double *)&_XMM5);
      DLog_Assert(this->m_processedCentroidsIndex < 0x64u, "m_processedCentroidsIndex < ARRAY_COUNT( m_processedCentroids )", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<100,8>::ProcessBufferedCentroids", 299);
      v33 = 2 * (this->m_processedCentroidsIndex + 3i64);
      *((double *)&this->m_min + v33) = v32;
      *((double *)&this->m_max + v33) = v31;
      ++this->m_processedCentroidsIndex;
    }
    this->m_unprocessedCentroidBufferIndex = 0;
  }
}

/*
==============
DLogTDigest<100,8>::Reset
==============
*/
void DLogTDigest<100,8>::Reset(DLogTDigest<100,8> *this)
{
  this->m_min = 1.797693134862316e308;
  this->m_max = 2.225073858507201e-308;
  this->m_processedWeightTotal = 0.0;
  this->m_unprocessedWeightTotal = 0.0;
  *(_QWORD *)&this->m_unprocessedCentroidBufferIndex = 0i64;
  memset_0(this->m_processedCentroids, 0, 0x3840ui64);
}

/*
==============
DLogTDigest<100,8>::SerializeToProtobuf
==============
*/
unsigned __int64 DLogTDigest<100,8>::SerializeToProtobuf(DLogTDigest<100,8> *this, unsigned __int8 *outBuffer, unsigned __int64 bufferSize)
{
  bool v6; 
  int v7; 
  int v8; 
  long double *p_m_weight; 
  DLogTDigestCentroid *m_processedCentroids; 
  ProtobufSerializer v16; 

  DLog_Assert(bufferSize >= 0x33E, "GetSerializedByteSize() <= bufferSize", "c:\\workspace\\iw8\\code_source\\src\\dlog\\dlog_tdigest.h", "DLogTDigest<100,8>::SerializeToProtobuf", 398);
  DLogTDigest<100,8>::ProcessBufferedCentroids(this);
  ProtobufSerializer::ProtobufSerializer(&v16, outBuffer, bufferSize);
  v6 = ProtobufSerializer::UInt64(&v16, 1ui64, 1ui64) && ProtobufSerializer::Float64(&v16, 2ui64, this->m_min) && ProtobufSerializer::Float64(&v16, 3ui64, this->m_max) && ProtobufSerializer::Int32(&v16, 4ui64, this->m_processedCentroidsIndex + 1);
  ProtobufSerializer::BeginPacked(&v16, 5ui64);
  v7 = 0;
  v8 = 0;
  if ( this->m_processedCentroidsIndex > 0 )
  {
    p_m_weight = &this->m_processedCentroids[0].m_weight;
    do
    {
      if ( !v6 )
        goto LABEL_12;
      _XMM2 = *(unsigned __int64 *)p_m_weight;
      __asm { vcvtpd2ps xmm2, xmm2; value }
      if ( ProtobufSerializer::Float32(&v16, 5ui64, *(float *)&_XMM2) )
        v6 = 1;
      else
LABEL_12:
        v6 = 0;
      ++v8;
      p_m_weight += 2;
    }
    while ( v8 < this->m_processedCentroidsIndex );
  }
  ProtobufSerializer::EndPacked(&v16);
  ProtobufSerializer::BeginPacked(&v16, 6ui64);
  if ( this->m_processedCentroidsIndex > 0 )
  {
    m_processedCentroids = this->m_processedCentroids;
    do
    {
      if ( !v6 )
        goto LABEL_19;
      _XMM2 = *(unsigned __int64 *)&m_processedCentroids->m_mean;
      __asm { vcvtpd2ps xmm2, xmm2; value }
      if ( ProtobufSerializer::Float32(&v16, 6ui64, *(float *)&_XMM2) )
        v6 = 1;
      else
LABEL_19:
        v6 = 0;
      ++v7;
      ++m_processedCentroids;
    }
    while ( v7 < this->m_processedCentroidsIndex );
  }
  ProtobufSerializer::EndPacked(&v16);
  return ProtobufSerializer::Size(&v16);
}

/*
==============
DLogTDigest<100,8>::Add
==============
*/

void __fastcall DLogTDigest<100,8>::Add(DLogTDigest<100,8> *this, double value, long double weight)
{
  int m_unprocessedCentroidBufferIndex; 
  __int64 v11; 
  long double v14; 

  m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
  _XMM6 = *(_OWORD *)&value;
  if ( (unsigned int)m_unprocessedCentroidBufferIndex < 0x2BC )
    goto LABEL_4;
  if ( !this->m_disableAutoMerge )
  {
    DLogTDigest<100,8>::ProcessBufferedCentroids(this);
    m_unprocessedCentroidBufferIndex = this->m_unprocessedCentroidBufferIndex;
LABEL_4:
    _XMM1 = *(unsigned __int64 *)&this->m_min;
    __asm
    {
      vcmpltsd xmm0, xmm6, xmm1
      vblendvpd xmm1, xmm1, xmm6, xmm0
    }
    this->m_min = *(double *)&_XMM1;
    _XMM2 = *(unsigned __int64 *)&this->m_max;
    v11 = 2 * (m_unprocessedCentroidBufferIndex + 103i64);
    __asm
    {
      vcmpltsd xmm0, xmm2, xmm6
      vblendvpd xmm1, xmm2, xmm6, xmm0
    }
    this->m_max = *(double *)&_XMM1;
    *((double *)&this->m_min + v11) = *(double *)&_XMM6;
    *(&this->m_max + v11) = weight;
    v14 = weight + this->m_unprocessedWeightTotal;
    ++this->m_unprocessedCentroidBufferIndex;
    this->m_unprocessedWeightTotal = v14;
    return;
  }
  DLog_PrintError("Auto merge disabled - centroid buffer overflow\n");
}

/*
==============
DLogTDigest<32,8>::Reset
==============
*/
void DLogTDigest<32,8>::Reset(DLogTDigest<32,8> *this)
{
  this->m_min = 1.797693134862316e308;
  this->m_max = 2.225073858507201e-308;
  this->m_processedWeightTotal = 0.0;
  this->m_unprocessedWeightTotal = 0.0;
  *(_QWORD *)&this->m_unprocessedCentroidBufferIndex = 0i64;
  memset_0(this->m_processedCentroids, 0, 0x1200ui64);
}

