/*
==============
ScrAgentCmd_RelinquishClaimedNode
==============
*/

void __fastcall ScrAgentCmd_RelinquishClaimedNode(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_RelinquishClaimedNode@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetGoalRadius
==============
*/

void __fastcall ScrAgentCmd_SetGoalRadius(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetGoalRadius@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_SetAgentBounds
==============
*/

void __fastcall AgentCmd_SetAgentBounds(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_SetAgentBounds@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_DoAnimRelative
==============
*/

void __fastcall ScrAgentCmd_DoAnimRelative(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_DoAnimRelative@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_AgentClearScriptVars
==============
*/

void __fastcall AgentCmd_AgentClearScriptVars(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_AgentClearScriptVars@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetMaxTurnSpeed
==============
*/

void __fastcall ScrAgentCmd_SetMaxTurnSpeed(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetMaxTurnSpeed@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_SetCorpseModel
==============
*/

void __fastcall AgentCmd_SetCorpseModel(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_SetCorpseModel@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_GetMaxTurnSpeed
==============
*/

void __fastcall ScrAgentCmd_GetMaxTurnSpeed(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_GetMaxTurnSpeed@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_DeSpawnAgent
==============
*/

void __fastcall AgentCmd_DeSpawnAgent(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_DeSpawnAgent@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_GetPathGoalPos
==============
*/

void __fastcall ScrAgentCmd_GetPathGoalPos(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_GetPathGoalPos@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_FinishAgentDamage
==============
*/

void __fastcall AgentCmd_FinishAgentDamage(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_FinishAgentDamage@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_CloneAgent
==============
*/

void __fastcall AgentCmd_CloneAgent(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_CloneAgent@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetPhysicsMode
==============
*/

void __fastcall ScrAgentCmd_SetPhysicsMode(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetPhysicsMode@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetOrientMode
==============
*/

void __fastcall ScrAgentCmd_SetOrientMode(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetOrientMode@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetUnitType
==============
*/

void __fastcall ScrAgentCmd_SetUnitType(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetUnitType@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_AgentCanSeeSentient
==============
*/

void __fastcall AgentCmd_AgentCanSeeSentient(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_AgentCanSeeSentient@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_GetGoalPos
==============
*/

void __fastcall ScrAgentCmd_GetGoalPos(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_GetGoalPos@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetWallRunCost
==============
*/

void __fastcall ScrAgentCmd_SetWallRunCost(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetWallRunCost@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetClipMode
==============
*/

void __fastcall ScrAgentCmd_SetClipMode(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetClipMode@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetScripted
==============
*/

void __fastcall ScrAgentCmd_SetScripted(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetScripted@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetAnimScale
==============
*/

void __fastcall ScrAgentCmd_SetAnimScale(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetAnimScale@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetGoalEntity
==============
*/

void __fastcall ScrAgentCmd_SetGoalEntity(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetGoalEntity@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_ClaimNode
==============
*/

void __fastcall ScrAgentCmd_ClaimNode(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_ClaimNode@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_SetAgentAttacker
==============
*/

void __fastcall AgentCmd_SetAgentAttacker(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_SetAgentAttacker@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_AgentSetClipMode
==============
*/

void __fastcall AgentCmd_AgentSetClipMode(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_AgentSetClipMode@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_BeginMelee
==============
*/

void __fastcall ScrAgentCmd_BeginMelee(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_BeginMelee@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetGoalPos
==============
*/

void __fastcall ScrAgentCmd_SetGoalPos(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetGoalPos@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetGoalNode
==============
*/

void __fastcall ScrAgentCmd_SetGoalNode(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetGoalNode@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetViewHeight
==============
*/

void __fastcall ScrAgentCmd_SetViewHeight(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetViewHeight@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_AgentSetFavoriteEnemy
==============
*/

void __fastcall AgentCmd_AgentSetFavoriteEnemy(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_AgentSetFavoriteEnemy@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_DoTrajectory
==============
*/

void __fastcall ScrAgentCmd_DoTrajectory(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_DoTrajectory@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_SetWaypoint
==============
*/

void __fastcall ScrAgentCmd_SetWaypoint(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetWaypoint@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_IsStuck
==============
*/

void __fastcall ScrAgentCmd_IsStuck(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_IsStuck@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_GetLookaheadDir
==============
*/

void __fastcall ScrAgentCmd_GetLookaheadDir(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_GetLookaheadDir@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_RequestStopSoonNotify
==============
*/

void __fastcall ScrAgentCmd_RequestStopSoonNotify(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_RequestStopSoonNotify@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_DoAnimLerp
==============
*/

void __fastcall ScrAgentCmd_DoAnimLerp(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_DoAnimLerp@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
ScrAgentCmd_UseModelCollisionBounds
==============
*/

void __fastcall ScrAgentCmd_UseModelCollisionBounds(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_UseModelCollisionBounds@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_SpawnAgent
==============
*/

void __fastcall AgentCmd_SpawnAgent(scrContext_t *scrContext, scr_entref_t entref)
{
  ?AgentCmd_SpawnAgent@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
Scr_GetMaxAgents
==============
*/

void __fastcall Scr_GetMaxAgents(scrContext_t *scrContext)
{
  ?Scr_GetMaxAgents@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrAgentCmd_SetAnimMode
==============
*/

void __fastcall ScrAgentCmd_SetAnimMode(scrContext_t *scrContext, scr_entref_t entref)
{
  ?ScrAgentCmd_SetAnimMode@@YAXAEAUscrContext_t@@Uscr_entref_t@@@Z(scrContext, entref);
}

/*
==============
AgentCmd_AgentCanSeeSentient
==============
*/
void AgentCmd_AgentCanSeeSentient(scrContext_t *scrContext, scr_entref_t entref)
{
  const gentity_s *Entity; 
  AICommonInterface *m_pAI; 
  gentity_s *v6; 
  sentient_s *sentient; 
  int CanSeeSentient; 
  AICommonWrapper v9; 

  AIActorInterface::AIActorInterface(&v9.m_actorInterface);
  AIAgentInterface::AIAgentInterface(&v9.m_newAgentInterface);
  v9.m_newAgentInterface.__vftable = (AINewAgentInterface_vtbl *)&AINewAgentInterface::`vftable';
  AICommonInterface::AICommonInterface(&v9.m_botInterface);
  v9.m_botInterface.__vftable = (AIBotInterface_vtbl *)&AIBotInterface::`vftable';
  AICommonInterface::AICommonInterface(&v9.m_botAgentInterface);
  v9.m_pAI = NULL;
  v9.m_botAgentInterface.__vftable = (AIBotAgentInterface_vtbl *)&AIBotAgentInterface::`vftable';
  Entity = GetEntity(entref);
  AICommonWrapper::Setup(&v9, Entity);
  m_pAI = v9.m_pAI;
  if ( !v9.m_pAI && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 1005, ASSERT_TYPE_ASSERT, "(pAI)", (const char *)&queryFormat, "pAI") )
    __debugbreak();
  v6 = GScr_GetEntity(0);
  sentient = v6->sentient;
  if ( !sentient )
  {
    Scr_Error(COM_ERR_3627, scrContext, "AgentCanSeeSentient: entity is not sentient.");
    sentient = v6->sentient;
  }
  CanSeeSentient = AICommonInterface::CanSeeSentient(m_pAI, sentient, 250);
  Scr_AddBool(scrContext, CanSeeSentient);
}

/*
==============
AgentCmd_AgentClearScriptVars
==============
*/
void AgentCmd_AgentClearScriptVars(scrContext_t *scrContext, scr_entref_t entref)
{
  unsigned int entnum; 
  gentity_s *v4; 
  const char *v5; 

  entnum = entref.entnum;
  if ( entref.entclass )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    v4 = NULL;
  }
  else
  {
    if ( entref.entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 1027, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    v4 = &g_entities[entnum];
    if ( !v4->agent )
    {
      v5 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v5);
    }
  }
  Scr_ClearEntityNum(scrContext, v4->s.number, ENTITY_CLASS_GENTITY);
  Scr_ClearBlackboard(v4->s.number);
}

/*
==============
AgentCmd_AgentSetClipMode
==============
*/
void AgentCmd_AgentSetClipMode(scrContext_t *scrContext, scr_entref_t entref)
{
  unsigned int entnum; 
  gentity_s *v4; 
  const char *v5; 
  scr_string_t ConstString; 

  entnum = entref.entnum;
  if ( entref.entclass )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    v4 = NULL;
  }
  else
  {
    if ( entref.entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 1047, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    v4 = &g_entities[entnum];
    if ( !v4->agent )
    {
      v5 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v5);
    }
  }
  if ( !SV_IsAgentEntity(v4) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 1049, ASSERT_TYPE_ASSERT, "( SV_IsAgentEntity( pSelf ) )", (const char *)&queryFormat, "SV_IsAgentEntity( pSelf )") )
    __debugbreak();
  ConstString = Scr_GetConstString(scrContext, 0);
  if ( ConstString == scr_const.player )
  {
    v4->clipmask = 33636369;
  }
  else if ( ConstString == scr_const.ai )
  {
    v4->clipmask = 33685521;
  }
  else
  {
    Scr_Error(COM_ERR_1766, scrContext, "unknown clip mode.");
  }
}

/*
==============
AgentCmd_AgentSetFavoriteEnemy
==============
*/
void AgentCmd_AgentSetFavoriteEnemy(scrContext_t *scrContext, scr_entref_t entref)
{
  sentient_s *sentient; 
  unsigned int entnum; 
  gentity_s *v5; 
  const char *v6; 

  sentient = NULL;
  entnum = entref.entnum;
  if ( entref.entclass )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    v5 = NULL;
  }
  else
  {
    if ( entref.entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 1085, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    v5 = &g_entities[entnum];
    if ( !v5->agent )
    {
      v6 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v6);
    }
  }
  if ( Scr_GetType(scrContext, 0) )
  {
    sentient = GScr_GetEntity(0)->sentient;
    if ( !sentient )
      Scr_Error(COM_ERR_5655, scrContext, "AgentSetFavoriteEnemy: entity is not sentient.");
  }
  SentientHandle::setSentient(&v5->sentient->ai->threat.pFavoriteEnemy, sentient);
}

/*
==============
AgentCmd_CloneAgent
==============
*/
void AgentCmd_CloneAgent(scrContext_t *scrContext, scr_entref_t entref)
{
  unsigned int entnum; 
  const char *v5; 
  const dvar_t *v6; 
  unsigned int v8; 
  int v9; 
  LerpEntityState *p_lerp; 
  int v12; 
  XAnimTree *Tree; 
  int AgentCorpseIndex; 
  __int64 v19; 
  __int16 v20; 
  __int16 EntityIndex; 
  bool v22; 
  bool v23; 
  __int64 v24; 
  _DWORD *v25; 
  XAnim_s *Anims; 
  unsigned int Animset; 
  __int64 v28; 
  const XAnimTree *v29; 
  XAnimTree *v30; 
  XAnimTree *v31; 
  bool v32; 
  const Weapon *Weapon; 
  unsigned int eType; 
  int v39; 
  const Weapon *v40; 
  GWeaponMap *Instance; 
  GWeaponMap *v42; 
  unsigned __int16 *attachModelNames; 
  scr_string_t *attachTagNames; 
  AgentAttachModelData *attachModels; 
  const char *v46; 
  unsigned int v47; 
  const playerState_s *v48; 
  int v49; 
  const ScriptableDef *ScriptableDef; 
  unsigned int runtimeInstanceCount; 
  DObj *ServerDObjForEnt; 
  __int64 v53; 
  __int64 v54; 
  playerState_s *ps; 
  __int64 v56; 
  XAnimTree *from; 
  GameScriptDataMP *GameScriptDataMP; 
  DObj *obj; 
  char weaponMap; 
  GWeaponMap *weaponMapa; 
  EntityClass weaponMap_4; 
  GameModeFlagContainer<enum EntityStateFlagsCommon,enum EntityStateFlagsSP,enum EntityStateFlagsMP,32> v63; 
  int Int; 

  weaponMap_4 = entref.entclass;
  entnum = entref.entnum;
  Sys_ProfBeginNamedEvent(0xFFFF0000, "AgentCmd_CloneAgent");
  if ( weaponMap_4 )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    _RBP = NULL;
  }
  else
  {
    if ( entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 734, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    _RBP = &g_entities[entnum];
    if ( !_RBP->agent )
    {
      v5 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v5);
    }
  }
  v6 = DVARBOOL_entityLeakDisableItemsCorpses;
  if ( !DVARBOOL_entityLeakDisableItemsCorpses && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "entityLeakDisableItemsCorpses") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v6);
  if ( v6->current.enabled )
  {
    GScr_AddEntityAllowUndefined(NULL);
    return;
  }
  Int = Scr_GetInt(scrContext, 0);
  if ( Scr_GetNumParam(scrContext) < 2 || (weaponMap = 1, !Scr_GetInt(scrContext, 1u)) )
    weaponMap = 0;
  _R15 = _RBP->agent;
  ps = &_R15->playerState;
  if ( !_R15 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 748, ASSERT_TYPE_ASSERT, "(agent)", (const char *)&queryFormat, "agent") )
    __debugbreak();
  if ( !ComCharacterLimits::ms_isGameDataValid && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\com_character_limits.h", 160, ASSERT_TYPE_ASSERT, "(ms_isGameDataValid)", (const char *)&queryFormat, "ms_isGameDataValid") )
    __debugbreak();
  v8 = ComCharacterLimits::ms_gameData.m_characterCount + ComCharacterLimits::ms_gameData.m_clientCorpseCount;
  if ( !ComCharacterLimits::ms_isGameDataValid && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\com_character_limits.h", 137, ASSERT_TYPE_ASSERT, "(ms_isGameDataValid)", (const char *)&queryFormat, "ms_isGameDataValid") )
    __debugbreak();
  v9 = level.currentAgentClone + v8;
  _RDI = &level.gentities[level.currentAgentClone + v8];
  p_lerp = &_RDI->s.lerp;
  level.currentAgentClone = (level.currentAgentClone + 1) % (signed int)ComCharacterLimits::ms_gameData.m_agentCorpseCount;
  if ( _RDI == (gentity_s *)-12i64 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\com_gamemode_flags.h", 280, ASSERT_TYPE_ASSERT, "(sourceFlags)", (const char *)&queryFormat, "sourceFlags") )
    __debugbreak();
  v12 = ~p_lerp->eFlags.m_flags[0] & 4;
  if ( G_IsEntityInUse(v9) )
  {
    if ( !GUtils::ms_gUtils && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_utils.h", 112, ASSERT_TYPE_ASSERT, "( ms_gUtils )", (const char *)&queryFormat, "ms_gUtils") )
      __debugbreak();
    GUtils::ms_gUtils->FreeEntity(GUtils::ms_gUtils, _RDI);
  }
  if ( !GUtils::ms_gUtils && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_utils.h", 112, ASSERT_TYPE_ASSERT, "( ms_gUtils )", (const char *)&queryFormat, "ms_gUtils") )
    __debugbreak();
  GUtils::ms_gUtils->InitGentity(GUtils::ms_gUtils, _RDI);
  p_lerp->eFlags.m_flags[0] = v12;
  _RDI->s.clientNum = _R15->playerState.clientNum;
  if ( !GameModeFlagContainer<enum POtherFlagsCommon,enum POtherFlagsSP,enum POtherFlagsMP,64>::TestFlagStrict(&_R15->playerState.otherFlags, FOG_SCALE|0x20) && _R15->playerState.groundEntityNum == 2047 && G_PlayerCorpseMP_RequiresFixedDeathCamera(_RBP) )
  {
    if ( GameModeFlagValues::ms_mpValue != ACTIVE && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\com_gamemode_flags.h", 201, ASSERT_TYPE_ASSERT, "(IsFlagActive( index ))", "%s\n\tThis function must be used in a MP-only context", "IsFlagActive( index )") )
      __debugbreak();
    GameModeFlagContainer<enum POtherFlagsCommon,enum POtherFlagsSP,enum POtherFlagsMP,64>::SetFlagInternal(&_R15->playerState.otherFlags, ACTIVE, 0x32u);
  }
  v63.m_flags[0] = _R15->playerState.eFlags.m_flags[0];
  if ( GameModeFlagValues::ms_mpValue != ACTIVE && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\com_gamemode_flags.h", 201, ASSERT_TYPE_ASSERT, "(IsFlagActive( index ))", "%s\n\tThis function must be used in a MP-only context", "IsFlagActive( index )") )
    __debugbreak();
  GameModeFlagContainer<enum EntityStateFlagsCommon,enum EntityStateFlagsSP,enum EntityStateFlagsMP,32>::SetFlagInternal(&v63, ACTIVE, 0x1Bu);
  GameModeFlagContainer<enum EntityStateFlagsCommon,enum EntityStateFlagsSP,enum EntityStateFlagsMP,32>::SetFlagInternal(&v63, ACTIVE, 0x11u);
  if ( _RDI == (gentity_s *)-12i64 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\com_gamemode_flags.h", 280, ASSERT_TYPE_ASSERT, "(sourceFlags)", (const char *)&queryFormat, "sourceFlags") )
    __debugbreak();
  p_lerp->eFlags.m_flags[0] = (LOBYTE(v63.m_flags[0]) ^ (unsigned __int8)p_lerp->eFlags.m_flags[0]) & 4 ^ v63.m_flags[0];
  G_SetOriginAndAnglesForClone(&_R15->playerState, &_R15->playerState.origin, &_RBP->r.currentAngles, _RDI);
  _RDI->s.lerp.pos.trType = TR_GRAVITY;
  _RDI->s.lerp.pos.trTime = level.time;
  __asm
  {
    vmovss  xmm0, dword ptr [r15+3Ch]
    vmovss  dword ptr [rdi+28h], xmm0
  }
  _RDI->s.lerp.pos.trDelta.v[1] = _R15->playerState.velocity.v[1];
  _RDI->s.lerp.pos.trDelta.v[2] = _R15->playerState.velocity.v[2];
  __asm { vmovss  [rsp+0B8h+arg_10.m_flags], xmm0 }
  if ( (v63.m_flags[0] & 0x7F800000) == 2139095040 )
    goto LABEL_136;
  __asm
  {
    vmovss  xmm0, dword ptr [rdi+2Ch]
    vmovss  [rsp+0B8h+arg_10.m_flags], xmm0
  }
  if ( (v63.m_flags[0] & 0x7F800000) == 2139095040 )
    goto LABEL_136;
  __asm
  {
    vmovss  xmm0, dword ptr [rdi+30h]
    vmovss  [rsp+0B8h+arg_10.m_flags], xmm0
  }
  if ( (v63.m_flags[0] & 0x7F800000) == 2139095040 )
  {
LABEL_136:
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 779, ASSERT_TYPE_SANITY, "( !IS_NAN( ( body->s.lerp.pos.trDelta )[0] ) && !IS_NAN( ( body->s.lerp.pos.trDelta )[1] ) && !IS_NAN( ( body->s.lerp.pos.trDelta )[2] ) )", (const char *)&queryFormat, "!IS_NAN( ( body->s.lerp.pos.trDelta )[0] ) && !IS_NAN( ( body->s.lerp.pos.trDelta )[1] ) && !IS_NAN( ( body->s.lerp.pos.trDelta )[2] )") )
      __debugbreak();
  }
  __asm
  {
    vmovups ymm0, ymmword ptr [rbp+34h]
    vmovups ymmword ptr [rdi+34h], ymm0
  }
  _RDI->s.lerp.apos.trDelta.v[2] = _RBP->s.lerp.apos.trDelta.v[2];
  _RDI->s.eType = ET_AGENT_CORPSE;
  _RDI->physicsObject = 1;
  obj = Com_GetServerDObjForEntnum(_R15->playerState.clientNum);
  Tree = DObjGetTree(obj);
  _RDI->c.item[0].clipAmmoCount[0] = level.time;
  from = Tree;
  _RDI->c.item[0].ammoCount = 2047;
  AgentCorpseIndex = G_PlayerCorpseMP_GetAgentCorpseIndex(_RDI);
  GameScriptDataMP = GameScriptDataMP::GetGameScriptDataMP();
  v56 = 8i64;
  if ( (unsigned int)AgentCorpseIndex >= 8 )
  {
    LODWORD(v54) = 8;
    LODWORD(v53) = AgentCorpseIndex;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 795, ASSERT_TYPE_ASSERT, "(unsigned)( corpseIndex ) < (unsigned)( ( sizeof( *array_counter( gScrData->agentCorpseInfo ) ) + 0 ) )", "corpseIndex doesn't index ARRAY_COUNT( gScrData->agentCorpseInfo )\n\t%i not in [0, %i)", v53, v54) )
      __debugbreak();
  }
  v19 = AgentCorpseIndex;
  v20 = GameScriptDataMP->agentCorpseInfo[v19].entnum;
  if ( v20 != -1 )
  {
    LODWORD(v54) = -1;
    LODWORD(v53) = v20;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 797, ASSERT_TYPE_ASSERT, "( corpseInfo->entnum ) == ( G_PLAYER_CORPSE_INVALID_ENTNUM )", "corpseInfo->entnum == G_PLAYER_CORPSE_INVALID_ENTNUM\n\t%i, %i", v53, v54) )
      __debugbreak();
  }
  GameScriptDataMP->agentCorpseInfo[v19].entnum = _RDI->s.number;
  GameScriptDataMP->agentCorpseInfo[v19].time = level.time;
  GameScriptDataMP->agentCorpseInfo[v19].skipDropChecks = weaponMap;
  GameScriptDataMP->agentCorpseInfo[v19].falling = 1;
  EntityIndex = G_GetEntityIndex(_RBP);
  v22 = SV_IsAgentBot(EntityIndex) && !BG_IsPlayerPositionQuantized(&_R15->playerState);
  GameScriptDataMP->agentCorpseInfo[v19].fullPrecisionOrigin = v22;
  GameScriptDataMP->agentCorpseInfo[v19].codeStartRagdollTime = 0;
  if ( SV_Agent_IsScripted(_RBP->s.number) )
    v23 = BG_AnimationState_GetController(&_RBP->s) == ANIMCTRL_DOG;
  else
    v23 = 0;
  GameScriptDataMP->agentCorpseInfo[v19].skippedRagdoll = v23;
  if ( !*(_QWORD *)&GStatic::ms_gameStatics && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_static.h", 64, ASSERT_TYPE_ASSERT, "( ms_gameStatics )", (const char *)&queryFormat, "ms_gameStatics") )
    __debugbreak();
  v24 = *(_QWORD *)&GStatic::ms_gameStatics;
  v25 = (_DWORD *)(*(__int64 (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)&GStatic::ms_gameStatics + 224i64))(*(_QWORD *)&GStatic::ms_gameStatics, (unsigned int)_R15->playerState.clientNum);
  if ( !v25 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 824, ASSERT_TYPE_ASSERT, "( characterInfo )", (const char *)&queryFormat, "characterInfo") )
    __debugbreak();
  memcpy_0(&GameScriptDataMP->agentCorpseInfo[v19].ci, v25, sizeof(GameScriptDataMP->agentCorpseInfo[v19].ci));
  if ( (AgentCorpseIndex < 0 || (unsigned int)AgentCorpseIndex > 0xFF) && CoreAssert_Handler("c:\\workspace\\iw8\\shared\\codware\\core\\core_assert.h", 385, ASSERT_TYPE_ASSERT, (const char *)&queryFormat.fmt + 3, "%s (SmallType) %s 0x%jx == (BigType) %s 0x%jx", "unsigned char __cdecl truncate_cast_impl<unsigned char,int>(int)", "unsigned", (unsigned __int8)AgentCorpseIndex, "signed", AgentCorpseIndex) )
    __debugbreak();
  _R15->playerState.corpseIndex = AgentCorpseIndex;
  if ( v25[642] )
  {
    Anims = BG_AnimationState_GetAnims(&_RBP->s);
  }
  else if ( PlayerASM_IsEnabled() )
  {
    Animset = BG_PlayerASM_GetAnimset(&_RBP->s);
    Anims = BG_PlayerASM_GetAnims(Animset);
  }
  else
  {
    v28 = (*(__int64 (__fastcall **)(__int64))(*(_QWORD *)v24 + 16i64))(v24);
    if ( !v28 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 843, ASSERT_TYPE_ASSERT, "( bgameAnim )", (const char *)&queryFormat, "bgameAnim") )
      __debugbreak();
    Anims = *(XAnim_s **)(v28 + 17712);
  }
  v29 = GameScriptDataMP->agentCorpseInfo[v19].tree;
  if ( v29 )
  {
    if ( XAnimGetAnims(v29) == Anims )
      goto LABEL_90;
    v30 = GameScriptDataMP->agentCorpseInfo[v19].tree;
    if ( v30 )
      Com_XAnimFreeSmallTree(v30);
  }
  GameScriptDataMP->agentCorpseInfo[v19].tree = Com_XAnimCreateSmallTree(Anims, MOVEMENT);
LABEL_90:
  v31 = GameScriptDataMP->agentCorpseInfo[v19].tree;
  GameScriptDataMP->agentCorpseInfo[v19].ci.pXAnimTree = v31;
  XAnimCloneAnimTree(from, v31);
  v32 = _RDI->r.svFlags == 0;
  _RDI->s.groundEntityNum = 2047;
  _RDI->s.surfType = _RBP->s.surfType;
  if ( !v32 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 864, ASSERT_TYPE_ASSERT, "(!body->r.svFlags)", (const char *)&queryFormat, "!body->r.svFlags") )
    __debugbreak();
  _RDI->r.svFlags = 2;
  __asm
  {
    vmovups xmm0, xmmword ptr [rbp+100h]
    vmovups xmmword ptr [rdi+100h], xmm0
    vmovsd  xmm1, qword ptr [rbp+110h]
    vmovsd  qword ptr [rdi+110h], xmm1
    vmovups xmm0, xmmword ptr [rbp+118h]
    vmovups xmmword ptr [rdi+118h], xmm0
    vmovsd  xmm1, qword ptr [rbp+128h]
    vmovsd  qword ptr [rdi+128h], xmm1
  }
  weaponMapa = GWeaponMap::GetInstance();
  if ( !weaponMapa && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\bgame\\bg_weapons.h", 438, ASSERT_TYPE_ASSERT, "(weaponMap)", (const char *)&queryFormat, "weaponMap") )
    __debugbreak();
  Weapon = BgWeaponMap::GetWeapon(weaponMapa, _RBP->s.weaponHandle);
  if ( !weaponMapa && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\bgame\\bg_weapons.h", 522, ASSERT_TYPE_ASSERT, "(weaponMap)", (const char *)&queryFormat, "weaponMap") )
    __debugbreak();
  eType = (unsigned __int16)_RBP->s.eType;
  if ( (unsigned __int16)eType > 0x11u || (v39 = 131111, !_bittest(&v39, eType)) )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\bgame\\bg_weapons.h", 524, ASSERT_TYPE_ASSERT, "(es->eType == ET_GENERAL || es->eType == ET_PLAYER || es->eType == ET_PLAYER_CORPSE || es->eType == ET_AGENT || es->eType == ET_INVISIBLE)", (const char *)&queryFormat, "es->eType == ET_GENERAL || es->eType == ET_PLAYER || es->eType == ET_PLAYER_CORPSE || es->eType == ET_AGENT || es->eType == ET_INVISIBLE") )
      __debugbreak();
  }
  v40 = BgWeaponMap::GetWeapon(weaponMapa, _RBP->s.staticState.player.stowedWeaponHandle);
  Instance = GWeaponMap::GetInstance();
  BG_SetWeaponForEntity(Instance, &_RDI->s, Weapon);
  v42 = GWeaponMap::GetInstance();
  if ( !v42 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\bgame\\bg_weapons.h", 757, ASSERT_TYPE_ASSERT, "(weaponMap)", (const char *)&queryFormat, "weaponMap") )
    __debugbreak();
  if ( _RDI->s.eType != ET_AGENT_CORPSE && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\bgame\\bg_weapons.h", 759, ASSERT_TYPE_ASSERT, "(es->eType == ET_AGENT_CORPSE)", (const char *)&queryFormat, "es->eType == ET_AGENT_CORPSE") )
    __debugbreak();
  v42->SetWeapon(v42, (BgWeaponHandle *)&_RDI->s.staticState, v40);
  LerpEntityStateAgentCorpse::SetModelIndex((LerpEntityStateAgentCorpse *)&_RDI->s.lerp.u, _RBP->model);
  attachModelNames = _RBP->attachModelNames;
  attachTagNames = _RBP->attachTagNames;
  attachModels = _RDI->s.lerp.u.agentCorpse.attachModels;
  do
  {
    if ( *attachModelNames )
    {
      v46 = SL_ConvertToString(*attachTagNames);
      AgentAttachModelData::SetAttachModel(attachModels, *attachModelNames);
      if ( !GConfigStrings::ms_gConfigStrings && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_configstrings.h", 71, ASSERT_TYPE_ASSERT, "( ms_gConfigStrings )", (const char *)&queryFormat, "ms_gConfigStrings") )
        __debugbreak();
      v47 = GConfigStrings::ms_gConfigStrings->GetClientTagIndex(GConfigStrings::ms_gConfigStrings, v46);
      AgentAttachModelData::SetAttachTag(attachModels, v47);
    }
    else
    {
      AgentAttachModelData::Clear(attachModels);
    }
    ++attachModels;
    ++attachTagNames;
    ++attachModelNames;
    --v56;
  }
  while ( v56 );
  v48 = ps;
  _RDI->s.animInfo.animData = _RDI->s.animInfo.animData & 0xFFFFFFFE | (GameScriptDataMP->agentCorpseInfo[v19].ci.usingAnimState != 0);
  _RDI->s.animInfo.animTime = _RBP->s.animInfo.animTime;
  _RDI->s.animInfo.animData = _RBP->s.animInfo.animData;
  if ( !GameScriptDataMP->agentCorpseInfo[v19].ci.usingAnimState )
    BG_AnimationMP_PlayerToEntityAnimation(ps, &_RDI->s);
  _RDI->s.un.vehicleXModel = ps->suitIndex;
  _RDI->clipmask = 65537;
  SV_LinkEntity(_RDI);
  _RDI->nextthink = level.time + Int;
  v49 = _RDI->s.eType;
  _RDI->handler = 17;
  ScriptableDef = ScriptableBg_GetScriptableDef(v49, obj);
  if ( ScriptableDef )
  {
    ScriptableSv_LinkReservedScriptableEntity(_RDI, ScriptableDef, 0xFFFFFFFF);
  }
  else
  {
    ScriptableCommon_AssertCountsInitialized();
    runtimeInstanceCount = g_scriptableWorldCounts.runtimeInstanceCount;
    if ( ScriptableSv_GetScriptableIndexForEntity(_RDI) < runtimeInstanceCount )
      ScriptableSv_UnlinkReservedScriptableEntity(_RDI);
    v48 = ps;
  }
  if ( GameModeFlagContainer<enum POtherFlagsCommon,enum POtherFlagsSP,enum POtherFlagsMP,64>::TestFlagInternal(&v48->otherFlags, GameModeFlagValues::ms_mpValue, 0x38u) )
  {
    if ( !Com_GameMode_SupportsFeature(WEAPON_LADDER_CLIMB|0x80) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\bgame\\bg_public.h", 2514, ASSERT_TYPE_ASSERT, "(Com_GameMode_SupportsFeature( Com_GameMode_Feature::MELEE_EXECUTION ))", (const char *)&queryFormat, "Com_GameMode_SupportsFeature( Com_GameMode_Feature::MELEE_EXECUTION )") )
      __debugbreak();
    if ( v48->activeExecutionIsVictim && !G_Execution_InitializeCorpse(_RBP, _RDI) )
      G_Execution_Cancel(_RBP);
  }
  ServerDObjForEnt = Com_GetServerDObjForEnt(_RDI);
  BG_AnimationMP_UpdateAgentCorpseDObj(LOCAL_CLIENT_INVALID, ServerDObjForEnt, weaponMapa, &_RDI->s, &GameScriptDataMP->agentCorpseInfo[v19].ci);
  G_TransferLinkedEntities(_RBP, _RDI);
  G_PlayerCorpseMP_TransferNonWeaponPartBits(_RDI, _RBP);
  GScr_AddEntityAllowUndefined(_RDI);
  if ( BGMovingPlatforms::IsOnMovingPlatform(v48) )
    G_ClientScrMP_TryToLinkCorpseToMovingPlatform(_RDI);
  G_PlayerCorpseMP_SnapOrigin(_RDI);
  Sys_ProfEndNamedEvent();
}

/*
==============
AgentCmd_DeSpawnAgent
==============
*/
void AgentCmd_DeSpawnAgent(scrContext_t *scrContext, scr_entref_t entref)
{
  unsigned int entnum; 
  gentity_s *v4; 
  const char *v5; 

  entnum = entref.entnum;
  if ( entref.entclass )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    v4 = NULL;
  }
  else
  {
    if ( entref.entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 250, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    v4 = &g_entities[entnum];
    if ( !v4->agent )
    {
      v5 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v5);
    }
  }
  G_CombatMP_AgentDespawn(v4);
}

/*
==============
AgentCmd_FinishAgentDamage
==============
*/
void AgentCmd_FinishAgentDamage(scrContext_t *scrContext, scr_entref_t entref)
{
  unsigned int entnum; 
  gentity_s *v9; 
  const char *v10; 
  const gentity_s *Entity; 
  int Int; 
  meansOfDeath_t v13; 
  scr_string_t ConstString; 
  hitLocation_t hitLoc; 
  char v32; 
  char v33; 
  scr_string_t tagName; 
  playerState_s *p_playerState; 
  const char *v37; 
  ComErrorCode v38; 
  unsigned int v39; 
  int number; 
  __int64 v41; 
  __int64 v42; 
  __int16 otherEntityNum; 
  char v44; 
  char v45; 
  int v50; 
  int v55; 
  unsigned int v56; 
  int iDamageParts; 
  DamageParts *v58; 
  gentity_s *v59; 
  ai_agent_t *ScriptedAgentInfo; 
  const GEntityHandlerList *EntHandlerList; 
  int health; 
  int v63; 
  const gentity_s *HitCorpseEntity; 
  const gentity_s *v65; 
  GBullet *BulletSystem; 
  bool v67; 
  const gentity_s *v68; 
  __int16 EntityIndex; 
  void (__fastcall *pain)(gentity_s *, gentity_s *, int, const vec3_t *, const int, const vec3_t *, const hitLocation_t, const Weapon *, bool); 
  __int16 v71; 
  __int64 partName; 
  vec3_t *point; 
  BOOL localdir; 
  meansOfDeath_t means; 
  bool outIsAlternate; 
  bool v82; 
  bool v83; 
  unsigned int damageFlags; 
  int v85; 
  int modelIndex; 
  gentity_s *pInflictor; 
  meansOfDeath_t v88; 
  vec3_t *v89; 
  AIAgentInterface v90; 
  AIAgentInterface *v91; 
  vec3_t direction; 
  vec3_t vectorValue; 
  vec3_t v94; 
  Weapon outWeapon; 
  void *retaddr; 

  _RAX = &retaddr;
  __asm
  {
    vmovaps xmmword ptr [rax-58h], xmm7
    vmovaps xmmword ptr [rax-68h], xmm8
  }
  entnum = entref.entnum;
  if ( entref.entclass )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    v9 = NULL;
  }
  else
  {
    if ( entref.entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 431, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    v9 = &g_entities[entnum];
    if ( !v9->agent )
    {
      v10 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v10);
    }
  }
  pInflictor = g_entities + 2046;
  Entity = g_entities + 2046;
  Int = Scr_GetInt(scrContext, 2u);
  if ( Scr_GetType(scrContext, 0) && Scr_GetPointerType(scrContext, 0) == VAR_ENTITY )
    pInflictor = GScr_GetEntity(0);
  if ( Scr_GetType(scrContext, 1u) && Scr_GetPointerType(scrContext, 1u) == VAR_ENTITY )
    Entity = GScr_GetEntity(1u);
  damageFlags = Scr_GetInt(scrContext, 3u);
  v88 = G_Combat_MeansOfDeathFromScriptParam(scrContext, 4);
  v13 = v88;
  GScr_Main_GetWeaponParam(scrContext, 5u, &outWeapon, &outIsAlternate);
  __asm { vxorps  xmm7, xmm7, xmm7 }
  if ( Scr_GetType(scrContext, 6u) )
  {
    Scr_GetVector(scrContext, 6u, &vectorValue);
  }
  else
  {
    __asm
    {
      vmovss  dword ptr [rbp+0A0h+vectorValue], xmm7
      vmovss  dword ptr [rbp+0A0h+vectorValue+4], xmm7
      vmovss  dword ptr [rbp+0A0h+vectorValue+8], xmm7
    }
  }
  __asm
  {
    vmovaps [rsp+1A0h+var_40], xmm6
    vmovss  xmm8, cs:__real@3f800000
  }
  if ( Scr_GetType(scrContext, 7u) )
  {
    Scr_GetVector(scrContext, 7u, &v94);
    __asm
    {
      vmovss  xmm5, dword ptr [rbp+0A0h+var_C0]
      vmovss  xmm6, dword ptr [rbp+0A0h+var_C0+4]
      vmovss  xmm4, dword ptr [rbp+0A0h+var_C0+8]
      vmulss  xmm1, xmm5, xmm5
      vmulss  xmm0, xmm6, xmm6
      vaddss  xmm2, xmm1, xmm0
      vmulss  xmm1, xmm4, xmm4
      vaddss  xmm0, xmm2, xmm1
      vsqrtss xmm3, xmm0, xmm0
      vcmpless xmm0, xmm3, cs:__real@80000000
      vblendvps xmm0, xmm3, xmm8, xmm0
      vdivss  xmm2, xmm8, xmm0
      vmulss  xmm0, xmm5, xmm2
      vmovss  dword ptr [rbp+0A0h+direction], xmm0
      vmulss  xmm0, xmm4, xmm2
      vmulss  xmm1, xmm6, xmm2
      vmovss  dword ptr [rbp+0A0h+direction+8], xmm0
      vmovss  dword ptr [rbp+0A0h+direction+4], xmm1
    }
    v89 = &v94;
  }
  else
  {
    __asm
    {
      vmovss  dword ptr [rbp+0A0h+direction], xmm7
      vmovss  dword ptr [rbp+0A0h+direction+4], xmm7
      vmovss  dword ptr [rbp+0A0h+direction+8], xmm7
    }
    v89 = NULL;
  }
  ConstString = Scr_GetConstString(scrContext, 8u);
  hitLoc = G_Combat_GetHitLocationIndexFromString(ConstString);
  if ( hitLoc != HITLOC_SHIELD )
  {
    v85 = Scr_GetInt(scrContext, 9u);
    *(double *)&_XMM0 = Scr_GetFloat(scrContext, 0xAu);
    __asm
    {
      vcomiss xmm0, xmm7
      vmovaps xmm6, xmm0
    }
    if ( v32 )
      goto LABEL_120;
    __asm { vcomiss xmm0, xmm8 }
    if ( !(v32 | v33) )
    {
LABEL_120:
      __asm
      {
        vcvtss2sd xmm1, xmm6, xmm6
        vmovq   rdx, xmm1
      }
      v37 = j_va("Given stun fraction (%.2f) is outside the allowed range (0,1).", _RDX);
      v38 = COM_ERR_3625;
      goto LABEL_121;
    }
    modelIndex = 0;
    if ( Scr_GetType(scrContext, 0xBu) )
      modelIndex = Scr_GetInt(scrContext, 0xBu);
    tagName = 0;
    if ( Scr_GetType(scrContext, 0xCu) )
      tagName = Scr_GetConstString(scrContext, 0xCu);
    v82 = 0;
    if ( Scr_GetNumParam(scrContext) > 0xD )
      v82 = Scr_GetInt(scrContext, 0xDu) != 0;
    v83 = 0;
    if ( Scr_GetNumParam(scrContext) > 0xE )
      v83 = Scr_GetInt(scrContext, 0xEu) != 0;
    p_playerState = &v9->agent->playerState;
    if ( p_playerState->pm_type == 7 )
    {
      v37 = "Trying to do damage to a client that is already dead";
      v38 = COM_ERR_3626;
LABEL_121:
      Scr_Error(v38, scrContext, v37);
      goto LABEL_122;
    }
    v39 = v9->flags.m_flags[0];
    if ( (v39 & 8) == 0 && (damageFlags & 4) == 0 )
    {
      G_CombatMP_DamageKnockback(v9, Int, &direction, p_playerState);
      LOBYTE(v39) = v9->flags.m_flags[0];
    }
    if ( (v39 & 1) == 0 )
    {
      if ( EntHandle::isDefined(&v9->r.ownerNum) )
      {
        number = v9->r.ownerNum.number;
        if ( (unsigned int)(number - 1) >= 0x7FF )
        {
          LODWORD(partName) = number - 1;
          if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_public.h", 223, ASSERT_TYPE_ASSERT, "(unsigned)( number - 1 ) < (unsigned)( ENTITYNUM_NONE )", "number - 1 doesn't index ENTITYNUM_NONE\n\t%i not in [0, %i)", partName, 2047) )
            __debugbreak();
        }
        v41 = v9->r.ownerNum.number;
        if ( (unsigned int)(v41 - 1) >= 0x800 )
        {
          LODWORD(point) = 2048;
          LODWORD(partName) = v41 - 1;
          if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_public.h", 207, ASSERT_TYPE_ASSERT, "(unsigned)( entityIndex ) < (unsigned)( ( 2048 ) )", "entityIndex doesn't index MAX_GENTITIES\n\t%i not in [0, %i)", partName, point) )
            __debugbreak();
        }
        if ( !g_entities && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_public.h", 208, ASSERT_TYPE_ASSERT, "( g_entities != nullptr )", (const char *)&queryFormat, "g_entities != nullptr") )
          __debugbreak();
        v42 = v41 - 1;
        if ( g_entities[v42].r.isInUse != g_entityIsInUse[v42] && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_public.h", 209, ASSERT_TYPE_ASSERT, "( g_entities[entityIndex].r.isInUse == g_entityIsInUse[entityIndex] )", (const char *)&queryFormat, "g_entities[entityIndex].r.isInUse == g_entityIsInUse[entityIndex]") )
          __debugbreak();
        if ( !g_entityIsInUse[v42] )
        {
          LODWORD(point) = v9->r.ownerNum.number - 1;
          if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_public.h", 224, ASSERT_TYPE_ASSERT, "( ( G_IsEntityInUse( number - 1 ) ) )", "%s\n\t( number - 1 ) = %i", "( G_IsEntityInUse( number - 1 ) )", point) )
            __debugbreak();
        }
        if ( (g_entities[v9->r.ownerNum.number - 1].flags.m_flags[0] & 1) != 0 )
          goto LABEL_122;
        v13 = v88;
      }
      else
      {
        otherEntityNum = v9->s.otherEntityNum;
        if ( otherEntityNum != 2047 && (g_entities[otherEntityNum].flags.m_flags[0] & 1) != 0 )
          goto LABEL_122;
      }
      v44 = v82;
      if ( Int || !v82 )
      {
        v45 = 0;
        if ( Int <= 0 )
        {
          if ( v83 && v9->health > 0 )
            AgentCmd_SendHitEvent(v9, v9, Entity, &outWeapon, outIsAlternate, tagName, &vectorValue, &direction, v13, hitLoc, 0);
          goto LABEL_122;
        }
      }
      else
      {
        v45 = 1;
        Int = 1;
      }
      __asm
      {
        vxorps  xmm0, xmm0, xmm0
        vcvtsi2ss xmm0, xmm0, ebx
        vmulss  xmm1, xmm0, xmm6
        vcvttss2si ecx, xmm1
      }
      v9->agent->damageStun += _ECX;
      v50 = Int - _ECX;
      v9->agent->damageBlood += v50;
      if ( (damageFlags & 0x100) != 0 )
        v9->agent->damageRicochet += v50;
      if ( v44 )
        v9->agent->damageArmor += v50;
      _RCX = v9->agent;
      if ( v89 )
      {
        __asm
        {
          vmovss  xmm0, dword ptr [rbp+0A0h+direction]
          vmovss  dword ptr [rcx+8FBCh], xmm0
          vmovss  xmm1, dword ptr [rbp+0A0h+direction+4]
          vmovss  dword ptr [rcx+8FC0h], xmm1
          vmovss  xmm0, dword ptr [rbp+0A0h+direction+8]
          vmovss  dword ptr [rcx+8FC4h], xmm0
        }
        v9->agent->damageFromWorld = 0;
      }
      else
      {
        _RCX->damageFrom.v[0] = v9->r.currentOrigin.v[0];
        _RCX->damageFrom.v[1] = v9->r.currentOrigin.v[1];
        _RCX->damageFrom.v[2] = v9->r.currentOrigin.v[2];
        v9->agent->damageFromWorld = 1;
      }
      v55 = v50 - 1;
      if ( !v45 )
        v55 = v50;
      if ( v55 > 0 )
      {
        v56 = v55;
        if ( (v9->flags.m_flags[0] & 2) != 0 && v9->health - v55 <= 0 )
          v56 = v9->health - 1;
        iDamageParts = v9->sentient->iDamageParts;
        if ( iDamageParts != -1 && tagName )
        {
          v58 = DamageParts_Get(iDamageParts);
          if ( !v58 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 599, ASSERT_TYPE_ASSERT, "(pParts)", (const char *)&queryFormat, "pParts") )
            __debugbreak();
          v56 = DamageParts::ApplyDamage(v58, pInflictor, Entity, &direction, &vectorValue, v56, damageFlags, v13, &outWeapon, outIsAlternate, hitLoc, modelIndex, tagName);
        }
        BG_SetPlayerDamageFlinch(&v9->agent->playerState, v56);
        v59 = pInflictor;
        G_CombatMP_SetAnimDamageTypeCondition(v9->agent->playerState.clientNum, v9, pInflictor, v13, &outWeapon, outIsAlternate);
        G_CombatMP_SetAnimHitLocationCondition(v9->agent->playerState.clientNum, v9, hitLoc);
        G_CombatMP_SetAnimHitDirectionCondition(v9->agent->playerState.clientNum, v9, &direction, &v9->agent->playerState, v13);
        G_CombatMP_SetAnimMoveDirectionCondition(v9->agent->playerState.clientNum, v9, &v9->agent->playerState);
        if ( v13 == MOD_MELEE )
          G_CombatMP_SetMeleeReactionConditions(v9->agent->playerState.clientNum, v59);
        if ( v56 )
        {
          v9->health -= v56;
          G_Combat_DamageNotifyNoWeapon(scr_const.damage, v9, Entity, v59, NULL, NULL, v56, 0);
          AIAgentInterface::AIAgentInterface(&v90);
          v91 = NULL;
          v90.__vftable = (AIAgentInterface_vtbl *)&AINewAgentInterface::`vftable';
          if ( SV_IsAgentScripted(v9) )
          {
            ScriptedAgentInfo = AIAgentInterface::GetScriptedAgentInfo(v9);
            if ( ScriptedAgentInfo )
            {
              v91 = &v90;
              AINewAgentInterface::SetAgent((AINewAgentInterface *)&v90, ScriptedAgentInfo);
            }
          }
          if ( v91 )
          {
            LOBYTE(means) = outIsAlternate;
            v91->Pain(v91, (gentity_s *)Entity, v56, &vectorValue, v13, &direction, hitLoc, &outWeapon, means);
          }
        }
        EntHandlerList = G_Main_GetEntHandlerList(v9);
        if ( !EntHandlerList->die )
          Com_Printf(1, "No die handler for player entity handler type %i entity(%d)", v9->handler, (unsigned int)v9->s.number);
        health = v9->health;
        if ( health > 0 )
        {
          pain = EntHandlerList->pain;
          if ( pain )
          {
            LOBYTE(means) = outIsAlternate;
            pain(v9, (gentity_s *)Entity, v56, &vectorValue, v13, &direction, hitLoc, &outWeapon, means);
          }
          AgentCmd_SendHitEvent(v9, v9, Entity, &outWeapon, outIsAlternate, tagName, &vectorValue, &direction, v13, hitLoc, 0);
          goto LABEL_116;
        }
        if ( (unsigned int)(health + 999) > 0x3E6 )
          v9->health = -999;
        if ( EntHandlerList->die )
        {
          v63 = v85;
          if ( v85 < 0 )
          {
            if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 641, ASSERT_TYPE_ASSERT, "(timeOffset >= 0)", (const char *)&queryFormat, "timeOffset >= 0") )
              __debugbreak();
            v63 = v85;
          }
          LOBYTE(localdir) = outIsAlternate;
          EntHandlerList->die(v9, pInflictor, (gentity_s *)Entity, v56, damageFlags, v13, &outWeapon, localdir, &direction, hitLoc, v63);
        }
        if ( BG_IsImpalingBullet(&outWeapon, outIsAlternate) && (damageFlags & 1) == 0 )
        {
          if ( tagName )
          {
            HitCorpseEntity = G_CombatMP_GetHitCorpseEntity(v9);
            v65 = HitCorpseEntity;
            if ( HitCorpseEntity )
            {
              if ( HitCorpseEntity->s.eType == ET_AGENT_CORPSE )
              {
                BulletSystem = GBullet::GetBulletSystem();
                if ( !BulletSystem && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 652, ASSERT_TYPE_ASSERT, "(bullet)", (const char *)&queryFormat, "bullet") )
                  __debugbreak();
                GBullet::RegisterImpaledEntity(BulletSystem, Entity, v65, &outWeapon, outIsAlternate, &vectorValue, &direction, hitLoc, tagName);
              }
            }
          }
        }
        v67 = outIsAlternate;
        v68 = G_CombatMP_GetHitCorpseEntity(v9);
        AgentCmd_SendHitEvent(v68, v9, Entity, &outWeapon, v67, tagName, &vectorValue, &direction, v13, hitLoc, 1);
        EntityIndex = G_GetEntityIndex(v9);
        if ( G_IsEntityInUse(EntityIndex) )
        {
LABEL_116:
          v71 = G_GetEntityIndex(v9);
          if ( !G_IsEntityInUse(v71) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 672, ASSERT_TYPE_ASSERT, "(G_IsEntityInUse( G_GetEntityIndex( pSelf ) ))", (const char *)&queryFormat, "G_IsEntityInUse( G_GetEntityIndex( pSelf ) )") )
            __debugbreak();
          v9->agent->playerState.stats[0] = v9->health;
        }
      }
    }
  }
LABEL_122:
  __asm
  {
    vmovaps xmm6, [rsp+1A0h+var_40]
    vmovaps xmm7, [rsp+1A0h+var_50]
    vmovaps xmm8, [rsp+1A0h+var_60]
  }
}

/*
==============
AgentCmd_SendHitEvent
==============
*/
void AgentCmd_SendHitEvent(const gentity_s *body, const gentity_s *victim, const gentity_s *attacker, const Weapon *weapon, const bool isAlternate, const scr_string_t partName, const vec3_t *point, const vec3_t *localdir, const meansOfDeath_t means, const hitLocation_t hitLoc, const bool isFatal)
{
  int v14; 
  GBullet *BulletSystem; 
  int HitEvent; 
  unsigned int v17; 
  GWeaponMap *Instance; 
  ClientBits *p_clientMask; 
  unsigned int m_objIndex; 
  __int64 v23; 
  bool v24; 
  GTurret **v25; 
  GTurret *v26; 
  __int64 v27; 
  __int64 v28; 
  bool v29; 
  BulletHitBoneInfo outHitInfo[2]; 
  BOOL v32; 

  if ( weapon->weaponIdx && BG_GetWeaponType(weapon, isAlternate) == WEAPTYPE_BULLET )
  {
    if ( (unsigned int)means >= MOD_NUM && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\bgame\\bg_public.h", 1114, ASSERT_TYPE_ASSERT, "(unsigned)( mod ) < (unsigned)( MOD_NUM )", "mod doesn't index MOD_NUM\n\t%i not in [0, %i)", means, 25) )
      __debugbreak();
    if ( (unsigned int)means <= MOD_FIRE_BULLET )
    {
      v14 = 1049094;
      if ( _bittest(&v14, means) )
      {
        if ( (unsigned int)(hitLoc - 20) > 1 )
        {
          if ( !body && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 277, ASSERT_TYPE_ASSERT, "( body )", (const char *)&queryFormat, "body") )
            __debugbreak();
          if ( !attacker && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 278, ASSERT_TYPE_ASSERT, "( attacker )", (const char *)&queryFormat, "attacker") )
            __debugbreak();
          if ( !Dvar_GetBool_Internal_DebugName(DVARBOOL_g_useHitLocationFix, "g_useHitLocationFix") || !G_Bullet_BoneHitEncode(body, partName, point, outHitInfo) )
          {
            *(_QWORD *)outHitInfo = 0i64;
            v32 = 0;
          }
          BulletSystem = GBullet::GetBulletSystem();
          if ( !BulletSystem && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 286, ASSERT_TYPE_ASSERT, "(bullet)", (const char *)&queryFormat, "bullet") )
            __debugbreak();
          v29 = GBullet::IncrementHitClientEventCount(BulletSystem, body->s.number);
          HitEvent = BG_WeaponBulletFire_GetHitEvent(means, 1);
          if ( !HitEvent && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 291, ASSERT_TYPE_SANITY, "( bulletEvent != EV_NONE )", (const char *)&queryFormat, "bulletEvent != EV_NONE") )
            __debugbreak();
          v17 = 0;
          v32 = v29;
          outHitInfo[1] = (BulletHitBoneInfo)GBullet::CalculateHitImpactSoundDelay(BulletSystem, attacker, victim);
          _RDI = G_Utils_SpawnEventEntity(point, HitEvent);
          Instance = GWeaponMap::GetInstance();
          BG_SetWeaponForEntity(Instance, &_RDI->s, weapon);
          _RDI->s.inAltWeaponMode = isAlternate;
          _RDI->s.eventParm = DirToByte(localdir);
          _RDI->s.eventParm2 = 0;
          _RDI->s.surfType = body->s.surfType;
          _RDI->s.otherEntityNum = attacker->s.number;
          _RDI->s.groundEntityNum = body->s.number;
          __asm
          {
            vmovsd  xmm0, qword ptr [rsp+0B8h+outHitInfo._bf_0]
            vmovsd  qword ptr [rdi+58h], xmm0
          }
          _RDI->s.lerp.u.anonymous.data[2] = v32;
          p_clientMask = &_RDI->clientMask;
          while ( !p_clientMask->array[0] )
          {
            ++v17;
            p_clientMask = (ClientBits *)((char *)p_clientMask + 4);
            if ( v17 >= 7 )
              goto LABEL_30;
          }
          if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 308, ASSERT_TYPE_ASSERT, "( eventEnt->clientMask.noBitsOn() )", (const char *)&queryFormat, "eventEnt->clientMask.noBitsOn()") )
            __debugbreak();
LABEL_30:
          if ( hitLoc == HITLOC_HEAD )
          {
            _RDI->s.eventParm2 |= 1u;
          }
          else if ( (unsigned int)(hitLoc - 6) <= 0xB )
          {
            _RDI->s.eventParm2 |= 0x40u;
          }
          if ( isFatal )
            _RDI->s.eventParm2 |= 2u;
          m_objIndex = attacker->turretHandle.m_objIndex;
          if ( m_objIndex )
          {
            v23 = m_objIndex - 1;
            if ( !(_BYTE)GTurret::ms_allocatedType && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_turret.h", 226, ASSERT_TYPE_ASSERT, "( ms_allocatedType != GameModeType::NONE )", (const char *)&queryFormat, "ms_allocatedType != GameModeType::NONE") )
              __debugbreak();
            if ( (unsigned int)v23 >= 0x80 )
            {
              LODWORD(v28) = 128;
              LODWORD(v27) = v23;
              if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_turret.h", 227, ASSERT_TYPE_ASSERT, "(unsigned)( turretIndex ) < (unsigned)( ( sizeof( *array_counter( ms_turretArray ) ) + 0 ) )", "turretIndex doesn't index ARRAY_COUNT( ms_turretArray )\n\t%i not in [0, %i)", v27, v28) )
                __debugbreak();
            }
            v24 = GTurret::ms_turretArray[v23] == NULL;
            v25 = &GTurret::ms_turretArray[v23];
            if ( v24 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_turret.h", 228, ASSERT_TYPE_ASSERT, "( ms_turretArray[turretIndex] )", (const char *)&queryFormat, "ms_turretArray[turretIndex]") )
              __debugbreak();
            v26 = *v25;
            if ( !v26 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 378, ASSERT_TYPE_ASSERT, "(turret)", (const char *)&queryFormat, "turret") )
              __debugbreak();
            v26->m_data.flags |= 0x10000u;
          }
          G_BulletMP_MarkPotentialImpactFixup(_RDI, _RDI->s.groundEntityNum, partName);
        }
      }
    }
  }
}

/*
==============
AgentCmd_SetAgentAttacker
==============
*/
void AgentCmd_SetAgentAttacker(scrContext_t *scrContext, scr_entref_t entref)
{
  unsigned int entnum; 
  gentity_s *v4; 
  const char *v5; 
  gentity_s *Entity; 
  bot_data_t *BotDataForEnt; 

  entnum = entref.entnum;
  if ( entref.entclass )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    v4 = NULL;
  }
  else
  {
    if ( entref.entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 694, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    v4 = &g_entities[entnum];
    if ( !v4->agent )
    {
      v5 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v5);
    }
  }
  Entity = GScr_GetEntity(0);
  if ( SV_IsAgentBot(v4->s.number) )
  {
    BotDataForEnt = Agent_GetBotDataForEnt(v4);
    Bot_SetAttacker(BotDataForEnt, Entity);
  }
}

/*
==============
AgentCmd_SetAgentBounds
==============
*/
void AgentCmd_SetAgentBounds(scrContext_t *scrContext, scr_entref_t entref)
{
  unsigned int entnum; 
  const char *v8; 
  unsigned int NumParam; 
  bool v11; 
  VariableType Type; 

  __asm { vmovaps [rsp+58h+var_18], xmm6 }
  entnum = entref.entnum;
  __asm { vmovaps [rsp+58h+var_28], xmm7 }
  if ( entref.entclass )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    _RSI = NULL;
  }
  else
  {
    if ( entref.entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 127, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    _RSI = &g_entities[entnum];
    if ( !_RSI->agent )
    {
      v8 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v8);
    }
  }
  if ( Scr_GetNumParam(scrContext) && Scr_GetType(scrContext, 0) )
  {
    *(double *)&_XMM0 = Scr_GetFloat(scrContext, 0);
    __asm { vmovaps xmm6, xmm0 }
  }
  else
  {
    __asm { vmovss  xmm6, dword ptr cs:?actorBox@@3UBounds@@B.halfSize; Bounds const actorBox }
  }
  NumParam = Scr_GetNumParam(scrContext);
  v11 = NumParam == 0;
  if ( NumParam > 1 && (Type = Scr_GetType(scrContext, 1u), v11 = 0, Type) )
  {
    *(double *)&_XMM0 = Scr_GetFloat(scrContext, 1u);
    __asm { vmulss  xmm7, xmm0, cs:__real@3f000000 }
  }
  else
  {
    __asm { vmovss  xmm7, dword ptr cs:?actorBox@@3UBounds@@B.halfSize+8; Bounds const actorBox }
  }
  __asm { vcomiss xmm7, xmm6 }
  if ( v11 )
    Scr_Error(COM_ERR_5656, scrContext, "Cannot create capsule with radius larger than half the height");
  __asm
  {
    vaddss  xmm3, xmm7, dword ptr cs:?vec3_origin@@3Tvec3_t@@B+8; vec3_t const vec3_origin
    vmovss  xmm2, dword ptr cs:?vec3_origin@@3Tvec3_t@@B+4; vec3_t const vec3_origin
    vmovss  xmm1, dword ptr cs:?vec3_origin@@3Tvec3_t@@B; vec3_t const vec3_origin
    vmovss  dword ptr [rsi+100h], xmm1
    vmovss  dword ptr [rsi+104h], xmm2
    vmovss  dword ptr [rsi+108h], xmm3
    vmovss  dword ptr [rsi+10Ch], xmm6
    vmovss  dword ptr [rsi+110h], xmm6
    vmovaps xmm6, [rsp+58h+var_18]
    vmovss  dword ptr [rsi+114h], xmm7
    vmovaps xmm7, [rsp+58h+var_28]
  }
}

/*
==============
AgentCmd_SetCorpseModel
==============
*/
void AgentCmd_SetCorpseModel(scrContext_t *scrContext, scr_entref_t entref)
{
  gentity_s *Entity; 
  const char *String; 
  int ModelIndex; 
  AgentAttachModelData *attachModels; 
  __int64 v7; 
  __int64 AgentCorpseIndex; 
  GameScriptDataMP *GameScriptDataMP; 
  GWeaponMap *Instance; 
  DObj *ServerDObjForEnt; 
  __int64 v12; 
  int v13; 

  Entity = GetEntity(entref);
  if ( Entity->s.eType != ET_AGENT_CORPSE )
    Scr_Error(COM_ERR_6326, scrContext, "Function only valid on agent corpses.");
  String = Scr_GetString(scrContext, 0);
  if ( !GConfigStrings::ms_gConfigStrings && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_configstrings.h", 71, ASSERT_TYPE_ASSERT, "( ms_gConfigStrings )", (const char *)&queryFormat, "ms_gConfigStrings") )
    __debugbreak();
  ModelIndex = GConfigStrings::GetModelIndex(GConfigStrings::ms_gConfigStrings, String);
  LerpEntityStateAgentCorpse::SetModelIndex((LerpEntityStateAgentCorpse *)&Entity->s.lerp.u, ModelIndex);
  if ( Scr_GetInt(scrContext, 1u) )
  {
    attachModels = Entity->s.lerp.u.agentCorpse.attachModels;
    v7 = 8i64;
    do
    {
      AgentAttachModelData::Clear(attachModels++);
      --v7;
    }
    while ( v7 );
  }
  AgentCorpseIndex = G_PlayerCorpseMP_GetAgentCorpseIndex(Entity);
  GameScriptDataMP = GameScriptDataMP::GetGameScriptDataMP();
  if ( (unsigned int)AgentCorpseIndex >= 8 )
  {
    v13 = 8;
    LODWORD(v12) = AgentCorpseIndex;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 982, ASSERT_TYPE_ASSERT, "(unsigned)( corpseIndex ) < (unsigned)( ( sizeof( *array_counter( gScrData->agentCorpseInfo ) ) + 0 ) )", "corpseIndex doesn't index ARRAY_COUNT( gScrData->agentCorpseInfo )\n\t%i not in [0, %i)", v12, v13) )
      __debugbreak();
  }
  Instance = GWeaponMap::GetInstance();
  ServerDObjForEnt = Com_GetServerDObjForEnt(Entity);
  BG_AnimationMP_UpdateAgentCorpseDObj(LOCAL_CLIENT_INVALID, ServerDObjForEnt, Instance, &Entity->s, &GameScriptDataMP->agentCorpseInfo[AgentCorpseIndex].ci);
}

/*
==============
AgentCmd_SpawnAgent
==============
*/
void AgentCmd_SpawnAgent(scrContext_t *scrContext, scr_entref_t entref)
{
  const char *String; 
  unsigned int entnum; 
  bool bLegacyAgent; 
  gentity_s *v10; 
  const char *v11; 
  const char *v12; 
  unsigned int NumParam; 
  bool v15; 
  VariableType Type; 
  const gentity_s *Entity; 
  __int16 EntityIndex; 
  unsigned int ownerNum; 
  bool freezeControls; 
  Bounds bounds; 
  vec3_t angles; 
  vec3_t vectorValue; 
  char v31; 
  void *retaddr; 

  _RAX = &retaddr;
  __asm
  {
    vmovaps xmmword ptr [rax-38h], xmm6
    vmovaps xmmword ptr [rax-48h], xmm7
  }
  String = NULL;
  entnum = entref.entnum;
  bLegacyAgent = 1;
  if ( entref.entclass )
  {
    Scr_ObjectError(COM_ERR_3618, scrContext, "not an entity");
    v10 = NULL;
  }
  else
  {
    if ( entref.entnum >= 0x800 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\server_mp\\sv_agent_scr.cpp", 176, ASSERT_TYPE_ASSERT, "(entref.entnum < ( 2048 ))", (const char *)&queryFormat, "entref.entnum < MAX_GENTITIES") )
      __debugbreak();
    v10 = &g_entities[entnum];
    if ( !v10->agent )
    {
      v11 = j_va("entity %i is not an agent", entnum);
      Scr_ObjectError(COM_ERR_3617, scrContext, v11);
    }
  }
  Scr_GetVector(scrContext, 0, &vectorValue);
  Scr_GetVector(scrContext, 1u, &angles);
  if ( !*(_QWORD *)&GStatic::ms_gameStatics && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_static.h", 64, ASSERT_TYPE_ASSERT, "( ms_gameStatics )", (const char *)&queryFormat, "ms_gameStatics") )
    __debugbreak();
  if ( *(_QWORD *)((*(__int64 (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)&GStatic::ms_gameStatics + 224i64))(*(_QWORD *)&GStatic::ms_gameStatics, (unsigned int)v10->s.number) + 2040) )
  {
    v12 = j_va(&byte_1440C2820, (unsigned int)v10->s.number);
    Scr_Error(COM_ERR_3622, scrContext, v12);
  }
  if ( Scr_GetNumParam(scrContext) > 2 && Scr_GetType(scrContext, 2u) )
    String = Scr_GetString(scrContext, 2u);
  if ( Scr_GetNumParam(scrContext) > 3 && Scr_GetType(scrContext, 3u) )
  {
    *(double *)&_XMM0 = Scr_GetFloat(scrContext, 3u);
    __asm { vmovaps xmm7, xmm0 }
  }
  else
  {
    __asm { vmovss  xmm7, dword ptr cs:?actorBox@@3UBounds@@B.halfSize; Bounds const actorBox }
  }
  NumParam = Scr_GetNumParam(scrContext);
  v15 = NumParam < 4;
  if ( NumParam > 4 && (Type = Scr_GetType(scrContext, 4u), v15 = 0, Type) )
  {
    *(double *)&_XMM0 = Scr_GetFloat(scrContext, 4u);
    __asm { vmulss  xmm6, xmm0, cs:__real@3f000000 }
  }
  else
  {
    __asm { vmovss  xmm6, dword ptr cs:?actorBox@@3UBounds@@B.halfSize+8; Bounds const actorBox }
  }
  __asm { vcomiss xmm6, xmm7 }
  if ( v15 )
    Scr_Error(COM_ERR_3623, scrContext, "Cannot create capsule with radius larger than half the height");
  if ( Scr_GetNumParam(scrContext) > 5 && Scr_GetType(scrContext, 5u) == VAR_POINTER )
  {
    Entity = GScr_GetEntity(5u);
    EntityIndex = G_GetEntityIndex(Entity);
    if ( !G_IsEntityInUse(EntityIndex) )
      Scr_Error(COM_ERR_3624, scrContext, "ERROR: Cannot set owner that is not in use.");
    ownerNum = Entity->s.number;
  }
  else
  {
    ownerNum = 2047;
  }
  freezeControls = Scr_GetNumParam(scrContext) > 6 && Scr_GetType(scrContext, 6u) && Scr_GetInt(scrContext, 6u);
  if ( Scr_GetNumParam(scrContext) > 7 && Scr_GetType(scrContext, 7u) )
    bLegacyAgent = Scr_GetInt(scrContext, 7u) != 0;
  __asm
  {
    vmovss  xmm0, dword ptr cs:?vec3_origin@@3Tvec3_t@@B; vec3_t const vec3_origin
    vmovss  xmm1, dword ptr cs:?vec3_origin@@3Tvec3_t@@B+4; vec3_t const vec3_origin
    vaddss  xmm2, xmm6, dword ptr cs:?vec3_origin@@3Tvec3_t@@B+8; vec3_t const vec3_origin
    vmovss  dword ptr [rsp+0C8h+bounds.midPoint], xmm0
    vmovss  dword ptr [rsp+0C8h+bounds.midPoint+4], xmm1
    vmovss  dword ptr [rsp+0C8h+bounds.midPoint+8], xmm2
    vmovss  dword ptr [rsp+0C8h+bounds.halfSize], xmm7
    vmovss  dword ptr [rsp+0C8h+bounds.halfSize+4], xmm7
    vmovss  dword ptr [rsp+0C8h+bounds.halfSize+8], xmm6
  }
  Agent_Spawn(v10, &vectorValue, &angles, String, &bounds, ownerNum, freezeControls, bLegacyAgent);
  _R11 = &v31;
  __asm
  {
    vmovaps xmm6, xmmword ptr [r11-10h]
    vmovaps xmm7, xmmword ptr [r11-20h]
  }
}

/*
==============
ScrAgentCmd_BeginMelee
==============
*/
void ScrAgentCmd_BeginMelee(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3663, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_ClaimNode
==============
*/
void ScrAgentCmd_ClaimNode(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3654, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_DoAnimLerp
==============
*/
void ScrAgentCmd_DoAnimLerp(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3667, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_DoAnimRelative
==============
*/
void ScrAgentCmd_DoAnimRelative(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3671, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_DoTrajectory
==============
*/
void ScrAgentCmd_DoTrajectory(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3665, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_GetGoalPos
==============
*/
void ScrAgentCmd_GetGoalPos(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3634, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_GetLookaheadDir
==============
*/
void ScrAgentCmd_GetLookaheadDir(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3629, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_GetMaxTurnSpeed
==============
*/
void ScrAgentCmd_GetMaxTurnSpeed(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3659, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_GetPathGoalPos
==============
*/
void ScrAgentCmd_GetPathGoalPos(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3631, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_IsStuck
==============
*/
void ScrAgentCmd_IsStuck(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3676, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_RelinquishClaimedNode
==============
*/
void ScrAgentCmd_RelinquishClaimedNode(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3656, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_RequestStopSoonNotify
==============
*/
void ScrAgentCmd_RequestStopSoonNotify(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3640, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetAnimMode
==============
*/
void ScrAgentCmd_SetAnimMode(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3647, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetAnimScale
==============
*/
void ScrAgentCmd_SetAnimScale(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3639, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetClipMode
==============
*/
void ScrAgentCmd_SetClipMode(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3652, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetGoalEntity
==============
*/
void ScrAgentCmd_SetGoalEntity(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3636, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetGoalNode
==============
*/
void ScrAgentCmd_SetGoalNode(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3635, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetGoalPos
==============
*/
void ScrAgentCmd_SetGoalPos(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3632, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetGoalRadius
==============
*/
void ScrAgentCmd_SetGoalRadius(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3637, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetMaxTurnSpeed
==============
*/
void ScrAgentCmd_SetMaxTurnSpeed(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3660, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetOrientMode
==============
*/
void ScrAgentCmd_SetOrientMode(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3643, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetPhysicsMode
==============
*/
void ScrAgentCmd_SetPhysicsMode(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3650, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetScripted
==============
*/
void ScrAgentCmd_SetScripted(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3669, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetUnitType
==============
*/
void ScrAgentCmd_SetUnitType(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3675, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetViewHeight
==============
*/
void ScrAgentCmd_SetViewHeight(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3661, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetWallRunCost
==============
*/
void ScrAgentCmd_SetWallRunCost(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3672, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_SetWaypoint
==============
*/
void ScrAgentCmd_SetWaypoint(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3638, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
ScrAgentCmd_UseModelCollisionBounds
==============
*/
void ScrAgentCmd_UseModelCollisionBounds(scrContext_t *scrContext, scr_entref_t entref)
{
  Scr_Error(COM_ERR_3658, scrContext, "Legacy agent script commands no longer supported");
}

/*
==============
Scr_GetMaxAgents
==============
*/
void Scr_GetMaxAgents(scrContext_t *scrContext)
{
  int AgentCount; 

  AgentCount = SV_GameMP_GetAgentCount();
  Scr_AddInt(scrContext, AgentCount);
}

