/*
==============
ParticleModuleTestImpact::Update
==============
*/

void __fastcall ParticleModuleTestImpact::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestImpact@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestAge::Update
==============
*/

void __fastcall ParticleModuleTestAge::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestAge@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestAge::Init
==============
*/

void __fastcall ParticleModuleTestAge::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestAge@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestPos::Update
==============
*/

void __fastcall ParticleModuleTestPos::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestPos@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
Particle_GenerateMatrixFromLookAt2
==============
*/

void __fastcall Particle_GenerateMatrixFromLookAt2(const float4 *normalAxis, const float4 *incommingXAxis, const float4 *incommingZAxis, vector3 *outMatrix)
{
  ?Particle_GenerateMatrixFromLookAt2@@YAXAEBUfloat4@@00AEAUvector3@@@Z(normalAxis, incommingXAxis, incommingZAxis, outMatrix);
}

/*
==============
ParticleModuleTestDeath::Init
==============
*/

void __fastcall ParticleModuleTestDeath::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestDeath@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestGravity::Init
==============
*/

void __fastcall ParticleModuleTestGravity::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestGravity@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestDeath::Update
==============
*/

void __fastcall ParticleModuleTestDeath::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestDeath@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestBirth::Init
==============
*/

void __fastcall ParticleModuleTestBirth::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestBirth@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestTimeInState::Update
==============
*/

void __fastcall ParticleModuleTestTimeInState::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestTimeInState@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestImpact::Init
==============
*/

void __fastcall ParticleModuleTestImpact::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestImpact@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestBirth::Update
==============
*/

void __fastcall ParticleModuleTestBirth::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestBirth@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestTimeInState::Init
==============
*/

void __fastcall ParticleModuleTestTimeInState::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestTimeInState@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestGravity::Update
==============
*/

void __fastcall ParticleModuleTestGravity::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestGravity@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestPos::Init
==============
*/

void __fastcall ParticleModuleTestPos::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestPos@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestAge::Init
==============
*/
void ParticleModuleTestAge::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestBirth::Init
==============
*/
void ParticleModuleTestBirth::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestDeath::Init
==============
*/
void ParticleModuleTestDeath::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestGravity::Init
==============
*/
void ParticleModuleTestGravity::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestImpact::Init
==============
*/
void ParticleModuleTestImpact::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestPos::Init
==============
*/
void ParticleModuleTestPos::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestTimeInState::Init
==============
*/
void ParticleModuleTestTimeInState::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
Particle_GenerateMatrixFromLookAt2
==============
*/
void Particle_GenerateMatrixFromLookAt2(const float4 *normalAxis, const float4 *incommingXAxis, const float4 *incommingZAxis, vector3 *outMatrix)
{
  char v8; 

  __asm
  {
    vmovss  xmm1, dword ptr [rcx+0Ch]
    vxorps  xmm0, xmm0, xmm0
    vucomiss xmm1, xmm0
  }
  _RSI = outMatrix;
  _RDI = incommingZAxis;
  _RBP = incommingXAxis;
  _RBX = normalAxis;
  if ( !v8 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 465, ASSERT_TYPE_ASSERT, "(Float4ExtractW( normalAxis ) == 0.0f)", (const char *)&queryFormat, "Float4ExtractW( normalAxis ) == 0.0f") )
    __debugbreak();
  __asm
  {
    vmovups xmm4, xmmword ptr cs:?g_negativeZero@@3Ufloat4@@B.v; float4 const g_negativeZero
    vandnps xmm1, xmm4, xmmword ptr [rbx]
    vmovups xmm0, xmmword ptr cs:?g_equalsEpsilon@@3Ufloat4@@B.v; float4 const g_equalsEpsilon
    vcmpltps xmm1, xmm0, xmm1
    vmovmskps eax, xmm1
  }
  if ( (_EAX & 0xF) != 0 )
  {
    __asm
    {
      vmovups xmm3, xmmword ptr [rbx]
      vmulps  xmm1, xmm3, xmm3
      vinsertps xmm2, xmm1, xmm1, 8
      vhaddps xmm0, xmm2, xmm2
      vhaddps xmm0, xmm0, xmm0
      vsqrtps xmm1, xmm0
      vmovaps [rsp+78h+var_18], xmm6
      vmovaps [rsp+78h+var_28], xmm7
      vdivps  xmm7, xmm3, xmm1
      vmulps  xmm1, xmm7, xmmword ptr [rdi]
      vinsertps xmm2, xmm1, xmm1, 8
      vhaddps xmm0, xmm2, xmm2
      vhaddps xmm0, xmm0, xmm0
      vandnps xmm1, xmm4, xmm0
      vcomiss xmm1, cs:__real@3f7fbe77
      vmovaps [rsp+78h+var_38], xmm8
    }
    if ( (_EAX & 0xF) != 0 )
    {
      __asm
      {
        vmovups xmm1, xmmword ptr [rbp+0]
        vshufps xmm0, xmm1, xmm1, 0D2h ; 'Ò'
        vshufps xmm1, xmm1, xmm1, 0C9h ; 'É'
        vshufps xmm6, xmm7, xmm7, 0D2h ; 'Ò'
        vmulps  xmm2, xmm1, xmm6
        vshufps xmm5, xmm7, xmm7, 0C9h ; 'É'
        vmulps  xmm3, xmm0, xmm5
        vsubps  xmm4, xmm3, xmm2
        vmulps  xmm0, xmm4, xmm4
        vinsertps xmm1, xmm0, xmm0, 8
        vhaddps xmm2, xmm1, xmm1
        vhaddps xmm0, xmm2, xmm2
        vsqrtps xmm1, xmm0
        vdivps  xmm4, xmm4, xmm1
        vshufps xmm0, xmm4, xmm4, 0D2h ; 'Ò'
        vshufps xmm1, xmm4, xmm4, 0C9h ; 'É'
        vmulps  xmm3, xmm0, xmm5
        vmulps  xmm2, xmm1, xmm6
        vsubps  xmm8, xmm2, xmm3
      }
    }
    else
    {
      __asm
      {
        vmovups xmm1, xmmword ptr [rdi]
        vshufps xmm0, xmm1, xmm1, 0C9h ; 'É'
        vshufps xmm1, xmm1, xmm1, 0D2h ; 'Ò'
        vshufps xmm6, xmm7, xmm7, 0C9h ; 'É'
        vmulps  xmm2, xmm1, xmm6
        vshufps xmm5, xmm7, xmm7, 0D2h ; 'Ò'
        vmulps  xmm3, xmm0, xmm5
        vsubps  xmm4, xmm3, xmm2
        vmulps  xmm0, xmm4, xmm4
        vinsertps xmm1, xmm0, xmm0, 8
        vhaddps xmm2, xmm1, xmm1
        vhaddps xmm0, xmm2, xmm2
        vsqrtps xmm1, xmm0
        vdivps  xmm8, xmm4, xmm1
        vshufps xmm0, xmm8, xmm8, 0C9h ; 'É'
        vshufps xmm1, xmm8, xmm8, 0D2h ; 'Ò'
        vmulps  xmm3, xmm0, xmm5
        vmulps  xmm2, xmm1, xmm6
        vsubps  xmm4, xmm2, xmm3
      }
    }
    __asm
    {
      vmovups xmmword ptr [rsi], xmm8
      vmovups xmmword ptr [rsi+10h], xmm4
      vmovups xmmword ptr [rsi+20h], xmm7
    }
    Particle_AssertFloat4IsNormalized(&_RSI->x);
    Particle_AssertFloat4IsNormalized(&_RSI->y);
    Particle_AssertFloat4IsNormalized(&_RSI->z);
    __asm
    {
      vmovaps xmm8, [rsp+78h+var_38]
      vmovaps xmm7, [rsp+78h+var_28]
      vmovaps xmm6, [rsp+78h+var_18]
    }
  }
  else
  {
    __asm
    {
      vmovups xmm0, xmmword ptr cs:?identityMatrix44@@3T?$tmat44_t@Tvec4_t@@@@B; tmat44_t<vec4_t> const identityMatrix44
      vmovups xmmword ptr [rsi], xmm0
      vmovups xmm1, xmmword ptr cs:?identityMatrix44@@3T?$tmat44_t@Tvec4_t@@@@B+10h; tmat44_t<vec4_t> const identityMatrix44
      vmovups xmmword ptr [rsi+10h], xmm1
      vmovups xmm0, xmmword ptr cs:?identityMatrix44@@3T?$tmat44_t@Tvec4_t@@@@B+20h; tmat44_t<vec4_t> const identityMatrix44
      vmovups xmmword ptr [rsi+20h], xmm0
    }
  }
}

/*
==============
Particle_HandleSuccessfulTest
==============
*/
void Particle_HandleSuccessfulTest(ParticleManager *pManager, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState, LocalClientNum_t localClientNum, unsigned int currentTime, const ParticleModuleTest *pTestModule, unsigned int moduleIndexFlag, unsigned int *moduleTests, unsigned int *state, unsigned int *flags, int randomSeed, const float4 *pos, bool hasWorldPosition, const float4 *size, const float4 *velocity, const float4 *rotationAngle, const vector4 *rEmitterTransform, const ParticleSystemDef *const systemDefOverride, const Particle_OnImpactData *pImpactData)
{
  ParticleUseOrientationOptions m_useOrientationOptions; 
  __int64 v33; 
  bool v34; 
  bool hasRotation; 
  FxMarkSpawnData *pMarkSpawnData; 
  const ParticleModuleInitRelativeVelocity *m_pModuleInitRelativeVelocity; 
  int dobjHandle; 
  unsigned int v84; 
  const DObj *ClientDObj; 
  bool v86; 
  scr_string_t partName; 
  int entNum; 
  int v90; 
  __int64 v136; 
  CgEntitySystem *v137; 
  ParticleSystem *v138; 
  const char *name; 
  const char *v140; 
  const dvar_t *v141; 
  TraceHitType hitType; 
  unsigned int v143; 
  unsigned int LinkObject; 
  unsigned int v145; 
  unsigned __int16 v146; 
  const DObj *v147; 
  char v148; 
  ParticleEmitter *v149; 
  const ParticleSystem *pParentSystem; 
  ParticleSystemHandle v151; 
  unsigned int v152; 
  ParticleUseVelocityOptions m_useVelocityOptions; 
  __int64 v154; 
  ParticleUseScaleOptions m_useScaleOptions; 
  ParticleSystem *v156; 
  const ParticleSystem *v157; 
  ParticleSystem *SystemOwner; 
  const ParticleSystemDef *Def; 
  vector4 *v160; 
  vector4 *v161; 
  __int64 useOrientationOptions; 
  __int64 useOrientationOptionsa; 
  unsigned __int8 inOutIndex; 
  char v165; 
  unsigned int v166; 
  FxMarkSpawnData v167; 
  unsigned int v168; 
  unsigned int boneIndex; 
  ParticleEmitter *v170; 
  ParticleSystemFlags spawnFlags; 
  ParticleLinkedAssetListDef *pLinkedAssetList; 
  ParticleManager *pManagera; 
  float4 *v174; 
  int modelIndex; 
  int v176; 
  ParticleSystemDef *v177; 
  float4 *v178; 
  unsigned int *v179; 
  orientation_t *boltOffset[2]; 
  orientation_t orFirst; 
  vector4 outParticleTransform; 
  orientation_t orient; 
  orientation_t out; 
  orientation_t v185; 

  m_useOrientationOptions = pTestModule->m_useOrientationOptions;
  _RBX = pos;
  _R14 = rEmitterTransform;
  v178 = (float4 *)size;
  pManagera = pManager;
  v174 = (float4 *)velocity;
  v33 = localClientNum;
  *state = pTestModule->m_eventHandlerData.m_nextState;
  v34 = !pTestModule->m_eventHandlerData.m_kill;
  v170 = (ParticleEmitter *)pEmitterOwner;
  v179 = moduleTests;
  v177 = (ParticleSystemDef *)systemDefOverride;
  if ( !v34 )
    *flags |= 1u;
  if ( pTestModule->m_eventHandlerData.m_linkedAssetList.numAssets <= 0 && !systemDefOverride )
    goto LABEL_88;
  if ( pManagera->m_archiveState == ARCHIVE_STATE_RESTORING )
  {
    SystemOwner = (ParticleSystem *)ParticleEmitter::GetSystemOwner((ParticleEmitter *)pEmitterOwner);
    Def = ParticleSystem::GetDef(SystemOwner);
    Com_PrintWarning(21, "Can't create child effects during a savegame restore- killed 1 spawn (from an Event Module) for this emitter : %s \n", Def->name);
LABEL_88:
    *moduleTests |= moduleIndexFlag;
    return;
  }
  hasRotation = (pParticleState->m_pStateDef->flags & 0xF0) != 0;
  pMarkSpawnData = NULL;
  if ( systemDefOverride )
    pLinkedAssetList = NULL;
  else
    pLinkedAssetList = &pTestModule->m_eventHandlerData.m_linkedAssetList;
  ParticleEmitter::GetChildOrientation((ParticleEmitter *)pEmitterOwner, pos, v174, rotationAngle, hasRotation, rEmitterTransform, m_useOrientationOptions, 0, &outParticleTransform);
  if ( hasWorldPosition )
  {
    __asm
    {
      vmovups xmm0, xmmword ptr [rbx]
      vmovups xmmword ptr [rbp+1E0h+var_1C0.w.v], xmm0
    }
  }
  else
  {
    m_pModuleInitRelativeVelocity = pParticleState->m_pModuleInitRelativeVelocity;
    if ( !m_pModuleInitRelativeVelocity || (m_pModuleInitRelativeVelocity->m_flags & 1) != 0 || ((m_pModuleInitRelativeVelocity->m_velocityType - 3) & 0xFFFFFFFD) != 0 )
    {
      __asm
      {
        vmovups xmm0, xmmword ptr [rbx]
        vmovups xmmword ptr [rbp+1E0h+var_1C0.w.v], xmm0
      }
    }
    else
    {
      __asm
      {
        vmovups xmm0, xmmword ptr [rbx]
        vmovups xmm1, xmmword ptr [r14+30h]
        vshufps xmm2, xmm0, xmm0, 0AAh ; 'ª'
        vshufps xmm3, xmm0, xmm0, 55h ; 'U'
        vshufps xmm4, xmm0, xmm0, 0
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm2
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm3
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm3
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
        vmovups xmm0, xmmword ptr [r14+20h]
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm4
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm4
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm2
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm2
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
        vmulps  xmm0, xmm0, xmm2
        vaddps  xmm2, xmm1, xmm0
        vmovups xmm0, xmmword ptr [r14+10h]
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm2
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm3
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm2
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
        vmulps  xmm0, xmm0, xmm3
        vaddps  xmm1, xmm0, xmm2
        vmovups xmm0, xmmword ptr [r14]
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm3
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm2
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm1
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm4
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm1
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm4
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
        vmulps  xmm0, xmm0, xmm4
        vaddps  xmm1, xmm0, xmm1
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm1
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm1
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm1
        vmovdqa xmmword ptr [rbp+1E0h+var_1C0.w.v], xmm1
      }
    }
    if ( (pParticleState->m_pStateDef->flags & 0x10000000) != 0 )
    {
      _RAX = ParticleEmitter::GetSystemOwner(v170);
      __asm
      {
        vmovups xmm0, xmmword ptr [rbp+1E0h+var_1C0.w.v]
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
        vmovups xmm1, xmmword ptr [rax+30h]
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
        vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
        vaddps  xmm0, xmm0, xmm1
        vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm0
        vmovdqa xmmword ptr [rbp+1E0h+var_1C0.w.v], xmm0
      }
    }
  }
  boneIndex = 0xFFFF;
  boltOffset[0] = NULL;
  dobjHandle = 4095;
  v168 = 4095;
  spawnFlags = PARTICLE_SYSTEM_FLAG_NONE;
  if ( !pImpactData )
    goto LABEL_79;
  FxMarkSpawnData::SetDefaults(&v167);
  if ( (pTestModule->m_flags & 0x10000) != 0 && pImpactData->hitType == TRACE_HITTYPE_ENTITY && (v84 = pImpactData->entNum, v84 < 0x7FE) && particle_on_impact_entity_bolt_killswitch->current.enabled )
  {
    v165 = 0;
    inOutIndex = -2;
    if ( FX_GetBoneOrientation_IsDObjEntityValid((LocalClientNum_t)v33, v84) )
    {
      ClientDObj = Com_GetClientDObj(pImpactData->entNum, (LocalClientNum_t)v33);
      v86 = ClientDObj != NULL;
      if ( ClientDObj )
      {
        partName = pImpactData->partName;
        if ( partName )
        {
          if ( DObjGetBoneIndexInternal_90(ClientDObj, partName, &inOutIndex, &modelIndex) )
          {
            entNum = pImpactData->entNum;
            __asm
            {
              vmovaps [rsp+300h+var_50], xmm6
              vmovaps [rsp+300h+var_60], xmm7
              vmovaps [rsp+300h+var_70], xmm8
              vmovaps [rsp+300h+var_80], xmm9
              vmovaps [rsp+300h+var_90], xmm10
              vmovaps [rsp+300h+var_A0], xmm11
              vstmxcsr [rbp+1E0h+var_25C]
            }
            LOWORD(v166) = _ET0;
            __asm { vmovaps [rsp+300h+var_B0], xmm12 }
            v90 = v166 & 0x1F80;
            __asm
            {
              vstmxcsr [rbp+1E0h+var_25C]
              vmovaps [rsp+300h+var_C0], xmm13
            }
            v166 |= 0x1F80u;
            __asm
            {
              vmovaps [rsp+300h+var_D0], xmm14
              vmovaps [rsp+300h+var_E0], xmm15
              vldmxcsr [rbp+1E0h+var_25C]
            }
            if ( FX_GetBoneOrientation((LocalClientNum_t)v33, entNum, inOutIndex, &orient) )
            {
              __asm
              {
                vmovups xmm1, xmmword ptr [rbp+1E0h+var_1C0.baseclass_0.x.v]
                vmovups xmm2, xmmword ptr [rbp+1E0h+var_1C0.w.v]
                vshufps xmm0, xmm1, xmm1, 55h ; 'U'
                vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovss  dword ptr [rbp+1E0h+orFirst.axis], xmm1
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vshufps xmm1, xmm1, xmm1, 0AAh ; 'ª'
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovss  dword ptr [rbp+1E0h+orFirst.axis+8], xmm1
                vmovups xmm1, xmmword ptr [rbp+1E0h+var_1C0.baseclass_0.y.v]
                vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovss  dword ptr [rbp+1E0h+orFirst.axis+0Ch], xmm1
                vmovss  dword ptr [rbp+1E0h+orFirst.axis+4], xmm0
                vshufps xmm0, xmm1, xmm1, 55h ; 'U'
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vshufps xmm1, xmm1, xmm1, 0AAh ; 'ª'
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovss  dword ptr [rbp+1E0h+orFirst.axis+14h], xmm1
                vmovups xmm1, xmmword ptr [rbp+1E0h+var_1C0.baseclass_0.z.v]
                vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovss  dword ptr [rbp+1E0h+orFirst.axis+10h], xmm0
                vshufps xmm0, xmm1, xmm1, 55h ; 'U'
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovss  dword ptr [rbp+1E0h+orFirst.axis+18h], xmm1
                vshufps xmm1, xmm1, xmm1, 0AAh ; 'ª'
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovdqa xmmword ptr [rbp+1E0h+var_200], xmm2
                vmovss  dword ptr [rbp+1E0h+orFirst.axis+1Ch], xmm0
                vshufps xmm0, xmm2, xmm2, 55h ; 'U'
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm2
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm2
                vmovss  dword ptr [rbp+1E0h+orFirst.axis+20h], xmm1
                vshufps xmm1, xmm2, xmm2, 0AAh ; 'ª'
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm0
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm2
                vmovups xmmword ptr [rbp+1E0h+var_200], xmm1
                vmovss  dword ptr [rbp+1E0h+orFirst.origin], xmm2
                vmovss  dword ptr [rbp+1E0h+orFirst.origin+4], xmm0
                vmovss  dword ptr [rbp+1E0h+orFirst.origin+8], xmm1
              }
              OrientationInvert(&orient, &out);
              OrientationConcatenate(&orFirst, &out, &v185);
              v165 = 1;
              boltOffset[0] = &v185;
              v168 = pImpactData->entNum;
              boneIndex = inOutIndex;
            }
            __asm { vstmxcsr [rbp+1E0h+var_25C] }
            v166 = v90 | v166 & 0xFFFFE07F;
            __asm
            {
              vldmxcsr [rbp+1E0h+var_25C]
              vmovaps xmm15, [rsp+300h+var_E0]
              vmovaps xmm14, [rsp+300h+var_D0]
              vmovaps xmm13, [rsp+300h+var_C0]
              vmovaps xmm12, [rsp+300h+var_B0]
              vmovaps xmm11, [rsp+300h+var_A0]
              vmovaps xmm10, [rsp+300h+var_90]
              vmovaps xmm9, [rsp+300h+var_80]
              vmovaps xmm8, [rsp+300h+var_70]
              vmovaps xmm7, [rsp+300h+var_60]
              vmovaps xmm6, [rsp+300h+var_50]
            }
          }
        }
      }
      if ( v86 )
        goto LABEL_48;
    }
    v136 = (int)pImpactData->entNum;
    if ( (unsigned int)v136 >= 0x7FE || !particle_bolt_non_dobj_entities_killswitch->current.enabled )
      goto LABEL_48;
    if ( !(_BYTE)CgEntitySystem::ms_allocatedType )
    {
      LODWORD(useOrientationOptions) = v33;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\cgame\\cg_entity.h", 288, ASSERT_TYPE_ASSERT, "(ms_allocatedType != GameModeType::NONE)", "%s\n\tTrying to access the entity system for localClientNum %d but the entity system type is not known\n", "ms_allocatedType != GameModeType::NONE", useOrientationOptions) )
        __debugbreak();
    }
    if ( (unsigned int)v33 >= CgEntitySystem::ms_allocatedCount )
    {
      LODWORD(useOrientationOptions) = CgEntitySystem::ms_allocatedCount;
      LODWORD(v160) = v33;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\cgame\\cg_entity.h", 289, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( ms_allocatedCount )", "localClientNum doesn't index ms_allocatedCount\n\t%i not in [0, %i)", v160, useOrientationOptions) )
        __debugbreak();
    }
    if ( !CgEntitySystem::ms_entitySystemArray[v33] )
    {
      LODWORD(useOrientationOptions) = v33;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\cgame\\cg_entity.h", 290, ASSERT_TYPE_ASSERT, "(ms_entitySystemArray[localClientNum])", "%s\n\tTrying to access unallocated entity system for localClientNum %d\n", "ms_entitySystemArray[localClientNum]", useOrientationOptions) )
        __debugbreak();
    }
    v137 = CgEntitySystem::ms_entitySystemArray[v33];
    if ( (unsigned int)v136 >= 0x800 )
    {
      LODWORD(useOrientationOptions) = 2048;
      LODWORD(v160) = v136;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\cgame\\cg_entity.h", 518, ASSERT_TYPE_ASSERT, "(unsigned)( entityIndex ) < (unsigned)( (( 2048 ) + 0) )", "entityIndex doesn't index MAX_LOCAL_CENTITIES\n\t%i not in [0, %i)", v160, useOrientationOptions) )
        __debugbreak();
    }
    if ( (v137->m_entities[v136].flags & 1) != 0 && v137->m_entities[v136].nextState.eType == ET_SCRIPTMOVER )
    {
      dobjHandle = pImpactData->entNum;
      boneIndex = 0xFFFF;
      spawnFlags = PARTICLE_SYSTEM_FLAG_DYNAMIC_BOLT_ROTATION;
    }
    else
    {
LABEL_48:
      if ( !v165 )
      {
        v138 = (ParticleSystem *)ParticleEmitter::GetSystemOwner(v170);
        name = ParticleSystem::GetDef(v138)->name;
        v140 = SL_ConvertToString(pImpactData->partName);
        Com_PrintWarning(21, "Bolting to entity '%u' partName '%s' failed - unsupported entity type. Effect '%s'\n", pImpactData->entNum, v140, name);
      }
      dobjHandle = v168;
    }
    v141 = particle_on_impact_entity_marks_killswitch;
    if ( particle_on_impact_entity_marks_killswitch->current.enabled )
    {
      v167.boneIndex = inOutIndex;
LABEL_77:
      LOWORD(LinkObject) = truncate_cast<unsigned short,unsigned int>(pImpactData->entNum);
      *((_BYTE *)&v167 + 3) &= ~0x80u;
      LinkObject = (unsigned __int16)LinkObject;
      goto LABEL_78;
    }
  }
  else
  {
    v141 = particle_on_impact_entity_marks_killswitch;
  }
  if ( !v141->current.enabled || (hitType = pImpactData->hitType, ((hitType - 1) & 0xFFFFFFFA) != 0) || hitType == TRACE_HITTYPE_CLIENT_MODEL )
  {
    if ( (pParticleState->m_pStateDef->flags & 0x400) == 0 || (v148 = 1, !pParticleState->m_pModulePhysicsLight) )
      v148 = 0;
    if ( !v148 )
      goto LABEL_79;
    if ( pImpactData->hitType && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 305, ASSERT_TYPE_ASSERT, "(pImpactData->hitType == TRACE_HITTYPE_NONE)", (const char *)&queryFormat, "pImpactData->hitType == TRACE_HITTYPE_NONE") )
      __debugbreak();
    goto LABEL_77;
  }
  if ( hitType == TRACE_HITTYPE_SCRIPTABLE )
  {
    v143 = pImpactData->entNum;
    if ( v143 != -1 && ScriptableCl_GetLinkTypeEquals((const LocalClientNum_t)v33, v143, SCRIPTABLE_LINK_DYNENT) )
    {
      LinkObject = ScriptableCl_GetLinkObject((const LocalClientNum_t)v33, pImpactData->entNum);
      goto LABEL_64;
    }
LABEL_66:
    v145 = pImpactData->entNum;
    if ( v145 < 0x7FE )
    {
      v146 = truncate_cast<unsigned short,unsigned int>(v145);
      *((_BYTE *)&v167 + 3) &= ~0x80u;
      pMarkSpawnData = &v167;
      v34 = pImpactData->partName == 0;
      v167.markEntnum = v146;
      if ( !v34 )
      {
        v147 = Com_GetClientDObj(pImpactData->entNum, (LocalClientNum_t)v33);
        if ( v147 )
          DObjGetBoneIndexInternal_90(v147, pImpactData->partName, &v167.boneIndex, &v176);
      }
    }
    goto LABEL_79;
  }
  if ( hitType != TRACE_HITTYPE_DYNENT_MODEL )
    goto LABEL_66;
  LinkObject = pImpactData->entNum;
LABEL_64:
  if ( LinkObject == -1 )
    goto LABEL_66;
  *((_BYTE *)&v167 + 3) |= 0x80u;
  v167.boneIndex = -2;
LABEL_78:
  v167.markEntnum = LinkObject;
  pMarkSpawnData = &v167;
LABEL_79:
  v149 = v170;
  pParentSystem = ParticleEmitter::GetSystemOwner(v170);
  v151 = ParticleEmitter::SpawnChildEffect(v149, (LocalClientNum_t)v33, currentTime, pManagera, pParticleState, pLinkedAssetList, randomSeed, &outParticleTransform.w, &outParticleTransform, dobjHandle, boneIndex, boltOffset[0], NULL, pMarkSpawnData, 0, 0, pParentSystem, v177, spawnFlags);
  v152 = v151 & 0xFFF;
  if ( v152 >= 0x1000 )
  {
    LODWORD(useOrientationOptionsa) = 4096;
    LODWORD(v161) = v151 & 0xFFF;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 914, ASSERT_TYPE_ASSERT, "(unsigned)( handleImpl._index ) < (unsigned)( ( sizeof( *array_counter( g_particleSystemsGeneration[localClientNum] ) ) + 0 ) )", "handleImpl._index doesn't index ARRAY_COUNT( g_particleSystemsGeneration[localClientNum] )\n\t%i not in [0, %i)", v161, useOrientationOptionsa) )
      __debugbreak();
  }
  v34 = g_particleSystemsGeneration[4096 * v33 + (v151 & 0xFFF)].__all32 == v151;
  m_useVelocityOptions = pTestModule->m_useVelocityOptions;
  if ( !v34 )
    v152 = 0;
  v154 = v152;
  m_useScaleOptions = pTestModule->m_useScaleOptions;
  v156 = g_particleSystems[v33][v154];
  if ( (unsigned __int64)v156 < 0x1000 )
    v156 = NULL;
  v157 = ParticleEmitter::GetSystemOwner(v149);
  ParticleState::UpdateModifiers((ParticleState *)pParticleState, v157, v156, v178, v174, &pTestModule->m_scaleModifier, &pTestModule->m_velocityModifier, m_useScaleOptions, m_useVelocityOptions);
  *v179 |= moduleIndexFlag;
}

/*
==============
ParticleModuleTestAge::Update
==============
*/
void ParticleModuleTestAge::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  unsigned int v14; 
  unsigned int v15; 
  float4 *RotationAngleArrayAtIndex; 
  float *LifeArrayAtIndex; 
  __int64 v21; 
  signed __int64 v23; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int *particleIndexa; 
  signed __int64 particleIndexb; 
  int currentTime; 
  float4 *v31; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  vector4 rEmitterTransform; 

  __asm { vmovaps [rsp+1A8h+var_58], xmm6 }
  _RDI = pModuleBase;
  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (_RDI->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  _RAX = ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v14 = particleOffset;
  v15 = 1 << LOBYTE(_RDI[1].m_type);
  __asm
  {
    vmovups ymm0, ymmword ptr [rax]
    vmovups ymm1, ymmword ptr [rax+20h]
    vmovups ymmword ptr [rsp+1A8h+var_A8.baseclass_0.x.v], ymm0
    vmovups ymmword ptr [rsp+1A8h+var_A8.baseclass_0.z.v], ymm1
  }
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  particleIndexa = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, v14);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, v14);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, v14);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, v14);
  __asm { vmovss  xmm6, dword ptr [rdi+70h] }
  v31 = RotationAngleArrayAtIndex;
  LifeArrayAtIndex = Particle_GetLifeArrayAtIndex(pParticleData, v14);
  v21 = 0i64;
  _RDI = LifeArrayAtIndex;
  if ( particleCount )
  {
    v23 = (char *)ModuleTestsArrayAtIndex - (char *)LifeArrayAtIndex;
    particleIndexb = (char *)particleIndexa - (char *)LifeArrayAtIndex;
    do
    {
      if ( (v15 & *(_DWORD *)((_BYTE *)_RDI + v23)) == 0 )
      {
        __asm { vcomiss xmm6, dword ptr [rdi] }
        if ( (v15 & *(_DWORD *)((_BYTE *)_RDI + v23)) == 0 )
          Particle_HandleSuccessfulTest(&g_particleManager[m_localClientNum], pEmitterOwner, pParticleState, (LocalClientNum_t)m_localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v15, &ModuleTestsArrayAtIndex[v21], &StateArrayAtIndex[v21], &FlagsArrayAtIndex[v21], *(_DWORD *)((char *)_RDI + particleIndexb), &PositionArrayAtIndex[(unsigned int)v21], 0, &SizeArrayAtIndex[(unsigned int)v21], &VelocityArrayAtIndex[(unsigned int)v21], &v31[(unsigned int)v21], &rEmitterTransform, NULL, NULL);
      }
      v21 = (unsigned int)(v21 + 1);
      ++_RDI;
    }
    while ( (unsigned int)v21 < particleCount );
  }
  __asm { vmovaps xmm6, [rsp+1A8h+var_58] }
}

/*
==============
ParticleModuleTestBirth::Update
==============
*/
void ParticleModuleTestBirth::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  float *LifeArrayAtIndex; 
  __int64 v18; 
  bool v19; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int v25; 
  int currentTime; 
  float4 *RotationAngleArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  vector4 rEmitterTransform; 

  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  _RAX = ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  __asm
  {
    vmovups ymm0, ymmword ptr [rax]
    vmovups ymm1, ymmword ptr [rax+20h]
  }
  v25 = 1 << LOBYTE(pModuleBase[1].m_type);
  __asm
  {
    vmovups ymmword ptr [rsp+198h+var_A8.baseclass_0.x.v], ymm0
    vmovups ymmword ptr [rsp+198h+var_A8.baseclass_0.z.v], ymm1
  }
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  _RDI = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, particleOffset);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, particleOffset);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, particleOffset);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, particleOffset);
  LifeArrayAtIndex = Particle_GetLifeArrayAtIndex(pParticleData, particleOffset);
  v18 = 0i64;
  if ( particleCount )
  {
    __asm { vmovaps [rsp+198h+var_58], xmm6 }
    _R15 = (char *)LifeArrayAtIndex - (char *)_RDI;
    v19 = LifeArrayAtIndex == (float *)_RDI;
    __asm { vxorps  xmm6, xmm6, xmm6 }
    do
    {
      __asm { vucomiss xmm6, dword ptr [r15+rdi] }
      if ( v19 )
        Particle_HandleSuccessfulTest(&g_particleManager[m_localClientNum], pEmitterOwner, pParticleState, (LocalClientNum_t)m_localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v25, &ModuleTestsArrayAtIndex[v18], &StateArrayAtIndex[v18], &FlagsArrayAtIndex[v18], *_RDI, &PositionArrayAtIndex[(unsigned int)v18], 0, &SizeArrayAtIndex[(unsigned int)v18], &VelocityArrayAtIndex[(unsigned int)v18], &RotationAngleArrayAtIndex[(unsigned int)v18], &rEmitterTransform, NULL, NULL);
      v18 = (unsigned int)(v18 + 1);
      ++_RDI;
      v19 = (_DWORD)v18 == particleCount;
    }
    while ( (unsigned int)v18 < particleCount );
    __asm { vmovaps xmm6, [rsp+198h+var_58] }
  }
}

/*
==============
ParticleModuleTestDeath::Update
==============
*/
void ParticleModuleTestDeath::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  int *RandomSeedArrayAtIndex; 
  __int64 v16; 
  float4 *v17; 
  unsigned int *v18; 
  signed __int64 v19; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int v22; 
  int currentTime; 
  unsigned int *FlagsArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  float4 *RotationAngleArrayAtIndex; 
  vector4 rEmitterTransform; 

  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  _RAX = ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  __asm
  {
    vmovups ymm0, ymmword ptr [rax]
    vmovups ymm1, ymmword ptr [rax+20h]
  }
  v22 = 1 << LOBYTE(pModuleBase[1].m_type);
  __asm
  {
    vmovups ymmword ptr [rsp+188h+var_98.baseclass_0.x.v], ymm0
    vmovups ymmword ptr [rsp+188h+var_98.baseclass_0.z.v], ymm1
  }
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, particleOffset);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, particleOffset);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, particleOffset);
  v16 = 0i64;
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, particleOffset);
  v17 = RotationAngleArrayAtIndex;
  if ( particleCount )
  {
    v18 = FlagsArrayAtIndex;
    v19 = (char *)FlagsArrayAtIndex - (char *)RandomSeedArrayAtIndex;
    do
    {
      if ( (*((_BYTE *)RandomSeedArrayAtIndex + v19) & 1) != 0 )
      {
        Particle_HandleSuccessfulTest(&g_particleManager[m_localClientNum], pEmitterOwner, pParticleState, (LocalClientNum_t)m_localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v22, &ModuleTestsArrayAtIndex[v16], &StateArrayAtIndex[v16], &v18[v16], *RandomSeedArrayAtIndex, &PositionArrayAtIndex[(unsigned int)v16], 0, &SizeArrayAtIndex[(unsigned int)v16], &VelocityArrayAtIndex[(unsigned int)v16], &v17[(unsigned int)v16], &rEmitterTransform, NULL, NULL);
        v18 = FlagsArrayAtIndex;
        v17 = RotationAngleArrayAtIndex;
      }
      v16 = (unsigned int)(v16 + 1);
      ++RandomSeedArrayAtIndex;
    }
    while ( (unsigned int)v16 < particleCount );
  }
}

/*
==============
ParticleModuleTestGravity::Update
==============
*/
void ParticleModuleTestGravity::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  ParticleManager *v12; 
  unsigned int v14; 
  int *RandomSeedArrayAtIndex; 
  __int64 p_camera; 
  __int64 v19; 
  unsigned int *v20; 
  unsigned int *v21; 
  unsigned int v22; 
  signed __int64 v23; 
  unsigned int *v24; 
  _DWORD *v25; 
  int v26; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int currentTime; 
  LocalClientNum_t localClientNum; 
  unsigned int *StateArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  float4 *RotationAngleArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  signed __int64 v39; 
  ParticleManager *pManager; 
  vector4 rEmitterTransform; 

  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  localClientNum = (int)m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  v12 = &g_particleManager[m_localClientNum];
  pManager = v12;
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  _RAX = ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v14 = 1 << LOBYTE(pModuleBase[1].m_type);
  __asm
  {
    vmovups ymm0, ymmword ptr [rax]
    vmovups ymm1, ymmword ptr [rax+20h]
    vmovups ymmword ptr [rsp+1A8h+var_98.baseclass_0.x.v], ymm0
    vmovups ymmword ptr [rsp+1A8h+var_98.baseclass_0.z.v], ymm1
  }
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, particleOffset);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, particleOffset);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, particleOffset);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, particleOffset);
  if ( !v12->m_pFxSystem && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 550, ASSERT_TYPE_ASSERT, "(GetFxSystem())", (const char *)&queryFormat, "GetFxSystem()") )
    __debugbreak();
  p_camera = (__int64)&v12->m_pFxSystem->camera;
  if ( v12->m_pFxSystem == (FxSystem *)-96i64 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 390, ASSERT_TYPE_ASSERT, "(pCamera)", (const char *)&queryFormat, "pCamera") )
    __debugbreak();
  if ( *(_DWORD *)&pModuleBase[14].m_type >= 2u && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 391, ASSERT_TYPE_ASSERT, "(pModule->m_gravityState == PARTICLE_GRAVITY_STATE_ON || pModule->m_gravityState == PARTICLE_GRAVITY_STATE_OFF)", (const char *)&queryFormat, "pModule->m_gravityState == PARTICLE_GRAVITY_STATE_ON || pModule->m_gravityState == PARTICLE_GRAVITY_STATE_OFF") )
    __debugbreak();
  if ( (*(_BYTE *)(p_camera + 151) == 0) == (*(_DWORD *)&pModuleBase[14].m_type == 0) )
  {
    v19 = 0i64;
    if ( particleCount )
    {
      v20 = StateArrayAtIndex;
      v21 = ModuleTestsArrayAtIndex;
      v22 = particleCount;
      v23 = (char *)StateArrayAtIndex - (char *)ModuleTestsArrayAtIndex;
      v39 = (char *)RandomSeedArrayAtIndex - (char *)StateArrayAtIndex;
      v24 = ModuleTestsArrayAtIndex;
      do
      {
        if ( (v14 & *v24) == 0 )
        {
          v25 = (unsigned int *)((char *)v24 + v23);
          v26 = *(unsigned int *)((char *)v24 + v23);
          Particle_HandleSuccessfulTest(pManager, pEmitterOwner, pParticleState, localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v14, &v21[v19], &v20[v19], &FlagsArrayAtIndex[v19], *(unsigned int *)((char *)v24 + v23 + v39), &PositionArrayAtIndex[(unsigned int)v19], 0, &SizeArrayAtIndex[(unsigned int)v19], &VelocityArrayAtIndex[(unsigned int)v19], &RotationAngleArrayAtIndex[(unsigned int)v19], &rEmitterTransform, NULL, NULL);
          v23 = (char *)StateArrayAtIndex - (char *)ModuleTestsArrayAtIndex;
          v20 = StateArrayAtIndex;
          v21 = ModuleTestsArrayAtIndex;
          if ( v26 != *v25 )
            *v24 &= ~v14;
          v22 = particleCount;
        }
        v19 = (unsigned int)(v19 + 1);
        ++v24;
      }
      while ( (unsigned int)v19 < v22 );
    }
  }
}

/*
==============
ParticleModuleTestImpact::Update
==============
*/
void ParticleModuleTestImpact::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 v20; 
  __int64 m_localClientNum; 
  float4 *RotationAngleArrayAtIndex; 
  bool v23; 
  Particle_OnImpactData *v24; 
  const ParticleStateDef *m_pStateDef; 
  __int64 v26; 
  const ParticleSystemDef *systemDefOverride; 
  bool v29; 
  unsigned int v31; 
  signed __int64 v32; 
  const float4 *surfaceFx; 
  unsigned int *v36; 
  unsigned int v37; 
  int v38; 
  const ParticleModule *v39; 
  int v40; 
  unsigned int v41; 
  ParticleModule v42; 
  int v43; 
  const ParticleSystemDef *v44; 
  unsigned int v45; 
  ntl::red_black_tree_node_base *mp_parent; 
  ntl::red_black_tree_node_base *p_m_endNodeBase; 
  __int64 mp_parent_low; 
  vector3 *v49; 
  int v50; 
  bool v51; 
  int v52; 
  int v53; 
  const char *v63; 
  const char *Name; 
  ParticleModuleTest *pTestModule; 
  ParticleModuleTest *pTestModulea; 
  __int64 moduleIndexFlag; 
  double moduleIndexFlaga; 
  unsigned int *moduleTests; 
  unsigned int *state; 
  unsigned int *flags; 
  unsigned int v156; 
  int *RandomSeedArrayAtIndex; 
  const float4 *v158; 
  int currentTime; 
  LocalClientNum_t localClientNum; 
  Particle_OnImpactData *v161; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  bool v164; 
  float4 lookAtInput; 
  FXRegisteredDef v166; 
  float4 *v167; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  ParticleState *v171; 
  ParticleEmitter *v172; 
  ParticleManager *pManager; 
  float4 incommingZAxis; 
  float4 incommingXAxis; 
  __int128 v177; 
  __int128 v178; 
  vector4 outMatrix; 

  v172 = (ParticleEmitter *)pEmitterOwner;
  v171 = (ParticleState *)pParticleState;
  v20 = particleOffset;
  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + (unsigned int)v20 >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + v20;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  localClientNum = (int)m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  pManager = &g_particleManager[m_localClientNum];
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v156 = 1 << LOBYTE(pModuleBase[1].m_type);
  Particle_GetPositionArrayAtIndex(pParticleData, v20);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, v20);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, v20);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, v20);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, v20);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, v20);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, v20);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, v20);
  v23 = pParticleState->m_onImpactDataList == NULL;
  v167 = RotationAngleArrayAtIndex;
  if ( v23 )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlestate.h", 455, ASSERT_TYPE_ASSERT, "(m_onImpactDataList)", (const char *)&queryFormat, "m_onImpactDataList") )
      __debugbreak();
    if ( !pParticleState->m_onImpactDataList && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 518, ASSERT_TYPE_ASSERT, "(pParticleState->GetOnImpactDataList())", (const char *)&queryFormat, "pParticleState->GetOnImpactDataList()") )
      __debugbreak();
  }
  v24 = &ParticleState::GetOnImpactDataList((ParticleState *)pParticleState)[v20];
  v161 = v24;
  if ( !v24 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 520, ASSERT_TYPE_ASSERT, "(pOnImpactDataList)", (const char *)&queryFormat, "pOnImpactDataList") )
    __debugbreak();
  m_pStateDef = pParticleState->m_pStateDef;
  v26 = 0i64;
  __asm { vmovups xmm0, xmmword ptr cs:?g_unit@@3Ufloat4@@B.v; float4 const g_unit }
  systemDefOverride = NULL;
  __asm { vmovdqa [rsp+2E8h+var_118], xmm0 }
  v29 = (m_pStateDef->flags & 0x20000000) != 0i64;
  v164 = v29;
  if ( particleCount )
  {
    _R14 = &v24->particleQuat.v[2];
    v31 = v156;
    __asm { vmovaps [rsp+2E8h+var_88], xmm10 }
    v32 = (char *)ModuleTestsArrayAtIndex - (char *)FlagsArrayAtIndex;
    __asm
    {
      vmovss  xmm10, cs:__real@40000000
      vmovaps [rsp+2E8h+var_D8], xmm15
    }
    surfaceFx = (const float4 *)((char *)RandomSeedArrayAtIndex - (char *)FlagsArrayAtIndex);
    __asm
    {
      vmovss  xmm15, cs:__real@3f800000
      vmovaps [rsp+2E8h+var_48], xmm6
    }
    v36 = FlagsArrayAtIndex;
    v37 = particleCount;
    __asm
    {
      vmovaps [rsp+2E8h+var_58], xmm7
      vmovaps [rsp+2E8h+var_68], xmm8
      vmovaps [rsp+2E8h+var_78], xmm9
      vmovaps [rsp+2E8h+var_98], xmm11
      vmovaps [rsp+2E8h+var_A8], xmm12
      vmovaps [rsp+2E8h+var_B8], xmm13
      vmovaps [rsp+2E8h+var_C8], xmm14
    }
    v158 = (const float4 *)((char *)RandomSeedArrayAtIndex - (char *)FlagsArrayAtIndex);
    while ( (v31 & *(unsigned int *)((char *)v36 + v32)) != 0 )
    {
LABEL_93:
      v26 = (unsigned int)(v26 + 1);
      _R14 += 20;
      ++v36;
      if ( (unsigned int)v26 >= v37 )
      {
        __asm
        {
          vmovaps xmm15, [rsp+2E8h+var_D8]
          vmovaps xmm14, [rsp+2E8h+var_C8]
          vmovaps xmm13, [rsp+2E8h+var_B8]
          vmovaps xmm12, [rsp+2E8h+var_A8]
          vmovaps xmm11, [rsp+2E8h+var_98]
          vmovaps xmm10, [rsp+2E8h+var_88]
          vmovaps xmm9, [rsp+2E8h+var_78]
          vmovaps xmm8, [rsp+2E8h+var_68]
          vmovaps xmm7, [rsp+2E8h+var_58]
          vmovaps xmm6, [rsp+2E8h+var_48]
        }
        return;
      }
    }
    if ( (*v36 & 4) == 0 )
    {
LABEL_92:
      v37 = particleCount;
      goto LABEL_93;
    }
    *v36 &= ~4u;
    if ( v29 )
    {
      v38 = *(unsigned int *)((char *)v36 + (_QWORD)surfaceFx);
      v39 = pModuleBase + 11;
      if ( pModuleBase == (const ParticleModule *)-88i64 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particleutil.h", 215, ASSERT_TYPE_ASSERT, "(pLinkedAssetList)", (const char *)&queryFormat, "pLinkedAssetList") )
        __debugbreak();
      if ( !*(_QWORD *)v39 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particleutil.h", 216, ASSERT_TYPE_ASSERT, "(pLinkedAssetList->assetList)", (const char *)&queryFormat, "pLinkedAssetList->assetList") )
        __debugbreak();
      if ( *(int *)&pModuleBase[12].m_type <= 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particleutil.h", 217, ASSERT_TYPE_ASSERT, "(pLinkedAssetList->numAssets > 0)", (const char *)&queryFormat, "pLinkedAssetList->numAssets > 0") )
        __debugbreak();
      v40 = *(_DWORD *)&pModuleBase[12].m_type;
      if ( v40 <= 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlerandom.h", 74, ASSERT_TYPE_ASSERT, "(count > 0)", (const char *)&queryFormat, "count > 0") )
        __debugbreak();
      v41 = abs32((v40 * LOWORD(fx_randomTable[v38 + 22])) >> 16);
      if ( v41 >= v40 )
      {
        LODWORD(moduleIndexFlag) = v40;
        LODWORD(pTestModule) = v41;
        if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlerandom.h", 78, ASSERT_TYPE_ASSERT, "(unsigned)( randomIndex ) < (unsigned)( count )", "randomIndex doesn't index count\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
          __debugbreak();
      }
      v42 = *v39;
      v43 = *((_DWORD *)_R14 + 2);
      v44 = *(const ParticleSystemDef **)(32i64 * (int)v41 + *(_QWORD *)&v42);
      if ( !v44 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 446, ASSERT_TYPE_ASSERT, "(impactEffect)", (const char *)&queryFormat, "impactEffect") )
        __debugbreak();
      surfaceFx = (const float4 *)cgMedia.surfaceFx;
      v45 = (v43 >> 19) & 0x3F;
      v166.m_particleSystemDef = v44;
      if ( !cgMedia.surfaceFx )
        goto LABEL_76;
      mp_parent = cgMediaSurfaceFxMap.m_endNodeBase.mp_parent;
      p_m_endNodeBase = &cgMediaSurfaceFxMap.m_endNodeBase;
      if ( !cgMediaSurfaceFxMap.m_endNodeBase.mp_parent )
        goto LABEL_76;
      do
      {
        if ( *(_QWORD *)&mp_parent[1].m_color < (unsigned __int64)v44 )
        {
          mp_parent = mp_parent->mp_right;
        }
        else
        {
          p_m_endNodeBase = mp_parent;
          mp_parent = mp_parent->mp_left;
        }
      }
      while ( mp_parent );
      if ( p_m_endNodeBase == &cgMediaSurfaceFxMap.m_endNodeBase || (unsigned __int64)v44 < *(_QWORD *)&p_m_endNodeBase[1].m_color )
        goto LABEL_76;
      mp_parent_low = LODWORD(p_m_endNodeBase[1].mp_parent);
      if ( (unsigned int)mp_parent_low >= cgMedia.surfaceFx->numTableEntry )
      {
        LODWORD(moduleIndexFlag) = cgMedia.surfaceFx->numTableEntry;
        LODWORD(pTestModule) = p_m_endNodeBase[1].mp_parent;
        if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 431, ASSERT_TYPE_ASSERT, "(unsigned)( overrideIndex ) < (unsigned)( cgMedia.surfaceFx->numTableEntry )", "overrideIndex doesn't index cgMedia.surfaceFx->numTableEntry\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
          __debugbreak();
        surfaceFx = (const float4 *)cgMedia.surfaceFx;
      }
      systemDefOverride = *(const ParticleSystemDef **)(surfaceFx->v.m128_u64[1] + 8 * (v45 + 65 * mp_parent_low) + 8);
      if ( !systemDefOverride )
      {
LABEL_76:
        v63 = Com_SurfaceTypeToName(v45);
        Name = FXRegisteredDef::GetName(&v166);
        Com_PrintError(21, "Surface effect type not found for impact effect %s with surface type %s\n", Name, v63);
        v31 = v156;
        systemDefOverride = NULL;
LABEL_91:
        v32 = (char *)ModuleTestsArrayAtIndex - (char *)FlagsArrayAtIndex;
        v24 = v161;
        surfaceFx = v158;
        v29 = v164;
        goto LABEL_92;
      }
      v31 = v156;
      v24 = v161;
    }
    v49 = (vector3 *)*(unsigned int *)&pModuleBase[14].m_type;
    v50 = *(_DWORD *)&pModuleBase[14].m_type;
    v51 = v50 == 0;
    v52 = v50 - 1;
    if ( v52 )
    {
      v51 = v52 == 0;
      v53 = v52 - 1;
      if ( !v53 )
      {
        __asm
        {
          vmovups xmm3, xmmword ptr [r14-18h]
          vmulps  xmm1, xmm3, xmm3
          vinsertps xmm2, xmm1, xmm1, 8
          vhaddps xmm0, xmm2, xmm2
          vhaddps xmm0, xmm0, xmm0
        }
LABEL_83:
        __asm
        {
          vsqrtps xmm1, xmm0
          vdivps  xmm2, xmm3, xmm1
          vmovups xmmword ptr [rsp+2E8h+lookAtInput.v], xmm2
        }
        goto LABEL_84;
      }
      v51 = v53 == 0;
      if ( v53 != 1 )
      {
        __asm
        {
          vmovups xmm0, xmmword ptr [r14-28h]
          vmovups xmmword ptr [rsp+2E8h+lookAtInput.v], xmm0
        }
        if ( (_DWORD)v49 == 5 )
        {
          __asm
          {
            vmovups xmm3, xmmword ptr [r14-8]
            vmovaps xmm0, xmm3
            vshufps xmm1, xmm3, xmm3, 55h ; 'U'
            vinsertps xmm0, xmm0, xmm1, 10h
            vshufps xmm2, xmm3, xmm3, 0AAh ; 'ª'
            vinsertps xmm0, xmm0, xmm2, 20h ; ' '
            vshufps xmm3, xmm3, xmm3, 0FFh
            vinsertps xmm0, xmm0, xmm3, 30h ; '0'
          }
          Float4UnitQuatToAxis(v49, surfaceFx);
          __asm
          {
            vmovups xmmword ptr [rsp+2E8h+var_198+10h], xmm1
            vmovups xmmword ptr [rsp+2E8h+var_198], xmm0
            vmovups ymm3, [rsp+2E8h+var_198]
            vmovups ymmword ptr [rsp+2E8h+outMatrix.x.v], ymm3
            vmovups xmmword ptr [rsp+2E8h+outMatrix.z.v], xmm2
          }
LABEL_90:
          Particle_HandleSuccessfulTest(pManager, v172, v171, localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v31, &ModuleTestsArrayAtIndex[v26], &StateArrayAtIndex[v26], &FlagsArrayAtIndex[v26], *(unsigned int *)((char *)v36 + (_QWORD)v158), &v24[v26].pos, 1, &SizeArrayAtIndex[(unsigned int)v26], &VelocityArrayAtIndex[(unsigned int)v26], &v167[(unsigned int)v26], &outMatrix, systemDefOverride, &v24[v26]);
          goto LABEL_91;
        }
        v51 = (unsigned int)v49 < 4;
        if ( (_DWORD)v49 == 4 )
        {
          Particle_GenerateMatrixFromLookAt(&lookAtInput, &outMatrix);
          __asm
          {
            vmovdqa xmm2, xmmword ptr [rsp+2E8h+outMatrix.z.v]
            vxorps  xmm0, xmm0, xmm0
            vsubps  xmm1, xmm0, xmmword ptr [rsp+2E8h+outMatrix.x.v]
            vmovups xmm0, xmmword ptr [rsp+2E8h+outMatrix.y.v]
            vmovdqa xmmword ptr [rsp+2E8h+outMatrix.z.v], xmm0
            vmovdqa xmmword ptr [rsp+2E8h+outMatrix.y.v], xmm2
          }
LABEL_89:
          __asm { vmovups xmmword ptr [rsp+2E8h+outMatrix.x.v], xmm1 }
          goto LABEL_90;
        }
LABEL_84:
        __asm
        {
          vmovss  xmm4, dword ptr [r14-4]
          vmovss  xmm5, dword ptr [r14-8]
          vmovss  xmm6, dword ptr [r14]
          vmovss  xmm7, dword ptr [r14+4]
          vmulss  xmm1, xmm5, xmm5
          vmulss  xmm0, xmm4, xmm4
          vaddss  xmm2, xmm1, xmm0
          vmulss  xmm1, xmm6, xmm6
          vaddss  xmm3, xmm2, xmm1
          vmulss  xmm0, xmm7, xmm7
          vaddss  xmm2, xmm3, xmm0
          vsubss  xmm1, xmm2, xmm15
          vandps  xmm1, xmm1, cs:__xmm@7fffffff7fffffff7fffffff7fffffff
          vcomiss xmm1, cs:__real@3b03126f
        }
        if ( !v51 )
        {
          __asm
          {
            vsqrtss xmm0, xmm2, xmm2
            vcvtss2sd xmm1, xmm0, xmm0
            vmovsd  [rsp+2E8h+flags], xmm1
            vcvtss2sd xmm0, xmm4, xmm4
            vcvtss2sd xmm2, xmm7, xmm7
            vmovsd  [rsp+2E8h+state], xmm2
            vcvtss2sd xmm3, xmm6, xmm6
            vmovsd  [rsp+2E8h+moduleTests], xmm3
            vmovsd  qword ptr [rsp+2E8h+moduleIndexFlag], xmm0
            vcvtss2sd xmm4, xmm5, xmm5
            vmovsd  [rsp+2E8h+pTestModule], xmm4
          }
          if ( CoreAssert_Handler("c:\\workspace\\iw8\\shared\\codware\\core\\core_math.h", 770, ASSERT_TYPE_ASSERT, "( Vec4IsNormalized( quat ) )", "(%g, %g, %g, %g) len: %g", *(double *)&pTestModulea, moduleIndexFlaga, *(double *)&moduleTests, *(double *)&state, *(double *)&flags) )
            __debugbreak();
        }
        __asm
        {
          vmulss  xmm1, xmm10, dword ptr [r14-8]
          vmovss  xmm4, dword ptr [r14]
          vmovss  xmm2, dword ptr [r14-4]
          vmovss  xmm3, dword ptr [r14+4]
          vmulss  xmm12, xmm1, dword ptr [r14-8]
          vmulss  xmm0, xmm2, xmm10
          vmulss  xmm5, xmm3, xmm0
          vmulss  xmm9, xmm2, xmm0
          vmulss  xmm6, xmm4, xmm0
          vmulss  xmm8, xmm3, xmm1
          vmulss  xmm14, xmm2, xmm1
          vmulss  xmm0, xmm4, xmm10
          vmulss  xmm13, xmm3, xmm0
          vmulss  xmm2, xmm4, xmm0
          vmulss  xmm7, xmm4, xmm1
          vaddss  xmm1, xmm2, xmm9
          vsubss  xmm3, xmm15, xmm1
          vaddss  xmm11, xmm2, xmm12
        }
        HIDWORD(v177) = 0;
        __asm
        {
          vmovups xmm0, xmmword ptr [rsp+180h]
          vmovss  xmm0, xmm0, xmm3
        }
        HIDWORD(v178) = 0;
        __asm
        {
          vmovups xmm3, xmmword ptr [rsp+190h]
          vaddss  xmm4, xmm13, xmm14
          vinsertps xmm0, xmm0, xmm4, 10h
          vsubss  xmm10, xmm7, xmm5
          vinsertps xmm0, xmm0, xmm10, 20h ; ' '
          vmovups xmmword ptr [rsp+180h], xmm0
          vmovups xmmword ptr [rsp+2E8h+incommingXAxis.v], xmm0
          vsubss  xmm0, xmm13, xmm14
          vmovss  xmm3, xmm3, xmm0
          vaddss  xmm2, xmm6, xmm8
          vxorps  xmm2, xmm2, cs:__xmm@80000000800000008000000080000000
          vsubss  xmm1, xmm11, xmm15
          vinsertps xmm3, xmm3, xmm1, 10h
          vinsertps xmm3, xmm3, xmm2, 20h ; ' '
          vmovups xmmword ptr [rsp+190h], xmm3
          vmovups xmmword ptr [rsp+2E8h+incommingZAxis.v], xmm3
        }
        Particle_GenerateMatrixFromLookAt2(&lookAtInput, &incommingXAxis, &incommingZAxis, &outMatrix);
        __asm { vmovss  xmm10, cs:__real@40000000 }
        if ( !*(_DWORD *)&pModuleBase[14].m_type )
          goto LABEL_90;
        __asm
        {
          vmovdqa xmm2, xmmword ptr [rsp+2E8h+outMatrix.y.v]
          vxorps  xmm0, xmm0, xmm0
          vsubps  xmm1, xmm0, xmmword ptr [rsp+2E8h+outMatrix.x.v]
          vmovups xmm0, xmmword ptr [rsp+2E8h+outMatrix.z.v]
          vmovdqa xmmword ptr [rsp+2E8h+outMatrix.y.v], xmm0
          vmovdqa xmmword ptr [rsp+2E8h+outMatrix.z.v], xmm2
        }
        goto LABEL_89;
      }
      __asm
      {
        vxorps  xmm0, xmm0, xmm0
        vsubps  xmm3, xmm0, xmmword ptr [r14-18h]
      }
    }
    else
    {
      __asm
      {
        vmovups xmm1, xmmword ptr [r14-28h]
        vmulps  xmm1, xmm1, xmmword ptr [r14-18h]
        vinsertps xmm2, xmm1, xmm1, 8
        vhaddps xmm0, xmm2, xmm2
        vhaddps xmm1, xmm0, xmm0
        vmulps  xmm2, xmm1, cs:__xmm@c0000000c0000000c0000000c0000000
        vmulps  xmm0, xmm2, xmmword ptr [r14-28h]
        vaddps  xmm3, xmm0, xmmword ptr [r14-18h]
      }
    }
    __asm
    {
      vmulps  xmm1, xmm3, xmm3
      vinsertps xmm0, xmm1, xmm1, 8
      vhaddps xmm2, xmm0, xmm0
      vhaddps xmm0, xmm2, xmm2
    }
    goto LABEL_83;
  }
}

/*
==============
ParticleModuleTestPos::Update
==============
*/
void ParticleModuleTestPos::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  int v14; 
  float4 *PositionArrayAtIndex; 
  int *RandomSeedArrayAtIndex; 
  unsigned int v29; 
  signed __int64 v32; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  unsigned int *ModuleTestsArrayAtIndex; 

  __asm { vmovaps [rsp+198h+var_48], xmm6 }
  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  if ( pEmitterOwner->m_pSystemOwner->m_localClientNum >= (unsigned int)LOCAL_CLIENT_COUNT )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  _RAX = ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v14 = 1 << LOBYTE(pModuleBase[1].m_type);
  __asm
  {
    vmovups ymm0, ymmword ptr [rax]
    vmovups ymm1, ymmword ptr [rax+20h]
    vmovups ymmword ptr [rsp+198h+var_98.baseclass_0.x.v], ymm0
    vmovups ymmword ptr [rsp+198h+var_98.baseclass_0.z.v], ymm1
  }
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, particleOffset);
  Particle_GetSizeArrayAtIndex(pParticleData, particleOffset);
  Particle_GetVelocityArrayAtIndex(pParticleData, particleOffset);
  Particle_GetRotationAngleArrayAtIndex(pParticleData, particleOffset);
  __asm
  {
    vxorps  xmm0, xmm0, xmm0
    vinsertps xmm0, xmm0, dword ptr [r12+70h], 20h ; ' '
  }
  if ( (pModuleBase->m_flags & 0x80) == 0 )
  {
    __asm
    {
      vshufps xmm3, xmm0, xmm0, 55h ; 'U'
      vshufps xmm1, xmm0, xmm0, 0AAh ; 'ª'
      vmulps  xmm1, xmm1, xmmword ptr [rsp+198h+var_98.baseclass_0.z.v]
      vaddps  xmm2, xmm1, xmmword ptr [rsp+198h+var_98.w.v]
      vmulps  xmm1, xmm3, xmmword ptr [rsp+198h+var_98.baseclass_0.y.v]
      vshufps xmm4, xmm0, xmm0, 0
      vaddps  xmm3, xmm1, xmm2
      vmulps  xmm1, xmm4, xmmword ptr [rsp+198h+var_98.baseclass_0.x.v]
      vaddps  xmm0, xmm1, xmm3
    }
  }
  v29 = 0;
  __asm { vshufps xmm6, xmm0, xmm0, 0AAh ; 'ª' }
  if ( particleCount )
  {
    _R14 = PositionArrayAtIndex;
    v32 = (char *)ModuleTestsArrayAtIndex - (char *)RandomSeedArrayAtIndex;
    do
    {
      if ( (v14 & *(int *)((char *)RandomSeedArrayAtIndex + v32)) == 0 )
      {
        __asm
        {
          vmovss  xmm1, dword ptr [r14+8]
          vcomiss xmm1, xmm6
        }
      }
      ++v29;
      ++_R14;
      ++RandomSeedArrayAtIndex;
    }
    while ( v29 < particleCount );
  }
  __asm { vmovaps xmm6, [rsp+198h+var_48] }
}

/*
==============
ParticleModuleTestTimeInState::Update
==============
*/
void ParticleModuleTestTimeInState::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 v11; 
  __int64 m_localClientNum; 
  unsigned int v14; 
  float *v18; 
  __int64 v19; 
  unsigned int v21; 
  signed __int64 v22; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int currentTime; 
  LocalClientNum_t localClientNum; 
  unsigned int *ModuleTestsArrayAtIndex; 
  float4 *RotationAngleArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  ParticleManager *pManager; 
  vector4 rEmitterTransform; 

  v11 = particleOffset;
  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + (unsigned int)v11 >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + v11;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  localClientNum = (int)m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  pManager = &g_particleManager[m_localClientNum];
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  _RAX = ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v14 = 1 << LOBYTE(pModuleBase[1].m_type);
  __asm
  {
    vmovups ymm0, ymmword ptr [rax]
    vmovups ymm1, ymmword ptr [rax+20h]
    vmovups ymmword ptr [rsp+1A8h+var_A8.baseclass_0.x.v], ymm0
    vmovups ymmword ptr [rsp+1A8h+var_A8.baseclass_0.z.v], ymm1
  }
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, v11);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, v11);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, v11);
  _RBX = Particle_GetRandomSeedArrayAtIndex(pParticleData, v11);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, v11);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, v11);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, v11);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, v11);
  if ( !pParticleState->m_timeInStateList )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlestate.h", 525, ASSERT_TYPE_ASSERT, "(m_timeInStateList)", (const char *)&queryFormat, "m_timeInStateList") )
      __debugbreak();
    if ( !pParticleState->m_timeInStateList && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 674, ASSERT_TYPE_ASSERT, "(pParticleState->GetTimeInStateList())", (const char *)&queryFormat, "pParticleState->GetTimeInStateList()") )
      __debugbreak();
  }
  v18 = &ParticleState::GetTimeInStateList((ParticleState *)pParticleState)[v11];
  if ( !v18 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 676, ASSERT_TYPE_ASSERT, "(pTimeInStateList)", (const char *)&queryFormat, "pTimeInStateList") )
    __debugbreak();
  v19 = 0i64;
  if ( particleCount )
  {
    _RCX = &fx_randomTable[51];
    v21 = particleCount;
    v22 = (char *)ModuleTestsArrayAtIndex - (char *)_RBX;
    __asm { vmovaps [rsp+1A8h+var_58], xmm6 }
    _R12 = (char *)v18 - (char *)_RBX;
    __asm { vmovss  xmm6, cs:__real@3f800000 }
    do
    {
      if ( (v14 & *(int *)((char *)_RBX + v22)) == 0 )
      {
        _RBP = *_RBX;
        __asm
        {
          vmovss  xmm0, dword ptr [rcx+rbp*4]
          vmulss  xmm2, xmm0, dword ptr [rsi+74h]
          vsubss  xmm0, xmm6, xmm0
          vmulss  xmm1, xmm0, dword ptr [rsi+70h]
          vaddss  xmm2, xmm2, xmm1
          vcomiss xmm2, dword ptr [r12+rbx]
        }
        if ( (v14 & *(int *)((char *)_RBX + v22)) == 0 )
        {
          Particle_HandleSuccessfulTest(pManager, pEmitterOwner, pParticleState, localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v14, &ModuleTestsArrayAtIndex[v19], &StateArrayAtIndex[v19], &FlagsArrayAtIndex[v19], *_RBX, &PositionArrayAtIndex[(unsigned int)v19], 0, &SizeArrayAtIndex[(unsigned int)v19], &VelocityArrayAtIndex[(unsigned int)v19], &RotationAngleArrayAtIndex[(unsigned int)v19], &rEmitterTransform, NULL, NULL);
          _RCX = &fx_randomTable[51];
        }
        v21 = particleCount;
      }
      v19 = (unsigned int)(v19 + 1);
      ++_RBX;
    }
    while ( (unsigned int)v19 < v21 );
    __asm { vmovaps xmm6, [rsp+1A8h+var_58] }
  }
}

