/*
==============
ScrCmd_SetHeadIconNeutralImage
==============
*/

void __fastcall ScrCmd_SetHeadIconNeutralImage(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconNeutralImage@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
G_HeadIcons_SetPlayerDirty
==============
*/

void __fastcall G_HeadIcons_SetPlayerDirty(const int playerNum)
{
  ?G_HeadIcons_SetPlayerDirty@@YAXH@Z(playerNum);
}

/*
==============
G_HeadIcons_Load
==============
*/

void __fastcall G_HeadIcons_Load(MemoryFile *memFile)
{
  ?G_HeadIcons_Load@@YAXPEAUMemoryFile@@@Z(memFile);
}

/*
==============
G_HeadIcons_Save
==============
*/

void __fastcall G_HeadIcons_Save(MemoryFile *memFile)
{
  ?G_HeadIcons_Save@@YAXPEAUMemoryFile@@@Z(memFile);
}

/*
==============
ScrCmd_SetHeadIconImage
==============
*/

void __fastcall ScrCmd_SetHeadIconImage(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconImage@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_DeleteHeadIcon
==============
*/

void __fastcall ScrCmd_DeleteHeadIcon(scrContext_t *scrContext)
{
  ?ScrCmd_DeleteHeadIcon@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_ShowHeadIconToPlayersInMask
==============
*/

void __fastcall ScrCmd_ShowHeadIconToPlayersInMask(scrContext_t *scrContext)
{
  ?ScrCmd_ShowHeadIconToPlayersInMask@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconNaturalDistance
==============
*/

void __fastcall ScrCmd_SetHeadIconNaturalDistance(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconNaturalDistance@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconTeam
==============
*/

void __fastcall ScrCmd_SetHeadIconTeam(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconTeam@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_AddClientToHeadIconMask
==============
*/

void __fastcall ScrCmd_AddClientToHeadIconMask(scrContext_t *scrContext)
{
  ?ScrCmd_AddClientToHeadIconMask@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
G_HeadIcons_Update
==============
*/

void __fastcall G_HeadIcons_Update(gentity_s *player)
{
  ?G_HeadIcons_Update@@YAXPEAUgentity_s@@@Z(player);
}

/*
==============
ScrCmd_CreateHeadIcon
==============
*/

void __fastcall ScrCmd_CreateHeadIcon(scrContext_t *scrContext)
{
  ?ScrCmd_CreateHeadIcon@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconDrawThroughGeo
==============
*/

void __fastcall ScrCmd_SetHeadIconDrawThroughGeo(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconDrawThroughGeo@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_CreateHeadIconAtOrigin
==============
*/

void __fastcall ScrCmd_CreateHeadIconAtOrigin(scrContext_t *scrContext)
{
  ?ScrCmd_CreateHeadIconAtOrigin@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconEnemyImage
==============
*/

void __fastcall ScrCmd_SetHeadIconEnemyImage(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconEnemyImage@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_AddTeamToHeadIconMask
==============
*/

void __fastcall ScrCmd_AddTeamToHeadIconMask(scrContext_t *scrContext)
{
  ?ScrCmd_AddTeamToHeadIconMask@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconSnapToEdges
==============
*/

void __fastcall ScrCmd_SetHeadIconSnapToEdges(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconSnapToEdges@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconOwner
==============
*/

void __fastcall ScrCmd_SetHeadIconOwner(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconOwner@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconMaxDistance
==============
*/

void __fastcall ScrCmd_SetHeadIconMaxDistance(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconMaxDistance@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_RemoveTeamFromHeadIconMask
==============
*/

void __fastcall ScrCmd_RemoveTeamFromHeadIconMask(scrContext_t *scrContext)
{
  ?ScrCmd_RemoveTeamFromHeadIconMask@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconDrawInMap
==============
*/

void __fastcall ScrCmd_SetHeadIconDrawInMap(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconDrawInMap@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconFriendlyImage
==============
*/

void __fastcall ScrCmd_SetHeadIconFriendlyImage(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconFriendlyImage@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_HideHeadIconFromPlayersInMask
==============
*/

void __fastcall ScrCmd_HideHeadIconFromPlayersInMask(scrContext_t *scrContext)
{
  ?ScrCmd_HideHeadIconFromPlayersInMask@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_RemoveClientFromHeadIconMask
==============
*/

void __fastcall ScrCmd_RemoveClientFromHeadIconMask(scrContext_t *scrContext)
{
  ?ScrCmd_RemoveClientFromHeadIconMask@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
ScrCmd_SetHeadIconZOffset
==============
*/

void __fastcall ScrCmd_SetHeadIconZOffset(scrContext_t *scrContext)
{
  ?ScrCmd_SetHeadIconZOffset@@YAXAEAUscrContext_t@@@Z(scrContext);
}

/*
==============
G_HeadIcon_Get
==============
*/
HeadIcon *G_HeadIcon_Get(int iconIndex)
{
  __int64 v1; 
  bool v2; 
  int v3; 
  unsigned int v4; 
  HeadIcon *v5; 
  scrContext_t *v6; 

  v1 = iconIndex;
  v2 = Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80);
  v3 = 256;
  v4 = 256;
  if ( v2 )
    v4 = 1024;
  if ( (unsigned int)v1 >= v4 )
  {
    if ( Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80) )
      v3 = 1024;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 330, ASSERT_TYPE_ASSERT, "(unsigned)( iconIndex ) < (unsigned)( G_HeadIcon_GetMaxCount() )", "iconIndex doesn't index G_HeadIcon_GetMaxCount()\n\t%i not in [0, %i)", v1, v3) )
      __debugbreak();
  }
  v5 = &level.headIcons[v1];
  if ( !v5 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 93, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
    __debugbreak();
  if ( (v5->flags & 1) == 0 )
  {
    v6 = ScriptContext_Server();
    Scr_Error(COM_ERR_5275, v6, "Attempted to access an invalid head icon slot.\n");
  }
  return v5;
}

/*
==============
G_HeadIcon_GetExtendedData
==============
*/
HeadIconExtendedData *G_HeadIcon_GetExtendedData(int iconIndex)
{
  __int64 v1; 
  bool v2; 
  int v3; 
  unsigned int v4; 
  HeadIcon *v5; 
  HeadIconExtendedData *v6; 
  scrContext_t *v7; 

  v1 = iconIndex;
  v2 = Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80);
  v3 = 256;
  v4 = 256;
  if ( v2 )
    v4 = 1024;
  if ( (unsigned int)v1 >= v4 )
  {
    if ( Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80) )
      v3 = 1024;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 344, ASSERT_TYPE_ASSERT, "(unsigned)( iconIndex ) < (unsigned)( G_HeadIcon_GetMaxCount() )", "iconIndex doesn't index G_HeadIcon_GetMaxCount()\n\t%i not in [0, %i)", v1, v3) )
      __debugbreak();
  }
  v5 = &level.headIcons[v1];
  v6 = &level.headIconExtendedData[v1];
  if ( !v5 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 93, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
    __debugbreak();
  if ( (v5->flags & 1) == 0 )
  {
    v7 = ScriptContext_Server();
    Scr_Error(COM_ERR_6442, v7, "Attempted to access an invalid head icon slot.\n");
  }
  return v6;
}

/*
==============
G_HeadIcons_GetRelativeIcon
==============
*/
__int64 G_HeadIcons_GetRelativeIcon(const HeadIcon *headIcon, const playerState_s *ps)
{
  GHandler *Handler; 
  GHandler *v5; 
  GHandler *v6; 
  unsigned __int32 v7; 
  team_t ownerTeam; 
  team_t outTeam; 

  if ( !headIcon && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 100, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
    __debugbreak();
  if ( !ps && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 101, ASSERT_TYPE_ASSERT, "(ps)", (const char *)&queryFormat, "ps") )
    __debugbreak();
  Handler = GHandler::getHandler();
  if ( !GHandler::GetPlayerTeam(Handler, ps->clientNum, &outTeam) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 104, ASSERT_TYPE_ASSERT, "(GHandler::getHandler()->GetPlayerTeam( ps->clientNum, &playerTeam ))", (const char *)&queryFormat, "GHandler::getHandler()->GetPlayerTeam( ps->clientNum, &playerTeam )") )
    __debugbreak();
  if ( headIcon->entityNumber == 2047 || (v5 = GHandler::getHandler(), !GHandler::GetPlayerTeam(v5, headIcon->entityNumber, &ownerTeam)) )
  {
    if ( headIcon->ownerClient == -1 )
    {
      ownerTeam = headIcon->ownerTeam;
    }
    else
    {
      v6 = GHandler::getHandler();
      if ( !GHandler::GetPlayerTeam(v6, headIcon->ownerClient, &ownerTeam) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 111, ASSERT_TYPE_ASSERT, "(GHandler::getHandler()->GetPlayerTeam( headIcon->ownerClient, &iconTeam ))", (const char *)&queryFormat, "GHandler::getHandler()->GetPlayerTeam( headIcon->ownerClient, &iconTeam )") )
        __debugbreak();
    }
  }
  if ( Com_GameMode_SupportsFeature(WEAPON_SKYDIVE_WEAPON_DROP|0x80) && (unsigned int)(ownerTeam - 4) <= 1 )
    return headIcon->neutralIcon;
  if ( ownerTeam == TEAM_ZERO )
  {
    if ( headIcon->ownerClient != ps->clientNum )
    {
      v7 = outTeam - 201;
LABEL_29:
      if ( v7 <= 1 )
        return headIcon->neutralIcon;
      return headIcon->enemyIcon;
    }
    return headIcon->friendlyIcon;
  }
  if ( ownerTeam <= TEAM_ZERO )
    return headIcon->enemyIcon;
  if ( ownerTeam > TEAM_TWO )
  {
    v7 = ownerTeam - 201;
    goto LABEL_29;
  }
  if ( (unsigned int)(outTeam - 1) <= 1 )
  {
    if ( outTeam != ownerTeam )
      return headIcon->enemyIcon;
    return headIcon->friendlyIcon;
  }
  return headIcon->neutralIcon;
}

/*
==============
G_HeadIcons_Load
==============
*/
void G_HeadIcons_Load(MemoryFile *memFile)
{
  unsigned __int64 v2; 
  unsigned __int64 v3; 

  if ( !memFile && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 50, ASSERT_TYPE_ASSERT, "( memFile )", (const char *)&queryFormat, "memFile") )
    __debugbreak();
  MemFile_ReadData(memFile, 0x1Cui64, &s_headIcons_updateRequired);
  if ( Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80) )
  {
    v2 = 77824i64;
    v3 = 0x4000i64;
  }
  else
  {
    v2 = 19456i64;
    v3 = 4096i64;
  }
  MemFile_ReadData(memFile, v2, level.headIcons);
  if ( Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80) )
    MemFile_ReadData(memFile, v3, level.headIconExtendedData);
}

/*
==============
G_HeadIcons_Save
==============
*/
void G_HeadIcons_Save(MemoryFile *memFile)
{
  unsigned __int64 v2; 
  unsigned __int64 v3; 

  if ( !memFile && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 35, ASSERT_TYPE_ASSERT, "( memFile )", (const char *)&queryFormat, "memFile") )
    __debugbreak();
  MemFile_WriteData(memFile, 0x1Cui64, &s_headIcons_updateRequired);
  if ( Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80) )
  {
    v2 = 77824i64;
    v3 = 0x4000i64;
  }
  else
  {
    v2 = 19456i64;
    v3 = 4096i64;
  }
  MemFile_WriteData(memFile, v2, level.headIcons);
  if ( Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80) )
    MemFile_WriteData(memFile, v3, level.headIconExtendedData);
}

/*
==============
G_HeadIcons_SetPlayerDirty
==============
*/
void G_HeadIcons_SetPlayerDirty(const int playerNum)
{
  unsigned __int64 v1; 
  int v3; 

  v1 = (unsigned int)playerNum;
  if ( (unsigned int)playerNum >= 0xE0 )
  {
    v3 = 224;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\bitarray.h", 263, ASSERT_TYPE_ASSERT, "( pos ) < ( impl()->getBitCount() )", "%s < %s\n\t%u, %u", "pos", "impl()->getBitCount()", playerNum, v3) )
      __debugbreak();
  }
  s_headIcons_updateRequired.array[v1 >> 5] |= 0x80000000 >> (v1 & 0x1F);
}

/*
==============
G_HeadIcons_Update
==============
*/
void G_HeadIcons_Update(gentity_s *player)
{
  gentity_s *v1; 
  unsigned int number; 
  playerState_s *EntityPlayerState; 
  unsigned int v4; 
  const playerState_s *v5; 
  signed int v6; 
  bool v7; 
  bool *p_renderInMap; 
  __int64 v9; 
  char *v10; 
  float *p_naturalDistance; 
  float *v12; 
  int v13; 
  int RelativeIcon; 
  signed int v15; 
  HeadIconView *headIcons; 
  unsigned int v17; 
  __int64 v18; 
  char *v19; 
  __int64 v20; 
  char *v21; 
  bool v22; 
  __int128 v23; 
  double v24; 
  __int64 v25; 
  HeadIconExtendedView v26; 
  _BYTE *v27; 
  HeadIconFlags *p_flags; 
  __int64 v29; 
  __int64 v30; 
  bool *v31; 
  char *v33; 
  __int128 v34; 
  _BYTE v35[24]; 
  char v36[512]; 
  char v37[768]; 
  __int64 v38[4]; 

  v1 = player;
  if ( !player && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 198, ASSERT_TYPE_ASSERT, "( player )", (const char *)&queryFormat, rowName) )
    __debugbreak();
  number = v1->s.number;
  if ( number >= 0xE0 )
  {
    LODWORD(v29) = v1->s.number;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\bitarray.h", 257, ASSERT_TYPE_ASSERT, "( pos ) < ( impl()->getBitCount() )", "pos < impl()->getBitCount()\n\t%i, %i", v29, 224) )
      __debugbreak();
  }
  if ( ((0x80000000 >> (number & 0x1F)) & s_headIcons_updateRequired.array[(unsigned __int64)number >> 5]) != 0 )
  {
    Sys_ProfBeginNamedEvent(0xFFFFFFFu, "G_HeadIcons_Update");
    EntityPlayerState = G_GetEntityPlayerState(v1);
    v4 = v1->s.number;
    v5 = EntityPlayerState;
    if ( v4 >= 0xE0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\bitarray.h", 290, ASSERT_TYPE_ASSERT, "( pos ) < ( impl()->getBitCount() )", "%s < %s\n\t%u, %u", "pos", "impl()->getBitCount()", v1->s.number, 224) )
      __debugbreak();
    s_headIcons_updateRequired.array[(unsigned __int64)v4 >> 5] &= ~(0x80000000 >> (v4 & 0x1F));
    memset_0(v37, 0, sizeof(v37));
    memset_0(v36, 0, sizeof(v36));
    memset(v38, 0, sizeof(v38));
    v6 = 0;
    v7 = Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80);
    p_renderInMap = &level.headIconExtendedData[0].renderInMap;
    v31 = &level.headIconExtendedData[0].renderInMap;
    v9 = 256i64;
    v33 = v36;
    v10 = v37;
    if ( v7 )
      v9 = 1024i64;
    p_naturalDistance = &level.headIcons[0].naturalDistance;
    v30 = v9;
    do
    {
      v12 = p_naturalDistance - 7;
      if ( p_naturalDistance == (float *)28 )
      {
        if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", (_DWORD)v12 + 93, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
          __debugbreak();
        v9 = v30;
      }
      if ( (*(_BYTE *)(p_naturalDistance - 1) & 1) != 0 )
      {
        if ( G_PlayerMask_IsPlayerInMask((const PlayerMask *)(p_naturalDistance + 3), v5, NULL) )
        {
          v13 = *(_DWORD *)v12;
          *(float *)v35 = *v12;
          RelativeIcon = G_HeadIcons_GetRelativeIcon((const HeadIcon *)(p_naturalDistance - 7), v5);
          *(_DWORD *)&v35[12] = (int)*p_naturalDistance;
          *(_DWORD *)&v35[16] = (int)p_naturalDistance[1];
          v15 = 0;
          *(float *)&v35[20] = p_naturalDistance[2];
          *(float *)&v35[8] = *(p_naturalDistance - 1);
          BYTE12(v34) = *(p_renderInMap - 1);
          LODWORD(v34) = *(_DWORD *)(p_renderInMap - 13);
          BYTE13(v34) = *p_renderInMap;
          headIcons = v5->headIcons;
          DWORD1(v34) = *(_DWORD *)(p_renderInMap - 9);
          DWORD2(v34) = *(_DWORD *)(p_renderInMap - 5);
          *(_DWORD *)&v35[4] = RelativeIcon;
          do
          {
            if ( headIcons->entityNumber == v13 && headIcons->icon == RelativeIcon && *(_QWORD *)&headIcons->entityNumber == *(_QWORD *)v35 && *(_OWORD *)&headIcons->flags == *(_OWORD *)&v35[8] && *(_OWORD *)&v5->headIconsExtendedData[v15] == v34 )
            {
              v1 = player;
              *((_BYTE *)v38 + v15) = 1;
              goto LABEL_31;
            }
            ++v15;
            ++headIcons;
          }
          while ( (unsigned int)v15 < 0x20 );
          v1 = player;
          if ( (unsigned int)v6 >= 0x20 )
          {
            Com_PrintWarning(15, "G_HeadIcons_Update: Too many new icons for player %i (%i)\n", (unsigned int)player->s.number, 32i64);
          }
          else
          {
            ++v6;
            *(_OWORD *)v10 = *(_OWORD *)v35;
            *((double *)v10 + 2) = *(double *)&v35[16];
            v10 += 24;
            *(_OWORD *)v33 = v34;
            v33 += 16;
          }
LABEL_31:
          p_renderInMap = v31;
        }
        v9 = v30;
      }
      p_renderInMap += 16;
      p_naturalDistance += 19;
      v31 = p_renderInMap;
      v30 = --v9;
    }
    while ( v9 );
    v17 = 0;
    if ( v6 > 0i64 )
    {
      v18 = 0i64;
      v19 = v37;
      v20 = 0i64;
      v21 = v36;
      do
      {
        v22 = v17 == 32;
        if ( v17 < 0x20 )
        {
          while ( *((_BYTE *)v38 + v20) )
          {
            ++v17;
            ++v20;
            if ( v17 >= 0x20 )
              goto LABEL_41;
          }
          v23 = *(_OWORD *)v19;
          v24 = *((double *)v19 + 2);
          v25 = 3 * v20 + 1278;
          *((_BYTE *)v38 + v20) = 1;
          *(_OWORD *)(&v5->commandTime + 2 * v25) = v23;
          v26 = *(HeadIconExtendedView *)v21;
          *((double *)&v5->pm_time + v25) = v24;
          v5->headIconsExtendedData[v20] = v26;
LABEL_41:
          v22 = v17 == 32;
        }
        if ( v22 )
        {
          Com_PrintWarning(15, "G_HeadIcons_Update: Can't add new icon, list is full for player %i\n", (unsigned int)v1->s.number);
          goto LABEL_49;
        }
        ++v18;
        v19 += 24;
        v21 += 16;
      }
      while ( v18 < v6 );
      if ( v17 >= 0x20 )
        goto LABEL_49;
    }
    v27 = (char *)v38 + (int)v17;
    p_flags = &v5->headIcons[v17].flags;
    do
    {
      if ( !*v27 )
        *p_flags = NONE;
      ++v17;
      ++v27;
      p_flags += 6;
    }
    while ( v17 < 0x20 );
LABEL_49:
    Sys_ProfEndNamedEvent();
  }
}

/*
==============
ScrCmd_AddClientToHeadIconMask
==============
*/
void ScrCmd_AddClientToHeadIconMask(scrContext_t *scrContext)
{
  int Int; 
  HeadIcon *v3; 
  gentity_s *Entity; 
  gentity_s *v5; 

  Int = Scr_GetInt(scrContext, 0);
  v3 = G_HeadIcon_Get(Int);
  Entity = GScr_GetEntity(1u);
  v5 = Entity;
  if ( !Entity->client && !Entity->agent )
    Scr_Error(COM_ERR_5284, scrContext, "Entity must be a player or a bot.");
  G_PlayerMask_AddClient(&v3->visData, v5->s.clientNum);
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_AddTeamToHeadIconMask
==============
*/
void ScrCmd_AddTeamToHeadIconMask(scrContext_t *scrContext)
{
  int Int; 
  HeadIcon *v3; 
  scr_string_t ConstString; 
  const char *v5; 
  const char *v6; 
  team_t outTeam; 

  Int = Scr_GetInt(scrContext, 0);
  v3 = G_HeadIcon_Get(Int);
  ConstString = Scr_GetConstString(scrContext, 1u);
  if ( Com_Teams_TeamFromString(ConstString, &outTeam) )
  {
    G_PlayerMask_AddTeam(&v3->visData, outTeam);
    *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
    *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
    *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
    s_headIcons_updateRequired.array[6] = -1;
  }
  else
  {
    v5 = SL_ConvertToString(ConstString);
    v6 = j_va("unknown team '%s'", v5);
    Scr_Error(COM_ERR_5285, scrContext, v6);
  }
}

/*
==============
ScrCmd_CreateHeadIcon
==============
*/
void ScrCmd_CreateHeadIcon(scrContext_t *scrContext)
{
  gentity_s *Entity; 

  Entity = GScr_GetEntity(0);
  ScrCmd_CreateHeadIcon_Common(scrContext, Entity->s.number, 0, &vec3_origin);
}

/*
==============
ScrCmd_CreateHeadIconAtOrigin
==============
*/
void ScrCmd_CreateHeadIconAtOrigin(scrContext_t *scrContext)
{
  vec3_t vectorValue; 

  Scr_GetVector(scrContext, 0, &vectorValue);
  ScrCmd_CreateHeadIcon_Common(scrContext, 2047, 1, &vectorValue);
}

/*
==============
ScrCmd_CreateHeadIcon_Common
==============
*/
void ScrCmd_CreateHeadIcon_Common(scrContext_t *scrContext, const int entityNum, const bool hasWorldOrigin, const vec3_t *worldOrigin)
{
  HeadIcon *headIcons; 
  __int64 v9; 
  int v10; 
  __int64 v11; 
  HeadIcon *v12; 
  bool v13; 
  HeadIconExtendedData *ExtendedData; 

  headIcons = level.headIcons;
  v9 = 256i64;
  if ( Com_GameMode_SupportsFeature(WEAPON_LEAP_LOOP|0x80) )
    v9 = 1024i64;
  v10 = 0;
  v11 = 0i64;
  while ( 1 )
  {
    if ( !headIcons && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 93, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
      __debugbreak();
    if ( (headIcons->flags & 1) == 0 )
      break;
    ++v10;
    ++v11;
    ++headIcons;
    if ( v11 >= v9 )
    {
      v10 = -1;
      goto LABEL_12;
    }
  }
  headIcons->flags |= 1u;
  if ( v10 != -1 )
  {
    v12 = G_HeadIcon_Get(v10);
    v12->entityNumber = entityNum;
    v12->ownerClient = -1;
    v13 = Com_GameMode_SupportsFeature(WEAPON_SKYDIVE_WEAPON_DROP|0x80);
    v12->naturalDistance = 250.0;
    v12->maxDistance = 1000.0;
    v12->ownerTeam = v13 ? TEAM_FOUR : TEAM_ZERO;
    ExtendedData = G_HeadIcon_GetExtendedData(v10);
    ExtendedData->hasWorldOrigin = hasWorldOrigin;
    ExtendedData->renderInMap = 0;
    ExtendedData->worldOrigin.v[0] = worldOrigin->v[0];
    ExtendedData->worldOrigin.v[1] = worldOrigin->v[1];
    ExtendedData->worldOrigin.v[2] = worldOrigin->v[2];
    *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
    *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
    *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
    s_headIcons_updateRequired.array[6] = -1;
  }
LABEL_12:
  Scr_AddInt(scrContext, v10);
}

/*
==============
ScrCmd_DeleteHeadIcon
==============
*/
void ScrCmd_DeleteHeadIcon(scrContext_t *scrContext)
{
  int Int; 
  HeadIconExtendedData *ExtendedData; 
  HeadIcon *v3; 

  Int = Scr_GetInt(scrContext, 0);
  ExtendedData = G_HeadIcon_GetExtendedData(Int);
  *(_QWORD *)ExtendedData->worldOrigin.v = 0i64;
  *(_QWORD *)&ExtendedData->worldOrigin.z = 0i64;
  v3 = G_HeadIcon_Get(Int);
  *(_QWORD *)&v3->entityNumber = 0i64;
  *(_QWORD *)&v3->ownerClient = 0i64;
  *(_QWORD *)&v3->enemyIcon = 0i64;
  *(_QWORD *)&v3->flags = 0i64;
  *(_QWORD *)&v3->maxDistance = 0i64;
  *(_QWORD *)v3->visData.mask.array = 0i64;
  *(_QWORD *)&v3->visData.mask.array[2] = 0i64;
  *(_QWORD *)&v3->visData.mask.array[4] = 0i64;
  *(_QWORD *)&v3->visData.mask.array[6] = 0i64;
  *(_DWORD *)&v3->visData.invert = 0;
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_HideHeadIconFromPlayersInMask
==============
*/
void ScrCmd_HideHeadIconFromPlayersInMask(scrContext_t *scrContext)
{
  int Int; 
  HeadIcon *v2; 

  Int = Scr_GetInt(scrContext, 0);
  v2 = G_HeadIcon_Get(Int);
  G_PlayerMask_SetInverted(&v2->visData, 1);
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_RemoveClientFromHeadIconMask
==============
*/
void ScrCmd_RemoveClientFromHeadIconMask(scrContext_t *scrContext)
{
  int Int; 
  HeadIcon *v3; 
  gentity_s *Entity; 
  gentity_s *v5; 

  Int = Scr_GetInt(scrContext, 0);
  v3 = G_HeadIcon_Get(Int);
  Entity = GScr_GetEntity(1u);
  v5 = Entity;
  if ( !Entity->client && !Entity->agent )
    Scr_Error(COM_ERR_5286, scrContext, "Entity must be a player or a bot.");
  G_PlayerMask_RemoveClient(&v3->visData, v5->s.clientNum);
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_RemoveTeamFromHeadIconMask
==============
*/
void ScrCmd_RemoveTeamFromHeadIconMask(scrContext_t *scrContext)
{
  int Int; 
  HeadIcon *v3; 
  scr_string_t ConstString; 
  const char *v5; 
  const char *v6; 
  team_t outTeam; 

  Int = Scr_GetInt(scrContext, 0);
  v3 = G_HeadIcon_Get(Int);
  ConstString = Scr_GetConstString(scrContext, 1u);
  if ( Com_Teams_TeamFromString(ConstString, &outTeam) )
  {
    G_PlayerMask_RemoveTeam(&v3->visData, outTeam);
    *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
    *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
    *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
    s_headIcons_updateRequired.array[6] = -1;
  }
  else
  {
    v5 = SL_ConvertToString(ConstString);
    v6 = j_va("unknown team '%s'", v5);
    Scr_Error(COM_ERR_5287, scrContext, v6);
  }
}

/*
==============
ScrCmd_SetHeadIconDrawInMap
==============
*/
void ScrCmd_SetHeadIconDrawInMap(scrContext_t *scrContext)
{
  scrContext_t *v1; 
  int Int; 

  v1 = scrContext;
  Int = Scr_GetInt(scrContext, 0);
  LOBYTE(v1) = Scr_GetInt(v1, 1u) != 0;
  G_HeadIcon_GetExtendedData(Int)->renderInMap = (char)v1;
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_SetHeadIconDrawThroughGeo
==============
*/
void ScrCmd_SetHeadIconDrawThroughGeo(scrContext_t *scrContext)
{
  scrContext_t *v1; 
  int Int; 
  HeadIcon *v3; 
  HeadIcon *v4; 

  v1 = scrContext;
  Int = Scr_GetInt(scrContext, 0);
  LODWORD(v1) = Scr_GetInt(v1, 1u);
  v3 = G_HeadIcon_Get(Int);
  v4 = v3;
  if ( (_DWORD)v1 )
  {
    if ( !v3 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 86, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
      __debugbreak();
    v4->flags &= ~2u;
  }
  else
  {
    if ( !v3 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 79, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
      __debugbreak();
    v4->flags |= 2u;
  }
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_SetHeadIconEnemyImage
==============
*/
void ScrCmd_SetHeadIconEnemyImage(scrContext_t *scrContext)
{
  int Int; 
  const char *String; 
  HeadIcon *v4; 
  const char *v5; 
  unsigned int outIndex; 

  Int = Scr_GetInt(scrContext, 0);
  String = Scr_GetString(scrContext, 1u);
  v4 = G_HeadIcon_Get(Int);
  if ( !NetConstStrings_GetIndexFromName(NETCONSTSTRINGTYPE_HEADICON, String, &outIndex) )
  {
    v5 = j_va("'%s' is not a valid head icon image. Please make sure it is included as precache_headicon in zone_source.", String);
    Scr_Error(COM_ERR_5278, scrContext, v5);
  }
  v4->enemyIcon = outIndex;
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_SetHeadIconFriendlyImage
==============
*/
void ScrCmd_SetHeadIconFriendlyImage(scrContext_t *scrContext)
{
  int Int; 
  const char *String; 
  HeadIcon *v4; 
  const char *v5; 
  unsigned int outIndex; 

  Int = Scr_GetInt(scrContext, 0);
  String = Scr_GetString(scrContext, 1u);
  v4 = G_HeadIcon_Get(Int);
  if ( !NetConstStrings_GetIndexFromName(NETCONSTSTRINGTYPE_HEADICON, String, &outIndex) )
  {
    v5 = j_va("'%s' is not a valid head icon image. Please make sure it is included as precache_headicon in zone_source.", String);
    Scr_Error(COM_ERR_5277, scrContext, v5);
  }
  v4->friendlyIcon = outIndex;
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_SetHeadIconImage
==============
*/
void ScrCmd_SetHeadIconImage(scrContext_t *scrContext)
{
  int Int; 
  const char *String; 
  HeadIcon *v4; 
  const char *v5; 
  unsigned int outIndex; 

  Int = Scr_GetInt(scrContext, 0);
  String = Scr_GetString(scrContext, 1u);
  v4 = G_HeadIcon_Get(Int);
  if ( !NetConstStrings_GetIndexFromName(NETCONSTSTRINGTYPE_HEADICON, String, &outIndex) )
  {
    v5 = j_va("'%s' is not a valid head icon image. Please make sure it is included as precache_headicon in zone_source.", String);
    Scr_Error(COM_ERR_5276, scrContext, v5);
  }
  v4->friendlyIcon = outIndex;
  v4->enemyIcon = outIndex;
  v4->neutralIcon = outIndex;
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_SetHeadIconMaxDistance
==============
*/
void ScrCmd_SetHeadIconMaxDistance(scrContext_t *scrContext)
{
  int Int; 
  double Float; 
  HeadIcon *v4; 

  Int = Scr_GetInt(scrContext, 0);
  Float = Scr_GetFloat(scrContext, 1u);
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
  v4 = G_HeadIcon_Get(Int);
  v4->maxDistance = *(float *)&Float;
  if ( *(float *)&Float > 32000.0 )
  {
    v4->maxDistance = 32000.0;
    Scr_Error(COM_ERR_5283, scrContext, "SetHeadIconMaxDistance( index, distance ) should be called with a distance < 32000\n");
  }
}

/*
==============
ScrCmd_SetHeadIconNaturalDistance
==============
*/
void ScrCmd_SetHeadIconNaturalDistance(scrContext_t *scrContext)
{
  int Int; 
  double Float; 
  HeadIcon *v4; 

  Int = Scr_GetInt(scrContext, 0);
  Float = Scr_GetFloat(scrContext, 1u);
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
  v4 = G_HeadIcon_Get(Int);
  v4->naturalDistance = *(float *)&Float;
  if ( *(float *)&Float > 32000.0 )
  {
    v4->naturalDistance = 32000.0;
    Scr_Error(COM_ERR_5282, scrContext, "SetHeadIconNaturalDistance( index, distance ) should be called with a distance < 32000\n");
  }
}

/*
==============
ScrCmd_SetHeadIconNeutralImage
==============
*/
void ScrCmd_SetHeadIconNeutralImage(scrContext_t *scrContext)
{
  int Int; 
  const char *String; 
  HeadIcon *v4; 
  const char *v5; 
  unsigned int outIndex; 

  Int = Scr_GetInt(scrContext, 0);
  String = Scr_GetString(scrContext, 1u);
  v4 = G_HeadIcon_Get(Int);
  if ( !NetConstStrings_GetIndexFromName(NETCONSTSTRINGTYPE_HEADICON, String, &outIndex) )
  {
    v5 = j_va("'%s' is not a valid head icon image. Please make sure it is included as precache_headicon in zone_source.", String);
    Scr_Error(COM_ERR_5279, scrContext, v5);
  }
  v4->neutralIcon = outIndex;
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_SetHeadIconOwner
==============
*/
void ScrCmd_SetHeadIconOwner(scrContext_t *scrContext)
{
  int Int; 
  HeadIcon *v3; 
  int clientNum; 
  gentity_s *Entity; 
  gentity_s *v6; 

  Int = Scr_GetInt(scrContext, 0);
  v3 = G_HeadIcon_Get(Int);
  if ( Scr_GetType(scrContext, 1u) )
  {
    Entity = GScr_GetEntity(1u);
    v6 = Entity;
    if ( !Entity->client && !Entity->agent )
      Scr_Error(COM_ERR_5280, scrContext, "Entity must be a player or a bot.");
    clientNum = v6->s.clientNum;
  }
  else
  {
    clientNum = -1;
  }
  v3->ownerClient = clientNum;
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_SetHeadIconSnapToEdges
==============
*/
void ScrCmd_SetHeadIconSnapToEdges(scrContext_t *scrContext)
{
  scrContext_t *v1; 
  int Int; 
  HeadIcon *v3; 
  HeadIcon *v4; 

  v1 = scrContext;
  Int = Scr_GetInt(scrContext, 0);
  LODWORD(v1) = Scr_GetInt(v1, 1u);
  v3 = G_HeadIcon_Get(Int);
  v4 = v3;
  if ( (_DWORD)v1 )
  {
    if ( !v3 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 79, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
      __debugbreak();
    v4->flags |= 4u;
  }
  else
  {
    if ( !v3 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\game\\g_head_icons.cpp", 86, ASSERT_TYPE_ASSERT, "(headIcon)", (const char *)&queryFormat, "headIcon") )
      __debugbreak();
    v4->flags &= ~4u;
  }
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_SetHeadIconTeam
==============
*/
void ScrCmd_SetHeadIconTeam(scrContext_t *scrContext)
{
  int Int; 
  HeadIcon *v3; 
  scr_string_t ConstString; 
  const char *v5; 
  const char *v6; 

  Int = Scr_GetInt(scrContext, 0);
  v3 = G_HeadIcon_Get(Int);
  if ( Scr_GetType(scrContext, 1u) == VAR_UNDEFINED )
  {
    v3->ownerTeam = Com_GameMode_SupportsFeature(WEAPON_SKYDIVE_WEAPON_DROP|0x80) ? TEAM_FOUR : TEAM_ZERO;
LABEL_3:
    *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
    *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
    *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
    s_headIcons_updateRequired.array[6] = -1;
    return;
  }
  ConstString = Scr_GetConstString(scrContext, 1u);
  if ( Com_Teams_TeamFromString(ConstString, &v3->ownerTeam) )
    goto LABEL_3;
  v5 = SL_ConvertToString(ConstString);
  v6 = j_va("unknown team '%s'", v5);
  Scr_Error(COM_ERR_5281, scrContext, v6);
}

/*
==============
ScrCmd_SetHeadIconZOffset
==============
*/
void ScrCmd_SetHeadIconZOffset(scrContext_t *scrContext)
{
  int Int; 
  double Float; 

  Int = Scr_GetInt(scrContext, 0);
  Float = Scr_GetFloat(scrContext, 1u);
  G_HeadIcon_Get(Int)->zOffset = (int)*(float *)&Float;
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

/*
==============
ScrCmd_ShowHeadIconToPlayersInMask
==============
*/
void ScrCmd_ShowHeadIconToPlayersInMask(scrContext_t *scrContext)
{
  int Int; 
  HeadIcon *v2; 

  Int = Scr_GetInt(scrContext, 0);
  v2 = G_HeadIcon_Get(Int);
  G_PlayerMask_SetInverted(&v2->visData, 0);
  *(_QWORD *)s_headIcons_updateRequired.array = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[2] = -1i64;
  *(_QWORD *)&s_headIcons_updateRequired.array[4] = -1i64;
  s_headIcons_updateRequired.array[6] = -1;
}

