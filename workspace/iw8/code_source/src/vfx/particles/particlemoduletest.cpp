/*
==============
ParticleModuleTestImpact::Update
==============
*/

void __fastcall ParticleModuleTestImpact::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestImpact@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestAge::Update
==============
*/

void __fastcall ParticleModuleTestAge::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestAge@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestAge::Init
==============
*/

void __fastcall ParticleModuleTestAge::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestAge@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestPos::Update
==============
*/

void __fastcall ParticleModuleTestPos::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestPos@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
Particle_GenerateMatrixFromLookAt2
==============
*/

void __fastcall Particle_GenerateMatrixFromLookAt2(const float4 *normalAxis, const float4 *incommingXAxis, const float4 *incommingZAxis, vector3 *outMatrix)
{
  ?Particle_GenerateMatrixFromLookAt2@@YAXAEBUfloat4@@00AEAUvector3@@@Z(normalAxis, incommingXAxis, incommingZAxis, outMatrix);
}

/*
==============
ParticleModuleTestDeath::Init
==============
*/

void __fastcall ParticleModuleTestDeath::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestDeath@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestGravity::Init
==============
*/

void __fastcall ParticleModuleTestGravity::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestGravity@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestDeath::Update
==============
*/

void __fastcall ParticleModuleTestDeath::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestDeath@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestBirth::Init
==============
*/

void __fastcall ParticleModuleTestBirth::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestBirth@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestTimeInState::Update
==============
*/

void __fastcall ParticleModuleTestTimeInState::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestTimeInState@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestImpact::Init
==============
*/

void __fastcall ParticleModuleTestImpact::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestImpact@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestBirth::Update
==============
*/

void __fastcall ParticleModuleTestBirth::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestBirth@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestTimeInState::Init
==============
*/

void __fastcall ParticleModuleTestTimeInState::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestTimeInState@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestGravity::Update
==============
*/

void __fastcall ParticleModuleTestGravity::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  ?Update@ParticleModuleTestGravity@@SAXPEBUParticleModule@@PEAUParticleData@@IIMPEBVParticleEmitter@@PEBVParticleState@@@Z(pModuleBase, pParticleData, particleOffset, particleCount, __formal, pEmitterOwner, pParticleState);
}

/*
==============
ParticleModuleTestPos::Init
==============
*/

void __fastcall ParticleModuleTestPos::Init(ParticleModule *pModuleBase)
{
  ?Init@ParticleModuleTestPos@@SAXPEAUParticleModule@@@Z(pModuleBase);
}

/*
==============
ParticleModuleTestAge::Init
==============
*/
void ParticleModuleTestAge::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestBirth::Init
==============
*/
void ParticleModuleTestBirth::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestDeath::Init
==============
*/
void ParticleModuleTestDeath::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestGravity::Init
==============
*/
void ParticleModuleTestGravity::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestImpact::Init
==============
*/
void ParticleModuleTestImpact::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestPos::Init
==============
*/
void ParticleModuleTestPos::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
ParticleModuleTestTimeInState::Init
==============
*/
void ParticleModuleTestTimeInState::Init(ParticleModule *pModuleBase)
{
  *((_BYTE *)&pModuleBase[1].m_type + 2) = 6;
}

/*
==============
Particle_GenerateMatrixFromLookAt2
==============
*/
void Particle_GenerateMatrixFromLookAt2(const float4 *normalAxis, const float4 *incommingXAxis, const float4 *incommingZAxis, vector3 *outMatrix)
{
  float4 v17; 
  __m128 v23; 
  __m128 v24; 
  __m128 v25; 
  float4 v30; 
  float4 v31; 
  __m128 v32; 
  __m128 v33; 
  __m128 v34; 

  if ( normalAxis->v.m128_f32[3] != 0.0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 465, ASSERT_TYPE_ASSERT, "(Float4ExtractW( normalAxis ) == 0.0f)", (const char *)&queryFormat, "Float4ExtractW( normalAxis ) == 0.0f") )
    __debugbreak();
  _XMM4 = g_negativeZero.v;
  __asm { vandnps xmm1, xmm4, xmmword ptr [rbx] }
  _XMM0 = g_equalsEpsilon.v;
  __asm
  {
    vcmpltps xmm1, xmm0, xmm1
    vmovmskps eax, xmm1
  }
  if ( (_EAX & 0xF) != 0 )
  {
    _XMM1 = _mm128_mul_ps(normalAxis->v, normalAxis->v);
    __asm
    {
      vinsertps xmm2, xmm1, xmm1, 8
      vhaddps xmm0, xmm2, xmm2
      vhaddps xmm0, xmm0, xmm0
    }
    v17.v = _mm128_div_ps(normalAxis->v, _mm_sqrt_ps(_XMM0));
    _XMM1 = _mm128_mul_ps(v17.v, incommingZAxis->v);
    __asm
    {
      vinsertps xmm2, xmm1, xmm1, 8
      vhaddps xmm0, xmm2, xmm2
      vhaddps xmm0, xmm0, xmm0
      vandnps xmm1, xmm4, xmm0
    }
    if ( *(float *)&_XMM1 <= 0.99900001 )
    {
      v32 = _mm_shuffle_ps(v17.v, v17.v, 201);
      v33 = _mm_shuffle_ps(v17.v, v17.v, 210);
      v34 = _mm128_sub_ps(_mm128_mul_ps(_mm_shuffle_ps(incommingZAxis->v, incommingZAxis->v, 201), v33), _mm128_mul_ps(_mm_shuffle_ps(incommingZAxis->v, incommingZAxis->v, 210), v32));
      _XMM0 = _mm128_mul_ps(v34, v34);
      __asm
      {
        vinsertps xmm1, xmm0, xmm0, 8
        vhaddps xmm2, xmm1, xmm1
        vhaddps xmm0, xmm2, xmm2
      }
      v31.v = _mm128_div_ps(v34, _mm_sqrt_ps(_XMM0));
      v30.v = _mm128_sub_ps(_mm128_mul_ps(_mm_shuffle_ps(v31.v, v31.v, 210), v32), _mm128_mul_ps(_mm_shuffle_ps(v31.v, v31.v, 201), v33));
    }
    else
    {
      v23 = _mm_shuffle_ps(v17.v, v17.v, 210);
      v24 = _mm_shuffle_ps(v17.v, v17.v, 201);
      v25 = _mm128_sub_ps(_mm128_mul_ps(_mm_shuffle_ps(incommingXAxis->v, incommingXAxis->v, 210), v24), _mm128_mul_ps(_mm_shuffle_ps(incommingXAxis->v, incommingXAxis->v, 201), v23));
      _XMM0 = _mm128_mul_ps(v25, v25);
      __asm
      {
        vinsertps xmm1, xmm0, xmm0, 8
        vhaddps xmm2, xmm1, xmm1
        vhaddps xmm0, xmm2, xmm2
      }
      v30.v = _mm128_div_ps(v25, _mm_sqrt_ps(_XMM0));
      v31.v = _mm128_sub_ps(_mm128_mul_ps(_mm_shuffle_ps(v30.v, v30.v, 201), v23), _mm128_mul_ps(_mm_shuffle_ps(v30.v, v30.v, 210), v24));
    }
    outMatrix->x = (float4)v31.v;
    outMatrix->y = (float4)v30.v;
    outMatrix->z = (float4)v17.v;
    Particle_AssertFloat4IsNormalized(&outMatrix->x);
    Particle_AssertFloat4IsNormalized(&outMatrix->y);
    Particle_AssertFloat4IsNormalized(&outMatrix->z);
  }
  else
  {
    outMatrix->x = (float4)identityMatrix44.m[0];
    outMatrix->y = (float4)identityMatrix44.row1;
    outMatrix->z = (float4)identityMatrix44.row2;
  }
}

/*
==============
Particle_HandleSuccessfulTest
==============
*/
void Particle_HandleSuccessfulTest(ParticleManager *pManager, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState, LocalClientNum_t localClientNum, unsigned int currentTime, const ParticleModuleTest *pTestModule, unsigned int moduleIndexFlag, unsigned int *moduleTests, unsigned int *state, unsigned int *flags, int randomSeed, const float4 *pos, bool hasWorldPosition, const float4 *size, const float4 *velocity, const float4 *rotationAngle, const vector4 *rEmitterTransform, const ParticleSystemDef *const systemDefOverride, const Particle_OnImpactData *pImpactData)
{
  __int128 v19; 
  __int128 v20; 
  __int128 v21; 
  __int128 v22; 
  __int128 v23; 
  __int128 v24; 
  __int128 v25; 
  __int128 v26; 
  __int128 v27; 
  __int128 v28; 
  ParticleUseOrientationOptions m_useOrientationOptions; 
  __int64 v31; 
  bool v32; 
  bool hasRotation; 
  FxMarkSpawnData *pMarkSpawnData; 
  const ParticleModuleInitRelativeVelocity *m_pModuleInitRelativeVelocity; 
  const ParticleSystem *v36; 
  int dobjHandle; 
  unsigned int v38; 
  const DObj *ClientDObj; 
  bool v40; 
  scr_string_t partName; 
  int entNum; 
  int v44; 
  float4 v45; 
  float4 v46; 
  float v47; 
  float4 v48; 
  float v49; 
  float4 v50; 
  __int64 v51; 
  CgEntitySystem *v52; 
  ParticleSystem *v53; 
  const char *name; 
  const char *v55; 
  const dvar_t *v56; 
  TraceHitType hitType; 
  unsigned int v58; 
  unsigned int LinkObject; 
  unsigned int v60; 
  unsigned __int16 v61; 
  const DObj *v62; 
  char v63; 
  ParticleEmitter *v64; 
  const ParticleSystem *pParentSystem; 
  ParticleSystemHandle v66; 
  unsigned int v67; 
  ParticleUseVelocityOptions m_useVelocityOptions; 
  __int64 v69; 
  ParticleUseScaleOptions m_useScaleOptions; 
  ParticleSystem *v71; 
  const ParticleSystem *v72; 
  ParticleSystem *SystemOwner; 
  const ParticleSystemDef *Def; 
  vector4 *v75; 
  vector4 *v76; 
  __int64 useOrientationOptions; 
  __int64 useOrientationOptionsa; 
  unsigned __int8 inOutIndex; 
  char v80; 
  unsigned int v81; 
  FxMarkSpawnData v82; 
  unsigned int v83; 
  unsigned int boneIndex; 
  ParticleEmitter *v85; 
  ParticleSystemFlags spawnFlags; 
  ParticleLinkedAssetListDef *pLinkedAssetList; 
  ParticleManager *pManagera; 
  float4 *v89; 
  int modelIndex; 
  int v91; 
  ParticleSystemDef *v92; 
  float4 *v93; 
  unsigned int *v94; 
  orientation_t *boltOffset[2]; 
  orientation_t orFirst; 
  vector4 outParticleTransform; 
  orientation_t orient; 
  orientation_t out; 
  orientation_t v100; 
  __int128 v101; 
  __int128 v102; 
  __int128 v103; 
  __int128 v104; 
  __int128 v105; 
  __int128 v106; 
  __int128 v107; 
  __int128 v108; 
  __int128 v109; 
  __int128 v110; 

  m_useOrientationOptions = pTestModule->m_useOrientationOptions;
  v93 = (float4 *)size;
  pManagera = pManager;
  v89 = (float4 *)velocity;
  v31 = localClientNum;
  *state = pTestModule->m_eventHandlerData.m_nextState;
  v32 = !pTestModule->m_eventHandlerData.m_kill;
  v85 = (ParticleEmitter *)pEmitterOwner;
  v94 = moduleTests;
  v92 = (ParticleSystemDef *)systemDefOverride;
  if ( !v32 )
    *flags |= 1u;
  if ( pTestModule->m_eventHandlerData.m_linkedAssetList.numAssets <= 0 && !systemDefOverride )
    goto LABEL_88;
  if ( pManagera->m_archiveState == ARCHIVE_STATE_RESTORING )
  {
    SystemOwner = (ParticleSystem *)ParticleEmitter::GetSystemOwner((ParticleEmitter *)pEmitterOwner);
    Def = ParticleSystem::GetDef(SystemOwner);
    Com_PrintWarning(21, "Can't create child effects during a savegame restore- killed 1 spawn (from an Event Module) for this emitter : %s \n", Def->name);
LABEL_88:
    *moduleTests |= moduleIndexFlag;
    return;
  }
  hasRotation = (pParticleState->m_pStateDef->flags & 0xF0) != 0;
  pMarkSpawnData = NULL;
  if ( systemDefOverride )
    pLinkedAssetList = NULL;
  else
    pLinkedAssetList = &pTestModule->m_eventHandlerData.m_linkedAssetList;
  ParticleEmitter::GetChildOrientation((ParticleEmitter *)pEmitterOwner, pos, v89, rotationAngle, hasRotation, rEmitterTransform, m_useOrientationOptions, 0, &outParticleTransform);
  if ( hasWorldPosition )
  {
    outParticleTransform.w = (float4)pos->v;
  }
  else
  {
    m_pModuleInitRelativeVelocity = pParticleState->m_pModuleInitRelativeVelocity;
    if ( !m_pModuleInitRelativeVelocity || (m_pModuleInitRelativeVelocity->m_flags & 1) != 0 || ((m_pModuleInitRelativeVelocity->m_velocityType - 3) & 0xFFFFFFFD) != 0 )
    {
      outParticleTransform.w = (float4)pos->v;
    }
    else
    {
      *(__m128 *)boltOffset = _mm128_add_ps(_mm128_mul_ps(rEmitterTransform->x.v, _mm_shuffle_ps(pos->v, pos->v, 0)), _mm128_add_ps(_mm128_mul_ps(rEmitterTransform->y.v, _mm_shuffle_ps(pos->v, pos->v, 85)), _mm128_add_ps(rEmitterTransform->w.v, _mm128_mul_ps(rEmitterTransform->z.v, _mm_shuffle_ps(pos->v, pos->v, 170)))));
      outParticleTransform.w = *(float4 *)boltOffset;
    }
    if ( (pParticleState->m_pStateDef->flags & 0x10000000) != 0 )
    {
      v36 = ParticleEmitter::GetSystemOwner(v85);
      *(float4 *)boltOffset = outParticleTransform.w;
      *(__m128 *)boltOffset = _mm128_add_ps(outParticleTransform.w.v, v36->m_systemTransform.w.v);
      outParticleTransform.w = *(float4 *)boltOffset;
    }
  }
  boneIndex = 0xFFFF;
  boltOffset[0] = NULL;
  dobjHandle = 4095;
  v83 = 4095;
  spawnFlags = PARTICLE_SYSTEM_FLAG_NONE;
  if ( !pImpactData )
    goto LABEL_79;
  FxMarkSpawnData::SetDefaults(&v82);
  if ( (pTestModule->m_flags & 0x10000) != 0 && pImpactData->hitType == TRACE_HITTYPE_ENTITY && (v38 = pImpactData->entNum, v38 < 0x7FE) && particle_on_impact_entity_bolt_killswitch->current.enabled )
  {
    v80 = 0;
    inOutIndex = -2;
    if ( FX_GetBoneOrientation_IsDObjEntityValid((LocalClientNum_t)v31, v38) )
    {
      ClientDObj = Com_GetClientDObj(pImpactData->entNum, (LocalClientNum_t)v31);
      v40 = ClientDObj != NULL;
      if ( ClientDObj )
      {
        partName = pImpactData->partName;
        if ( partName )
        {
          if ( DObjGetBoneIndexInternal_90(ClientDObj, partName, &inOutIndex, &modelIndex) )
          {
            entNum = pImpactData->entNum;
            v110 = v19;
            v109 = v20;
            v108 = v21;
            v107 = v22;
            v106 = v23;
            v105 = v24;
            __asm { vstmxcsr [rbp+1E0h+var_25C] }
            LOWORD(v81) = _ET0;
            v104 = v25;
            v44 = v81 & 0x1F80;
            __asm { vstmxcsr [rbp+1E0h+var_25C] }
            v103 = v26;
            v81 |= 0x1F80u;
            v102 = v27;
            v101 = v28;
            __asm { vldmxcsr [rbp+1E0h+var_25C] }
            if ( FX_GetBoneOrientation((LocalClientNum_t)v31, entNum, inOutIndex, &orient) )
            {
              v45.v = (__m128)outParticleTransform.x;
              v46.v = (__m128)outParticleTransform.w;
              v47 = _mm_shuffle_ps(v45.v, v45.v, 85).m128_f32[0];
              orFirst.axis.m[0].v[0] = outParticleTransform.x.v.m128_f32[0];
              LODWORD(orFirst.axis.m[0].v[2]) = _mm_shuffle_ps(v45.v, v45.v, 170).m128_u32[0];
              v48.v = (__m128)outParticleTransform.y;
              orFirst.axis.m[1].v[0] = outParticleTransform.y.v.m128_f32[0];
              orFirst.axis.m[0].v[1] = v47;
              v49 = _mm_shuffle_ps(v48.v, v48.v, 85).m128_f32[0];
              LODWORD(orFirst.axis.m[1].v[2]) = _mm_shuffle_ps(v48.v, v48.v, 170).m128_u32[0];
              v50.v = (__m128)outParticleTransform.z;
              orFirst.axis.m[1].v[1] = v49;
              orFirst.axis.m[2].v[0] = outParticleTransform.z.v.m128_f32[0];
              LODWORD(orFirst.axis.m[2].v[1]) = _mm_shuffle_ps(v50.v, v50.v, 85).m128_u32[0];
              LODWORD(orFirst.axis.m[2].v[2]) = _mm_shuffle_ps(v50.v, v50.v, 170).m128_u32[0];
              *(__m128 *)boltOffset = _mm_shuffle_ps(v46.v, v46.v, 170);
              orFirst.origin.v[0] = outParticleTransform.w.v.m128_f32[0];
              LODWORD(orFirst.origin.v[1]) = _mm_shuffle_ps(v46.v, v46.v, 85).m128_u32[0];
              orFirst.origin.v[2] = *(float *)boltOffset;
              OrientationInvert(&orient, &out);
              OrientationConcatenate(&orFirst, &out, &v100);
              v80 = 1;
              boltOffset[0] = &v100;
              v83 = pImpactData->entNum;
              boneIndex = inOutIndex;
            }
            __asm { vstmxcsr [rbp+1E0h+var_25C] }
            v81 = v44 | v81 & 0xFFFFE07F;
            __asm { vldmxcsr [rbp+1E0h+var_25C] }
          }
        }
      }
      if ( v40 )
        goto LABEL_48;
    }
    v51 = (int)pImpactData->entNum;
    if ( (unsigned int)v51 >= 0x7FE || !particle_bolt_non_dobj_entities_killswitch->current.enabled )
      goto LABEL_48;
    if ( !(_BYTE)CgEntitySystem::ms_allocatedType )
    {
      LODWORD(useOrientationOptions) = v31;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\cgame\\cg_entity.h", 288, ASSERT_TYPE_ASSERT, "(ms_allocatedType != GameModeType::NONE)", "%s\n\tTrying to access the entity system for localClientNum %d but the entity system type is not known\n", "ms_allocatedType != GameModeType::NONE", useOrientationOptions) )
        __debugbreak();
    }
    if ( (unsigned int)v31 >= CgEntitySystem::ms_allocatedCount )
    {
      LODWORD(useOrientationOptions) = CgEntitySystem::ms_allocatedCount;
      LODWORD(v75) = v31;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\cgame\\cg_entity.h", 289, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( ms_allocatedCount )", "localClientNum doesn't index ms_allocatedCount\n\t%i not in [0, %i)", v75, useOrientationOptions) )
        __debugbreak();
    }
    if ( !CgEntitySystem::ms_entitySystemArray[v31] )
    {
      LODWORD(useOrientationOptions) = v31;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\cgame\\cg_entity.h", 290, ASSERT_TYPE_ASSERT, "(ms_entitySystemArray[localClientNum])", "%s\n\tTrying to access unallocated entity system for localClientNum %d\n", "ms_entitySystemArray[localClientNum]", useOrientationOptions) )
        __debugbreak();
    }
    v52 = CgEntitySystem::ms_entitySystemArray[v31];
    if ( (unsigned int)v51 >= 0x800 )
    {
      LODWORD(useOrientationOptions) = 2048;
      LODWORD(v75) = v51;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\cgame\\cg_entity.h", 518, ASSERT_TYPE_ASSERT, "(unsigned)( entityIndex ) < (unsigned)( (( 2048 ) + 0) )", "entityIndex doesn't index MAX_LOCAL_CENTITIES\n\t%i not in [0, %i)", v75, useOrientationOptions) )
        __debugbreak();
    }
    if ( (v52->m_entities[v51].flags & 1) != 0 && v52->m_entities[v51].nextState.eType == ET_SCRIPTMOVER )
    {
      dobjHandle = pImpactData->entNum;
      boneIndex = 0xFFFF;
      spawnFlags = PARTICLE_SYSTEM_FLAG_DYNAMIC_BOLT_ROTATION;
    }
    else
    {
LABEL_48:
      if ( !v80 )
      {
        v53 = (ParticleSystem *)ParticleEmitter::GetSystemOwner(v85);
        name = ParticleSystem::GetDef(v53)->name;
        v55 = SL_ConvertToString(pImpactData->partName);
        Com_PrintWarning(21, "Bolting to entity '%u' partName '%s' failed - unsupported entity type. Effect '%s'\n", pImpactData->entNum, v55, name);
      }
      dobjHandle = v83;
    }
    v56 = particle_on_impact_entity_marks_killswitch;
    if ( particle_on_impact_entity_marks_killswitch->current.enabled )
    {
      v82.boneIndex = inOutIndex;
LABEL_77:
      LOWORD(LinkObject) = truncate_cast<unsigned short,unsigned int>(pImpactData->entNum);
      *((_BYTE *)&v82 + 3) &= ~0x80u;
      LinkObject = (unsigned __int16)LinkObject;
      goto LABEL_78;
    }
  }
  else
  {
    v56 = particle_on_impact_entity_marks_killswitch;
  }
  if ( !v56->current.enabled || (hitType = pImpactData->hitType, ((hitType - 1) & 0xFFFFFFFA) != 0) || hitType == TRACE_HITTYPE_CLIENT_MODEL )
  {
    if ( (pParticleState->m_pStateDef->flags & 0x400) == 0 || (v63 = 1, !pParticleState->m_pModulePhysicsLight) )
      v63 = 0;
    if ( !v63 )
      goto LABEL_79;
    if ( pImpactData->hitType && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 305, ASSERT_TYPE_ASSERT, "(pImpactData->hitType == TRACE_HITTYPE_NONE)", (const char *)&queryFormat, "pImpactData->hitType == TRACE_HITTYPE_NONE") )
      __debugbreak();
    goto LABEL_77;
  }
  if ( hitType == TRACE_HITTYPE_SCRIPTABLE )
  {
    v58 = pImpactData->entNum;
    if ( v58 != -1 && ScriptableCl_GetLinkTypeEquals((const LocalClientNum_t)v31, v58, SCRIPTABLE_LINK_DYNENT) )
    {
      LinkObject = ScriptableCl_GetLinkObject((const LocalClientNum_t)v31, pImpactData->entNum);
      goto LABEL_64;
    }
LABEL_66:
    v60 = pImpactData->entNum;
    if ( v60 < 0x7FE )
    {
      v61 = truncate_cast<unsigned short,unsigned int>(v60);
      *((_BYTE *)&v82 + 3) &= ~0x80u;
      pMarkSpawnData = &v82;
      v32 = pImpactData->partName == 0;
      v82.markEntnum = v61;
      if ( !v32 )
      {
        v62 = Com_GetClientDObj(pImpactData->entNum, (LocalClientNum_t)v31);
        if ( v62 )
          DObjGetBoneIndexInternal_90(v62, pImpactData->partName, &v82.boneIndex, &v91);
      }
    }
    goto LABEL_79;
  }
  if ( hitType != TRACE_HITTYPE_DYNENT_MODEL )
    goto LABEL_66;
  LinkObject = pImpactData->entNum;
LABEL_64:
  if ( LinkObject == -1 )
    goto LABEL_66;
  *((_BYTE *)&v82 + 3) |= 0x80u;
  v82.boneIndex = -2;
LABEL_78:
  v82.markEntnum = LinkObject;
  pMarkSpawnData = &v82;
LABEL_79:
  v64 = v85;
  pParentSystem = ParticleEmitter::GetSystemOwner(v85);
  v66 = ParticleEmitter::SpawnChildEffect(v64, (LocalClientNum_t)v31, currentTime, pManagera, pParticleState, pLinkedAssetList, randomSeed, &outParticleTransform.w, &outParticleTransform, dobjHandle, boneIndex, boltOffset[0], NULL, pMarkSpawnData, 0, 0, pParentSystem, v92, spawnFlags);
  v67 = v66 & 0xFFF;
  if ( v67 >= 0x1000 )
  {
    LODWORD(useOrientationOptionsa) = 4096;
    LODWORD(v76) = v66 & 0xFFF;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 914, ASSERT_TYPE_ASSERT, "(unsigned)( handleImpl._index ) < (unsigned)( ( sizeof( *array_counter( g_particleSystemsGeneration[localClientNum] ) ) + 0 ) )", "handleImpl._index doesn't index ARRAY_COUNT( g_particleSystemsGeneration[localClientNum] )\n\t%i not in [0, %i)", v76, useOrientationOptionsa) )
      __debugbreak();
  }
  v32 = g_particleSystemsGeneration[4096 * v31 + (v66 & 0xFFF)].__all32 == v66;
  m_useVelocityOptions = pTestModule->m_useVelocityOptions;
  if ( !v32 )
    v67 = 0;
  v69 = v67;
  m_useScaleOptions = pTestModule->m_useScaleOptions;
  v71 = g_particleSystems[v31][v69];
  if ( (unsigned __int64)v71 < 0x1000 )
    v71 = NULL;
  v72 = ParticleEmitter::GetSystemOwner(v64);
  ParticleState::UpdateModifiers((ParticleState *)pParticleState, v72, v71, v93, v89, &pTestModule->m_scaleModifier, &pTestModule->m_velocityModifier, m_useScaleOptions, m_useVelocityOptions);
  *v94 |= moduleIndexFlag;
}

/*
==============
ParticleModuleTestAge::Update
==============
*/
void ParticleModuleTestAge::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  __m256i *EmitterTransform; 
  unsigned int v13; 
  unsigned int v14; 
  __m256i v15; 
  float4 *RotationAngleArrayAtIndex; 
  float v17; 
  float *LifeArrayAtIndex; 
  __int64 v19; 
  float *v20; 
  signed __int64 v21; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int *particleIndexa; 
  signed __int64 particleIndexb; 
  int currentTime; 
  float4 *v28; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  vector4 rEmitterTransform; 

  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 336, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  EmitterTransform = (__m256i *)ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v13 = particleOffset;
  v14 = 1 << LOBYTE(pModuleBase[1].m_type);
  v15 = EmitterTransform[1];
  *(__m256i *)rEmitterTransform.x.v.m128_f32 = *EmitterTransform;
  *(__m256i *)rEmitterTransform.z.v.m128_f32 = v15;
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  particleIndexa = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, v13);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, v13);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, v13);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, v13);
  v17 = *(float *)&pModuleBase[14].m_type;
  v28 = RotationAngleArrayAtIndex;
  LifeArrayAtIndex = Particle_GetLifeArrayAtIndex(pParticleData, v13);
  v19 = 0i64;
  v20 = LifeArrayAtIndex;
  if ( particleCount )
  {
    v21 = (char *)ModuleTestsArrayAtIndex - (char *)LifeArrayAtIndex;
    particleIndexb = (char *)particleIndexa - (char *)LifeArrayAtIndex;
    do
    {
      if ( (v14 & *(_DWORD *)((_BYTE *)v20 + v21)) == 0 && v17 <= *v20 )
        Particle_HandleSuccessfulTest(&g_particleManager[m_localClientNum], pEmitterOwner, pParticleState, (LocalClientNum_t)m_localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v14, &ModuleTestsArrayAtIndex[v19], &StateArrayAtIndex[v19], &FlagsArrayAtIndex[v19], *(_DWORD *)((char *)v20 + particleIndexb), &PositionArrayAtIndex[(unsigned int)v19], 0, &SizeArrayAtIndex[(unsigned int)v19], &VelocityArrayAtIndex[(unsigned int)v19], &v28[(unsigned int)v19], &rEmitterTransform, NULL, NULL);
      v19 = (unsigned int)(v19 + 1);
      ++v20;
    }
    while ( (unsigned int)v19 < particleCount );
  }
}

/*
==============
ParticleModuleTestBirth::Update
==============
*/
void ParticleModuleTestBirth::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  __m256i *EmitterTransform; 
  __m256i v13; 
  int *RandomSeedArrayAtIndex; 
  float *LifeArrayAtIndex; 
  __int64 v16; 
  signed __int64 v17; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int v20; 
  int currentTime; 
  float4 *RotationAngleArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  vector4 rEmitterTransform; 

  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 357, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  EmitterTransform = (__m256i *)ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v13 = EmitterTransform[1];
  v20 = 1 << LOBYTE(pModuleBase[1].m_type);
  *(__m256i *)rEmitterTransform.x.v.m128_f32 = *EmitterTransform;
  *(__m256i *)rEmitterTransform.z.v.m128_f32 = v13;
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, particleOffset);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, particleOffset);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, particleOffset);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, particleOffset);
  LifeArrayAtIndex = Particle_GetLifeArrayAtIndex(pParticleData, particleOffset);
  v16 = 0i64;
  if ( particleCount )
  {
    v17 = (char *)LifeArrayAtIndex - (char *)RandomSeedArrayAtIndex;
    do
    {
      if ( *(float *)((char *)RandomSeedArrayAtIndex + v17) == 0.0 )
        Particle_HandleSuccessfulTest(&g_particleManager[m_localClientNum], pEmitterOwner, pParticleState, (LocalClientNum_t)m_localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v20, &ModuleTestsArrayAtIndex[v16], &StateArrayAtIndex[v16], &FlagsArrayAtIndex[v16], *RandomSeedArrayAtIndex, &PositionArrayAtIndex[(unsigned int)v16], 0, &SizeArrayAtIndex[(unsigned int)v16], &VelocityArrayAtIndex[(unsigned int)v16], &RotationAngleArrayAtIndex[(unsigned int)v16], &rEmitterTransform, NULL, NULL);
      v16 = (unsigned int)(v16 + 1);
      ++RandomSeedArrayAtIndex;
    }
    while ( (unsigned int)v16 < particleCount );
  }
}

/*
==============
ParticleModuleTestDeath::Update
==============
*/
void ParticleModuleTestDeath::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  __m256i *EmitterTransform; 
  __m256i v13; 
  int *RandomSeedArrayAtIndex; 
  __int64 v15; 
  float4 *v16; 
  unsigned int *v17; 
  signed __int64 v18; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int v21; 
  int currentTime; 
  unsigned int *FlagsArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  float4 *RotationAngleArrayAtIndex; 
  vector4 rEmitterTransform; 

  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 373, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  EmitterTransform = (__m256i *)ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v13 = EmitterTransform[1];
  v21 = 1 << LOBYTE(pModuleBase[1].m_type);
  *(__m256i *)rEmitterTransform.x.v.m128_f32 = *EmitterTransform;
  *(__m256i *)rEmitterTransform.z.v.m128_f32 = v13;
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, particleOffset);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, particleOffset);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, particleOffset);
  v15 = 0i64;
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, particleOffset);
  v16 = RotationAngleArrayAtIndex;
  if ( particleCount )
  {
    v17 = FlagsArrayAtIndex;
    v18 = (char *)FlagsArrayAtIndex - (char *)RandomSeedArrayAtIndex;
    do
    {
      if ( (*((_BYTE *)RandomSeedArrayAtIndex + v18) & 1) != 0 )
      {
        Particle_HandleSuccessfulTest(&g_particleManager[m_localClientNum], pEmitterOwner, pParticleState, (LocalClientNum_t)m_localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v21, &ModuleTestsArrayAtIndex[v15], &StateArrayAtIndex[v15], &v17[v15], *RandomSeedArrayAtIndex, &PositionArrayAtIndex[(unsigned int)v15], 0, &SizeArrayAtIndex[(unsigned int)v15], &VelocityArrayAtIndex[(unsigned int)v15], &v16[(unsigned int)v15], &rEmitterTransform, NULL, NULL);
        v17 = FlagsArrayAtIndex;
        v16 = RotationAngleArrayAtIndex;
      }
      v15 = (unsigned int)(v15 + 1);
      ++RandomSeedArrayAtIndex;
    }
    while ( (unsigned int)v15 < particleCount );
  }
}

/*
==============
ParticleModuleTestGravity::Update
==============
*/
void ParticleModuleTestGravity::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  ParticleManager *v12; 
  __m256i *EmitterTransform; 
  unsigned int v14; 
  __m256i v15; 
  int *RandomSeedArrayAtIndex; 
  __int64 p_camera; 
  __int64 v18; 
  unsigned int *v19; 
  unsigned int *v20; 
  unsigned int v21; 
  signed __int64 v22; 
  unsigned int *v23; 
  _DWORD *v24; 
  int v25; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int currentTime; 
  LocalClientNum_t localClientNum; 
  unsigned int *StateArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  float4 *RotationAngleArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  signed __int64 v38; 
  ParticleManager *pManager; 
  vector4 rEmitterTransform; 

  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  localClientNum = (int)m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  v12 = &g_particleManager[m_localClientNum];
  pManager = v12;
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 387, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  EmitterTransform = (__m256i *)ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v14 = 1 << LOBYTE(pModuleBase[1].m_type);
  v15 = EmitterTransform[1];
  *(__m256i *)rEmitterTransform.x.v.m128_f32 = *EmitterTransform;
  *(__m256i *)rEmitterTransform.z.v.m128_f32 = v15;
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, particleOffset);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, particleOffset);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, particleOffset);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, particleOffset);
  if ( !v12->m_pFxSystem && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 550, ASSERT_TYPE_ASSERT, "(GetFxSystem())", (const char *)&queryFormat, "GetFxSystem()") )
    __debugbreak();
  p_camera = (__int64)&v12->m_pFxSystem->camera;
  if ( v12->m_pFxSystem == (FxSystem *)-96i64 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 390, ASSERT_TYPE_ASSERT, "(pCamera)", (const char *)&queryFormat, "pCamera") )
    __debugbreak();
  if ( *(_DWORD *)&pModuleBase[14].m_type >= 2u && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 391, ASSERT_TYPE_ASSERT, "(pModule->m_gravityState == PARTICLE_GRAVITY_STATE_ON || pModule->m_gravityState == PARTICLE_GRAVITY_STATE_OFF)", (const char *)&queryFormat, "pModule->m_gravityState == PARTICLE_GRAVITY_STATE_ON || pModule->m_gravityState == PARTICLE_GRAVITY_STATE_OFF") )
    __debugbreak();
  if ( (*(_BYTE *)(p_camera + 151) == 0) == (*(_DWORD *)&pModuleBase[14].m_type == 0) )
  {
    v18 = 0i64;
    if ( particleCount )
    {
      v19 = StateArrayAtIndex;
      v20 = ModuleTestsArrayAtIndex;
      v21 = particleCount;
      v22 = (char *)StateArrayAtIndex - (char *)ModuleTestsArrayAtIndex;
      v38 = (char *)RandomSeedArrayAtIndex - (char *)StateArrayAtIndex;
      v23 = ModuleTestsArrayAtIndex;
      do
      {
        if ( (v14 & *v23) == 0 )
        {
          v24 = (unsigned int *)((char *)v23 + v22);
          v25 = *(unsigned int *)((char *)v23 + v22);
          Particle_HandleSuccessfulTest(pManager, pEmitterOwner, pParticleState, localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v14, &v20[v18], &v19[v18], &FlagsArrayAtIndex[v18], *(unsigned int *)((char *)v23 + v22 + v38), &PositionArrayAtIndex[(unsigned int)v18], 0, &SizeArrayAtIndex[(unsigned int)v18], &VelocityArrayAtIndex[(unsigned int)v18], &RotationAngleArrayAtIndex[(unsigned int)v18], &rEmitterTransform, NULL, NULL);
          v22 = (char *)StateArrayAtIndex - (char *)ModuleTestsArrayAtIndex;
          v19 = StateArrayAtIndex;
          v20 = ModuleTestsArrayAtIndex;
          if ( v25 != *v24 )
            *v23 &= ~v14;
          v21 = particleCount;
        }
        v18 = (unsigned int)(v18 + 1);
        ++v23;
      }
      while ( (unsigned int)v18 < v21 );
    }
  }
}

/*
==============
ParticleModuleTestImpact::Update
==============
*/
void ParticleModuleTestImpact::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 v10; 
  __int64 m_localClientNum; 
  float4 *RotationAngleArrayAtIndex; 
  bool v13; 
  Particle_OnImpactData *v14; 
  const ParticleStateDef *m_pStateDef; 
  __int64 v16; 
  const ParticleSystemDef *systemDefOverride; 
  bool v18; 
  float *v19; 
  unsigned int v20; 
  signed __int64 v21; 
  float v22; 
  const float4 *surfaceFx; 
  unsigned int *v24; 
  unsigned int v25; 
  int v26; 
  const ParticleModule *v27; 
  int v28; 
  unsigned int v29; 
  ParticleModule v30; 
  int v31; 
  const ParticleSystemDef *v32; 
  unsigned int v33; 
  ntl::red_black_tree_node_base *mp_parent; 
  ntl::red_black_tree_node_base *p_m_endNodeBase; 
  __int64 mp_parent_low; 
  vector3 *v37; 
  __m128 v38; 
  const char *v43; 
  const char *Name; 
  float4 v45; 
  float4 v46; 
  __m128 v47; 
  float v59; 
  float v60; 
  float v61; 
  float v62; 
  float v63; 
  float v64; 
  float v65; 
  float v66; 
  float v67; 
  float v68; 
  __m128 v70; 
  __m128 v74; 
  float4 v77; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  unsigned int v81; 
  int *RandomSeedArrayAtIndex; 
  const float4 *v83; 
  int currentTime; 
  LocalClientNum_t localClientNum; 
  Particle_OnImpactData *v86; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *ModuleTestsArrayAtIndex; 
  bool v89; 
  float4 lookAtInput; 
  FXRegisteredDef v91; 
  float4 *v92; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  ParticleState *v96; 
  ParticleEmitter *v97; 
  ParticleManager *pManager; 
  float4 incommingZAxis; 
  float4 incommingXAxis; 
  __m256i v101; 
  __m128 v102; 
  __m128 v103; 
  vector4 outMatrix; 

  v97 = (ParticleEmitter *)pEmitterOwner;
  v96 = (ParticleState *)pParticleState;
  v10 = particleOffset;
  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + (unsigned int)v10 >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + v10;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  localClientNum = (int)m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  pManager = &g_particleManager[m_localClientNum];
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 513, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v81 = 1 << LOBYTE(pModuleBase[1].m_type);
  Particle_GetPositionArrayAtIndex(pParticleData, v10);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, v10);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, v10);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, v10);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, v10);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, v10);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, v10);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, v10);
  v13 = pParticleState->m_onImpactDataList == NULL;
  v92 = RotationAngleArrayAtIndex;
  if ( v13 )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlestate.h", 455, ASSERT_TYPE_ASSERT, "(m_onImpactDataList)", (const char *)&queryFormat, "m_onImpactDataList") )
      __debugbreak();
    if ( !pParticleState->m_onImpactDataList && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 518, ASSERT_TYPE_ASSERT, "(pParticleState->GetOnImpactDataList())", (const char *)&queryFormat, "pParticleState->GetOnImpactDataList()") )
      __debugbreak();
  }
  v14 = &ParticleState::GetOnImpactDataList((ParticleState *)pParticleState)[v10];
  v86 = v14;
  if ( !v14 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 520, ASSERT_TYPE_ASSERT, "(pOnImpactDataList)", (const char *)&queryFormat, "pOnImpactDataList") )
    __debugbreak();
  m_pStateDef = pParticleState->m_pStateDef;
  v16 = 0i64;
  systemDefOverride = NULL;
  outMatrix.w = (float4)g_unit.v;
  v18 = (m_pStateDef->flags & 0x20000000) != 0i64;
  v89 = v18;
  if ( particleCount )
  {
    v19 = &v14->particleQuat.v[2];
    v20 = v81;
    v21 = (char *)ModuleTestsArrayAtIndex - (char *)FlagsArrayAtIndex;
    v22 = FLOAT_2_0;
    surfaceFx = (const float4 *)((char *)RandomSeedArrayAtIndex - (char *)FlagsArrayAtIndex);
    v24 = FlagsArrayAtIndex;
    v25 = particleCount;
    v83 = (const float4 *)((char *)RandomSeedArrayAtIndex - (char *)FlagsArrayAtIndex);
    while ( (v20 & *(unsigned int *)((char *)v24 + v21)) != 0 )
    {
LABEL_93:
      v16 = (unsigned int)(v16 + 1);
      v19 += 20;
      ++v24;
      if ( (unsigned int)v16 >= v25 )
        return;
    }
    if ( (*v24 & 4) == 0 )
    {
LABEL_92:
      v25 = particleCount;
      goto LABEL_93;
    }
    *v24 &= ~4u;
    if ( v18 )
    {
      v26 = *(unsigned int *)((char *)v24 + (_QWORD)surfaceFx);
      v27 = pModuleBase + 11;
      if ( pModuleBase == (const ParticleModule *)-88i64 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particleutil.h", 215, ASSERT_TYPE_ASSERT, "(pLinkedAssetList)", (const char *)&queryFormat, "pLinkedAssetList") )
        __debugbreak();
      if ( !*(_QWORD *)v27 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particleutil.h", 216, ASSERT_TYPE_ASSERT, "(pLinkedAssetList->assetList)", (const char *)&queryFormat, "pLinkedAssetList->assetList") )
        __debugbreak();
      if ( *(int *)&pModuleBase[12].m_type <= 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particleutil.h", 217, ASSERT_TYPE_ASSERT, "(pLinkedAssetList->numAssets > 0)", (const char *)&queryFormat, "pLinkedAssetList->numAssets > 0") )
        __debugbreak();
      v28 = *(_DWORD *)&pModuleBase[12].m_type;
      if ( v28 <= 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlerandom.h", 74, ASSERT_TYPE_ASSERT, "(count > 0)", (const char *)&queryFormat, "count > 0") )
        __debugbreak();
      v29 = abs32((v28 * LOWORD(fx_randomTable[v26 + 22])) >> 16);
      if ( v29 >= v28 )
      {
        LODWORD(moduleIndexFlag) = v28;
        LODWORD(pTestModule) = v29;
        if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlerandom.h", 78, ASSERT_TYPE_ASSERT, "(unsigned)( randomIndex ) < (unsigned)( count )", "randomIndex doesn't index count\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
          __debugbreak();
      }
      v30 = *v27;
      v31 = *((_DWORD *)v19 + 2);
      v32 = *(const ParticleSystemDef **)(32i64 * (int)v29 + *(_QWORD *)&v30);
      if ( !v32 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 446, ASSERT_TYPE_ASSERT, "(impactEffect)", (const char *)&queryFormat, "impactEffect") )
        __debugbreak();
      surfaceFx = (const float4 *)cgMedia.surfaceFx;
      v33 = (v31 >> 19) & 0x3F;
      v91.m_particleSystemDef = v32;
      if ( !cgMedia.surfaceFx )
        goto LABEL_76;
      mp_parent = cgMediaSurfaceFxMap.m_endNodeBase.mp_parent;
      p_m_endNodeBase = &cgMediaSurfaceFxMap.m_endNodeBase;
      if ( !cgMediaSurfaceFxMap.m_endNodeBase.mp_parent )
        goto LABEL_76;
      do
      {
        if ( *(_QWORD *)&mp_parent[1].m_color < (unsigned __int64)v32 )
        {
          mp_parent = mp_parent->mp_right;
        }
        else
        {
          p_m_endNodeBase = mp_parent;
          mp_parent = mp_parent->mp_left;
        }
      }
      while ( mp_parent );
      if ( p_m_endNodeBase == &cgMediaSurfaceFxMap.m_endNodeBase || (unsigned __int64)v32 < *(_QWORD *)&p_m_endNodeBase[1].m_color )
        goto LABEL_76;
      mp_parent_low = LODWORD(p_m_endNodeBase[1].mp_parent);
      if ( (unsigned int)mp_parent_low >= cgMedia.surfaceFx->numTableEntry )
      {
        LODWORD(moduleIndexFlag) = cgMedia.surfaceFx->numTableEntry;
        LODWORD(pTestModule) = p_m_endNodeBase[1].mp_parent;
        if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 431, ASSERT_TYPE_ASSERT, "(unsigned)( overrideIndex ) < (unsigned)( cgMedia.surfaceFx->numTableEntry )", "overrideIndex doesn't index cgMedia.surfaceFx->numTableEntry\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
          __debugbreak();
        surfaceFx = (const float4 *)cgMedia.surfaceFx;
      }
      systemDefOverride = *(const ParticleSystemDef **)(surfaceFx->v.m128_u64[1] + 8 * (v33 + 65 * mp_parent_low) + 8);
      if ( !systemDefOverride )
      {
LABEL_76:
        v43 = Com_SurfaceTypeToName(v33);
        Name = FXRegisteredDef::GetName(&v91);
        Com_PrintError(21, "Surface effect type not found for impact effect %s with surface type %s\n", Name, v43);
        v20 = v81;
        systemDefOverride = NULL;
LABEL_91:
        v21 = (char *)ModuleTestsArrayAtIndex - (char *)FlagsArrayAtIndex;
        v14 = v86;
        surfaceFx = v83;
        v18 = v89;
        goto LABEL_92;
      }
      v20 = v81;
      v14 = v86;
    }
    v37 = (vector3 *)*(unsigned int *)&pModuleBase[14].m_type;
    switch ( *(_DWORD *)&pModuleBase[14].m_type )
    {
      case 1:
        _XMM1 = _mm128_mul_ps(*(__m128 *)(v19 - 10), *(__m128 *)(v19 - 6));
        __asm
        {
          vinsertps xmm2, xmm1, xmm1, 8
          vhaddps xmm0, xmm2, xmm2
          vhaddps xmm1, xmm0, xmm0
        }
        v47 = _mm128_add_ps(_mm128_mul_ps(_mm128_mul_ps(_XMM1, (__m128)_xmm_c0000000c0000000c0000000c0000000), *(__m128 *)(v19 - 10)), *(__m128 *)(v19 - 6));
        break;
      case 2:
        v47 = *(__m128 *)(v19 - 6);
        _XMM1 = _mm128_mul_ps(v47, v47);
        __asm
        {
          vinsertps xmm2, xmm1, xmm1, 8
          vhaddps xmm0, xmm2, xmm2
          vhaddps xmm0, xmm0, xmm0
        }
LABEL_83:
        lookAtInput.v = _mm128_div_ps(v47, _mm_sqrt_ps(_XMM0));
        goto LABEL_84;
      case 3:
        v47 = _mm128_sub_ps((__m128)0i64, *(__m128 *)(v19 - 6));
        break;
      default:
        lookAtInput.v = *(__m128 *)(v19 - 10);
        if ( (_DWORD)v37 == 5 )
        {
          v38 = *(__m128 *)(v19 - 2);
          _XMM0 = v38;
          __asm
          {
            vinsertps xmm0, xmm0, xmm1, 10h
            vinsertps xmm0, xmm0, xmm2, 20h ; ' '
          }
          _mm_shuffle_ps(v38, v38, 255);
          __asm { vinsertps xmm0, xmm0, xmm3, 30h ; '0' }
          Float4UnitQuatToAxis(v37, surfaceFx);
          *(__m128 *)&v101.m256i_u64[2] = _mm_shuffle_ps(v38, v38, 85);
          *(_OWORD *)v101.m256i_i8 = _XMM0;
          *(__m256i *)outMatrix.x.v.m128_f32 = v101;
          outMatrix.z.v = _mm_shuffle_ps(v38, v38, 170);
LABEL_90:
          Particle_HandleSuccessfulTest(pManager, v97, v96, localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v20, &ModuleTestsArrayAtIndex[v16], &StateArrayAtIndex[v16], &FlagsArrayAtIndex[v16], *(unsigned int *)((char *)v24 + (_QWORD)v83), &v14[v16].pos, 1, &SizeArrayAtIndex[(unsigned int)v16], &VelocityArrayAtIndex[(unsigned int)v16], &v92[(unsigned int)v16], &outMatrix, systemDefOverride, &v14[v16]);
          goto LABEL_91;
        }
        if ( (_DWORD)v37 == 4 )
        {
          Particle_GenerateMatrixFromLookAt(&lookAtInput, &outMatrix);
          v45.v = (__m128)outMatrix.z;
          v46.v = _mm128_sub_ps((__m128)0i64, outMatrix.x.v);
          outMatrix.z = outMatrix.y;
          outMatrix.y = (float4)v45.v;
LABEL_89:
          outMatrix.x = (float4)v46.v;
          goto LABEL_90;
        }
LABEL_84:
        v59 = *(v19 - 1);
        v60 = *(v19 - 2);
        v61 = *v19;
        v62 = v19[1];
        v63 = (float)((float)((float)(v60 * v60) + (float)(v59 * v59)) + (float)(v61 * v61)) + (float)(v62 * v62);
        if ( COERCE_FLOAT(COERCE_UNSIGNED_INT(v63 - 1.0) & _xmm) >= 0.0020000001 && CoreAssert_Handler("c:\\workspace\\iw8\\shared\\codware\\core\\core_math.h", 770, ASSERT_TYPE_ASSERT, "( Vec4IsNormalized( quat ) )", "(%g, %g, %g, %g) len: %g", v60, v59, v61, v62, fsqrt(v63)) )
          __debugbreak();
        v64 = *(v19 - 1);
        v65 = v64 * (float)(v64 * v22);
        v66 = v64 * (float)(v22 * *(v19 - 2));
        v67 = v19[1] * (float)(*v19 * v22);
        v68 = *v19 * (float)(*v19 * v22);
        v102.m128_i32[3] = 0;
        v70 = v102;
        v70.m128_f32[0] = 1.0 - (float)(v68 + v65);
        _XMM0 = v70;
        v103.m128_i32[3] = 0;
        __asm
        {
          vinsertps xmm0, xmm0, xmm4, 10h
          vinsertps xmm0, xmm0, xmm10, 20h ; ' '
        }
        v102 = _XMM0;
        incommingXAxis.v = _XMM0;
        v74 = v103;
        v74.m128_f32[0] = v67 - v66;
        _XMM3 = v74;
        __asm
        {
          vinsertps xmm3, xmm3, xmm1, 10h
          vinsertps xmm3, xmm3, xmm2, 20h ; ' '
        }
        v103 = _XMM3;
        incommingZAxis.v = _XMM3;
        Particle_GenerateMatrixFromLookAt2(&lookAtInput, &incommingXAxis, &incommingZAxis, &outMatrix);
        v22 = FLOAT_2_0;
        if ( !*(_DWORD *)&pModuleBase[14].m_type )
          goto LABEL_90;
        v77.v = (__m128)outMatrix.y;
        v46.v = _mm128_sub_ps((__m128)0i64, outMatrix.x.v);
        outMatrix.y = outMatrix.z;
        outMatrix.z = (float4)v77.v;
        goto LABEL_89;
    }
    _XMM1 = _mm128_mul_ps(v47, v47);
    __asm
    {
      vinsertps xmm0, xmm1, xmm1, 8
      vhaddps xmm2, xmm0, xmm0
      vhaddps xmm0, xmm2, xmm2
    }
    goto LABEL_83;
  }
}

/*
==============
ParticleModuleTestPos::Update
==============
*/
void ParticleModuleTestPos::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 m_localClientNum; 
  __m256i *EmitterTransform; 
  unsigned int v13; 
  __m256i v14; 
  float4 *v15; 
  int *RandomSeedArrayAtIndex; 
  float4 *RotationAngleArrayAtIndex; 
  __int64 v20; 
  float v21; 
  float4 *v22; 
  unsigned int v23; 
  signed __int64 v24; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  float4 *particleIndexa; 
  int currentTime; 
  LocalClientNum_t localClientNum; 
  unsigned int *ModuleTestsArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  ParticleManager *pManager; 
  float4 *PositionArrayAtIndex; 
  vector4 rEmitterTransform; 

  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + particleOffset >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + particleOffset;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  localClientNum = (int)m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  pManager = &g_particleManager[m_localClientNum];
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 644, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  EmitterTransform = (__m256i *)ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v13 = 1 << LOBYTE(pModuleBase[1].m_type);
  v14 = EmitterTransform[1];
  *(__m256i *)rEmitterTransform.x.v.m128_f32 = *EmitterTransform;
  *(__m256i *)rEmitterTransform.z.v.m128_f32 = v14;
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, particleOffset);
  v15 = PositionArrayAtIndex;
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, particleOffset);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, particleOffset);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, particleOffset);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, particleOffset);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, particleOffset);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, particleOffset);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, particleOffset);
  particleIndexa = RotationAngleArrayAtIndex;
  _XMM0 = 0i64;
  __asm { vinsertps xmm0, xmm0, dword ptr [r12+70h], 20h ; ' ' }
  if ( (pModuleBase->m_flags & 0x80) == 0 )
    _XMM0 = _mm128_add_ps(_mm128_mul_ps(_mm_shuffle_ps(_XMM0, _XMM0, 0), rEmitterTransform.x.v), _mm128_add_ps(_mm128_mul_ps(_mm_shuffle_ps(_XMM0, _XMM0, 85), rEmitterTransform.y.v), _mm128_add_ps(_mm128_mul_ps(_mm_shuffle_ps(_XMM0, _XMM0, 170), rEmitterTransform.z.v), rEmitterTransform.w.v)));
  v20 = 0i64;
  LODWORD(v21) = _mm_shuffle_ps(_XMM0, _XMM0, 170).m128_u32[0];
  if ( particleCount )
  {
    v22 = PositionArrayAtIndex;
    v23 = particleCount;
    v24 = (char *)ModuleTestsArrayAtIndex - (char *)RandomSeedArrayAtIndex;
    do
    {
      if ( (v13 & *(int *)((char *)RandomSeedArrayAtIndex + v24)) == 0 && v22->v.m128_f32[2] < v21 )
      {
        Particle_HandleSuccessfulTest(pManager, pEmitterOwner, pParticleState, localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v13, &ModuleTestsArrayAtIndex[v20], &StateArrayAtIndex[v20], &FlagsArrayAtIndex[v20], *RandomSeedArrayAtIndex, &v15[(unsigned int)v20], 0, &SizeArrayAtIndex[(unsigned int)v20], &VelocityArrayAtIndex[(unsigned int)v20], &RotationAngleArrayAtIndex[(unsigned int)v20], &rEmitterTransform, NULL, NULL);
        v23 = particleCount;
        RotationAngleArrayAtIndex = particleIndexa;
        v15 = PositionArrayAtIndex;
      }
      v20 = (unsigned int)(v20 + 1);
      ++v22;
      ++RandomSeedArrayAtIndex;
    }
    while ( (unsigned int)v20 < v23 );
  }
}

/*
==============
ParticleModuleTestTimeInState::Update
==============
*/
void ParticleModuleTestTimeInState::Update(const ParticleModule *pModuleBase, ParticleData *pParticleData, unsigned int particleOffset, unsigned int particleCount, const float __formal, const ParticleEmitter *pEmitterOwner, const ParticleState *pParticleState)
{
  __int64 v10; 
  __int64 m_localClientNum; 
  __m256i *EmitterTransform; 
  unsigned int v13; 
  __m256i v14; 
  int *RandomSeedArrayAtIndex; 
  float *v16; 
  __int64 v17; 
  unsigned int v18; 
  signed __int64 v19; 
  signed __int64 v20; 
  float v21; 
  ParticleModuleTest *pTestModule; 
  __int64 moduleIndexFlag; 
  int currentTime; 
  LocalClientNum_t localClientNum; 
  unsigned int *ModuleTestsArrayAtIndex; 
  float4 *RotationAngleArrayAtIndex; 
  float4 *VelocityArrayAtIndex; 
  float4 *SizeArrayAtIndex; 
  float4 *PositionArrayAtIndex; 
  unsigned int *FlagsArrayAtIndex; 
  unsigned int *StateArrayAtIndex; 
  ParticleManager *pManager; 
  vector4 rEmitterTransform; 

  v10 = particleOffset;
  if ( !pModuleBase && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pModuleBase)", (const char *)&queryFormat, "pModuleBase") )
    __debugbreak();
  if ( !pParticleData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pParticleData)", (const char *)&queryFormat, "pParticleData") )
    __debugbreak();
  if ( !pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pEmitterOwner)", (const char *)&queryFormat, "pEmitterOwner") )
    __debugbreak();
  if ( !pParticleState && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pParticleState)", (const char *)&queryFormat, "pParticleState") )
    __debugbreak();
  if ( pParticleData->m_pEmitter != pEmitterOwner && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pParticleData->GetEmitter() == pEmitterOwner)", (const char *)&queryFormat, "pParticleData->GetEmitter() == pEmitterOwner") )
    __debugbreak();
  if ( particleCount + (unsigned int)v10 >= pParticleData->m_particleCountRunning + 1 )
  {
    LODWORD(pTestModule) = particleCount + v10;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(unsigned)( particleOffset + particleCount ) < (unsigned)( pParticleData->GetParticleCountRunning() + 1 )", "particleOffset + particleCount doesn't index pParticleData->GetParticleCountRunning() + 1\n\t%i not in [0, %i)", pTestModule, pParticleData->m_particleCountRunning + 1) )
      __debugbreak();
  }
  m_localClientNum = pEmitterOwner->m_pSystemOwner->m_localClientNum;
  localClientNum = (int)m_localClientNum;
  if ( (unsigned int)m_localClientNum >= 2 )
  {
    LODWORD(moduleIndexFlag) = 2;
    LODWORD(pTestModule) = pEmitterOwner->m_pSystemOwner->m_localClientNum;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemanager.h", 866, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", pTestModule, moduleIndexFlag) )
      __debugbreak();
  }
  pManager = &g_particleManager[m_localClientNum];
  currentTime = CG_GetLocalClientTime((const LocalClientNum_t)pEmitterOwner->m_pSystemOwner->m_localClientNum);
  if ( (pModuleBase->m_flags & 1) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 672, ASSERT_TYPE_ASSERT, "(pModule->IsEnabled())", (const char *)&queryFormat, "pModule->IsEnabled()") )
    __debugbreak();
  EmitterTransform = (__m256i *)ParticleEmitter::GetEmitterTransform((ParticleEmitter *)pEmitterOwner, pParticleState);
  v13 = 1 << LOBYTE(pModuleBase[1].m_type);
  v14 = EmitterTransform[1];
  *(__m256i *)rEmitterTransform.x.v.m128_f32 = *EmitterTransform;
  *(__m256i *)rEmitterTransform.z.v.m128_f32 = v14;
  PositionArrayAtIndex = Particle_GetPositionArrayAtIndex(pParticleData, v10);
  StateArrayAtIndex = Particle_GetStateArrayAtIndex(pParticleData, v10);
  FlagsArrayAtIndex = Particle_GetFlagsArrayAtIndex(pParticleData, v10);
  RandomSeedArrayAtIndex = Particle_GetRandomSeedArrayAtIndex(pParticleData, v10);
  ModuleTestsArrayAtIndex = Particle_GetModuleTestsArrayAtIndex(pParticleData, v10);
  SizeArrayAtIndex = Particle_GetSizeArrayAtIndex(pParticleData, v10);
  VelocityArrayAtIndex = Particle_GetVelocityArrayAtIndex(pParticleData, v10);
  RotationAngleArrayAtIndex = Particle_GetRotationAngleArrayAtIndex(pParticleData, v10);
  if ( !pParticleState->m_timeInStateList )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlestate.h", 525, ASSERT_TYPE_ASSERT, "(m_timeInStateList)", (const char *)&queryFormat, "m_timeInStateList") )
      __debugbreak();
    if ( !pParticleState->m_timeInStateList && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 674, ASSERT_TYPE_ASSERT, "(pParticleState->GetTimeInStateList())", (const char *)&queryFormat, "pParticleState->GetTimeInStateList()") )
      __debugbreak();
  }
  v16 = &ParticleState::GetTimeInStateList((ParticleState *)pParticleState)[v10];
  if ( !v16 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\vfx\\particles\\particlemoduletest.cpp", 676, ASSERT_TYPE_ASSERT, "(pTimeInStateList)", (const char *)&queryFormat, "pTimeInStateList") )
    __debugbreak();
  v17 = 0i64;
  if ( particleCount )
  {
    v18 = particleCount;
    v19 = (char *)ModuleTestsArrayAtIndex - (char *)RandomSeedArrayAtIndex;
    v20 = (char *)v16 - (char *)RandomSeedArrayAtIndex;
    do
    {
      if ( (v13 & *(int *)((char *)RandomSeedArrayAtIndex + v19)) == 0 )
      {
        v21 = fx_randomTable[*RandomSeedArrayAtIndex + 51];
        if ( (float)((float)(v21 * *(float *)&pModuleBase[14].m_flags) + (float)((float)(1.0 - v21) * *(float *)&pModuleBase[14].m_type)) <= *(float *)((char *)RandomSeedArrayAtIndex + v20) )
          Particle_HandleSuccessfulTest(pManager, pEmitterOwner, pParticleState, localClientNum, currentTime, (const ParticleModuleTest *)pModuleBase, v13, &ModuleTestsArrayAtIndex[v17], &StateArrayAtIndex[v17], &FlagsArrayAtIndex[v17], *RandomSeedArrayAtIndex, &PositionArrayAtIndex[(unsigned int)v17], 0, &SizeArrayAtIndex[(unsigned int)v17], &VelocityArrayAtIndex[(unsigned int)v17], &RotationAngleArrayAtIndex[(unsigned int)v17], &rEmitterTransform, NULL, NULL);
        v18 = particleCount;
      }
      v17 = (unsigned int)(v17 + 1);
      ++RandomSeedArrayAtIndex;
    }
    while ( (unsigned int)v17 < v18 );
  }
}

