/*
==============
DB_BackendCallbackDataRingBuffer_ClearSubmitQueue
==============
*/

void DB_BackendCallbackDataRingBuffer_ClearSubmitQueue(void)
{
  ?DB_BackendCallbackDataRingBuffer_ClearSubmitQueue@@YAXXZ();
}

/*
==============
SerializeIn<DB_BackendCallbackDataRingBufferAlloc>
==============
*/

void __fastcall SerializeIn<DB_BackendCallbackDataRingBufferAlloc>(const DB_BackendCallbackDataRingBufferAlloc *data, unsigned __int8 **buffer, int *bufferSize)
{
  ??$SerializeIn@UDB_BackendCallbackDataRingBufferAlloc@@@@YAXAEBUDB_BackendCallbackDataRingBufferAlloc@@AEAPEAEAEAH@Z(data, buffer, bufferSize);
}

/*
==============
DB_BackendCallbacks_Init
==============
*/

void DB_BackendCallbacks_Init(void)
{
  ?DB_BackendCallbacks_Init@@YAXXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_Unlock
==============
*/

void DB_BackendCallbackDataRingBuffer_Unlock(void)
{
  ?DB_BackendCallbackDataRingBuffer_Unlock@@YAXXZ();
}

/*
==============
DB_BackendCallbacks_CancelZoneCallbacks
==============
*/

void __fastcall DB_BackendCallbacks_CancelZoneCallbacks(XZoneHandleUnique zoneId)
{
  ?DB_BackendCallbacks_CancelZoneCallbacks@@YAXUXZoneHandleUnique@@@Z(zoneId);
}

/*
==============
DB_BackendCallbackDataRingBuffer_Init
==============
*/

void DB_BackendCallbackDataRingBuffer_Init(void)
{
  ?DB_BackendCallbackDataRingBuffer_Init@@YAXXZ();
}

/*
==============
SerializeOut<DB_BackendCallbackDataRingBufferAlloc>
==============
*/

void __fastcall SerializeOut<DB_BackendCallbackDataRingBufferAlloc>(DB_BackendCallbackDataRingBufferAlloc *data, unsigned __int8 **buffer, int *bufferSize)
{
  ??$SerializeOut@UDB_BackendCallbackDataRingBufferAlloc@@@@YAXAEAUDB_BackendCallbackDataRingBufferAlloc@@AEAPEAEAEAH@Z(data, buffer, bufferSize);
}

/*
==============
DB_BackendCallbackDataRingBuffer_Shutdown
==============
*/

void DB_BackendCallbackDataRingBuffer_Shutdown(void)
{
  ?DB_BackendCallbackDataRingBuffer_Shutdown@@YAXXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_AllocsFull
==============
*/

bool __fastcall DB_BackendCallbackDataRingBuffer_AllocsFull()
{
  return ?DB_BackendCallbackDataRingBuffer_AllocsFull@@YA_NXZ();
}

/*
==============
DB_BackendCallbacks_AddZoneCallbackToProcess
==============
*/

void __fastcall DB_BackendCallbacks_AddZoneCallbackToProcess(XZoneHandleUnique zoneId)
{
  ?DB_BackendCallbacks_AddZoneCallbackToProcess@@YAXUXZoneHandleUnique@@@Z(zoneId);
}

/*
==============
DB_GpuTempMemCallbacks_GetTotalSize
==============
*/

unsigned __int64 __fastcall DB_GpuTempMemCallbacks_GetTotalSize()
{
  return ?DB_GpuTempMemCallbacks_GetTotalSize@@YA_KXZ();
}

/*
==============
DB_BackendCallbacks_CancelAllAndFlush
==============
*/

void DB_BackendCallbacks_CancelAllAndFlush(void)
{
  ?DB_BackendCallbacks_CancelAllAndFlush@@YAXXZ();
}

/*
==============
DB_BackendCallbacks_RestoreSubmitQueue
==============
*/

void __fastcall DB_BackendCallbacks_RestoreSubmitQueue(unsigned __int8 *buffer, unsigned int bufferSize)
{
  ?DB_BackendCallbacks_RestoreSubmitQueue@@YAXPEAEI@Z(buffer, bufferSize);
}

/*
==============
DB_BackendCallbackDataRingBuffer_SerializeSubmitQueue
==============
*/

unsigned int __fastcall DB_BackendCallbackDataRingBuffer_SerializeSubmitQueue(unsigned __int8 *buffer, int bufferSize, bool save)
{
  return ?DB_BackendCallbackDataRingBuffer_SerializeSubmitQueue@@YAIPEAEH_N@Z(buffer, bufferSize, save);
}

/*
==============
DB_ProcessFinishedGpuTempMemCallbacks
==============
*/

void DB_ProcessFinishedGpuTempMemCallbacks(void)
{
  ?DB_ProcessFinishedGpuTempMemCallbacks@@YAXXZ();
}

/*
==============
DB_BackendCallbacks_AllZoneCallbackProcessed
==============
*/

bool __fastcall DB_BackendCallbacks_AllZoneCallbackProcessed(XZoneHandleUnique zoneId)
{
  return ?DB_BackendCallbacks_AllZoneCallbackProcessed@@YA_NUXZoneHandleUnique@@@Z(zoneId);
}

/*
==============
RB_ProcessBackendDBCallback
==============
*/

bool __fastcall RB_ProcessBackendDBCallback(ComputeCmdBufState *computeState)
{
  return ?RB_ProcessBackendDBCallback@@YA_NPEAUComputeCmdBufState@@@Z(computeState);
}

/*
==============
DB_BackendCallbacks_AllCallbacksProcessed
==============
*/

bool __fastcall DB_BackendCallbacks_AllCallbacksProcessed()
{
  return ?DB_BackendCallbacks_AllCallbacksProcessed@@YA_NXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_SubmitQueued
==============
*/

void DB_BackendCallbackDataRingBuffer_SubmitQueued(void)
{
  ?DB_BackendCallbackDataRingBuffer_SubmitQueued@@YAXXZ();
}

/*
==============
DB_BackendCallbacks_EndExclusiveAccess
==============
*/

void DB_BackendCallbacks_EndExclusiveAccess(void)
{
  ?DB_BackendCallbacks_EndExclusiveAccess@@YAXXZ();
}

/*
==============
DB_BackendCallbacks_Submit
==============
*/

void DB_BackendCallbacks_Submit(void)
{
  ?DB_BackendCallbacks_Submit@@YAXXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_ReleaseSerializedSubmitQueue
==============
*/

void __fastcall DB_BackendCallbackDataRingBuffer_ReleaseSerializedSubmitQueue(unsigned __int8 *buffer, int bufferSize)
{
  ?DB_BackendCallbackDataRingBuffer_ReleaseSerializedSubmitQueue@@YAXPEAEH@Z(buffer, bufferSize);
}

/*
==============
DB_BackendCallbackDataRingBuffer_PopFront
==============
*/

void DB_BackendCallbackDataRingBuffer_PopFront(void)
{
  ?DB_BackendCallbackDataRingBuffer_PopFront@@YAXXZ();
}

/*
==============
DB_BackendCallbacks_MarkZoneCallbackProcessed
==============
*/

void __fastcall DB_BackendCallbacks_MarkZoneCallbackProcessed(XZoneHandleUnique zoneId)
{
  ?DB_BackendCallbacks_MarkZoneCallbackProcessed@@YAXUXZoneHandleUnique@@@Z(zoneId);
}

/*
==============
DB_BackendCallbacks_EnsureExclusiveAccess
==============
*/

void DB_BackendCallbacks_EnsureExclusiveAccess(void)
{
  ?DB_BackendCallbacks_EnsureExclusiveAccess@@YAXXZ();
}

/*
==============
DB_BackendCallbacks_ReleaseSavedSubmitQueue
==============
*/

void __fastcall DB_BackendCallbacks_ReleaseSavedSubmitQueue(unsigned __int8 *buffer, unsigned int bufferSize)
{
  ?DB_BackendCallbacks_ReleaseSavedSubmitQueue@@YAXPEAEI@Z(buffer, bufferSize);
}

/*
==============
DB_BackendCallbacks_Shutdown
==============
*/

void DB_BackendCallbacks_Shutdown(void)
{
  ?DB_BackendCallbacks_Shutdown@@YAXXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_PreallocData
==============
*/

DB_BackendCallbackDataRingBufferAlloc *__fastcall DB_BackendCallbackDataRingBuffer_PreallocData(DB_BackendCallbackDataRingBufferAlloc *result, unsigned int size)
{
  return ?DB_BackendCallbackDataRingBuffer_PreallocData@@YA?AUDB_BackendCallbackDataRingBufferAlloc@@I@Z(result, size);
}

/*
==============
DB_BackendCallbackDataRingBuffer_Empty
==============
*/

bool __fastcall DB_BackendCallbackDataRingBuffer_Empty()
{
  return ?DB_BackendCallbackDataRingBuffer_Empty@@YA_NXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_Front
==============
*/

const DB_BackendCallbackDataRingBufferAlloc *__fastcall DB_BackendCallbackDataRingBuffer_Front()
{
  return ?DB_BackendCallbackDataRingBuffer_Front@@YAAEBUDB_BackendCallbackDataRingBufferAlloc@@XZ();
}

/*
==============
DB_GpuTempMemCallbacksTransferGpuTempMemOwnership
==============
*/

void __fastcall DB_GpuTempMemCallbacksTransferGpuTempMemOwnership(XZoneHandleUnique zoneId)
{
  ?DB_GpuTempMemCallbacksTransferGpuTempMemOwnership@@YAXUXZoneHandleUnique@@@Z(zoneId);
}

/*
==============
DB_BackendCallbackDataRingBuffer_SubmitQueueEmpty
==============
*/

bool __fastcall DB_BackendCallbackDataRingBuffer_SubmitQueueEmpty()
{
  return ?DB_BackendCallbackDataRingBuffer_SubmitQueueEmpty@@YA_NXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_AllocData
==============
*/

DB_BackendCallbackDataRingBufferAlloc *__fastcall DB_BackendCallbackDataRingBuffer_AllocData(DB_BackendCallbackDataRingBufferAlloc *result, unsigned int size)
{
  return ?DB_BackendCallbackDataRingBuffer_AllocData@@YA?AUDB_BackendCallbackDataRingBufferAlloc@@I@Z(result, size);
}

/*
==============
DB_BackendCallbackDataRingBuffer_Queue
==============
*/

void __fastcall DB_BackendCallbackDataRingBuffer_Queue(const DB_BackendCallbackDataRingBufferAlloc *alloc)
{
  ?DB_BackendCallbackDataRingBuffer_Queue@@YAXAEBUDB_BackendCallbackDataRingBufferAlloc@@@Z(alloc);
}

/*
==============
DB_BackendCallbacks_SaveSubmitQueue
==============
*/

unsigned int __fastcall DB_BackendCallbacks_SaveSubmitQueue(unsigned __int8 *buffer, unsigned int bufferSize)
{
  return ?DB_BackendCallbacks_SaveSubmitQueue@@YAIPEAEI@Z(buffer, bufferSize);
}

/*
==============
DB_GpuTempMemCallbacks_Init
==============
*/

void DB_GpuTempMemCallbacks_Init(void)
{
  ?DB_GpuTempMemCallbacks_Init@@YAXXZ();
}

/*
==============
RB_ProcessBackendDBCallbacks
==============
*/

void __fastcall RB_ProcessBackendDBCallbacks(ComputeCmdBufState *computeState)
{
  ?RB_ProcessBackendDBCallbacks@@YAXPEAUComputeCmdBufState@@@Z(computeState);
}

/*
==============
DB_BackendCallbacks_AnyCallbacksToSubmit
==============
*/

bool __fastcall DB_BackendCallbacks_AnyCallbacksToSubmit()
{
  return ?DB_BackendCallbacks_AnyCallbacksToSubmit@@YA_NXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_Lock
==============
*/

void DB_BackendCallbackDataRingBuffer_Lock(void)
{
  ?DB_BackendCallbackDataRingBuffer_Lock@@YAXXZ();
}

/*
==============
DB_AddGpuTempMemCallbackToProcess
==============
*/

void __fastcall DB_AddGpuTempMemCallbackToProcess(XZoneHandleUnique zoneId)
{
  ?DB_AddGpuTempMemCallbackToProcess@@YAXUXZoneHandleUnique@@@Z(zoneId);
}

/*
==============
DB_GpuTempMemCallbacks_Shutdown
==============
*/

void DB_GpuTempMemCallbacks_Shutdown(void)
{
  ?DB_GpuTempMemCallbacks_Shutdown@@YAXXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_DataFull
==============
*/

bool __fastcall DB_BackendCallbackDataRingBuffer_DataFull()
{
  return ?DB_BackendCallbackDataRingBuffer_DataFull@@YA_NXZ();
}

/*
==============
DB_BackendCallbackDataRingBuffer_PushBack
==============
*/

void __fastcall DB_BackendCallbackDataRingBuffer_PushBack(const DB_BackendCallbackDataRingBufferAlloc *alloc)
{
  ?DB_BackendCallbackDataRingBuffer_PushBack@@YAXAEBUDB_BackendCallbackDataRingBufferAlloc@@@Z(alloc);
}

/*
==============
SerializeIn<DB_BackendCallbackDataRingBufferAlloc>
==============
*/
void SerializeIn<DB_BackendCallbackDataRingBufferAlloc>(const DB_BackendCallbackDataRingBufferAlloc *data, unsigned __int8 **buffer, int *bufferSize)
{
  if ( (unsigned int)*bufferSize < 0x10 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 841, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
    __debugbreak();
  *(DB_BackendCallbackDataRingBufferAlloc *)*buffer = *data;
  *buffer += 16;
  *bufferSize -= 16;
}

/*
==============
SerializeOut<DB_BackendCallbackDataRingBufferAlloc>
==============
*/
void SerializeOut<DB_BackendCallbackDataRingBufferAlloc>(DB_BackendCallbackDataRingBufferAlloc *data, unsigned __int8 **buffer, int *bufferSize)
{
  if ( (unsigned int)*bufferSize < 0x10 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
    __debugbreak();
  *data = *(DB_BackendCallbackDataRingBufferAlloc *)*buffer;
  *buffer += 16;
  *bufferSize -= 16;
}

/*
==============
DB_AddGpuTempMemCallbackToProcess
==============
*/
void DB_AddGpuTempMemCallbackToProcess(XZoneHandleUnique zoneId)
{
  unsigned int v1; 
  __int64 v3; 
  unsigned int *p_m_packed; 
  DB_GpuTempMemCallbacks::ZoneToProcess *v5; 
  int v6; 
  int v7; 
  unsigned __int16 m_zoneIndex; 

  m_zoneIndex = zoneId.m_zoneIndex;
  v1 = g_dbGpuTempMemCallbacks.numZonesToProcess - 1;
  v3 = g_dbGpuTempMemCallbacks.numZonesToProcess - 1;
  if ( (signed int)(g_dbGpuTempMemCallbacks.numZonesToProcess - 1) < 0 )
    goto LABEL_7;
  p_m_packed = &g_dbGpuTempMemCallbacks.zonesToProcess[v1].zoneId.m_packed;
  while ( *p_m_packed != zoneId )
  {
    --v1;
    p_m_packed -= 12;
    if ( --v3 < 0 )
      goto LABEL_7;
  }
  if ( !&g_dbGpuTempMemCallbacks.zonesToProcess[v1] )
  {
LABEL_7:
    if ( m_zoneIndex >= 0x7A4u )
    {
      v7 = 1956;
      v6 = m_zoneIndex;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 314, ASSERT_TYPE_ASSERT, "(unsigned)( zoneId.m_zoneIndex ) < (unsigned)( DB_BackendCallbacks::MAX_ZONE_INDEX )", "zoneId.m_zoneIndex doesn't index DB_BackendCallbacks::MAX_ZONE_INDEX\n\t%i not in [0, %i)", v6, v7) )
        __debugbreak();
    }
    if ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[zoneId.m_generation % 6u][m_zoneIndex] && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 107, ASSERT_TYPE_ASSERT, "(DB_BackendCallbacks_AllZoneCallbackProcessed( zoneId ))", (const char *)&queryFormat, "DB_BackendCallbacks_AllZoneCallbackProcessed( zoneId )") )
      __debugbreak();
    if ( g_dbGpuTempMemCallbacks.numZonesToProcess >= 0x400 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 108, ASSERT_TYPE_ASSERT, "(g_dbGpuTempMemCallbacks.numZonesToProcess < DB_GpuTempMemCallbacks::MAX_ZONES_TO_PROCESS)", (const char *)&queryFormat, "g_dbGpuTempMemCallbacks.numZonesToProcess < DB_GpuTempMemCallbacks::MAX_ZONES_TO_PROCESS") )
      __debugbreak();
    v5 = &g_dbGpuTempMemCallbacks.zonesToProcess[g_dbGpuTempMemCallbacks.numZonesToProcess];
    v5->zoneId = zoneId;
    *(_QWORD *)&v5->firstCallbackIndex = -1i64;
    v5->gpuTempMemAlloc.pageRange = (Mem_PageRange)-1i64;
    v5->gpuTempMemAlloc.alloc = NULL;
    v5->gpuTempMemAlloc.size = 0i64;
    v5->ownsGpuTempMemory = 0;
    ++g_dbGpuTempMemCallbacks.numZonesToProcess;
  }
}

/*
==============
DB_BackendCallbackDataRingBuffer_AllocData
==============
*/
DB_BackendCallbackDataRingBufferAlloc *DB_BackendCallbackDataRingBuffer_AllocData(DB_BackendCallbackDataRingBufferAlloc *result, unsigned int size)
{
  volatile unsigned int m_dataWritePtr; 
  unsigned int v5; 
  signed __int32 v7[8]; 

  if ( g_dbBackendCallbackDataRingBuffer.m_dataWritePtr - g_dbBackendCallbackDataRingBuffer.m_dataReadPtr == g_dbBackendCallbackDataRingBuffer.m_dataSize && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 766, ASSERT_TYPE_ASSERT, "(!DB_BackendCallbackDataRingBuffer_DataFull())", (const char *)&queryFormat, "!DB_BackendCallbackDataRingBuffer_DataFull()") )
    __debugbreak();
  m_dataWritePtr = g_dbBackendCallbackDataRingBuffer.m_dataWritePtr;
  if ( size + g_dbBackendCallbackDataRingBuffer.m_dataWritePtr - g_dbBackendCallbackDataRingBuffer.m_dataReadPtr > g_dbBackendCallbackDataRingBuffer.m_dataSize && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 771, ASSERT_TYPE_ASSERT, "(writePtr - readPtr + size <= g_dbBackendCallbackDataRingBuffer.m_dataSize)", (const char *)&queryFormat, "writePtr - readPtr + size <= g_dbBackendCallbackDataRingBuffer.m_dataSize") )
    __debugbreak();
  _InterlockedOr(v7, 0);
  v5 = g_dbBackendCallbackDataRingBuffer.m_dataSize - (m_dataWritePtr & g_dbBackendCallbackDataRingBuffer.m_dataMask);
  if ( size > v5 )
    m_dataWritePtr += v5;
  result->m_data = &g_dbBackendCallbackDataRingBuffer.m_data[m_dataWritePtr & g_dbBackendCallbackDataRingBuffer.m_dataMask];
  result->m_dataEndPtr = m_dataWritePtr + size;
  g_dbBackendCallbackDataRingBuffer.m_dataWritePtr = m_dataWritePtr + size;
  _InterlockedOr(v7, 0);
  return result;
}

/*
==============
DB_BackendCallbackDataRingBuffer_AllocsFull
==============
*/
bool DB_BackendCallbackDataRingBuffer_AllocsFull()
{
  return g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr - g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr == g_dbBackendCallbackDataRingBuffer.m_allocsSize;
}

/*
==============
DB_BackendCallbackDataRingBuffer_ClearSubmitQueue
==============
*/
void DB_BackendCallbackDataRingBuffer_ClearSubmitQueue(void)
{
  *(_QWORD *)&g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr = 0i64;
}

/*
==============
DB_BackendCallbackDataRingBuffer_DataFull
==============
*/
bool DB_BackendCallbackDataRingBuffer_DataFull()
{
  return g_dbBackendCallbackDataRingBuffer.m_dataWritePtr - g_dbBackendCallbackDataRingBuffer.m_dataReadPtr == g_dbBackendCallbackDataRingBuffer.m_dataSize;
}

/*
==============
DB_BackendCallbackDataRingBuffer_Empty
==============
*/
bool DB_BackendCallbackDataRingBuffer_Empty()
{
  return g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr == g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr;
}

/*
==============
DB_BackendCallbackDataRingBuffer_Front
==============
*/
DB_BackendCallbackDataRingBufferAlloc *DB_BackendCallbackDataRingBuffer_Front()
{
  __int64 v0; 
  signed __int32 v2[8]; 

  if ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr == g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 798, ASSERT_TYPE_ASSERT, "(!DB_BackendCallbackDataRingBuffer_Empty())", (const char *)&queryFormat, "!DB_BackendCallbackDataRingBuffer_Empty()") )
    __debugbreak();
  v0 = g_dbBackendCallbackDataRingBuffer.m_allocsMask & g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr;
  _InterlockedOr(v2, 0);
  return &g_dbBackendCallbackDataRingBuffer.m_allocs[v0];
}

/*
==============
DB_BackendCallbackDataRingBuffer_Init
==============
*/
void DB_BackendCallbackDataRingBuffer_Init(void)
{
  PMem_BeginAlloc(DB_BACKEND_CALLBACK_RING_BUFFER_MEM, PMEM_STACK_GAME);
  g_dbBackendCallbackDataRingBuffer.m_allocsSize = 1024;
  g_dbBackendCallbackDataRingBuffer.m_allocsMask = 1023;
  g_dbBackendCallbackDataRingBuffer.m_allocs = (DB_BackendCallbackDataRingBufferAlloc *)PMem_Alloc(0x4000ui64, 0x10ui64, MEM_POOL_MAIN, PMEM_STACK_GAME, "ring buffer allocations");
  g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_queuedAllocs = (DB_BackendCallbackDataRingBufferAlloc *)PMem_Alloc(0x4000ui64, 0x10ui64, MEM_POOL_MAIN, PMEM_STACK_GAME, "ring buffer allocations");
  *(_QWORD *)&g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr = 0i64;
  g_dbBackendCallbackDataRingBuffer.m_preallocDataSize = 0x40000;
  g_dbBackendCallbackDataRingBuffer.m_preallocData = (unsigned __int8 *)PMem_Alloc(0x40000ui64, 0x10ui64, MEM_POOL_MAIN, PMEM_STACK_GAME, "prealloc data");
  g_dbBackendCallbackDataRingBuffer.m_dataSize = 0x40000;
  g_dbBackendCallbackDataRingBuffer.m_dataMask = 0x3FFFF;
  g_dbBackendCallbackDataRingBuffer.m_data = (unsigned __int8 *)PMem_Alloc(0x40000ui64, 0x10ui64, MEM_POOL_MAIN, PMEM_STACK_GAME, "ring buffer data");
  g_dbBackendCallbackDataRingBuffer.m_dataReadPtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_dataWritePtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_lock = 0;
  PMem_EndAlloc(DB_BACKEND_CALLBACK_RING_BUFFER_MEM, PMEM_STACK_GAME);
}

/*
==============
DB_BackendCallbackDataRingBuffer_Lock
==============
*/
void DB_BackendCallbackDataRingBuffer_Lock(void)
{
  while ( 1 )
  {
    if ( ((unsigned __int64)&g_dbBackendCallbackDataRingBuffer.m_lock & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 121, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", &g_dbBackendCallbackDataRingBuffer.m_lock) )
      __debugbreak();
    if ( !_InterlockedCompareExchange(&g_dbBackendCallbackDataRingBuffer.m_lock, 1, 0) )
      break;
    _mm_pause();
  }
}

/*
==============
DB_BackendCallbackDataRingBuffer_PopFront
==============
*/
void DB_BackendCallbackDataRingBuffer_PopFront(void)
{
  signed __int32 v0[8]; 

  _InterlockedOr(v0, 0);
  if ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr == g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 993, ASSERT_TYPE_ASSERT, "(!DB_BackendCallbackDataRingBuffer_Empty())", (const char *)&queryFormat, "!DB_BackendCallbackDataRingBuffer_Empty()") )
    __debugbreak();
  g_dbBackendCallbackDataRingBuffer.m_dataReadPtr = DB_BackendCallbackDataRingBuffer_Front()->m_dataEndPtr;
  if ( ((unsigned __int8)&g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", &g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr) )
    __debugbreak();
  _InterlockedIncrement(&g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr);
}

/*
==============
DB_BackendCallbackDataRingBuffer_PreallocData
==============
*/
DB_BackendCallbackDataRingBufferAlloc *DB_BackendCallbackDataRingBuffer_PreallocData(DB_BackendCallbackDataRingBufferAlloc *result, unsigned int size)
{
  unsigned int v3; 
  DB_BackendCallbackDataRingBufferAlloc *v4; 

  v3 = size + g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr;
  if ( size + g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr > g_dbBackendCallbackDataRingBuffer.m_preallocDataSize && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 752, ASSERT_TYPE_ASSERT, "(newPreallocWritePtr <= g_dbBackendCallbackDataRingBuffer.m_preallocDataSize)", (const char *)&queryFormat, "newPreallocWritePtr <= g_dbBackendCallbackDataRingBuffer.m_preallocDataSize") )
    __debugbreak();
  result->m_data = &g_dbBackendCallbackDataRingBuffer.m_preallocData[g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr];
  v4 = result;
  result->m_dataEndPtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr = v3;
  return v4;
}

/*
==============
DB_BackendCallbackDataRingBuffer_PushBack
==============
*/
void DB_BackendCallbackDataRingBuffer_PushBack(const DB_BackendCallbackDataRingBufferAlloc *alloc)
{
  signed __int32 v2[8]; 

  if ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr - g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr == g_dbBackendCallbackDataRingBuffer.m_allocsSize && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 968, ASSERT_TYPE_ASSERT, "(!DB_BackendCallbackDataRingBuffer_AllocsFull())", (const char *)&queryFormat, "!DB_BackendCallbackDataRingBuffer_AllocsFull()") )
    __debugbreak();
  _InterlockedOr(v2, 0);
  g_dbBackendCallbackDataRingBuffer.m_allocs[g_dbBackendCallbackDataRingBuffer.m_allocsMask & g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr] = *alloc;
  _InterlockedOr(v2, 0);
  if ( ((unsigned __int8)&g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", &g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr) )
    __debugbreak();
  _InterlockedIncrement(&g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr);
}

/*
==============
DB_BackendCallbackDataRingBuffer_Queue
==============
*/
void DB_BackendCallbackDataRingBuffer_Queue(const DB_BackendCallbackDataRingBufferAlloc *alloc)
{
  if ( g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs >= 0x400 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 810, ASSERT_TYPE_ASSERT, "(g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs < DB_BackendCallbackDataRingBuffer::MAX_QUEUED_ALLOCS)", (const char *)&queryFormat, "g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs < DB_BackendCallbackDataRingBuffer::MAX_QUEUED_ALLOCS") )
    __debugbreak();
  g_dbBackendCallbackDataRingBuffer.m_queuedAllocs[g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs++] = *alloc;
}

/*
==============
DB_BackendCallbackDataRingBuffer_ReleaseSerializedSubmitQueue
==============
*/
void DB_BackendCallbackDataRingBuffer_ReleaseSerializedSubmitQueue(unsigned __int8 *buffer, int bufferSize)
{
  __int64 v4; 
  unsigned int v5; 
  unsigned __int8 *v6; 
  unsigned int v7; 
  unsigned __int8 *v8; 
  __int64 v9; 
  __int64 v10; 
  unsigned __int8 (__fastcall *v11)(unsigned __int8 *, __int64 *); 
  int v12; 
  __int64 v13[2]; 
  int v14; 
  int v15; 

  if ( (unsigned int)bufferSize < 4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
    __debugbreak();
  v4 = *(unsigned int *)buffer;
  v5 = bufferSize - 4;
  if ( v5 < 4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
    __debugbreak();
  v6 = buffer + 8;
  v7 = v5 - 4;
  v8 = &v6[16 * v4];
  v9 = v4;
  if ( (int)v4 > 0 )
  {
    do
    {
      if ( v7 < 0x10 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
        __debugbreak();
      v10 = *(_QWORD *)v6;
      v6 += 16;
      v7 -= 16;
      v11 = *(unsigned __int8 (__fastcall **)(unsigned __int8 *, __int64 *))&v8[v10 + 16];
      if ( !v11 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 934, ASSERT_TYPE_ASSERT, "(trampolineFunc)", (const char *)&queryFormat, "trampolineFunc") )
        __debugbreak();
      v13[0] = 0i64;
      v12 = *(_DWORD *)&v8[v10 + 4];
      v13[1] = 0i64;
      v14 = v12;
      v15 = 1;
      if ( !v11(&v8[v10 + 32], v13) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 948, ASSERT_TYPE_ASSERT, "(retVal)", (const char *)&queryFormat, "retVal") )
        __debugbreak();
      --v9;
    }
    while ( v9 );
  }
}

/*
==============
DB_BackendCallbackDataRingBuffer_SerializeSubmitQueue
==============
*/
__int64 DB_BackendCallbackDataRingBuffer_SerializeSubmitQueue(unsigned __int8 *buffer, int bufferSize, bool save)
{
  int v5; 
  unsigned int v6; 
  int v7; 
  unsigned __int8 *v8; 
  int v9; 
  __int64 v10; 
  DB_BackendCallbackDataRingBufferAlloc *m_queuedAllocs; 
  unsigned int v12; 
  unsigned int v13; 
  unsigned int v14; 
  int v15; 
  unsigned __int8 *v16; 
  int v17; 
  __int64 v18; 
  DB_BackendCallbackDataRingBufferAlloc *v19; 
  int v21; 

  v21 = (int)buffer;
  v5 = (int)buffer;
  if ( save )
  {
    if ( (unsigned int)bufferSize < 4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 841, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
      __debugbreak();
    v6 = bufferSize - 4;
    *(_DWORD *)buffer = g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs;
    if ( v6 < 4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 841, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
      __debugbreak();
    *((_DWORD *)buffer + 1) = g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr;
    v7 = v6 - 4;
    v8 = buffer + 8;
    v9 = 0;
    if ( (int)g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs > 0 )
    {
      v10 = 0i64;
      do
      {
        g_dbBackendCallbackDataRingBuffer.m_queuedAllocs[v10].m_data -= (__int64)g_dbBackendCallbackDataRingBuffer.m_preallocData;
        m_queuedAllocs = g_dbBackendCallbackDataRingBuffer.m_queuedAllocs;
        if ( (unsigned int)v7 < 0x10 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 841, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
          __debugbreak();
        *(DB_BackendCallbackDataRingBufferAlloc *)v8 = m_queuedAllocs[v10];
        v8 += 16;
        v7 -= 16;
        ++v9;
        ++v10;
      }
      while ( v9 < (int)g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs );
      v5 = v21;
    }
    if ( v7 < (int)g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 877, ASSERT_TYPE_ASSERT, "(bufferSize >= (int)g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr)", (const char *)&queryFormat, "bufferSize >= (int)g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr") )
      __debugbreak();
    memcpy_0(v8, g_dbBackendCallbackDataRingBuffer.m_preallocData, g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr);
    v12 = g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr + (_DWORD)v8;
    *(_QWORD *)&g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr = 0i64;
  }
  else
  {
    if ( g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 887, ASSERT_TYPE_ASSERT, "(DB_BackendCallbackDataRingBuffer_SubmitQueueEmpty())", (const char *)&queryFormat, "DB_BackendCallbackDataRingBuffer_SubmitQueueEmpty()") )
      __debugbreak();
    if ( (unsigned int)bufferSize < 4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
      __debugbreak();
    v13 = bufferSize - 4;
    g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs = *(_DWORD *)buffer;
    if ( v13 < 4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
      __debugbreak();
    v14 = *((_DWORD *)buffer + 1);
    v15 = v13 - 4;
    v16 = buffer + 8;
    g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr = v14;
    v17 = 0;
    if ( (int)g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs > 0 )
    {
      v18 = 0i64;
      do
      {
        v19 = g_dbBackendCallbackDataRingBuffer.m_queuedAllocs;
        if ( (unsigned int)v15 < 0x10 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
          __debugbreak();
        v19[v18] = *(DB_BackendCallbackDataRingBufferAlloc *)v16;
        v16 += 16;
        v15 -= 16;
        ++v17;
        g_dbBackendCallbackDataRingBuffer.m_queuedAllocs[v18++].m_data += (unsigned __int64)g_dbBackendCallbackDataRingBuffer.m_preallocData;
      }
      while ( v17 < (int)g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs );
      v5 = v21;
    }
    if ( v15 < (int)g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 901, ASSERT_TYPE_ASSERT, "(bufferSize >= (int)g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr)", (const char *)&queryFormat, "bufferSize >= (int)g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr") )
      __debugbreak();
    if ( g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr > g_dbBackendCallbackDataRingBuffer.m_preallocDataSize && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 902, ASSERT_TYPE_ASSERT, "(g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr <= g_dbBackendCallbackDataRingBuffer.m_preallocDataSize)", (const char *)&queryFormat, "g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr <= g_dbBackendCallbackDataRingBuffer.m_preallocDataSize") )
      __debugbreak();
    memcpy_0(g_dbBackendCallbackDataRingBuffer.m_preallocData, v16, g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr);
    v12 = g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr + (_DWORD)v16;
    if ( v15 != g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 908, ASSERT_TYPE_ASSERT, "(bufferSize == 0)", (const char *)&queryFormat, "bufferSize == 0") )
      __debugbreak();
  }
  return v12 - v5;
}

/*
==============
DB_BackendCallbackDataRingBuffer_Shutdown
==============
*/
void DB_BackendCallbackDataRingBuffer_Shutdown(void)
{
  StreamerMemLoan result; 

  if ( g_dbBackendCallbackDataRingBuffer.m_allocs )
  {
    if ( !g_dbBackendCallbackDataRingBuffer.m_preallocData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 683, ASSERT_TYPE_ASSERT, "(g_dbBackendCallbackDataRingBuffer.m_preallocData != nullptr)", (const char *)&queryFormat, "g_dbBackendCallbackDataRingBuffer.m_preallocData != nullptr") )
      __debugbreak();
    if ( !g_dbBackendCallbackDataRingBuffer.m_queuedAllocs && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 684, ASSERT_TYPE_ASSERT, "(g_dbBackendCallbackDataRingBuffer.m_queuedAllocs != nullptr)", (const char *)&queryFormat, "g_dbBackendCallbackDataRingBuffer.m_queuedAllocs != nullptr") )
      __debugbreak();
    if ( !g_dbBackendCallbackDataRingBuffer.m_data && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 685, ASSERT_TYPE_ASSERT, "(g_dbBackendCallbackDataRingBuffer.m_data != nullptr)", (const char *)&queryFormat, "g_dbBackendCallbackDataRingBuffer.m_data != nullptr") )
      __debugbreak();
    PMem_Free(&result, DB_BACKEND_CALLBACK_RING_BUFFER_MEM, PMEM_STACK_GAME);
    StreamerMemLoan::~StreamerMemLoan(&result);
    g_dbBackendCallbackDataRingBuffer.m_allocs = NULL;
    g_dbBackendCallbackDataRingBuffer.m_preallocData = NULL;
    g_dbBackendCallbackDataRingBuffer.m_queuedAllocs = NULL;
    g_dbBackendCallbackDataRingBuffer.m_data = NULL;
  }
}

/*
==============
DB_BackendCallbackDataRingBuffer_SubmitQueueEmpty
==============
*/
bool DB_BackendCallbackDataRingBuffer_SubmitQueueEmpty()
{
  return g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs == 0;
}

/*
==============
DB_BackendCallbackDataRingBuffer_SubmitQueued
==============
*/
void DB_BackendCallbackDataRingBuffer_SubmitQueued(void)
{
  __int64 m_numQueuedAllocs; 
  __int64 v1; 
  DB_BackendCallbackDataRingBufferAlloc *m_queuedAllocs; 
  XZoneHandleUnique *m_data; 
  unsigned int m_packed; 
  volatile unsigned int m_dataWritePtr; 
  unsigned int v6; 
  unsigned __int8 *v7; 
  DB_BackendCallbackDataRingBufferAlloc v8; 
  signed __int32 v9[8]; 
  DB_BackendCallbackDataRingBufferAlloc v10; 

  if ( g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs )
  {
    m_numQueuedAllocs = g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs;
    v1 = 0i64;
    do
    {
      m_queuedAllocs = g_dbBackendCallbackDataRingBuffer.m_queuedAllocs;
      m_data = (XZoneHandleUnique *)g_dbBackendCallbackDataRingBuffer.m_queuedAllocs[v1].m_data;
      m_packed = m_data->m_packed;
      if ( g_dbBackendCallbackDataRingBuffer.m_dataWritePtr - g_dbBackendCallbackDataRingBuffer.m_dataReadPtr == g_dbBackendCallbackDataRingBuffer.m_dataSize && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 766, ASSERT_TYPE_ASSERT, "(!DB_BackendCallbackDataRingBuffer_DataFull())", (const char *)&queryFormat, "!DB_BackendCallbackDataRingBuffer_DataFull()") )
        __debugbreak();
      m_dataWritePtr = g_dbBackendCallbackDataRingBuffer.m_dataWritePtr;
      if ( m_packed + g_dbBackendCallbackDataRingBuffer.m_dataWritePtr - g_dbBackendCallbackDataRingBuffer.m_dataReadPtr > g_dbBackendCallbackDataRingBuffer.m_dataSize && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 771, ASSERT_TYPE_ASSERT, "(writePtr - readPtr + size <= g_dbBackendCallbackDataRingBuffer.m_dataSize)", (const char *)&queryFormat, "writePtr - readPtr + size <= g_dbBackendCallbackDataRingBuffer.m_dataSize") )
        __debugbreak();
      _InterlockedOr(v9, 0);
      v6 = g_dbBackendCallbackDataRingBuffer.m_dataSize - (m_dataWritePtr & g_dbBackendCallbackDataRingBuffer.m_dataMask);
      if ( m_packed > v6 )
        m_dataWritePtr += v6;
      v7 = &g_dbBackendCallbackDataRingBuffer.m_data[m_dataWritePtr & g_dbBackendCallbackDataRingBuffer.m_dataMask];
      v10.m_data = v7;
      v10.m_dataEndPtr = m_dataWritePtr + m_packed;
      g_dbBackendCallbackDataRingBuffer.m_dataWritePtr = m_dataWritePtr + m_packed;
      _InterlockedOr(v9, 0);
      v8 = v10;
      memcpy_0(v7, m_queuedAllocs[v1].m_data, m_data->m_packed);
      DB_BackendCallbacks_AddZoneCallbackToProcess(m_data[1]);
      if ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr - g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr == g_dbBackendCallbackDataRingBuffer.m_allocsSize && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 968, ASSERT_TYPE_ASSERT, "(!DB_BackendCallbackDataRingBuffer_AllocsFull())", (const char *)&queryFormat, "!DB_BackendCallbackDataRingBuffer_AllocsFull()") )
        __debugbreak();
      _InterlockedOr(v9, 0);
      g_dbBackendCallbackDataRingBuffer.m_allocs[g_dbBackendCallbackDataRingBuffer.m_allocsMask & g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr] = v8;
      _InterlockedOr(v9, 0);
      if ( ((unsigned __int64)&g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", &g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr) )
        __debugbreak();
      _InterlockedIncrement(&g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr);
      ++v1;
      --m_numQueuedAllocs;
    }
    while ( m_numQueuedAllocs );
  }
  *(_QWORD *)&g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr = 0i64;
}

/*
==============
DB_BackendCallbackDataRingBuffer_Unlock
==============
*/
void DB_BackendCallbackDataRingBuffer_Unlock(void)
{
  if ( ((unsigned __int8)&g_dbBackendCallbackDataRingBuffer.m_lock & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 93, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", &g_dbBackendCallbackDataRingBuffer.m_lock) )
    __debugbreak();
  if ( _InterlockedExchange(&g_dbBackendCallbackDataRingBuffer.m_lock, 0) != 1 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 715, ASSERT_TYPE_ASSERT, "(prevVal == 1)", (const char *)&queryFormat, "prevVal == 1") )
    __debugbreak();
}

/*
==============
DB_BackendCallbacks_AddZoneCallbackToProcess
==============
*/
void DB_BackendCallbacks_AddZoneCallbackToProcess(XZoneHandleUnique zoneId)
{
  unsigned __int16 m_zoneIndex; 
  unsigned int v2; 
  __int64 v4; 
  unsigned int *p_m_packed; 
  DB_GpuTempMemCallbacks::ZoneToProcess *v6; 
  __int64 v7; 
  volatile signed __int32 *v8; 
  __int64 v9; 
  __int64 v10; 
  int v11; 
  __int64 v12; 
  int v13; 

  m_zoneIndex = zoneId.m_zoneIndex;
  v2 = g_dbGpuTempMemCallbacks.numZonesToProcess - 1;
  v4 = g_dbGpuTempMemCallbacks.numZonesToProcess - 1;
  if ( (signed int)(g_dbGpuTempMemCallbacks.numZonesToProcess - 1) < 0 )
    goto LABEL_7;
  p_m_packed = &g_dbGpuTempMemCallbacks.zonesToProcess[v2].zoneId.m_packed;
  while ( *p_m_packed != zoneId )
  {
    --v2;
    p_m_packed -= 12;
    if ( --v4 < 0 )
      goto LABEL_7;
  }
  if ( !&g_dbGpuTempMemCallbacks.zonesToProcess[v2] )
  {
LABEL_7:
    if ( m_zoneIndex >= 0x7A4u )
    {
      v13 = 1956;
      v11 = m_zoneIndex;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 314, ASSERT_TYPE_ASSERT, "(unsigned)( zoneId.m_zoneIndex ) < (unsigned)( DB_BackendCallbacks::MAX_ZONE_INDEX )", "zoneId.m_zoneIndex doesn't index DB_BackendCallbacks::MAX_ZONE_INDEX\n\t%i not in [0, %i)", v11, v13) )
        __debugbreak();
    }
    if ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[zoneId.m_generation % 6u][m_zoneIndex] && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 107, ASSERT_TYPE_ASSERT, "(DB_BackendCallbacks_AllZoneCallbackProcessed( zoneId ))", (const char *)&queryFormat, "DB_BackendCallbacks_AllZoneCallbackProcessed( zoneId )") )
      __debugbreak();
    if ( g_dbGpuTempMemCallbacks.numZonesToProcess >= 0x400 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 108, ASSERT_TYPE_ASSERT, "(g_dbGpuTempMemCallbacks.numZonesToProcess < DB_GpuTempMemCallbacks::MAX_ZONES_TO_PROCESS)", (const char *)&queryFormat, "g_dbGpuTempMemCallbacks.numZonesToProcess < DB_GpuTempMemCallbacks::MAX_ZONES_TO_PROCESS") )
      __debugbreak();
    v6 = &g_dbGpuTempMemCallbacks.zonesToProcess[g_dbGpuTempMemCallbacks.numZonesToProcess];
    v6->zoneId = zoneId;
    *(_QWORD *)&v6->firstCallbackIndex = -1i64;
    v6->gpuTempMemAlloc.pageRange = (Mem_PageRange)-1i64;
    v6->gpuTempMemAlloc.alloc = NULL;
    v6->gpuTempMemAlloc.size = 0i64;
    v6->ownsGpuTempMemory = 0;
    ++g_dbGpuTempMemCallbacks.numZonesToProcess;
  }
  if ( m_zoneIndex >= 0x7A4u )
  {
    LODWORD(v12) = 1956;
    LODWORD(v10) = m_zoneIndex;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 282, ASSERT_TYPE_ASSERT, "(unsigned)( zoneId.m_zoneIndex ) < (unsigned)( DB_BackendCallbacks::MAX_ZONE_INDEX )", "zoneId.m_zoneIndex doesn't index DB_BackendCallbacks::MAX_ZONE_INDEX\n\t%i not in [0, %i)", v10, v12) )
      __debugbreak();
  }
  v7 = m_zoneIndex + 1956i64 * (zoneId.m_generation % 6u);
  v8 = &g_dbBackendCallbacks.m_numZoneScheduledCallbacks[0][v7];
  if ( ((unsigned __int8)v8 & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", (char *)g_dbBackendCallbacks.m_numZoneScheduledCallbacks + 4 * v7) )
    __debugbreak();
  _InterlockedIncrement(v8);
  if ( ((unsigned __int8)&g_dbBackendCallbacks & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", &g_dbBackendCallbacks) )
    __debugbreak();
  _InterlockedIncrement((volatile signed __int32 *)&g_dbBackendCallbacks);
  v9 = m_zoneIndex;
  if ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[0][v9] && g_dbBackendCallbacks.m_numZoneScheduledCallbacks[1][v9] && g_dbBackendCallbacks.m_numZoneScheduledCallbacks[2][v9] && g_dbBackendCallbacks.m_numZoneScheduledCallbacks[3][v9] && g_dbBackendCallbacks.m_numZoneScheduledCallbacks[4][v9] && g_dbBackendCallbacks.m_numZoneScheduledCallbacks[5][v9] && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 307, ASSERT_TYPE_ASSERT, "(( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[0][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[1][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[2][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[3][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[4][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[5][zoneId.m_zoneIndex] == 0 ))", (const char *)&queryFormat, "( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[0][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[1][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[2][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[3][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[4][zoneId.m_zoneIndex] == 0 ) || ( g_dbBackendCallbacks.m_numZoneScheduledCallbacks[5][zoneId.m_zoneIndex] == 0 )") )
    __debugbreak();
}

/*
==============
DB_BackendCallbacks_AllCallbacksProcessed
==============
*/
bool DB_BackendCallbacks_AllCallbacksProcessed()
{
  return g_dbBackendCallbacks.m_numTotalScheduledCallbacks == 0;
}

/*
==============
DB_BackendCallbacks_AllZoneCallbackProcessed
==============
*/
bool DB_BackendCallbacks_AllZoneCallbackProcessed(XZoneHandleUnique zoneId)
{
  unsigned __int16 m_generation; 
  unsigned __int16 m_zoneIndex; 

  m_zoneIndex = zoneId.m_zoneIndex;
  m_generation = zoneId.m_generation;
  if ( zoneId.m_zoneIndex >= 0x7A4u && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 314, ASSERT_TYPE_ASSERT, "(unsigned)( zoneId.m_zoneIndex ) < (unsigned)( DB_BackendCallbacks::MAX_ZONE_INDEX )", "zoneId.m_zoneIndex doesn't index DB_BackendCallbacks::MAX_ZONE_INDEX\n\t%i not in [0, %i)", zoneId.m_zoneIndex, 1956) )
    __debugbreak();
  return g_dbBackendCallbacks.m_numZoneScheduledCallbacks[m_generation % 6u][m_zoneIndex] == 0;
}

/*
==============
DB_BackendCallbacks_AnyCallbacksToSubmit
==============
*/
bool DB_BackendCallbacks_AnyCallbacksToSubmit()
{
  return g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs != 0;
}

/*
==============
DB_BackendCallbacks_CancelAllAndFlush
==============
*/
void DB_BackendCallbacks_CancelAllAndFlush(void)
{
  __int64 v0; 
  unsigned __int8 *m_data; 
  unsigned __int8 (__fastcall *v2)(unsigned __int8 *, __int64 *); 
  signed __int32 v3[8]; 
  __int64 v4[2]; 
  int v5; 
  int v6; 

  Sys_SyncDatabaseWithPump();
  DB_BackendCallbackDataRingBuffer_SubmitQueued();
  while ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr != g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr )
  {
    if ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr == g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 798, ASSERT_TYPE_ASSERT, "(!DB_BackendCallbackDataRingBuffer_Empty())", (const char *)&queryFormat, "!DB_BackendCallbackDataRingBuffer_Empty()") )
      __debugbreak();
    v0 = g_dbBackendCallbackDataRingBuffer.m_allocsMask & g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr;
    _InterlockedOr(v3, 0);
    m_data = g_dbBackendCallbackDataRingBuffer.m_allocs[v0].m_data;
    v2 = (unsigned __int8 (__fastcall *)(unsigned __int8 *, __int64 *))*((_QWORD *)m_data + 2);
    if ( !v2 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 458, ASSERT_TYPE_ASSERT, "(trampolineFunc)", (const char *)&queryFormat, "trampolineFunc") )
      __debugbreak();
    v4[0] = 0i64;
    v5 = *((_DWORD *)m_data + 1);
    v4[1] = *((_QWORD *)m_data + 3);
    v6 = 1;
    if ( !v2(m_data + 32, v4) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 470, ASSERT_TYPE_ASSERT, "(retVal)", (const char *)&queryFormat, "retVal") )
      __debugbreak();
    DB_BackendCallbacks_MarkZoneCallbackProcessed(*(XZoneHandleUnique *)(m_data + 4));
    DB_BackendCallbackDataRingBuffer_PopFront();
  }
}

/*
==============
DB_BackendCallbacks_CancelZoneCallbacks
==============
*/
void DB_BackendCallbacks_CancelZoneCallbacks(XZoneHandleUnique zoneId)
{
  __int64 v1; 
  unsigned int m_packed; 
  volatile int m_allocsReadPtr; 
  unsigned int v4; 
  unsigned int v5; 
  unsigned __int8 *m_data; 
  volatile signed __int32 *v7; 
  __int64 m_numQueuedAllocs; 
  unsigned __int8 *v9; 
  volatile signed __int32 *v10; 
  unsigned int v12; 

  v1 = 0i64;
  m_packed = zoneId.m_packed;
  m_allocsReadPtr = g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr;
  v4 = 0;
  v5 = g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr - g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr;
  if ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr != g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr )
  {
    do
    {
      m_data = g_dbBackendCallbackDataRingBuffer.m_allocs[g_dbBackendCallbackDataRingBuffer.m_allocsMask & (v4 + m_allocsReadPtr)].m_data;
      if ( *((_DWORD *)m_data + 1) == zoneId )
      {
        v7 = (volatile signed __int32 *)(m_data + 8);
        if ( ((unsigned __int8)v7 & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 121, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", (const void *)v7) )
          __debugbreak();
        _InterlockedCompareExchange(v7, 2, 0);
      }
      ++v4;
    }
    while ( v4 < v5 );
  }
  v12 = m_packed;
  if ( g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs )
  {
    m_numQueuedAllocs = g_dbBackendCallbackDataRingBuffer.m_numQueuedAllocs;
    do
    {
      v9 = g_dbBackendCallbackDataRingBuffer.m_queuedAllocs[v1].m_data;
      if ( *((_DWORD *)v9 + 1) == m_packed )
      {
        v10 = (volatile signed __int32 *)(v9 + 8);
        if ( (((_BYTE)v9 + 8) & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 121, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", v9 + 8) )
          __debugbreak();
        _InterlockedCompareExchange(v10, 2, 0);
        m_packed = v12;
      }
      ++v1;
      --m_numQueuedAllocs;
    }
    while ( m_numQueuedAllocs );
  }
}

/*
==============
DB_BackendCallbacks_EndExclusiveAccess
==============
*/
void DB_BackendCallbacks_EndExclusiveAccess(void)
{
  if ( ((unsigned __int8)&g_dbBackendCallbacks.m_loading & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 121, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", &g_dbBackendCallbacks.m_loading) )
    __debugbreak();
  if ( _InterlockedCompareExchange(&g_dbBackendCallbacks.m_loading, 0, 1) != 1 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 271, ASSERT_TYPE_ASSERT, "(prevVal == 1)", (const char *)&queryFormat, "prevVal == 1") )
    __debugbreak();
}

/*
==============
DB_BackendCallbacks_EnsureExclusiveAccess
==============
*/
void DB_BackendCallbacks_EnsureExclusiveAccess(void)
{
  if ( ((unsigned __int8)&g_dbBackendCallbacks.m_loading & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 121, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", &g_dbBackendCallbacks.m_loading) )
    __debugbreak();
  if ( _InterlockedCompareExchange(&g_dbBackendCallbacks.m_loading, 1, 0) )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 256, ASSERT_TYPE_ASSERT, "(prevVal == 0)", (const char *)&queryFormat, "prevVal == 0") )
      __debugbreak();
  }
}

/*
==============
DB_BackendCallbacks_Init
==============
*/
void DB_BackendCallbacks_Init(void)
{
  PMem_BeginAlloc(DB_BACKEND_CALLBACK_RING_BUFFER_MEM, PMEM_STACK_GAME);
  g_dbBackendCallbackDataRingBuffer.m_allocsSize = 1024;
  g_dbBackendCallbackDataRingBuffer.m_allocsMask = 1023;
  g_dbBackendCallbackDataRingBuffer.m_allocs = (DB_BackendCallbackDataRingBufferAlloc *)PMem_Alloc(0x4000ui64, 0x10ui64, MEM_POOL_MAIN, PMEM_STACK_GAME, "ring buffer allocations");
  g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_queuedAllocs = (DB_BackendCallbackDataRingBufferAlloc *)PMem_Alloc(0x4000ui64, 0x10ui64, MEM_POOL_MAIN, PMEM_STACK_GAME, "ring buffer allocations");
  *(_QWORD *)&g_dbBackendCallbackDataRingBuffer.m_preallocWritePtr = 0i64;
  g_dbBackendCallbackDataRingBuffer.m_preallocDataSize = 0x40000;
  g_dbBackendCallbackDataRingBuffer.m_preallocData = (unsigned __int8 *)PMem_Alloc(0x40000ui64, 0x10ui64, MEM_POOL_MAIN, PMEM_STACK_GAME, "prealloc data");
  g_dbBackendCallbackDataRingBuffer.m_dataSize = 0x40000;
  g_dbBackendCallbackDataRingBuffer.m_dataMask = 0x3FFFF;
  g_dbBackendCallbackDataRingBuffer.m_data = (unsigned __int8 *)PMem_Alloc(0x40000ui64, 0x10ui64, MEM_POOL_MAIN, PMEM_STACK_GAME, "ring buffer data");
  g_dbBackendCallbackDataRingBuffer.m_dataReadPtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_dataWritePtr = 0;
  g_dbBackendCallbackDataRingBuffer.m_lock = 0;
  PMem_EndAlloc(DB_BACKEND_CALLBACK_RING_BUFFER_MEM, PMEM_STACK_GAME);
  g_dbBackendCallbacks.m_numTotalScheduledCallbacks = 0;
  g_dbBackendCallbacks.m_loading = 0;
  memset_0((DB_BackendCallbacks *)g_dbBackendCallbacks.m_numZoneScheduledCallbacks, 0, sizeof(g_dbBackendCallbacks.m_numZoneScheduledCallbacks));
}

/*
==============
DB_BackendCallbacks_MarkZoneCallbackProcessed
==============
*/
void DB_BackendCallbacks_MarkZoneCallbackProcessed(XZoneHandleUnique zoneId)
{
  unsigned __int16 m_generation; 
  __int64 v2; 
  volatile signed __int32 *v3; 
  int v4; 
  int v5; 
  bool v6; 
  unsigned __int16 m_zoneIndex; 

  m_zoneIndex = zoneId.m_zoneIndex;
  m_generation = zoneId.m_generation;
  if ( zoneId.m_zoneIndex >= 0x7A4u && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 328, ASSERT_TYPE_ASSERT, "(unsigned)( zoneId.m_zoneIndex ) < (unsigned)( DB_BackendCallbacks::MAX_ZONE_INDEX )", "zoneId.m_zoneIndex doesn't index DB_BackendCallbacks::MAX_ZONE_INDEX\n\t%i not in [0, %i)", zoneId.m_zoneIndex, 1956) )
    __debugbreak();
  v2 = m_zoneIndex + 1956i64 * (m_generation % 6u);
  v3 = &g_dbBackendCallbacks.m_numZoneScheduledCallbacks[0][v2];
  if ( ((unsigned __int8)v3 & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 44, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", (char *)g_dbBackendCallbacks.m_numZoneScheduledCallbacks + 4 * v2) )
    __debugbreak();
  v4 = _InterlockedDecrement(v3);
  if ( ((unsigned __int8)&g_dbBackendCallbacks & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 44, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", &g_dbBackendCallbacks) )
    __debugbreak();
  v5 = _InterlockedDecrement((volatile signed __int32 *)&g_dbBackendCallbacks);
  if ( v4 < 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 334, ASSERT_TYPE_ASSERT, "(numZoneCallbacksLeft >= 0)", (const char *)&queryFormat, "numZoneCallbacksLeft >= 0") )
    __debugbreak();
  v6 = v5 == 0;
  if ( v5 < 0 )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 335, ASSERT_TYPE_ASSERT, "(numTotalCallbacksLeft >= 0)", (const char *)&queryFormat, "numTotalCallbacksLeft >= 0") )
      __debugbreak();
    v6 = v5 == 0;
  }
  if ( !v6 )
  {
LABEL_21:
    if ( v4 )
      return;
    goto LABEL_22;
  }
  if ( v4 )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 336, ASSERT_TYPE_ASSERT, "(( numTotalCallbacksLeft != 0 ) || ( numZoneCallbacksLeft == 0 ))", (const char *)&queryFormat, "( numTotalCallbacksLeft != 0 ) || ( numZoneCallbacksLeft == 0 )") )
      __debugbreak();
    goto LABEL_21;
  }
LABEL_22:
  Sys_WakeDatabaseThread();
}

/*
==============
DB_BackendCallbacks_ReleaseSavedSubmitQueue
==============
*/
void DB_BackendCallbacks_ReleaseSavedSubmitQueue(unsigned __int8 *buffer, unsigned int bufferSize)
{
  __int64 v4; 
  unsigned int v5; 
  unsigned __int8 *v6; 
  unsigned int v7; 
  unsigned __int8 *v8; 
  __int64 v9; 
  __int64 v10; 
  unsigned __int8 (__fastcall *v11)(unsigned __int8 *, __int64 *); 
  int v12; 
  __int64 v13[2]; 
  int v14; 
  int v15; 

  if ( bufferSize < 4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
    __debugbreak();
  v4 = *(unsigned int *)buffer;
  v5 = bufferSize - 4;
  if ( v5 < 4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
    __debugbreak();
  v6 = buffer + 8;
  v7 = v5 - 4;
  v8 = &buffer[16 * v4 + 8];
  v9 = v4;
  if ( (int)v4 > 0 )
  {
    do
    {
      if ( v7 < 0x10 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 852, ASSERT_TYPE_ASSERT, "(bufferSize >= sizeof( _Type ))", (const char *)&queryFormat, "bufferSize >= sizeof( _Type )") )
        __debugbreak();
      v10 = *(_QWORD *)v6;
      v6 += 16;
      v7 -= 16;
      v11 = *(unsigned __int8 (__fastcall **)(unsigned __int8 *, __int64 *))&v8[v10 + 16];
      if ( !v11 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 934, ASSERT_TYPE_ASSERT, "(trampolineFunc)", (const char *)&queryFormat, "trampolineFunc") )
        __debugbreak();
      v13[0] = 0i64;
      v12 = *(_DWORD *)&v8[v10 + 4];
      v13[1] = 0i64;
      v14 = v12;
      v15 = 1;
      if ( !v11(&v8[v10 + 32], v13) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 948, ASSERT_TYPE_ASSERT, "(retVal)", (const char *)&queryFormat, "retVal") )
        __debugbreak();
      --v9;
    }
    while ( v9 );
  }
}

/*
==============
DB_BackendCallbacks_RestoreSubmitQueue
==============
*/
void DB_BackendCallbacks_RestoreSubmitQueue(unsigned __int8 *buffer, unsigned int bufferSize)
{
  if ( !Sys_IsDatabaseThread() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 374, ASSERT_TYPE_ASSERT, "(Sys_IsDatabaseThread())", (const char *)&queryFormat, "Sys_IsDatabaseThread()") )
    __debugbreak();
  DB_BackendCallbackDataRingBuffer_SerializeSubmitQueue(buffer, bufferSize, 0);
}

/*
==============
DB_BackendCallbacks_SaveSubmitQueue
==============
*/
unsigned int DB_BackendCallbacks_SaveSubmitQueue(unsigned __int8 *buffer, unsigned int bufferSize)
{
  if ( !Sys_IsDatabaseThread() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 364, ASSERT_TYPE_ASSERT, "(Sys_IsDatabaseThread())", (const char *)&queryFormat, "Sys_IsDatabaseThread()") )
    __debugbreak();
  return DB_BackendCallbackDataRingBuffer_SerializeSubmitQueue(buffer, bufferSize, 1);
}

/*
==============
DB_BackendCallbacks_Shutdown
==============
*/
void DB_BackendCallbacks_Shutdown(void)
{
  StreamerMemLoan result; 

  if ( g_dbBackendCallbackDataRingBuffer.m_allocs )
  {
    if ( !g_dbBackendCallbackDataRingBuffer.m_preallocData && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 683, ASSERT_TYPE_ASSERT, "(g_dbBackendCallbackDataRingBuffer.m_preallocData != nullptr)", (const char *)&queryFormat, "g_dbBackendCallbackDataRingBuffer.m_preallocData != nullptr") )
      __debugbreak();
    if ( !g_dbBackendCallbackDataRingBuffer.m_queuedAllocs && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 684, ASSERT_TYPE_ASSERT, "(g_dbBackendCallbackDataRingBuffer.m_queuedAllocs != nullptr)", (const char *)&queryFormat, "g_dbBackendCallbackDataRingBuffer.m_queuedAllocs != nullptr") )
      __debugbreak();
    if ( !g_dbBackendCallbackDataRingBuffer.m_data && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 685, ASSERT_TYPE_ASSERT, "(g_dbBackendCallbackDataRingBuffer.m_data != nullptr)", (const char *)&queryFormat, "g_dbBackendCallbackDataRingBuffer.m_data != nullptr") )
      __debugbreak();
    PMem_Free(&result, DB_BACKEND_CALLBACK_RING_BUFFER_MEM, PMEM_STACK_GAME);
    StreamerMemLoan::~StreamerMemLoan(&result);
    g_dbBackendCallbackDataRingBuffer.m_allocs = NULL;
    g_dbBackendCallbackDataRingBuffer.m_preallocData = NULL;
    g_dbBackendCallbackDataRingBuffer.m_queuedAllocs = NULL;
    g_dbBackendCallbackDataRingBuffer.m_data = NULL;
  }
}

/*
==============
DB_BackendCallbacks_Submit
==============
*/

void DB_BackendCallbacks_Submit(void)
{
  DB_BackendCallbackDataRingBuffer_SubmitQueued();
}

/*
==============
DB_GpuTempMemCallbacksTransferGpuTempMemOwnership
==============
*/
void DB_GpuTempMemCallbacksTransferGpuTempMemOwnership(XZoneHandleUnique zoneId)
{
  __int64 v2; 
  DB_GpuTempMemCallbacks::ZoneToProcess *i; 
  XZoneMemoryAllocation *v4; 
  double v5; 
  unsigned __int64 size; 
  XZoneMemoryAllocation result; 
  unsigned __int16 m_zoneIndex; 

  m_zoneIndex = zoneId.m_zoneIndex;
  if ( !Sys_IsDatabaseThread() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 129, ASSERT_TYPE_ASSERT, "(Sys_IsDatabaseThread())", (const char *)&queryFormat, "Sys_IsDatabaseThread()") )
    __debugbreak();
  v2 = g_dbGpuTempMemCallbacks.numZonesToProcess - 1;
  if ( (signed int)(g_dbGpuTempMemCallbacks.numZonesToProcess - 1) >= 0 )
  {
    for ( i = &g_dbGpuTempMemCallbacks.zonesToProcess[v2]; i->zoneId.m_packed != zoneId; --i )
    {
      if ( --v2 < 0 )
        return;
    }
    if ( i->ownsGpuTempMemory && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 139, ASSERT_TYPE_ASSERT, "(!currZone->ownsGpuTempMemory)", (const char *)&queryFormat, "!currZone->ownsGpuTempMemory") )
      __debugbreak();
    v4 = DB_Zones_GpuTempMemoryAllocTransferOwnership(&result, m_zoneIndex);
    v5 = *(double *)&v4->size;
    *(_OWORD *)&i->gpuTempMemAlloc.pageRange.firstPageID = *(_OWORD *)&v4->pageRange.firstPageID;
    *(double *)&i->gpuTempMemAlloc.size = v5;
    size = i->gpuTempMemAlloc.size;
    i->ownsGpuTempMemory = 1;
    g_dbGpuTempMemCallbacks.totalMem += size;
  }
}

/*
==============
DB_GpuTempMemCallbacks_GetTotalSize
==============
*/
unsigned __int64 DB_GpuTempMemCallbacks_GetTotalSize()
{
  return g_dbGpuTempMemCallbacks.totalMem;
}

/*
==============
DB_GpuTempMemCallbacks_Init
==============
*/
void DB_GpuTempMemCallbacks_Init(void)
{
  g_dbGpuTempMemCallbacks.numZonesToProcess = 0;
}

/*
==============
DB_GpuTempMemCallbacks_Shutdown
==============
*/
void DB_GpuTempMemCallbacks_Shutdown(void)
{
  ;
}

/*
==============
DB_ProcessFinishedGpuTempMemCallbacks
==============
*/
void DB_ProcessFinishedGpuTempMemCallbacks(void)
{
  unsigned int numZonesToProcess; 
  __int64 i; 
  unsigned int callbacksDoneFrame; 
  unsigned __int64 size; 
  unsigned __int64 totalMem; 
  __int64 v5; 

  if ( !Sys_IsDatabaseThread() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 153, ASSERT_TYPE_ASSERT, "(Sys_IsDatabaseThread())", (const char *)&queryFormat, "Sys_IsDatabaseThread()") )
    __debugbreak();
  numZonesToProcess = g_dbGpuTempMemCallbacks.numZonesToProcess;
  for ( i = 0i64; (unsigned int)i < numZonesToProcess; i = (unsigned int)(i + 1) )
  {
    if ( DB_BackendCallbacks_AllZoneCallbackProcessed(g_dbGpuTempMemCallbacks.zonesToProcess[i].zoneId) )
    {
      callbacksDoneFrame = g_dbGpuTempMemCallbacks.zonesToProcess[i].callbacksDoneFrame;
      if ( callbacksDoneFrame == -1 )
      {
        g_dbGpuTempMemCallbacks.zonesToProcess[i].callbacksDoneFrame = g_gpuSwapFrame;
      }
      else if ( g_gpuSwapFrame - callbacksDoneFrame > 3 )
      {
        size = g_dbGpuTempMemCallbacks.zonesToProcess[i].gpuTempMemAlloc.size;
        totalMem = g_dbGpuTempMemCallbacks.totalMem;
        if ( size > g_dbGpuTempMemCallbacks.totalMem )
        {
          if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 178, ASSERT_TYPE_ASSERT, "( currZone->gpuTempMemAlloc.size ) <= ( g_dbGpuTempMemCallbacks.totalMem )", "%s <= %s\n\t%llu, %llu", "currZone->gpuTempMemAlloc.size", "g_dbGpuTempMemCallbacks.totalMem", size, g_dbGpuTempMemCallbacks.totalMem) )
            __debugbreak();
          totalMem = g_dbGpuTempMemCallbacks.totalMem;
        }
        g_dbGpuTempMemCallbacks.totalMem = totalMem - g_dbGpuTempMemCallbacks.zonesToProcess[i].gpuTempMemAlloc.size;
        if ( !g_dbGpuTempMemCallbacks.zonesToProcess[i].ownsGpuTempMemory && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 182, ASSERT_TYPE_ASSERT, "(currZone->ownsGpuTempMemory)", (const char *)&queryFormat, "currZone->ownsGpuTempMemory") )
          __debugbreak();
        DB_Zones_FreeGpuTempMemory(&g_dbGpuTempMemCallbacks.zonesToProcess[i].gpuTempMemAlloc);
        v5 = numZonesToProcess - 1;
        if ( (_DWORD)i != (_DWORD)v5 )
        {
          *(__m256i *)&g_dbGpuTempMemCallbacks.zonesToProcess[i].zoneId.m_generation = *(__m256i *)&g_dbGpuTempMemCallbacks.zonesToProcess[v5].zoneId.m_generation;
          *(_OWORD *)&g_dbGpuTempMemCallbacks.zonesToProcess[i].gpuTempMemAlloc.size = *(_OWORD *)&g_dbGpuTempMemCallbacks.zonesToProcess[v5].gpuTempMemAlloc.size;
        }
        numZonesToProcess = --g_dbGpuTempMemCallbacks.numZonesToProcess;
        LODWORD(i) = i - 1;
        continue;
      }
      Sys_WakeDatabaseThread();
    }
  }
}

/*
==============
RB_ProcessBackendDBCallback
==============
*/
char RB_ProcessBackendDBCallback(ComputeCmdBufState *computeState)
{
  const DB_BackendCallbackDataRingBufferAlloc *v2; 
  unsigned __int8 *m_data; 
  __int64 (__fastcall *v4)(unsigned __int8 *, ComputeCmdBufState **); 
  volatile signed __int32 *v5; 
  char v6; 
  ComputeCmdBufState *v8; 
  __int64 v9; 
  int v10; 
  int v11; 
  __int64 v12[2]; 
  int v13; 
  int v14; 

  if ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr == g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr )
    return 0;
  v2 = DB_BackendCallbackDataRingBuffer_Front();
  m_data = v2->m_data;
  v4 = (__int64 (__fastcall *)(unsigned __int8 *, ComputeCmdBufState **))*((_QWORD *)v2->m_data + 2);
  if ( !v4 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 493, ASSERT_TYPE_ASSERT, "(trampolineFunc)", (const char *)&queryFormat, "trampolineFunc") )
    __debugbreak();
  v5 = (volatile signed __int32 *)(m_data + 8);
  if ( *((_DWORD *)m_data + 2) == 1 )
    goto LABEL_10;
  if ( ((unsigned __int8)v5 & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 121, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", m_data + 8) )
    __debugbreak();
  if ( !_InterlockedCompareExchange(v5, 1, 0) )
  {
LABEL_10:
    v10 = *((_DWORD *)m_data + 1);
    v9 = *((_QWORD *)m_data + 3);
    v8 = computeState;
    v11 = 0;
    v6 = v4(m_data + 32, &v8);
    *((_QWORD *)m_data + 3) = v9;
    if ( v6 && Sys_InterlockedCompareExchange((volatile int *)m_data + 2, 2, 1) != 1 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 525, ASSERT_TYPE_ASSERT, "(oldState == DB_BackendCallbackBaseData::CALLBACK_STATE_PROCESSING)", (const char *)&queryFormat, "oldState == DB_BackendCallbackBaseData::CALLBACK_STATE_PROCESSING") )
      __debugbreak();
  }
  if ( *v5 != 2 )
    return 0;
  v13 = *((_DWORD *)m_data + 1);
  v12[1] = *((_QWORD *)m_data + 3);
  v12[0] = (__int64)computeState;
  v14 = 1;
  if ( !(unsigned __int8)v4(m_data + 32, (ComputeCmdBufState **)v12) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 542, ASSERT_TYPE_ASSERT, "(retVal)", (const char *)&queryFormat, "retVal") )
    __debugbreak();
  DB_BackendCallbacks_MarkZoneCallbackProcessed(*(XZoneHandleUnique *)(m_data + 4));
  DB_BackendCallbackDataRingBuffer_PopFront();
  return 1;
}

/*
==============
RB_ProcessBackendDBCallbacks
==============
*/
void RB_ProcessBackendDBCallbacks(ComputeCmdBufState *computeState)
{
  const char *v2; 
  __int64 v3; 
  unsigned __int8 *m_data; 
  __int64 (__fastcall *v5)(unsigned __int8 *, ComputeCmdBufState **, const char *); 
  volatile signed __int32 *v6; 
  char v7; 
  signed __int32 v8[8]; 
  ComputeCmdBufState *v9; 
  __int64 v10; 
  int v11; 
  int v12; 
  __int64 v13[2]; 
  int v14; 
  int v15; 

  if ( !Sys_IsBackendOwnerThread() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 558, ASSERT_TYPE_ASSERT, "(Sys_IsBackendOwnerThread())", (const char *)&queryFormat, "Sys_IsBackendOwnerThread()") )
    __debugbreak();
  while ( 1 )
  {
    v2 = "trampolineFunc";
    if ( g_dbBackendCallbackDataRingBuffer.m_allocsWritePtr == g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr )
      break;
    v3 = g_dbBackendCallbackDataRingBuffer.m_allocsMask & g_dbBackendCallbackDataRingBuffer.m_allocsReadPtr;
    _InterlockedOr(v8, 0);
    m_data = g_dbBackendCallbackDataRingBuffer.m_allocs[v3].m_data;
    v5 = (__int64 (__fastcall *)(unsigned __int8 *, ComputeCmdBufState **, const char *))*((_QWORD *)m_data + 2);
    if ( !v5 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 493, ASSERT_TYPE_ASSERT, "(trampolineFunc)", (const char *)&queryFormat, "trampolineFunc") )
      __debugbreak();
    v6 = (volatile signed __int32 *)(m_data + 8);
    if ( *((_DWORD *)m_data + 2) == 1 )
      goto LABEL_13;
    if ( ((unsigned __int8)v6 & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 121, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", m_data + 8) )
      __debugbreak();
    if ( !_InterlockedCompareExchange(v6, 1, 0) )
    {
LABEL_13:
      v11 = *((_DWORD *)m_data + 1);
      v10 = *((_QWORD *)m_data + 3);
      v9 = computeState;
      v12 = 0;
      v7 = v5(m_data + 32, &v9, v2);
      *((_QWORD *)m_data + 3) = v10;
      if ( v7 )
      {
        if ( ((unsigned __int8)v6 & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 121, ASSERT_TYPE_ASSERT, "( ( IsAligned( target, sizeof( volatile_int32 ) ) ) )", "( target ) = %p", m_data + 8) )
          __debugbreak();
        if ( _InterlockedCompareExchange(v6, 2, 1) != 1 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 525, ASSERT_TYPE_ASSERT, "(oldState == DB_BackendCallbackBaseData::CALLBACK_STATE_PROCESSING)", (const char *)&queryFormat, "oldState == DB_BackendCallbackBaseData::CALLBACK_STATE_PROCESSING") )
          __debugbreak();
      }
    }
    if ( *v6 != 2 )
      break;
    v14 = *((_DWORD *)m_data + 1);
    v13[1] = *((_QWORD *)m_data + 3);
    v13[0] = (__int64)computeState;
    v15 = 1;
    if ( !(unsigned __int8)v5(m_data + 32, (ComputeCmdBufState **)v13, v2) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\database\\db_backend_callback.cpp", 542, ASSERT_TYPE_ASSERT, "(retVal)", (const char *)&queryFormat, "retVal") )
      __debugbreak();
    DB_BackendCallbacks_MarkZoneCallbackProcessed(*(XZoneHandleUnique *)(m_data + 4));
    DB_BackendCallbackDataRingBuffer_PopFront();
  }
}

