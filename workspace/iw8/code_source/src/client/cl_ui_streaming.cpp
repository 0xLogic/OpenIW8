/*
==============
CL_UIStreaming_RequestWeaponWorldModels
==============
*/

void __fastcall CL_UIStreaming_RequestWeaponWorldModels(const char **weaponNames, const unsigned int weaponNameCount)
{
  ?CL_UIStreaming_RequestWeaponWorldModels@@YAXQEAPEBDI@Z(weaponNames, weaponNameCount);
}

/*
==============
CL_UIStreaming_AreHeadModelsLoaded
==============
*/

bool __fastcall CL_UIStreaming_AreHeadModelsLoaded(const char **headNames, const unsigned int headNameCount)
{
  return ?CL_UIStreaming_AreHeadModelsLoaded@@YA_NQEAPEBDI@Z(headNames, headNameCount);
}

/*
==============
CL_UIStreaming_AreWeaponWorldModelsLoaded
==============
*/

bool __fastcall CL_UIStreaming_AreWeaponWorldModelsLoaded(const char **weaponNames, const unsigned int weaponNameCount)
{
  return ?CL_UIStreaming_AreWeaponWorldModelsLoaded@@YA_NQEAPEBDI@Z(weaponNames, weaponNameCount);
}

/*
==============
CL_UIStreaming_TouchedAssetsMissing
==============
*/

int __fastcall CL_UIStreaming_TouchedAssetsMissing()
{
  return ?CL_UIStreaming_TouchedAssetsMissing@@YAHXZ();
}

/*
==============
CL_UIStreaming_TouchCachedImages
==============
*/

void CL_UIStreaming_TouchCachedImages(void)
{
  ?CL_UIStreaming_TouchCachedImages@@YAXXZ();
}

/*
==============
CL_UIStreaming_UpdateImages
==============
*/

bool __fastcall CL_UIStreaming_UpdateImages()
{
  return ?CL_UIStreaming_UpdateImages@@YA_NXZ();
}

/*
==============
CL_UIStreaming_RequestWeaponViewModels
==============
*/

void __fastcall CL_UIStreaming_RequestWeaponViewModels(const LocalClientNum_t localClientNum, const char **weaponNames, const unsigned int weaponNameCount)
{
  ?CL_UIStreaming_RequestWeaponViewModels@@YAXW4LocalClientNum_t@@QEAPEBDI@Z(localClientNum, weaponNames, weaponNameCount);
}

/*
==============
CL_UIStreaming_StartImageStreaming
==============
*/

void CL_UIStreaming_StartImageStreaming(void)
{
  ?CL_UIStreaming_StartImageStreaming@@YAXXZ();
}

/*
==============
CL_UIStreaming_TouchImage
==============
*/

void __fastcall CL_UIStreaming_TouchImage(const GfxImage *const image)
{
  ?CL_UIStreaming_TouchImage@@YAXQEBUGfxImage@@@Z(image);
}

/*
==============
CL_UIStreaming_RequestHeadModels
==============
*/

void __fastcall CL_UIStreaming_RequestHeadModels(const char **headNames, const unsigned int headNameCount)
{
  ?CL_UIStreaming_RequestHeadModels@@YAXQEAPEBDI@Z(headNames, headNameCount);
}

/*
==============
CL_UIStreaming_RemoveImage
==============
*/

bool __fastcall CL_UIStreaming_RemoveImage(const GfxImage *const image)
{
  return ?CL_UIStreaming_RemoveImage@@YA_NQEBUGfxImage@@@Z(image);
}

/*
==============
CL_UIStreaming_NeedsDatabaseAccess
==============
*/

bool __fastcall CL_UIStreaming_NeedsDatabaseAccess()
{
  return ?CL_UIStreaming_NeedsDatabaseAccess@@YA_NXZ();
}

/*
==============
CL_UIStreaming_StreamedEnough
==============
*/

bool __fastcall CL_UIStreaming_StreamedEnough()
{
  return ?CL_UIStreaming_StreamedEnough@@YA_NXZ();
}

/*
==============
CL_UIStreaming_IsRunningTransients
==============
*/

bool __fastcall CL_UIStreaming_IsRunningTransients()
{
  return ?CL_UIStreaming_IsRunningTransients@@YA_NXZ();
}

/*
==============
CL_UIStreaming_IsRunningImages
==============
*/

bool __fastcall CL_UIStreaming_IsRunningImages()
{
  return ?CL_UIStreaming_IsRunningImages@@YA_NXZ();
}

/*
==============
CL_UIStreaming_StartStreamingTransients
==============
*/

void CL_UIStreaming_StartStreamingTransients(void)
{
  ?CL_UIStreaming_StartStreamingTransients@@YAXXZ();
}

/*
==============
CL_UIStreaming_TouchMaterial
==============
*/

void __fastcall CL_UIStreaming_TouchMaterial(const Material *const material)
{
  ?CL_UIStreaming_TouchMaterial@@YAXQEBUMaterial@@@Z(material);
}

/*
==============
CL_UIStreaming_AreBodyModelsLoaded
==============
*/

bool __fastcall CL_UIStreaming_AreBodyModelsLoaded(const char **bodyNames, const unsigned int bodyNameCount)
{
  return ?CL_UIStreaming_AreBodyModelsLoaded@@YA_NQEAPEBDI@Z(bodyNames, bodyNameCount);
}

/*
==============
CL_UIStreaming_RegisterCommands
==============
*/

void CL_UIStreaming_RegisterCommands(void)
{
  ?CL_UIStreaming_RegisterCommands@@YAXXZ();
}

/*
==============
CL_UIStreaming_RequestBodyModels
==============
*/

void __fastcall CL_UIStreaming_RequestBodyModels(const char **bodyNames, const unsigned int bodyNameCount)
{
  ?CL_UIStreaming_RequestBodyModels@@YAXQEAPEBDI@Z(bodyNames, bodyNameCount);
}

/*
==============
CL_UIStreaming_AreWeaponViewModelsLoaded
==============
*/

bool __fastcall CL_UIStreaming_AreWeaponViewModelsLoaded(const LocalClientNum_t localClientNum, const char **weaponNames, const unsigned int weaponNameCount)
{
  return ?CL_UIStreaming_AreWeaponViewModelsLoaded@@YA_NW4LocalClientNum_t@@QEAPEBDI@Z(localClientNum, weaponNames, weaponNameCount);
}

/*
==============
CL_UIStreaming_ImageHash
==============
*/

unsigned int __fastcall CL_UIStreaming_ImageHash(const unsigned int imageIndex)
{
  return ?CL_UIStreaming_ImageHash@@YAII@Z(imageIndex);
}

/*
==============
CL_UIStreaming_GetActiveClients
==============
*/

unsigned int __fastcall CL_UIStreaming_GetActiveClients()
{
  return ?CL_UIStreaming_GetActiveClients@@YAIXZ();
}

/*
==============
CL_UIStreaming_RequestHandViewModels
==============
*/

void __fastcall CL_UIStreaming_RequestHandViewModels(const LocalClientNum_t localClientNum, const char **handModelNames, const unsigned int handModelNameCount)
{
  ?CL_UIStreaming_RequestHandViewModels@@YAXW4LocalClientNum_t@@QEAPEBDI@Z(localClientNum, handModelNames, handModelNameCount);
}

/*
==============
CL_UIStreaming_TouchImageIndex
==============
*/

void __fastcall CL_UIStreaming_TouchImageIndex(const unsigned int imageIndex)
{
  ?CL_UIStreaming_TouchImageIndex@@YAXI@Z(imageIndex);
}

/*
==============
CL_UIStreaming_GetMaxRequestCount
==============
*/

unsigned int __fastcall CL_UIStreaming_GetMaxRequestCount(const StreamSyncClientType requestType, const unsigned int activeClientCount)
{
  return ?CL_UIStreaming_GetMaxRequestCount@@YAIW4StreamSyncClientType@@I@Z(requestType, activeClientCount);
}

/*
==============
CL_UIStreaming_RequestClientModelModels
==============
*/

void __fastcall CL_UIStreaming_RequestClientModelModels(const LocalClientNum_t localClientNum, const char **clientModelModelNames, const unsigned int clientModelModelNameCount)
{
  ?CL_UIStreaming_RequestClientModelModels@@YAXW4LocalClientNum_t@@QEAPEBDI@Z(localClientNum, clientModelModelNames, clientModelModelNameCount);
}

/*
==============
CL_UIStreaming_AreHandViewModelsLoaded
==============
*/

bool __fastcall CL_UIStreaming_AreHandViewModelsLoaded(const LocalClientNum_t localClientNum, const char **handModelNames, const unsigned int handModelNameCount)
{
  return ?CL_UIStreaming_AreHandViewModelsLoaded@@YA_NW4LocalClientNum_t@@QEAPEBDI@Z(localClientNum, handModelNames, handModelNameCount);
}

/*
==============
CL_UIStreaming_StopImageStreaming
==============
*/

void CL_UIStreaming_StopImageStreaming(void)
{
  ?CL_UIStreaming_StopImageStreaming@@YAXXZ();
}

/*
==============
CL_UIStreaming_Shutdown
==============
*/

void __fastcall CL_UIStreaming_Shutdown(const LocalClientNum_t __formal)
{
  ?CL_UIStreaming_Shutdown@@YAXW4LocalClientNum_t@@@Z(__formal);
}

/*
==============
CL_UIStreaming_Update
==============
*/

void CL_UIStreaming_Update(void)
{
  ?CL_UIStreaming_Update@@YAXXZ();
}

/*
==============
CL_UIStreaming_StopStreamingTransients
==============
*/

void CL_UIStreaming_StopStreamingTransients(void)
{
  ?CL_UIStreaming_StopStreamingTransients@@YAXXZ();
}

/*
==============
CL_UIStreaming_EnableScriptRequests
==============
*/

void __fastcall CL_UIStreaming_EnableScriptRequests(const bool enabled)
{
  ?CL_UIStreaming_EnableScriptRequests@@YAX_N@Z(enabled);
}

/*
==============
CL_UIStreaming_AreClientModelModelsLoaded
==============
*/

bool __fastcall CL_UIStreaming_AreClientModelModelsLoaded(const LocalClientNum_t localClientNum, const char **clientModelModelNames, const unsigned int clientModelModelNameCount)
{
  return ?CL_UIStreaming_AreClientModelModelsLoaded@@YA_NW4LocalClientNum_t@@QEAPEBDI@Z(localClientNum, clientModelModelNames, clientModelModelNameCount);
}

/*
==============
CL_UIStreaming_TouchFrontendDObj
==============
*/

bool __fastcall CL_UIStreaming_TouchFrontendDObj(const DObj *const obj)
{
  return ?CL_UIStreaming_TouchFrontendDObj@@YA_NQEBUDObj@@@Z(obj);
}

/*
==============
CL_UIStreaming_ScriptRequestsEnabled
==============
*/

bool __fastcall CL_UIStreaming_ScriptRequestsEnabled()
{
  return ?CL_UIStreaming_ScriptRequestsEnabled@@YA_NXZ();
}

/*
==============
CL_UIStreaming_AddImage
==============
*/

bool __fastcall CL_UIStreaming_AddImage(const GfxImage *const image)
{
  return ?CL_UIStreaming_AddImage@@YA_NQEBUGfxImage@@@Z(image);
}

/*
==============
CL_UIStreaming_IsStartingMatch
==============
*/

bool __fastcall CL_UIStreaming_IsStartingMatch()
{
  return ?CL_UIStreaming_IsStartingMatch@@YA_NXZ();
}

/*
==============
CL_UIStreaming_Init
==============
*/

void __fastcall CL_UIStreaming_Init(const LocalClientNum_t __formal)
{
  ?CL_UIStreaming_Init@@YAXW4LocalClientNum_t@@@Z(__formal);
}

/*
==============
CL_UIStreaming_CmdRequestWeaponViewModel
==============
*/
void CL_UIStreaming_CmdRequestWeaponViewModel()
{
  LocalClientNum_t v0; 
  char *weaponNames; 

  if ( s_uiStreamingTransientsActive )
  {
    if ( Cmd_Argc() == 2 )
    {
      weaponNames = (char *)Cmd_Argv(1);
      Com_Printf(14, "cl_uistreaming_requestweaponviewmodel: %s\n", weaponNames);
      v0 = Cmd_LocalClientNum();
      CL_UIStreaming_RequestWeaponViewModels(v0, (const char **)&weaponNames, 1u);
    }
    else
    {
      Com_PrintError(14, "ERROR: cl_uistreaming_requestweaponviewmodel, should be called with 2 arguments.\n");
    }
  }
  else
  {
    Com_PrintError(14, "ERROR: cl_uistreaming_requestweaponviewmodel, ui streaming not enabled.\n");
  }
}

/*
==============
CL_UIStreaming_AddClientStreamingRequests
==============
*/
void CL_UIStreaming_AddClientStreamingRequests(const LocalClientNum_t localClientNum, StreamSyncClientType requestType)
{
  LocalClientNum_t v3; 
  UIStreamRequestQueue *ClientRequestQueue; 
  unsigned int maxRequestCount; 
  __int64 v6; 
  unsigned int requestCount; 
  __int64 v8; 
  ClStreamingRequest **v9; 
  UIStreamRequestItem *v10; 
  ClStreamingRequest *p_request; 
  int ActiveController; 
  const char *MapName; 
  bool v14; 
  int v15; 
  const char *ModelName; 
  AssetStreamingPriority v17; 
  __int64 v18; 
  unsigned int v19; 
  PartyData *PartyData; 
  bool v21; 
  __int64 v22; 
  __int64 v23; 
  ClientCustomizationInfo outInfo; 
  ClStreamingRequest *requests[64]; 
  ClStreamingRequest outRequest; 
  ClStreamingRequest requestPool; 

  v3 = localClientNum;
  if ( (unsigned int)requestType >= STREAM_SYNC_CLIENT_TYPE_COUNT && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 866, ASSERT_TYPE_ASSERT, "(unsigned)( requestType ) < (unsigned)( STREAM_SYNC_CLIENT_TYPE_COUNT )", "requestType doesn't index STREAM_SYNC_CLIENT_TYPE_COUNT\n\t%i not in [0, %i)", requestType, 6) )
    __debugbreak();
  ClientRequestQueue = CL_UIStreaming_GetClientRequestQueue(v3, requestType);
  if ( !ClientRequestQueue && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 869, ASSERT_TYPE_ASSERT, "(requestQueue)", (const char *)&queryFormat, "requestQueue") )
    __debugbreak();
  if ( ClientRequestQueue->requestCount > ClientRequestQueue->maxRequestCount )
  {
    LODWORD(v23) = ClientRequestQueue->maxRequestCount;
    LODWORD(v22) = ClientRequestQueue->requestCount;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 870, ASSERT_TYPE_ASSERT, "( requestQueue->requestCount ) <= ( requestQueue->maxRequestCount )", "requestQueue->requestCount not in [0, requestQueue->maxRequestCount]\n\t%u not in [0, %u]", v22, v23) )
      __debugbreak();
  }
  maxRequestCount = ClientRequestQueue->maxRequestCount;
  v6 = 0i64;
  requestCount = 0;
  if ( ClientRequestQueue->maxRequestCount > 0x40 )
  {
    LODWORD(v23) = 64;
    LODWORD(v22) = ClientRequestQueue->maxRequestCount;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 874, ASSERT_TYPE_ASSERT, "( maxRequestCount ) <= ( ( sizeof( *array_counter( requests ) ) + 0 ) )", "maxRequestCount not in [0, ARRAY_COUNT( requests )]\n\t%u not in [0, %u]", v22, v23) )
      __debugbreak();
  }
  if ( s_uiStreamingFromScript )
  {
    requestCount = ClientRequestQueue->requestCount;
    if ( requestCount )
    {
      v8 = requestCount;
      v9 = requests;
      do
      {
        v10 = &ClientRequestQueue->requestItem[v6];
        p_request = &v10->request;
        CL_UIStreaming_GetStreamRequest(&v10->request, v10->requestName, v10->priority, requestType);
        ++v6;
        *v9++ = p_request;
        --v8;
      }
      while ( v8 );
      v3 = localClientNum;
    }
  }
  if ( requestType == STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL )
  {
    if ( Com_GameMode_SupportsFeature(WEAPON_DROPPING_LADDER_SLIDE) && v3 < CL_UIStreaming_GetActiveClients() )
    {
      ActiveController = CL_UIStreaming_GetActiveController(v3);
      if ( LiveStorage_DoWeHaveStats(ActiveController) && CL_UIStreaming_ShouldLoadGameAssets() )
      {
        MapName = Party_GetMapName();
        if ( Com_FastFile_IsLevelPreloadComplete(MapName) )
        {
          v14 = requestCount < maxRequestCount;
          if ( requestCount > maxRequestCount )
          {
            LODWORD(v23) = maxRequestCount;
            LODWORD(v22) = requestCount;
            if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 734, ASSERT_TYPE_ASSERT, "( requestIndex ) <= ( maxRequestCount )", "requestIndex not in [0, maxRequestCount]\n\t%u not in [0, %u]", v22, v23) )
              __debugbreak();
            v14 = requestCount < maxRequestCount;
          }
          if ( v14 )
          {
            v15 = CL_UIStreaming_GetActiveController(v3);
            CL_PlayerData_GetCustomization(v15, &outInfo);
            ModelName = BG_Customization_GetModelName(CUSTOMIZATION_TYPE_VIEWHANDS, outInfo.modelIndex[2]);
            v17.raw = Com_Streaming_GetPriority(ASSET_STREAMING_REQUEST_NONE, 0, ASSET_STREAMING_REQUEST_FLAGS_UI).raw;
            CL_Streaming_GetSingleModelRequest(ModelName, v17, &outRequest);
            v18 = requestCount++;
            requests[v18] = &outRequest;
          }
        }
      }
    }
  }
  else if ( requestType == STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS )
  {
    v19 = 1;
    if ( Lobby_IsInRunningLobby() )
    {
      PartyData = Lobby_GetPartyData();
      v21 = PartyData == NULL;
    }
    else
    {
      PartyData = &g_partyData;
      v21 = Party_InParty(&g_partyData) == 0;
    }
    if ( !v21 && PartyData->splitscreenData.otherClientActive )
      v19 = 2;
    if ( v3 < v19 )
    {
      if ( requestCount > maxRequestCount )
      {
        LODWORD(v23) = maxRequestCount;
        LODWORD(v22) = requestCount;
        if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 760, ASSERT_TYPE_ASSERT, "( requestIndex ) <= ( maxRequestCount )", "requestIndex not in [0, maxRequestCount]\n\t%u not in [0, %u]", v22, v23) )
          __debugbreak();
      }
      if ( (unsigned int)v3 >= LOCAL_CLIENT_COUNT )
      {
        LODWORD(v23) = 2;
        LODWORD(v22) = v3;
        if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_active_client.h", 174, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", v22, v23) )
          __debugbreak();
      }
      if ( clientUIActives[v3].connectionState == CA_ACTIVE )
        requestCount = CG_ClientModel_SetupStreamingRequest(v3, (const ClStreamingRequest **)requests, maxRequestCount, &requestPool, requestCount);
    }
  }
  if ( requestCount > 0x40 )
  {
    LODWORD(v23) = 64;
    LODWORD(v22) = requestCount;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 903, ASSERT_TYPE_ASSERT, "( requestCount ) <= ( ( sizeof( *array_counter( requests ) ) + 0 ) )", "requestCount not in [0, ARRAY_COUNT( requests )]\n\t%u not in [0, %u]", v22, v23) )
      __debugbreak();
  }
  if ( requestCount )
    CL_Streaming_AddClientRequestedAssets(v3, (const ClStreamingRequest **)requests, requestCount, requestType, CL_STREAMING_BUFFER_INPUT_1);
}

/*
==============
CL_UIStreaming_AddImage
==============
*/
bool CL_UIStreaming_AddImage(const GfxImage *const image)
{
  unsigned int GfxImageIndex; 

  if ( !image && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1436, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
    __debugbreak();
  GfxImageIndex = DB_GetGfxImageIndex(image);
  return CL_UIStreaming_AddImageIndex(GfxImageIndex);
}

/*
==============
CL_UIStreaming_AddImageIndex
==============
*/
char CL_UIStreaming_AddImageIndex(const unsigned int imageIndex)
{
  const dvar_t *v2; 
  GfxImage *GfxImageAtIndex; 
  const dvar_t *v5; 
  unsigned int v6; 
  GfxImage *v7; 
  __int64 v8; 
  unsigned int v9; 
  unsigned int v10; 
  GfxImage *v11; 
  const char *name; 
  char v13; 
  char *fmt; 
  __int64 v15; 
  __int64 v16; 
  __int64 v17; 
  __int64 v18; 

  v2 = DCONST_DVARBOOL_cl_uistreaming_images;
  if ( !DCONST_DVARBOOL_cl_uistreaming_images && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_images") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v2);
  if ( !v2->current.enabled )
    return 0;
  if ( !s_uiStreamingInitialized )
  {
    GfxImageAtIndex = DB_GetGfxImageAtIndex(imageIndex);
    if ( !GfxImageAtIndex && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1461, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
      __debugbreak();
    Com_PrintWarning(14, "CL_UIStreaming_AddImageIndex called before the module was initialized! Ignoring request to add %u '%s'!\n", imageIndex, GfxImageAtIndex->name);
    return 0;
  }
  Sys_ProfBeginNamedEvent(0xFF808080, "CL_UIStreaming_AddImageIndex");
  v5 = DCONST_DVARBOOL_cl_uistreaming_verbose;
  if ( !DCONST_DVARBOOL_cl_uistreaming_verbose && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_verbose") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v5);
  v6 = 0;
  if ( v5->current.enabled )
  {
    v7 = DB_GetGfxImageAtIndex(imageIndex);
    if ( !v7 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1473, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
      __debugbreak();
    Com_Printf(14, "CL_UIStreaming_AddImageIndex %u '%s'\n", imageIndex, v7->name);
  }
  if ( imageIndex >= 0x14000 )
  {
    LODWORD(v17) = 81920;
    LODWORD(v15) = imageIndex;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1480, ASSERT_TYPE_ASSERT, "(unsigned)( imageIndex ) < (unsigned)( IMAGE_POOL_SIZE )", "imageIndex doesn't index IMAGE_POOL_SIZE\n\t%i not in [0, %i)", v15, v17) )
      __debugbreak();
  }
  v8 = imageIndex % 0xEF;
  do
  {
    if ( (unsigned int)v8 >= 0xEF )
    {
      LODWORD(v17) = 239;
      LODWORD(v15) = v8;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1486, ASSERT_TYPE_ASSERT, "(unsigned)( probeCacheIndex ) < (unsigned)( ( sizeof( *array_counter( s_uiStreamingImageCache.indices ) ) + 0 ) )", "probeCacheIndex doesn't index ARRAY_COUNT( s_uiStreamingImageCache.indices )\n\t%i not in [0, %i)", v15, v17) )
        __debugbreak();
      LODWORD(v18) = 239;
      LODWORD(v16) = v8;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1487, ASSERT_TYPE_ASSERT, "(unsigned)( probeCacheIndex ) < (unsigned)( ( sizeof( *array_counter( s_uiStreamingImageCache.refCounts ) ) + 0 ) )", "probeCacheIndex doesn't index ARRAY_COUNT( s_uiStreamingImageCache.refCounts )\n\t%i not in [0, %i)", v16, v18) )
        __debugbreak();
    }
    v9 = s_uiStreamingImageCache.indices[v8];
    if ( !v9 )
    {
      s_uiStreamingImageCache.indices[v8] = imageIndex + 1;
      s_uiStreamingImageCache.refCounts[v8] = 1;
LABEL_46:
      v13 = 1;
      goto LABEL_47;
    }
    v10 = v9 - 1;
    if ( v10 >= 0x14000 )
    {
      LODWORD(v17) = 81920;
      LODWORD(v15) = v10;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1501, ASSERT_TYPE_ASSERT, "(unsigned)( probeImageIndex ) < (unsigned)( IMAGE_POOL_SIZE )", "probeImageIndex doesn't index IMAGE_POOL_SIZE\n\t%i not in [0, %i)", v15, v17) )
        __debugbreak();
    }
    if ( v10 == imageIndex )
    {
      if ( !s_uiStreamingImageCache.refCounts[(unsigned int)v8] && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1505, ASSERT_TYPE_ASSERT, "(s_uiStreamingImageCache.refCounts[probeCacheIndex])", (const char *)&queryFormat, "s_uiStreamingImageCache.refCounts[probeCacheIndex]") )
        __debugbreak();
      if ( s_uiStreamingImageCache.refCounts[(unsigned int)v8] == 0xFF && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1506, ASSERT_TYPE_ASSERT, "( s_uiStreamingImageCache.refCounts[probeCacheIndex] ) < ( 0xffui8 )", "%s < %s\n\t%u, %u", "s_uiStreamingImageCache.refCounts[probeCacheIndex]", "UINT8_MAX", 255, 255) )
        __debugbreak();
      ++s_uiStreamingImageCache.refCounts[(unsigned int)v8];
      goto LABEL_46;
    }
    v8 = ((int)v8 + 1) % 0xEFu;
    ++v6;
  }
  while ( v6 < 0xEF );
  v11 = DB_GetGfxImageAtIndex(imageIndex);
  if ( v11 )
    name = v11->name;
  else
    name = "NULL";
  LODWORD(fmt) = 239;
  Com_PrintWarning(14, "CL_UIStreaming_AddImageIndex failed for GfxImage %u '%s'. Consider increasing CL_UI_STREAMING_MAX_STREAMED_IMAGES (%u)\n", imageIndex, name, fmt);
  v13 = 0;
LABEL_47:
  Sys_ProfEndNamedEvent();
  return v13;
}

/*
==============
CL_UIStreaming_AddRequestItem
==============
*/
void CL_UIStreaming_AddRequestItem(UIStreamRequestQueue *const requestQueue, const char *modelName, bool touchImages, unsigned int priority)
{
  __int64 requestCount; 
  UIStreamRequestItem *v9; 

  if ( !requestQueue && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1023, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
    __debugbreak();
  if ( modelName && *modelName )
  {
    requestCount = requestQueue->requestCount;
    if ( (unsigned int)requestCount < requestQueue->maxRequestCount )
    {
      v9 = &requestQueue->requestItem[requestCount];
      Core_strcpy(v9->requestName, 0x200ui64, modelName);
      v9->priority = priority;
      v9->touchImages = touchImages;
      *(_QWORD *)&v9->request.priority.raw = 0i64;
      *(_QWORD *)v9->request.assetIds = 0i64;
      *(_QWORD *)&v9->request.assetIds[2] = 0i64;
      *(_QWORD *)&v9->request.assetIds[4] = 0i64;
      *(_QWORD *)&v9->request.assetIds[6] = 0i64;
      *(_QWORD *)&v9->request.assetIds[8] = 0i64;
      *(_QWORD *)&v9->request.assetIds[10] = 0i64;
      v9->request.assetIds[12] = 0;
      ++requestQueue->requestCount;
    }
  }
}

/*
==============
CL_UIStreaming_AddWorldStreamingRequests
==============
*/
void CL_UIStreaming_AddWorldStreamingRequests(StreamSyncWorldType requestType)
{
  __int64 v1; 
  UIStreamRequestQueue *v2; 
  unsigned int maxRequestCount; 
  __int64 requestCount; 
  __int64 v5; 
  ClStreamingRequest **v6; 
  __int64 v7; 
  UIStreamRequestItem *v8; 
  ClStreamingRequest *p_request; 
  const PartyData *v10; 
  const PartyData *PartyData; 
  unsigned int v12; 
  int v13; 
  const char *MapName; 
  bool IsLevelPreloadComplete; 
  unsigned int PartyStreamingRequests; 
  __int64 v17; 
  ClStreamingRequest *p_outRequests; 
  __int64 v19; 
  __int64 v20; 
  __int64 v21; 
  __int64 v22; 
  __int64 v23; 
  ClStreamingRequest *requests[64]; 
  ClStreamingRequest outRequests; 

  v1 = requestType;
  if ( (unsigned int)requestType >= STREAM_SYNC_WORLD_TYPE_COUNT )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 783, ASSERT_TYPE_ASSERT, "(unsigned)( requestType ) < (unsigned)( STREAM_SYNC_WORLD_TYPE_COUNT )", "requestType doesn't index STREAM_SYNC_WORLD_TYPE_COUNT\n\t%i not in [0, %i)", requestType, 3) )
      __debugbreak();
    LODWORD(v23) = 3;
    LODWORD(v21) = v1;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 270, ASSERT_TYPE_ASSERT, "(unsigned)( requestType ) < (unsigned)( STREAM_SYNC_WORLD_TYPE_COUNT )", "requestType doesn't index STREAM_SYNC_WORLD_TYPE_COUNT\n\t%i not in [0, %i)", v21, v23) )
      __debugbreak();
  }
  v2 = s_uiWorldStreamRequestQueues[v1];
  if ( !v2 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 786, ASSERT_TYPE_ASSERT, "(requestQueue != nullptr)", (const char *)&queryFormat, "requestQueue != nullptr") )
    __debugbreak();
  if ( v2->requestCount > v2->maxRequestCount )
  {
    LODWORD(v22) = v2->maxRequestCount;
    LODWORD(v20) = v2->requestCount;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 787, ASSERT_TYPE_ASSERT, "( requestQueue->requestCount ) <= ( requestQueue->maxRequestCount )", "requestQueue->requestCount not in [0, requestQueue->maxRequestCount]\n\t%u not in [0, %u]", v20, v22) )
      __debugbreak();
  }
  maxRequestCount = v2->maxRequestCount;
  requestCount = 0i64;
  if ( v2->maxRequestCount > 0x40 )
  {
    LODWORD(v22) = 64;
    LODWORD(v20) = v2->maxRequestCount;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 791, ASSERT_TYPE_ASSERT, "( maxRequestCount ) <= ( ( sizeof( *array_counter( requests ) ) + 0 ) )", "maxRequestCount not in [0, ARRAY_COUNT( requests )]\n\t%u not in [0, %u]", v20, v22) )
      __debugbreak();
  }
  if ( s_uiStreamingFromScript )
  {
    requestCount = v2->requestCount;
    if ( (_DWORD)requestCount )
    {
      v5 = 0i64;
      v6 = requests;
      v7 = (unsigned int)requestCount;
      do
      {
        v8 = &v2->requestItem[v5];
        p_request = &v8->request;
        CL_UIStreaming_GetStreamRequest(&v8->request, v8->requestName, v8->priority, (const StreamSyncClientType)v1);
        ++v5;
        *v6++ = p_request;
        --v7;
      }
      while ( v7 );
    }
  }
  if ( (unsigned int)v1 <= 1 && Com_GameMode_SupportsFeature(WEAPON_DROPPING_LADDER_SLIDE) )
  {
    v10 = &g_partyData;
    if ( Lobby_IsInRunningLobby() )
    {
      PartyData = Lobby_GetPartyData();
      if ( !PartyData )
        goto LABEL_46;
    }
    else
    {
      if ( !Party_InParty(&g_partyData) )
        goto LABEL_46;
      PartyData = &g_partyData;
    }
    if ( !s_uiStreamingFromScript || PartyUI_IsStartingMatch(PartyData) )
    {
      if ( (unsigned int)v1 > 1 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 812, ASSERT_TYPE_ASSERT, "(requestType == STREAM_SYNC_WORLD_TYPE_BODY || requestType == STREAM_SYNC_WORLD_TYPE_HEAD)", (const char *)&queryFormat, "requestType == STREAM_SYNC_WORLD_TYPE_BODY || requestType == STREAM_SYNC_WORLD_TYPE_HEAD") )
        __debugbreak();
      v12 = 200;
      v13 = maxRequestCount - requestCount;
      if ( v13 < 200 )
        v12 = v13;
      MapName = Party_GetMapName();
      IsLevelPreloadComplete = Com_FastFile_IsLevelPreloadComplete(MapName);
      if ( Lobby_IsInRunningLobby() )
      {
        v10 = Lobby_GetPartyData();
        if ( !v10 )
        {
LABEL_38:
          if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 821, ASSERT_TYPE_ASSERT, "(party != nullptr)", (const char *)&queryFormat, "party != nullptr") )
            __debugbreak();
        }
      }
      else if ( !Party_InParty(&g_partyData) )
      {
        v10 = NULL;
        goto LABEL_38;
      }
      PartyStreamingRequests = CL_UIStreaming_GetPartyStreamingRequests(v10, IsLevelPreloadComplete, (CustomizationModelType)((_DWORD)v1 == 1), &outRequests, v12);
      v17 = PartyStreamingRequests;
      if ( PartyStreamingRequests > v12 )
      {
        LODWORD(v22) = v12;
        LODWORD(v20) = PartyStreamingRequests;
        if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 824, ASSERT_TYPE_ASSERT, "( partyRequestCount ) <= ( maxPartyRequestCount )", "partyRequestCount not in [0, maxPartyRequestCount]\n\t%u not in [0, %u]", v20, v22) )
          __debugbreak();
      }
      if ( (_DWORD)v17 )
      {
        p_outRequests = &outRequests;
        v19 = v17;
        do
        {
          requests[requestCount] = p_outRequests;
          requestCount = (unsigned int)(requestCount + 1);
          ++p_outRequests;
          --v19;
        }
        while ( v19 );
      }
    }
  }
LABEL_46:
  if ( (unsigned int)requestCount > 0x40 )
  {
    LODWORD(v22) = 64;
    LODWORD(v20) = requestCount;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 834, ASSERT_TYPE_ASSERT, "( requestCount ) <= ( ( sizeof( *array_counter( requests ) ) + 0 ) )", "requestCount not in [0, ARRAY_COUNT( requests )]\n\t%u not in [0, %u]", v20, v22) )
      __debugbreak();
  }
  if ( (_DWORD)requestCount )
    CL_Streaming_AddWorldRequestedAssets((const ClStreamingRequest **)requests, requestCount, (const StreamSyncWorldType)v1, CL_STREAMING_BUFFER_INPUT_1);
}

/*
==============
CL_UIStreaming_AreBodyModelsLoaded
==============
*/
char CL_UIStreaming_AreBodyModelsLoaded(const char **bodyNames, const unsigned int bodyNameCount)
{
  unsigned int v4; 
  AssetStreamingPriority v5; 
  char dest[520]; 
  ClStreamingRequest outRequest; 

  if ( s_uiStreamingTransientsActive )
  {
    v4 = 0;
    if ( !bodyNameCount )
      return 1;
    while ( 1 )
    {
      if ( !*bodyNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1948, ASSERT_TYPE_ASSERT, "(bodyNames[bodyNameIndex])", (const char *)&queryFormat, "bodyNames[bodyNameIndex]") )
        __debugbreak();
      Core_strcpy(dest, 0x200ui64, *bodyNames);
      v5.raw = Com_Streaming_GetPriority(ASSET_STREAMING_REQUEST_NONE, 0, ASSET_STREAMING_REQUEST_FLAGS_UI).raw;
      CL_Streaming_GetSingleModelRequest(dest, v5, &outRequest);
      if ( !CL_Streaming_IsWorldRequestLoaded(&outRequest, STREAM_SYNC_WORLD_TYPE_BODY) )
        break;
      ++v4;
      ++bodyNames;
      if ( v4 >= bodyNameCount )
        return 1;
    }
  }
  return 0;
}

/*
==============
CL_UIStreaming_AreClientModelModelsLoaded
==============
*/
char CL_UIStreaming_AreClientModelModelsLoaded(const LocalClientNum_t localClientNum, const char **clientModelModelNames, const unsigned int clientModelModelNameCount)
{
  unsigned int v6; 
  AssetStreamingPriority v7; 
  char dest[520]; 
  ClStreamingRequest outRequest; 

  if ( s_uiStreamingTransientsActive )
  {
    v6 = 0;
    if ( !clientModelModelNameCount )
      return 1;
    while ( 1 )
    {
      if ( !*clientModelModelNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2111, ASSERT_TYPE_ASSERT, "(clientModelModelNames[clientModelNameIndex])", (const char *)&queryFormat, "clientModelModelNames[clientModelNameIndex]") )
        __debugbreak();
      Core_strcpy(dest, 0x200ui64, *clientModelModelNames);
      v7.raw = Com_Streaming_GetPriority(ASSET_STREAMING_REQUEST_NONE, 0, ASSET_STREAMING_REQUEST_FLAGS_UI).raw;
      CL_Streaming_GetSingleModelRequest(dest, v7, &outRequest);
      if ( !CL_Streaming_IsClientRequestLoaded(localClientNum, &outRequest, STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS) )
        break;
      ++v6;
      ++clientModelModelNames;
      if ( v6 >= clientModelModelNameCount )
        return 1;
    }
  }
  return 0;
}

/*
==============
CL_UIStreaming_AreHandViewModelsLoaded
==============
*/
char CL_UIStreaming_AreHandViewModelsLoaded(const LocalClientNum_t localClientNum, const char **handModelNames, const unsigned int handModelNameCount)
{
  unsigned int v6; 
  AssetStreamingPriority v7; 
  char dest[520]; 
  ClStreamingRequest outRequest; 

  if ( s_uiStreamingTransientsActive )
  {
    v6 = 0;
    if ( !handModelNameCount )
      return 1;
    while ( 1 )
    {
      if ( !*handModelNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2057, ASSERT_TYPE_ASSERT, "(handModelNames[viewHandNameIndex])", (const char *)&queryFormat, "handModelNames[viewHandNameIndex]") )
        __debugbreak();
      Core_strcpy(dest, 0x200ui64, *handModelNames);
      v7.raw = Com_Streaming_GetPriority(ASSET_STREAMING_REQUEST_NONE, 0, ASSET_STREAMING_REQUEST_FLAGS_UI).raw;
      CL_Streaming_GetSingleModelRequest(dest, v7, &outRequest);
      if ( !CL_Streaming_IsClientRequestLoaded(localClientNum, &outRequest, STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL) )
        break;
      ++v6;
      ++handModelNames;
      if ( v6 >= handModelNameCount )
        return 1;
    }
  }
  return 0;
}

/*
==============
CL_UIStreaming_AreHeadModelsLoaded
==============
*/
char CL_UIStreaming_AreHeadModelsLoaded(const char **headNames, const unsigned int headNameCount)
{
  unsigned int v4; 
  AssetStreamingPriority v5; 
  char dest[520]; 
  ClStreamingRequest outRequest; 

  if ( s_uiStreamingTransientsActive )
  {
    v4 = 0;
    if ( !headNameCount )
      return 1;
    while ( 1 )
    {
      if ( !*headNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1894, ASSERT_TYPE_ASSERT, "(headNames[headNameIndex])", (const char *)&queryFormat, "headNames[headNameIndex]") )
        __debugbreak();
      Core_strcpy(dest, 0x200ui64, *headNames);
      v5.raw = Com_Streaming_GetPriority(ASSET_STREAMING_REQUEST_NONE, 0, ASSET_STREAMING_REQUEST_FLAGS_UI).raw;
      CL_Streaming_GetSingleModelRequest(dest, v5, &outRequest);
      if ( !CL_Streaming_IsWorldRequestLoaded(&outRequest, STREAM_SYNC_WORLD_TYPE_HEAD) )
        break;
      ++v4;
      ++headNames;
      if ( v4 >= headNameCount )
        return 1;
    }
  }
  return 0;
}

/*
==============
CL_UIStreaming_AreWeaponViewModelsLoaded
==============
*/
char CL_UIStreaming_AreWeaponViewModelsLoaded(const LocalClientNum_t localClientNum, const char **weaponNames, const unsigned int weaponNameCount)
{
  unsigned int v6; 
  AssetStreamingPriority v7; 
  int v12; 
  Weapon result; 
  Weapon weapon; 
  char dest[520]; 
  ClStreamingRequest outRequest; 

  if ( s_uiStreamingTransientsActive )
  {
    v6 = 0;
    if ( !weaponNameCount )
      return 1;
    while ( 1 )
    {
      if ( !*weaponNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2003, ASSERT_TYPE_ASSERT, "(weaponNames[weaponNameIndex])", (const char *)&queryFormat, "weaponNames[weaponNameIndex]") )
        __debugbreak();
      Core_strcpy(dest, 0x200ui64, *weaponNames);
      v7.raw = Com_Streaming_GetPriority(ASSET_STREAMING_REQUEST_NONE, 0, ASSET_STREAMING_REQUEST_FLAGS_UI).raw;
      if ( !CL_AnyLocalClientStateActive() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 323, ASSERT_TYPE_ASSERT, "(CL_AnyLocalClientStateActive())", "%s\n\tRegistering a weapon before the game is initialized.", "CL_AnyLocalClientStateActive()") )
        __debugbreak();
      if ( CL_AnyLocalClientStateActive() )
      {
        _RAX = CG_Weapons_GetWeaponForName(&result, dest);
        __asm
        {
          vmovups ymm0, ymmword ptr [rax]
          vmovups xmm1, xmmword ptr [rax+20h]
          vmovsd  xmm2, qword ptr [rax+30h]
        }
        v12 = *(_DWORD *)&_RAX->weaponCamo;
      }
      else
      {
        __asm
        {
          vmovups ymm0, ymmword ptr cs:?NULL_WEAPON@@3UWeapon@@B.weaponIdx; Weapon const NULL_WEAPON
          vmovups xmm1, xmmword ptr cs:?NULL_WEAPON@@3UWeapon@@B.attachmentVariationIndices+5; Weapon const NULL_WEAPON
          vmovsd  xmm2, qword ptr cs:?NULL_WEAPON@@3UWeapon@@B.attachmentVariationIndices+15h; Weapon const NULL_WEAPON
        }
        v12 = *(_DWORD *)&NULL_WEAPON.weaponCamo;
      }
      *(_DWORD *)&weapon.weaponCamo = v12;
      __asm
      {
        vmovups ymmword ptr [rsp+348h+weapon.weaponIdx], ymm0
        vmovups xmmword ptr [rsp+348h+weapon.attachmentVariationIndices+5], xmm1
        vmovsd  qword ptr [rsp+348h+weapon.attachmentVariationIndices+15h], xmm2
      }
      CL_Streaming_GetWeaponViewRequest(&weapon, v7, &outRequest);
      if ( !CL_Streaming_IsClientRequestLoaded(localClientNum, &outRequest, STREAM_SYNC_CLIENT_TYPE_VIEW_WEAPON) )
        break;
      ++v6;
      ++weaponNames;
      if ( v6 >= weaponNameCount )
        return 1;
    }
  }
  return 0;
}

/*
==============
CL_UIStreaming_AreWeaponWorldModelsLoaded
==============
*/
char CL_UIStreaming_AreWeaponWorldModelsLoaded(const char **weaponNames, const unsigned int weaponNameCount)
{
  unsigned int v4; 
  AssetStreamingPriority v5; 
  int v10; 
  Weapon result; 
  Weapon weapon; 
  char dest[520]; 
  ClStreamingRequest outRequest; 

  if ( s_uiStreamingTransientsActive )
  {
    v4 = 0;
    if ( !weaponNameCount )
      return 1;
    while ( 1 )
    {
      if ( !*weaponNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2165, ASSERT_TYPE_ASSERT, "(weaponNames[weaponNameIndex])", (const char *)&queryFormat, "weaponNames[weaponNameIndex]") )
        __debugbreak();
      Core_strcpy(dest, 0x200ui64, *weaponNames);
      v5.raw = Com_Streaming_GetPriority(ASSET_STREAMING_REQUEST_NONE, 0, ASSET_STREAMING_REQUEST_FLAGS_UI).raw;
      if ( !CL_AnyLocalClientStateActive() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 315, ASSERT_TYPE_ASSERT, "(CL_AnyLocalClientStateActive())", "%s\n\tRegistering a weapon before the game is initialized.", "CL_AnyLocalClientStateActive()") )
        __debugbreak();
      if ( CL_AnyLocalClientStateActive() )
      {
        _RAX = CG_Weapons_GetWeaponForName(&result, dest);
        __asm
        {
          vmovups ymm0, ymmword ptr [rax]
          vmovups xmm1, xmmword ptr [rax+20h]
          vmovsd  xmm2, qword ptr [rax+30h]
        }
        v10 = *(_DWORD *)&_RAX->weaponCamo;
      }
      else
      {
        __asm
        {
          vmovups ymm0, ymmword ptr cs:?NULL_WEAPON@@3UWeapon@@B.weaponIdx; Weapon const NULL_WEAPON
          vmovups xmm1, xmmword ptr cs:?NULL_WEAPON@@3UWeapon@@B.attachmentVariationIndices+5; Weapon const NULL_WEAPON
          vmovsd  xmm2, qword ptr cs:?NULL_WEAPON@@3UWeapon@@B.attachmentVariationIndices+15h; Weapon const NULL_WEAPON
        }
        v10 = *(_DWORD *)&NULL_WEAPON.weaponCamo;
      }
      *(_DWORD *)&weapon.weaponCamo = v10;
      __asm
      {
        vmovups ymmword ptr [rsp+338h+weapon.weaponIdx], ymm0
        vmovups xmmword ptr [rsp+338h+weapon.attachmentVariationIndices+5], xmm1
        vmovsd  qword ptr [rsp+338h+weapon.attachmentVariationIndices+15h], xmm2
      }
      CL_Streaming_GetWeaponWorldRequest(&weapon, v5, &outRequest);
      if ( !CL_Streaming_IsWorldRequestLoaded(&outRequest, STREAM_SYNC_WORLD_TYPE_WEAPON) )
        break;
      ++v4;
      ++weaponNames;
      if ( v4 >= weaponNameCount )
        return 1;
    }
  }
  return 0;
}

/*
==============
CL_UIStreaming_CheckRequestQueueForOverflow
==============
*/
void CL_UIStreaming_CheckRequestQueueForOverflow(const UIStreamRequestQueue *const requestQueue, const unsigned int expectedRequestCount, const StreamSyncClientType streamSyncType)
{
  const dvar_t *v3; 

  if ( requestQueue->requestCount < expectedRequestCount )
  {
    CL_UIStreaming_DebugPrintRequestQueue(requestQueue, streamSyncType);
    v3 = DCONST_DVARBOOL_cl_uistreaming_pedantic;
    if ( !DCONST_DVARBOOL_cl_uistreaming_pedantic && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_pedantic") )
      __debugbreak();
    Dvar_CheckFrontendServerThread(v3);
    if ( v3->current.enabled )
    {
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1057, ASSERT_TYPE_ASSERT, (const char *)&queryFormat.fmt + 3, "Too many UI assets requested. See console output for details.") )
        __debugbreak();
    }
    else
    {
      Com_PrintWarning(14, &byte_144204590);
    }
  }
}

/*
==============
CL_UIStreaming_ClearClientRequests
==============
*/
void CL_UIStreaming_ClearClientRequests(const LocalClientNum_t localClientNum)
{
  StreamSyncClientType i; 
  UIStreamRequestQueue *ClientRequestQueue; 
  UIStreamRequestQueue *v4; 
  UIStreamRequestQueue *v5; 
  UIStreamRequestQueue *v6; 

  for ( i = STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL; (unsigned int)i <= STREAM_SYNC_CLIENT_TYPE_VIEW_WEAPON; ++i )
  {
    ClientRequestQueue = CL_UIStreaming_GetClientRequestQueue(localClientNum, i);
    v4 = ClientRequestQueue;
    if ( ClientRequestQueue && ClientRequestQueue->requestCount )
    {
      DebugWipe(ClientRequestQueue->requestItem, 580i64 * ClientRequestQueue->maxRequestCount);
      v4->requestCount = 0;
    }
  }
  v5 = CL_UIStreaming_GetClientRequestQueue(localClientNum, STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS);
  v6 = v5;
  if ( v5 )
  {
    if ( v5->requestCount )
    {
      DebugWipe(v5->requestItem, 580i64 * v5->maxRequestCount);
      v6->requestCount = 0;
    }
  }
}

/*
==============
CL_UIStreaming_DebugPrintRequestQueue
==============
*/
void CL_UIStreaming_DebugPrintRequestQueue(const UIStreamRequestQueue *const requestQueue, const StreamSyncClientType streamSyncType)
{
  unsigned int v2; 

  v2 = 0;
  if ( !requestQueue && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 256, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
    __debugbreak();
  Com_Printf(14, "(-- CL_UIStreaming [%u] --)\n", (unsigned int)streamSyncType);
  if ( requestQueue->requestCount )
  {
    do
      Com_Printf(14, "\t'%s'\n", requestQueue->requestItem[v2++].requestName);
    while ( v2 < requestQueue->requestCount );
  }
}

/*
==============
CL_UIStreaming_EnableScriptRequests
==============
*/
void CL_UIStreaming_EnableScriptRequests(const bool enabled)
{
  s_uiStreamingFromScript = enabled;
}

/*
==============
CL_UIStreaming_FindPartyMemberCustomization
==============
*/
char CL_UIStreaming_FindPartyMemberCustomization(const PartyData *party, const unsigned int partyMemberIndex, const ClientCustomizationInfo *memberCustomizationInfo, const CustomizationModelType customizationType)
{
  __int64 v4; 
  unsigned int v8; 
  __int64 v9; 
  XUID *i; 
  XUID v11; 
  int bodyModelIndex; 
  int headModelIndex; 
  __int64 v15; 
  __int64 v16; 
  bool selectedOperatorIndex; 
  CustomizationModels customizationEast; 
  CustomizationModels customizationWest; 
  ClientCustomizationInfo outCustomizationInfo; 

  v4 = customizationType;
  if ( !party && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 463, ASSERT_TYPE_ASSERT, "(party)", (const char *)&queryFormat, "party") )
    __debugbreak();
  if ( !party->inParty && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 464, ASSERT_TYPE_ASSERT, "(party->inParty)", (const char *)&queryFormat, "party->inParty") )
    __debugbreak();
  if ( !memberCustomizationInfo && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 465, ASSERT_TYPE_ASSERT, "(memberCustomizationInfo)", (const char *)&queryFormat, "memberCustomizationInfo") )
    __debugbreak();
  if ( partyMemberIndex >= 0xC8 )
  {
    LODWORD(v15) = partyMemberIndex;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 466, ASSERT_TYPE_ASSERT, "(unsigned)( partyMemberIndex ) < (unsigned)( 200 )", "partyMemberIndex doesn't index MAX_PARTY_MEMBERS\n\t%i not in [0, %i)", v15, 200) )
      __debugbreak();
  }
  if ( (unsigned int)v4 >= 3 )
  {
    LODWORD(v16) = 3;
    LODWORD(v15) = v4;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 467, ASSERT_TYPE_ASSERT, "(unsigned)( customizationType ) < (unsigned)( CUSTOMIZATION_TYPE_COUNT )", "customizationType doesn't index CUSTOMIZATION_TYPE_COUNT\n\t%i not in [0, %i)", v15, v16) )
      __debugbreak();
  }
  if ( !Party_IsMemberIndexDataAvailable(party, partyMemberIndex) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 468, ASSERT_TYPE_ASSERT, "(Party_IsMemberIndexDataAvailable( party, partyMemberIndex ))", (const char *)&queryFormat, "Party_IsMemberIndexDataAvailable( party, partyMemberIndex )") )
    __debugbreak();
  v8 = 0;
  if ( !partyMemberIndex )
    return 0;
  v9 = v4;
  for ( i = &party->partyMembers[0].playerUID; ; i += 63 )
  {
    if ( Party_IsMemberIndexDataAvailable(party, v8) )
    {
      v11.m_id = i->m_id;
      *(_QWORD *)&customizationWest.headModelIndex = 0i64;
      customizationWest.executionId = 0;
      *(_QWORD *)&customizationEast.headModelIndex = 0i64;
      customizationEast.executionId = 0;
      PlayercardCache_GetMPActiveCustomizationData(v11, (const char *)&i[-46].m_id + 4, &selectedOperatorIndex, &customizationWest, &customizationEast);
      if ( LODWORD(i[-2].m_id) == 1 )
      {
        bodyModelIndex = customizationEast.bodyModelIndex;
        headModelIndex = customizationEast.headModelIndex;
      }
      else
      {
        bodyModelIndex = customizationWest.bodyModelIndex;
        headModelIndex = customizationWest.headModelIndex;
      }
      BG_Customization_BuildClientCustomization(&outCustomizationInfo, headModelIndex, 0, bodyModelIndex, (const PartyMember *const)&i[-52]);
      if ( outCustomizationInfo.modelIndex[v9] == memberCustomizationInfo->modelIndex[v9] )
        break;
    }
    if ( ++v8 >= partyMemberIndex )
      return 0;
  }
  return 1;
}

/*
==============
CL_UIStreaming_GetActiveClients
==============
*/
__int64 CL_UIStreaming_GetActiveClients()
{
  unsigned int v0; 
  PartyData *PartyData; 

  v0 = 1;
  if ( Lobby_IsInRunningLobby() )
  {
    PartyData = Lobby_GetPartyData();
    if ( !PartyData )
      return 1i64;
    goto LABEL_5;
  }
  PartyData = &g_partyData;
  if ( Party_InParty(&g_partyData) )
  {
LABEL_5:
    if ( PartyData->splitscreenData.otherClientActive )
      return 2;
  }
  return v0;
}

/*
==============
CL_UIStreaming_GetActiveController
==============
*/
int CL_UIStreaming_GetActiveController(const LocalClientNum_t localClientNum)
{
  const PartyData *PartyData; 
  bool v3; 
  __int64 v4; 

  if ( Lobby_IsInRunningLobby() )
  {
    PartyData = Lobby_GetPartyData();
    v3 = PartyData == NULL;
  }
  else
  {
    PartyData = &g_partyData;
    v3 = Party_InParty(&g_partyData) == 0;
  }
  if ( v3 )
    LODWORD(v4) = CL_Mgr_GetControllerFromClient(localClientNum);
  else
    return HIDWORD(*(unsigned __int64 *)&Party_GetActiveClientForLocalClientNum(PartyData, localClientNum));
  return v4;
}

/*
==============
CL_UIStreaming_GetClientRequestQueue
==============
*/
UIStreamRequestQueue *CL_UIStreaming_GetClientRequestQueue(const LocalClientNum_t localClientNum, const StreamSyncClientType requestType)
{
  __int64 v2; 
  __int64 v3; 
  __int64 v5; 
  __int64 v7; 
  int v8; 

  v2 = localClientNum;
  v3 = requestType;
  if ( (unsigned int)localClientNum >= LOCAL_CLIENT_COUNT )
  {
    v8 = 2;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 278, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", localClientNum, v8) )
      __debugbreak();
  }
  if ( (unsigned int)v3 >= 6 )
  {
    LODWORD(v7) = 6;
    LODWORD(v5) = v3;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 279, ASSERT_TYPE_ASSERT, "(unsigned)( requestType ) < (unsigned)( STREAM_SYNC_CLIENT_TYPE_COUNT )", "requestType doesn't index STREAM_SYNC_CLIENT_TYPE_COUNT\n\t%i not in [0, %i)", v5, v7) )
      __debugbreak();
  }
  return s_uiClientStreamRequestQueues[v2][v3];
}

/*
==============
CL_UIStreaming_GetMaxRequestCount
==============
*/
__int64 CL_UIStreaming_GetMaxRequestCount(const StreamSyncClientType requestType, const unsigned int activeClientCount)
{
  __int64 result; 

  switch ( requestType )
  {
    case STREAM_SYNC_CLIENT_TYPE_FIRST_WORLD_MODEL:
    case STREAM_SYNC_CLIENT_TYPE_BODY:
      result = 48i64;
      break;
    case STREAM_SYNC_CLIENT_TYPE_WEAPON:
      result = 64i64;
      break;
    case STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL:
      result = 20i64;
      break;
    case STREAM_SYNC_CLIENT_TYPE_VIEW_WEAPON:
      if ( !activeClientCount )
        goto LABEL_10;
      result = 0x18 / activeClientCount;
      break;
    case STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS:
      result = 32i64;
      break;
    default:
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 246, ASSERT_TYPE_ASSERT, (const char *)&queryFormat.fmt + 3, "Unknown stream request type %d", requestType) )
        __debugbreak();
LABEL_10:
      result = 0i64;
      break;
  }
  return result;
}

/*
==============
CL_UIStreaming_GetPartyStreamingRequests
==============
*/
__int64 CL_UIStreaming_GetPartyStreamingRequests(const PartyData *party, const bool loadRemotePlayerAssets, CustomizationModelType customizationType, ClStreamingRequest *outRequests, const unsigned int maxRequestCount)
{
  __int64 v5; 
  unsigned int v9; 
  XUID *p_playerUID; 
  unsigned int i; 
  XUID v12; 
  int bodyModelIndex; 
  int headModelIndex; 
  const char *ModelName; 
  __int64 v17; 
  bool selectedOperatorIndex; 
  StreamSyncClientType requestType; 
  CustomizationModels customizationEast; 
  ClientCustomizationInfo outCustomizationInfo; 
  CustomizationModels customizationWest; 

  v5 = customizationType;
  if ( !party && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 508, ASSERT_TYPE_ASSERT, "(party)", (const char *)&queryFormat, "party") )
    __debugbreak();
  if ( (unsigned int)v5 >= 3 )
  {
    LODWORD(v17) = v5;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 509, ASSERT_TYPE_ASSERT, "(unsigned)( customizationType ) < (unsigned)( CUSTOMIZATION_TYPE_COUNT )", "customizationType doesn't index CUSTOMIZATION_TYPE_COUNT\n\t%i not in [0, %i)", v17, 3) )
      __debugbreak();
  }
  if ( !outRequests && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 510, ASSERT_TYPE_ASSERT, "(outRequests)", (const char *)&queryFormat, "outRequests") )
    __debugbreak();
  if ( !Com_GameMode_SupportsFeature(WEAPON_DROPPING_LADDER_SLIDE) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 511, ASSERT_TYPE_ASSERT, "(Com_GameMode_SupportsFeature( Com_GameMode_Feature::CHARACTER_CUSTOMIZATION_INGAME ))", (const char *)&queryFormat, "Com_GameMode_SupportsFeature( Com_GameMode_Feature::CHARACTER_CUSTOMIZATION_INGAME )") )
    __debugbreak();
  v9 = 0;
  p_playerUID = &party->partyMembers[0].playerUID;
  requestType = Com_StreamSync_GetStreamTypeForCustomization((CustomizationModelType)v5);
  for ( i = 0; i < 0xC8; ++i )
  {
    if ( v9 >= maxRequestCount )
      break;
    if ( loadRemotePlayerAssets || Party_IsMemberLocalPlayer(party, i) )
    {
      if ( !party && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 431, ASSERT_TYPE_ASSERT, "(party)", (const char *)&queryFormat, "party") )
        __debugbreak();
      if ( !party->inParty && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 432, ASSERT_TYPE_ASSERT, "(party->inParty)", (const char *)&queryFormat, "party->inParty") )
        __debugbreak();
      if ( Party_IsMemberIndexDataAvailable(party, i) )
      {
        v12.m_id = p_playerUID->m_id;
        memset(&outCustomizationInfo, 0, sizeof(outCustomizationInfo));
        *(_QWORD *)&customizationEast.headModelIndex = 0i64;
        customizationEast.executionId = 0;
        PlayercardCache_GetMPActiveCustomizationData(v12, (const char *)&p_playerUID[-46].m_id + 4, &selectedOperatorIndex, &customizationWest, &customizationEast);
        if ( LODWORD(p_playerUID[-2].m_id) == 1 )
        {
          bodyModelIndex = customizationEast.bodyModelIndex;
          headModelIndex = customizationEast.headModelIndex;
        }
        else
        {
          bodyModelIndex = customizationWest.bodyModelIndex;
          headModelIndex = customizationWest.headModelIndex;
        }
        BG_Customization_BuildClientCustomization(&outCustomizationInfo, headModelIndex, 0, bodyModelIndex, (const PartyMember *const)&p_playerUID[-52]);
        if ( !CL_UIStreaming_FindPartyMemberCustomization(party, i, &outCustomizationInfo, (const CustomizationModelType)v5) )
        {
          ModelName = BG_Customization_GetModelName((const CustomizationModelType)v5, outCustomizationInfo.modelIndex[v5]);
          CL_UIStreaming_GetStreamRequest(&outRequests[v9++], ModelName, 0, requestType);
        }
      }
    }
    p_playerUID += 63;
  }
  return v9;
}

/*
==============
CL_UIStreaming_GetStreamRequest
==============
*/
void CL_UIStreaming_GetStreamRequest(ClStreamingRequest *outRequest, const char *requestName, const unsigned int uiPriority, const StreamSyncClientType requestType)
{
  AssetStreamingPriority v8; 
  AssetStreamingPriority v9; 
  Weapon result; 
  Weapon weapon; 

  if ( !outRequest && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 300, ASSERT_TYPE_ASSERT, "(outRequest)", (const char *)&queryFormat, "outRequest") )
    __debugbreak();
  v8.raw = Com_Streaming_GetPriority(ASSET_STREAMING_REQUEST_NONE, uiPriority, ASSET_STREAMING_REQUEST_FLAGS_UI).raw;
  v9.raw = v8.raw;
  switch ( requestType )
  {
    case STREAM_SYNC_CLIENT_TYPE_FIRST_WORLD_MODEL:
    case STREAM_SYNC_CLIENT_TYPE_BODY:
    case STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL:
    case STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS:
      CL_Streaming_GetSingleModelRequest(requestName, v8, outRequest);
      break;
    case STREAM_SYNC_CLIENT_TYPE_WEAPON:
      if ( !CL_AnyLocalClientStateActive() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 315, ASSERT_TYPE_ASSERT, "(CL_AnyLocalClientStateActive())", "%s\n\tRegistering a weapon before the game is initialized.", "CL_AnyLocalClientStateActive()") )
        __debugbreak();
      _RAX = CL_UIStreaming_GetWeaponForName(&result, requestName);
      __asm
      {
        vmovups ymm0, ymmword ptr [rax]
        vmovups ymmword ptr [rsp+0D8h+weapon.weaponIdx], ymm0
        vmovups xmm1, xmmword ptr [rax+20h]
        vmovups xmmword ptr [rsp+0D8h+weapon.attachmentVariationIndices+5], xmm1
        vmovsd  xmm0, qword ptr [rax+30h]
        vmovsd  qword ptr [rsp+0D8h+weapon.attachmentVariationIndices+15h], xmm0
      }
      *(_DWORD *)&weapon.weaponCamo = *(_DWORD *)&_RAX->weaponCamo;
      CL_Streaming_GetWeaponWorldRequest(&weapon, v9, outRequest);
      break;
    case STREAM_SYNC_CLIENT_TYPE_VIEW_WEAPON:
      if ( !CL_AnyLocalClientStateActive() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 323, ASSERT_TYPE_ASSERT, "(CL_AnyLocalClientStateActive())", "%s\n\tRegistering a weapon before the game is initialized.", "CL_AnyLocalClientStateActive()") )
        __debugbreak();
      _RAX = CL_UIStreaming_GetWeaponForName(&result, requestName);
      __asm
      {
        vmovups ymm0, ymmword ptr [rax]
        vmovups ymmword ptr [rsp+0D8h+weapon.weaponIdx], ymm0
        vmovups xmm1, xmmword ptr [rax+20h]
        vmovups xmmword ptr [rsp+0D8h+weapon.attachmentVariationIndices+5], xmm1
        vmovsd  xmm0, qword ptr [rax+30h]
        vmovsd  qword ptr [rsp+0D8h+weapon.attachmentVariationIndices+15h], xmm0
      }
      *(_DWORD *)&weapon.weaponCamo = *(_DWORD *)&_RAX->weaponCamo;
      CL_Streaming_GetWeaponViewRequest(&weapon, v9, outRequest);
      break;
    default:
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 330, ASSERT_TYPE_ASSERT, (const char *)&queryFormat.fmt + 3, "Uknown streaming type") )
        __debugbreak();
      break;
  }
}

/*
==============
CL_UIStreaming_GetWeaponForName
==============
*/
Weapon *CL_UIStreaming_GetWeaponForName(Weapon *result, const char *name)
{
  int v8; 
  Weapon resulta; 

  _RBX = result;
  if ( CL_AnyLocalClientStateActive() )
  {
    _RAX = CG_Weapons_GetWeaponForName(&resulta, name);
    __asm
    {
      vmovups ymm0, ymmword ptr [rax]
      vmovups xmm1, xmmword ptr [rax+20h]
      vmovups ymmword ptr [rbx], ymm0
      vmovsd  xmm0, qword ptr [rax+30h]
    }
    v8 = *(_DWORD *)&_RAX->weaponCamo;
  }
  else
  {
    __asm
    {
      vmovups ymm0, ymmword ptr cs:?NULL_WEAPON@@3UWeapon@@B.weaponIdx; Weapon const NULL_WEAPON
      vmovups xmm1, xmmword ptr cs:?NULL_WEAPON@@3UWeapon@@B.attachmentVariationIndices+5; Weapon const NULL_WEAPON
    }
    v8 = *(_DWORD *)&NULL_WEAPON.weaponCamo;
    __asm
    {
      vmovups ymmword ptr [rbx], ymm0
      vmovsd  xmm0, qword ptr cs:?NULL_WEAPON@@3UWeapon@@B.attachmentVariationIndices+15h; Weapon const NULL_WEAPON
    }
  }
  __asm
  {
    vmovups xmmword ptr [rbx+20h], xmm1
    vmovsd  qword ptr [rbx+30h], xmm0
  }
  *(_DWORD *)&_RBX->weaponCamo = v8;
  return _RBX;
}

/*
==============
CL_UIStreaming_ImageHash
==============
*/
__int64 CL_UIStreaming_ImageHash(const unsigned int imageIndex)
{
  return imageIndex % 0xEF;
}

/*
==============
CL_UIStreaming_Init
==============
*/
void CL_UIStreaming_Init(const LocalClientNum_t __formal)
{
  if ( !s_uiStreamingInitialized )
  {
    memset_0(&s_uiStreamingImageCache, 0, sizeof(s_uiStreamingImageCache));
    s_uiStreamingInitialized = 1;
  }
}

/*
==============
CL_UIStreaming_IsRunningImages
==============
*/
bool CL_UIStreaming_IsRunningImages()
{
  return s_uiStreamingImagesActive;
}

/*
==============
CL_UIStreaming_IsRunningTransients
==============
*/
_BOOL8 CL_UIStreaming_IsRunningTransients()
{
  return s_uiStreamingTransientsActive;
}

/*
==============
CL_UIStreaming_IsStartingMatch
==============
*/
bool CL_UIStreaming_IsStartingMatch()
{
  const PartyData *PartyData; 
  bool v1; 

  if ( Lobby_IsInRunningLobby() )
  {
    PartyData = Lobby_GetPartyData();
    v1 = PartyData == NULL;
  }
  else
  {
    PartyData = &g_partyData;
    v1 = Party_InParty(&g_partyData) == 0;
  }
  return !v1 && PartyUI_IsStartingMatch(PartyData);
}

/*
==============
CL_UIStreaming_NeedsDatabaseAccess
==============
*/
char CL_UIStreaming_NeedsDatabaseAccess()
{
  if ( !s_uiStreamingImagesMissing || s_uiStreamingImagesRequestDisabled )
    return 0;
  if ( !s_uiStreamingImagesActive && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1738, ASSERT_TYPE_ASSERT, "(s_uiStreamingImagesActive)", (const char *)&queryFormat, "s_uiStreamingImagesActive") )
    __debugbreak();
  return 1;
}

/*
==============
CL_UIStreaming_RegisterCommands
==============
*/
void CL_UIStreaming_RegisterCommands(void)
{
  Cmd_AddClientCommandList(S_CL_UI_STREAMING_CMD_COMMON, 1u);
}

/*
==============
CL_UIStreaming_RemoveImage
==============
*/
bool CL_UIStreaming_RemoveImage(const GfxImage *const image)
{
  unsigned int GfxImageIndex; 

  if ( !image && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1443, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
    __debugbreak();
  GfxImageIndex = DB_GetGfxImageIndex(image);
  return CL_UIStreaming_RemoveImageIndex(GfxImageIndex);
}

/*
==============
CL_UIStreaming_RemoveImageIndex
==============
*/
char CL_UIStreaming_RemoveImageIndex(const unsigned int imageIndex)
{
  const dvar_t *v2; 
  GfxImage *GfxImageAtIndex; 
  const dvar_t *v5; 
  GfxImage *v6; 
  __int64 v7; 
  int v8; 
  unsigned int v9; 
  unsigned __int8 v10; 
  unsigned int v11; 
  GfxImage *v12; 
  const char *name; 
  char v14; 
  char *fmt; 
  __int64 v17; 
  __int64 v18; 
  __int64 v19; 
  __int64 v20; 
  __int64 v21; 

  v2 = DCONST_DVARBOOL_cl_uistreaming_images;
  if ( !DCONST_DVARBOOL_cl_uistreaming_images && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_images") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v2);
  if ( !v2->current.enabled )
    return 0;
  if ( !s_uiStreamingInitialized )
  {
    GfxImageAtIndex = DB_GetGfxImageAtIndex(imageIndex);
    if ( !GfxImageAtIndex && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1540, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
      __debugbreak();
    Com_PrintWarning(14, "CL_UIStreaming_RemoveImageIndex called before the module was initialized! Ignoring request to remove %u '%s'!\n", imageIndex, GfxImageAtIndex->name);
    return 0;
  }
  Sys_ProfBeginNamedEvent(0xFF808080, "CL_UIStreaming_RemoveImageIndex");
  v5 = DCONST_DVARBOOL_cl_uistreaming_verbose;
  if ( !DCONST_DVARBOOL_cl_uistreaming_verbose && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_verbose") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v5);
  if ( v5->current.enabled )
  {
    v6 = DB_GetGfxImageAtIndex(imageIndex);
    if ( !v6 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1552, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
      __debugbreak();
    Com_Printf(14, "CL_UIStreaming_RemoveImageIndex %u '%s'\n", imageIndex, v6->name);
  }
  if ( imageIndex >= 0x14000 )
  {
    LODWORD(v19) = 81920;
    LODWORD(v17) = imageIndex;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1557, ASSERT_TYPE_ASSERT, "(unsigned)( imageIndex ) < (unsigned)( IMAGE_POOL_SIZE )", "imageIndex doesn't index IMAGE_POOL_SIZE\n\t%i not in [0, %i)", v17, v19) )
      __debugbreak();
  }
  v7 = imageIndex % 0xEF;
  v8 = 0;
  while ( 1 )
  {
    if ( (unsigned int)v7 >= 0xEF )
    {
      LODWORD(v19) = 239;
      LODWORD(v17) = v7;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1565, ASSERT_TYPE_ASSERT, "(unsigned)( probeCacheIndex ) < (unsigned)( ( sizeof( *array_counter( s_uiStreamingImageCache.indices ) ) + 0 ) )", "probeCacheIndex doesn't index ARRAY_COUNT( s_uiStreamingImageCache.indices )\n\t%i not in [0, %i)", v17, v19) )
        __debugbreak();
      LODWORD(v20) = 239;
      LODWORD(v18) = v7;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1566, ASSERT_TYPE_ASSERT, "(unsigned)( probeCacheIndex ) < (unsigned)( ( sizeof( *array_counter( s_uiStreamingImageCache.refCounts ) ) + 0 ) )", "probeCacheIndex doesn't index ARRAY_COUNT( s_uiStreamingImageCache.refCounts )\n\t%i not in [0, %i)", v18, v20) )
        __debugbreak();
    }
    v9 = s_uiStreamingImageCache.indices[v7];
    if ( v9 )
      break;
    v10 = s_uiStreamingImageCache.refCounts[v7];
    if ( v10 )
    {
      LODWORD(v21) = v10;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1572, ASSERT_TYPE_ASSERT, "( s_uiStreamingImageCache.refCounts[probeCacheIndex] ) == ( 0 )", "%s == %s\n\t%i, %i", "s_uiStreamingImageCache.refCounts[probeCacheIndex]", "0", v21, 0i64) )
        __debugbreak();
    }
LABEL_36:
    v7 = ((int)v7 + 1) % 0xEFu;
    if ( (unsigned int)++v8 >= 0xEF )
    {
      v12 = DB_GetGfxImageAtIndex(imageIndex);
      if ( v12 )
        name = v12->name;
      else
        name = "NULL";
      LODWORD(fmt) = 239;
      Com_PrintError(14, "CL_UIStreaming_RemoveImageIndex failed for GfxImage %u '%s'. Consider increasing CL_UI_STREAMING_MAX_STREAMED_IMAGES (%u)\n", imageIndex, name, fmt);
      v14 = 0;
      goto LABEL_47;
    }
  }
  v11 = v9 - 1;
  if ( v11 >= 0x14000 )
  {
    LODWORD(v19) = 81920;
    LODWORD(v17) = v11;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1577, ASSERT_TYPE_ASSERT, "(unsigned)( probeImageIndex ) < (unsigned)( IMAGE_POOL_SIZE )", "probeImageIndex doesn't index IMAGE_POOL_SIZE\n\t%i not in [0, %i)", v17, v19) )
      __debugbreak();
  }
  if ( v11 != imageIndex )
    goto LABEL_36;
  if ( !s_uiStreamingImageCache.refCounts[v7] && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1581, ASSERT_TYPE_ASSERT, "(s_uiStreamingImageCache.refCounts[probeCacheIndex])", (const char *)&queryFormat, "s_uiStreamingImageCache.refCounts[probeCacheIndex]") )
    __debugbreak();
  if ( s_uiStreamingImageCache.refCounts[v7]-- == 1 )
    s_uiStreamingImageCache.indices[v7] = 0;
  v14 = 1;
LABEL_47:
  Sys_ProfEndNamedEvent();
  return v14;
}

/*
==============
CL_UIStreaming_RequestBodyModels
==============
*/
void CL_UIStreaming_RequestBodyModels(const char **bodyNames, const unsigned int bodyNameCount)
{
  const char **v2; 
  __int64 v3; 
  UIStreamRequestQueue *v4; 
  __int64 v5; 
  const dvar_t *v6; 
  __int64 v7; 

  v2 = bodyNames;
  v3 = bodyNameCount;
  if ( !bodyNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1911, ASSERT_TYPE_ASSERT, "(bodyNames)", (const char *)&queryFormat, "bodyNames") )
    __debugbreak();
  if ( (unsigned int)v3 > 0x30 )
  {
    LODWORD(v7) = v3;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1912, ASSERT_TYPE_ASSERT, "( bodyNameCount ) <= ( MAX_UI_BODIES_STREAMED )", "bodyNameCount not in [0, MAX_UI_BODIES_STREAMED]\n\t%u not in [0, %u]", v7, 48) )
      __debugbreak();
  }
  v4 = s_uiWorldStreamRequestQueues[1];
  if ( !s_uiWorldStreamRequestQueues[1] )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1915, ASSERT_TYPE_ASSERT, "(requestQueue)", (const char *)&queryFormat, "requestQueue") )
      __debugbreak();
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 927, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
      __debugbreak();
  }
  DebugWipe(v4->requestItem, 580i64 * v4->maxRequestCount);
  v4->requestCount = 0;
  if ( (_DWORD)v3 )
  {
    v5 = v3;
    do
    {
      if ( !*v2 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1921, ASSERT_TYPE_ASSERT, "(bodyNames[bodyNameIndex])", (const char *)&queryFormat, "bodyNames[bodyNameIndex]") )
        __debugbreak();
      CL_UIStreaming_AddRequestItem(v4, *v2++, 0, s_uiStreamingPriority);
      --v5;
    }
    while ( v5 );
  }
  CL_UIStreaming_CheckRequestQueueForOverflow(v4, v3, STREAM_SYNC_CLIENT_TYPE_BODY);
  v6 = DCONST_DVARBOOL_cl_uistreaming_verbose;
  if ( !DCONST_DVARBOOL_cl_uistreaming_verbose && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_verbose") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v6);
  if ( v6->current.enabled )
    CL_UIStreaming_DebugPrintRequestQueue(v4, STREAM_SYNC_CLIENT_TYPE_BODY);
  ++s_uiStreamingPriority;
}

/*
==============
CL_UIStreaming_RequestClientModelModels
==============
*/
void CL_UIStreaming_RequestClientModelModels(const LocalClientNum_t localClientNum, const char **clientModelModelNames, const unsigned int clientModelModelNameCount)
{
  const char **v3; 
  __int64 v4; 
  __int64 v5; 
  UIStreamRequestQueue *v6; 
  __int64 v7; 
  const dvar_t *v8; 
  __int64 v9; 
  __int64 v10; 

  v3 = clientModelModelNames;
  v4 = clientModelModelNameCount;
  v5 = localClientNum;
  if ( !clientModelModelNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2074, ASSERT_TYPE_ASSERT, "(clientModelModelNames)", (const char *)&queryFormat, "clientModelModelNames") )
    __debugbreak();
  if ( (unsigned int)v4 > 0x20 )
  {
    LODWORD(v9) = v4;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2075, ASSERT_TYPE_ASSERT, "( clientModelModelNameCount ) <= ( MAX_UI_CLIENTMODELS_STREAMED )", "clientModelModelNameCount not in [0, MAX_UI_CLIENTMODELS_STREAMED]\n\t%u not in [0, %u]", v9, 32) )
      __debugbreak();
  }
  if ( (unsigned int)v5 >= 2 )
  {
    LODWORD(v10) = 2;
    LODWORD(v9) = v5;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 278, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", v9, v10) )
      __debugbreak();
  }
  v6 = s_uiClientStreamRequestQueues[v5][5];
  if ( !v6 )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2078, ASSERT_TYPE_ASSERT, "(requestQueue)", (const char *)&queryFormat, "requestQueue") )
      __debugbreak();
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 927, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
      __debugbreak();
  }
  DebugWipe(v6->requestItem, 580i64 * v6->maxRequestCount);
  v6->requestCount = 0;
  if ( (_DWORD)v4 )
  {
    v7 = v4;
    do
    {
      if ( !*v3 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2084, ASSERT_TYPE_ASSERT, "(clientModelModelNames[clientModelNameIndex])", (const char *)&queryFormat, "clientModelModelNames[clientModelNameIndex]") )
        __debugbreak();
      CL_UIStreaming_AddRequestItem(v6, *v3++, 0, s_uiStreamingPriority);
      --v7;
    }
    while ( v7 );
  }
  CL_UIStreaming_CheckRequestQueueForOverflow(v6, v4, STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS);
  v8 = DCONST_DVARBOOL_cl_uistreaming_verbose;
  if ( !DCONST_DVARBOOL_cl_uistreaming_verbose && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_verbose") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v8);
  if ( v8->current.enabled )
    CL_UIStreaming_DebugPrintRequestQueue(v6, STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS);
  ++s_uiStreamingPriority;
}

/*
==============
CL_UIStreaming_RequestHandViewModels
==============
*/
void CL_UIStreaming_RequestHandViewModels(const LocalClientNum_t localClientNum, const char **handModelNames, const unsigned int handModelNameCount)
{
  const char **v3; 
  __int64 v4; 
  __int64 v5; 
  UIStreamRequestQueue *v6; 
  __int64 v7; 
  const dvar_t *v8; 
  __int64 v9; 
  __int64 v10; 

  v3 = handModelNames;
  v4 = handModelNameCount;
  v5 = localClientNum;
  if ( !handModelNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2020, ASSERT_TYPE_ASSERT, "(handModelNames)", (const char *)&queryFormat, "handModelNames") )
    __debugbreak();
  if ( (unsigned int)v4 > 0x14 )
  {
    LODWORD(v9) = v4;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2021, ASSERT_TYPE_ASSERT, "( handModelNameCount ) <= ( MAX_UI_VIEW_HANDS_STREAMED )", "handModelNameCount not in [0, MAX_UI_VIEW_HANDS_STREAMED]\n\t%u not in [0, %u]", v9, 20) )
      __debugbreak();
  }
  if ( (unsigned int)v5 >= 2 )
  {
    LODWORD(v10) = 2;
    LODWORD(v9) = v5;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 278, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", v9, v10) )
      __debugbreak();
  }
  v6 = s_uiClientStreamRequestQueues[v5][3];
  if ( !v6 )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2024, ASSERT_TYPE_ASSERT, "(requestQueue)", (const char *)&queryFormat, "requestQueue") )
      __debugbreak();
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 927, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
      __debugbreak();
  }
  DebugWipe(v6->requestItem, 580i64 * v6->maxRequestCount);
  v6->requestCount = 0;
  if ( (_DWORD)v4 )
  {
    v7 = v4;
    do
    {
      if ( !*v3 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2030, ASSERT_TYPE_ASSERT, "(handModelNames[viewHandNameIndex])", (const char *)&queryFormat, "handModelNames[viewHandNameIndex]") )
        __debugbreak();
      CL_UIStreaming_AddRequestItem(v6, *v3++, 0, s_uiStreamingPriority);
      --v7;
    }
    while ( v7 );
  }
  CL_UIStreaming_CheckRequestQueueForOverflow(v6, v4, STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL);
  v8 = DCONST_DVARBOOL_cl_uistreaming_verbose;
  if ( !DCONST_DVARBOOL_cl_uistreaming_verbose && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_verbose") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v8);
  if ( v8->current.enabled )
    CL_UIStreaming_DebugPrintRequestQueue(v6, STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL);
  ++s_uiStreamingPriority;
}

/*
==============
CL_UIStreaming_RequestHeadModels
==============
*/
void CL_UIStreaming_RequestHeadModels(const char **headNames, const unsigned int headNameCount)
{
  const char **v2; 
  __int64 v3; 
  UIStreamRequestQueue *v4; 
  __int64 v5; 
  const dvar_t *v6; 
  __int64 v7; 

  v2 = headNames;
  v3 = headNameCount;
  if ( !headNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1857, ASSERT_TYPE_ASSERT, "(headNames)", (const char *)&queryFormat, "headNames") )
    __debugbreak();
  if ( (unsigned int)v3 > 0x30 )
  {
    LODWORD(v7) = v3;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1858, ASSERT_TYPE_ASSERT, "( headNameCount ) <= ( MAX_UI_HEADS_STREAMED )", "headNameCount not in [0, MAX_UI_HEADS_STREAMED]\n\t%u not in [0, %u]", v7, 48) )
      __debugbreak();
  }
  v4 = s_uiWorldStreamRequestQueues[0];
  if ( !s_uiWorldStreamRequestQueues[0] )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1861, ASSERT_TYPE_ASSERT, "(requestQueue)", (const char *)&queryFormat, "requestQueue") )
      __debugbreak();
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 927, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
      __debugbreak();
  }
  DebugWipe(v4->requestItem, 580i64 * v4->maxRequestCount);
  v4->requestCount = 0;
  if ( (_DWORD)v3 )
  {
    v5 = v3;
    do
    {
      if ( !*v2 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1867, ASSERT_TYPE_ASSERT, "(headNames[headNameIndex])", (const char *)&queryFormat, "headNames[headNameIndex]") )
        __debugbreak();
      CL_UIStreaming_AddRequestItem(v4, *v2++, 0, s_uiStreamingPriority);
      --v5;
    }
    while ( v5 );
  }
  CL_UIStreaming_CheckRequestQueueForOverflow(v4, v3, STREAM_SYNC_CLIENT_TYPE_FIRST_WORLD_MODEL);
  v6 = DCONST_DVARBOOL_cl_uistreaming_verbose;
  if ( !DCONST_DVARBOOL_cl_uistreaming_verbose && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_verbose") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v6);
  if ( v6->current.enabled )
    CL_UIStreaming_DebugPrintRequestQueue(v4, STREAM_SYNC_CLIENT_TYPE_FIRST_WORLD_MODEL);
  ++s_uiStreamingPriority;
}

/*
==============
CL_UIStreaming_RequestWeaponViewModels
==============
*/
void CL_UIStreaming_RequestWeaponViewModels(const LocalClientNum_t localClientNum, const char **weaponNames, const unsigned int weaponNameCount)
{
  const char **v3; 
  __int64 v4; 
  __int64 v5; 
  UIStreamRequestQueue *v6; 
  __int64 v7; 
  const dvar_t *v8; 
  __int64 v9; 
  __int64 v10; 

  v3 = weaponNames;
  v4 = weaponNameCount;
  v5 = localClientNum;
  if ( !weaponNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1965, ASSERT_TYPE_ASSERT, "(weaponNames)", (const char *)&queryFormat, "weaponNames") )
    __debugbreak();
  if ( (unsigned int)v4 > 0x18 )
  {
    LODWORD(v9) = v4;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1966, ASSERT_TYPE_ASSERT, "( weaponNameCount ) <= ( MAX_UI_VIEW_WEAPONS_STREAMED )", "weaponNameCount not in [0, MAX_UI_VIEW_WEAPONS_STREAMED]\n\t%u not in [0, %u]", v9, 24) )
      __debugbreak();
  }
  if ( (unsigned int)v5 >= 2 )
  {
    LODWORD(v10) = 2;
    LODWORD(v9) = v5;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 278, ASSERT_TYPE_ASSERT, "(unsigned)( localClientNum ) < (unsigned)( 2 )", "localClientNum doesn't index STATIC_MAX_LOCAL_CLIENTS\n\t%i not in [0, %i)", v9, v10) )
      __debugbreak();
  }
  v6 = s_uiClientStreamRequestQueues[v5][4];
  if ( !v6 )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1969, ASSERT_TYPE_ASSERT, "(requestQueue)", (const char *)&queryFormat, "requestQueue") )
      __debugbreak();
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 927, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
      __debugbreak();
  }
  DebugWipe(v6->requestItem, 580i64 * v6->maxRequestCount);
  v6->requestCount = 0;
  if ( (_DWORD)v4 )
  {
    v7 = v4;
    do
    {
      if ( !*v3 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1975, ASSERT_TYPE_ASSERT, "(weaponNames[viewWeaponNameIndex])", (const char *)&queryFormat, "weaponNames[viewWeaponNameIndex]") )
        __debugbreak();
      CL_UIStreaming_AddRequestItem(v6, *v3++, 1, s_uiStreamingPriority);
      --v7;
    }
    while ( v7 );
  }
  CL_UIStreaming_CheckRequestQueueForOverflow(v6, v4, STREAM_SYNC_CLIENT_TYPE_VIEW_WEAPON);
  v8 = DCONST_DVARBOOL_cl_uistreaming_verbose;
  if ( !DCONST_DVARBOOL_cl_uistreaming_verbose && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_verbose") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v8);
  if ( v8->current.enabled )
    CL_UIStreaming_DebugPrintRequestQueue(v6, STREAM_SYNC_CLIENT_TYPE_VIEW_WEAPON);
  ++s_uiStreamingPriority;
}

/*
==============
CL_UIStreaming_RequestWeaponWorldModels
==============
*/
void CL_UIStreaming_RequestWeaponWorldModels(const char **weaponNames, const unsigned int weaponNameCount)
{
  const char **v2; 
  __int64 v3; 
  UIStreamRequestQueue *v4; 
  __int64 v5; 
  const dvar_t *v6; 
  __int64 v7; 

  v2 = weaponNames;
  v3 = weaponNameCount;
  if ( !weaponNames && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2128, ASSERT_TYPE_ASSERT, "(weaponNames)", (const char *)&queryFormat, "weaponNames") )
    __debugbreak();
  if ( (unsigned int)v3 > 0x40 )
  {
    LODWORD(v7) = v3;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2129, ASSERT_TYPE_ASSERT, "( weaponNameCount ) <= ( MAX_UI_WORLD_WEAPONS_STREAMED )", "weaponNameCount not in [0, MAX_UI_WORLD_WEAPONS_STREAMED]\n\t%u not in [0, %u]", v7, 64) )
      __debugbreak();
  }
  v4 = s_uiWorldStreamRequestQueues[2];
  if ( !s_uiWorldStreamRequestQueues[2] )
  {
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2132, ASSERT_TYPE_ASSERT, "(requestQueue)", (const char *)&queryFormat, "requestQueue") )
      __debugbreak();
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 927, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
      __debugbreak();
  }
  DebugWipe(v4->requestItem, 580i64 * v4->maxRequestCount);
  v4->requestCount = 0;
  if ( (_DWORD)v3 )
  {
    v5 = v3;
    do
    {
      if ( !*v2 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 2138, ASSERT_TYPE_ASSERT, "(weaponNames[worldWeaponNameIndex])", (const char *)&queryFormat, "weaponNames[worldWeaponNameIndex]") )
        __debugbreak();
      CL_UIStreaming_AddRequestItem(v4, *v2++, 0, s_uiStreamingPriority);
      --v5;
    }
    while ( v5 );
  }
  CL_UIStreaming_CheckRequestQueueForOverflow(v4, v3, STREAM_SYNC_CLIENT_TYPE_WEAPON);
  v6 = DCONST_DVARBOOL_cl_uistreaming_verbose;
  if ( !DCONST_DVARBOOL_cl_uistreaming_verbose && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_verbose") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v6);
  if ( v6->current.enabled )
    CL_UIStreaming_DebugPrintRequestQueue(v4, STREAM_SYNC_CLIENT_TYPE_WEAPON);
  ++s_uiStreamingPriority;
}

/*
==============
CL_UIStreaming_ScriptRequestsEnabled
==============
*/
_BOOL8 CL_UIStreaming_ScriptRequestsEnabled()
{
  return s_uiStreamingFromScript;
}

/*
==============
CL_UIStreaming_SetMaxRequestCount
==============
*/
void CL_UIStreaming_SetMaxRequestCount(UIStreamRequestQueue *const requestQueue, const unsigned int maxRequestCount)
{
  if ( !requestQueue && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1070, ASSERT_TYPE_ASSERT, "( ( requestQueue != nullptr ) )", "( requestQueue ) = %p", NULL) )
    __debugbreak();
  for ( ; requestQueue->requestCount > maxRequestCount; --requestQueue->requestCount )
    DebugWipe(&requestQueue->requestItem[requestQueue->requestCount], 0x244ui64);
  requestQueue->maxRequestCount = maxRequestCount;
}

/*
==============
CL_UIStreaming_ShouldLoadGameAssets
==============
*/
bool CL_UIStreaming_ShouldLoadGameAssets()
{
  const PartyData *PartyData; 
  bool v1; 

  if ( Lobby_IsInRunningLobby() )
  {
    PartyData = Lobby_GetPartyData();
    v1 = PartyData == NULL;
  }
  else
  {
    PartyData = &g_partyData;
    v1 = Party_InParty(&g_partyData) == 0;
  }
  return !v1 && (!s_uiStreamingFromScript || PartyUI_IsStartingMatch(PartyData));
}

/*
==============
CL_UIStreaming_ShouldPrioritizeLevelPreload
==============
*/
bool CL_UIStreaming_ShouldPrioritizeLevelPreload()
{
  const PartyData *PartyData; 
  bool v1; 
  const char *MapName; 
  const dvar_t *v3; 
  const dvar_t *v4; 

  if ( Lobby_IsInRunningLobby() )
  {
    PartyData = Lobby_GetPartyData();
    v1 = PartyData == NULL;
  }
  else
  {
    PartyData = &g_partyData;
    v1 = Party_InParty(&g_partyData) == 0;
  }
  if ( v1 )
    return 0;
  if ( !PartyUI_IsStartingMatch(PartyData) )
    return 0;
  MapName = Party_GetMapName();
  if ( Com_FastFile_IsLevelPreloadComplete(MapName) )
    return 0;
  v3 = DVARBOOL_frontEndPrioritizeLevelLoadExceptNeededTransients;
  if ( !DVARBOOL_frontEndPrioritizeLevelLoadExceptNeededTransients && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "frontEndPrioritizeLevelLoadExceptNeededTransients") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v3);
  if ( v3->current.enabled && !CG_FrontendScene_AreRequiredTransientsLoaded() )
    return 0;
  v4 = DVARBOOL_frontEndPrioritizeLevelLoadExpectStreamingVisibility;
  if ( !DVARBOOL_frontEndPrioritizeLevelLoadExpectStreamingVisibility && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "frontEndPrioritizeLevelLoadExpectStreamingVisibility") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v4);
  return !v4->current.enabled || !Com_FrontEndScene_NeedsStreamingForVisiblity();
}

/*
==============
CL_UIStreaming_Shutdown
==============
*/
void CL_UIStreaming_Shutdown(const LocalClientNum_t __formal)
{
  unsigned __int8 *refCounts; 
  UIStreamedImageCache *v2; 
  unsigned int v3; 
  unsigned int v4; 
  unsigned int v5; 
  GfxImage *GfxImageAtIndex; 
  char *fmt; 

  if ( s_uiStreamingInitialized )
  {
    refCounts = s_uiStreamingImageCache.refCounts;
    v2 = &s_uiStreamingImageCache;
    v3 = 0;
    s_uiStreamingInitialized = 0;
    v4 = 0;
    do
    {
      v5 = v2->indices[0];
      if ( v2->indices[0] )
      {
        if ( !*refCounts && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1784, ASSERT_TYPE_ASSERT, "(s_uiStreamingImageCache.refCounts[cacheIndex])", (const char *)&queryFormat, "s_uiStreamingImageCache.refCounts[cacheIndex]") )
          __debugbreak();
        GfxImageAtIndex = DB_GetGfxImageAtIndex(v5);
        if ( !GfxImageAtIndex && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1786, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
          __debugbreak();
        LODWORD(fmt) = *refCounts;
        Com_PrintWarning(14, "CL_UIStreaming_OnLevelUnload detected cached UI image %u '%s' has %u leaked reference(s).\n", v5, GfxImageAtIndex->name, fmt);
        ++v4;
      }
      ++v3;
      v2 = (UIStreamedImageCache *)((char *)v2 + 4);
      ++refCounts;
    }
    while ( v3 < 0xEF );
    if ( v4 )
      Com_PrintWarning(14, "CL_UIStreaming_OnLevelUnload detected %u UI image leaks. See console log for details.\n", v4);
    DebugWipe(&s_uiStreamingImageCache, 0x4ACui64);
  }
}

/*
==============
CL_UIStreaming_StartImageStreaming
==============
*/
void CL_UIStreaming_StartImageStreaming(void)
{
  s_uiStreamingImagesActive = 1;
  s_uiStreamingImagesMissing = 0;
  s_uiStreamingImagesRequestDisabled = 0;
}

/*
==============
CL_UIStreaming_StartStreamingTransients
==============
*/
void CL_UIStreaming_StartStreamingTransients(void)
{
  if ( CL_StreamSync_IsRunning() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1148, ASSERT_TYPE_ASSERT, "(!CL_StreamSync_IsRunning())", (const char *)&queryFormat, "!CL_StreamSync_IsRunning()") )
    __debugbreak();
  s_uiStreamingTransientsActive = 1;
  CL_UIStreaming_UpdateRequestCounts();
}

/*
==============
CL_UIStreaming_StopImageStreaming
==============
*/
void CL_UIStreaming_StopImageStreaming(void)
{
  s_uiStreamingImagesActive = 0;
  s_uiStreamingImagesMissing = 0;
  s_uiStreamingImagesRequestDisabled = 0;
}

/*
==============
CL_UIStreaming_StopStreamingTransients
==============
*/
void CL_UIStreaming_StopStreamingTransients(void)
{
  int v0; 
  unsigned int i; 
  UIStreamRequestQueue *v2; 

  v0 = 0;
  s_uiStreamingTransientsActive = 0;
  s_uiStreamingFromScript = 0;
  for ( i = 0; i < 3; ++i )
  {
    v2 = s_uiWorldStreamRequestQueues[i];
    if ( v2 && v2->requestCount )
    {
      DebugWipe(v2->requestItem, 580i64 * v2->maxRequestCount);
      v2->requestCount = 0;
    }
  }
  do
    CL_UIStreaming_ClearClientRequests((const LocalClientNum_t)v0++);
  while ( v0 < 2 );
}

/*
==============
CL_UIStreaming_StreamedEnough
==============
*/

bool __fastcall CL_UIStreaming_StreamedEnough(double _XMM0_8)
{
  char v5; 

  if ( !Stream_LevelInit_IsDone() )
    return 1;
  _RBX = DVARFLT_stream_syncFrontend_imageQuality;
  __asm { vmovaps [rsp+58h+var_18], xmm6 }
  if ( !DVARFLT_stream_syncFrontend_imageQuality && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 720, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "stream_syncFrontend_imageQuality") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(_RBX);
  __asm { vmovss  xmm6, dword ptr [rbx+28h] }
  _XMM0_8 = Stream_LoadQuality_Image();
  __asm
  {
    vcomiss xmm0, xmm6
    vmovaps xmm6, [rsp+58h+var_18]
  }
  return !v5;
}

/*
==============
CL_UIStreaming_TouchCachedImages
==============
*/
void CL_UIStreaming_TouchCachedImages(void)
{
  const dvar_t *v0; 
  UIStreamedImageCache *v1; 
  __int64 v2; 
  unsigned int v3; 
  unsigned int v4; 
  const GfxImage *GfxImageAtIndex; 
  __int64 v6; 
  __int64 v7; 

  v0 = DCONST_DVARBOOL_cl_uistreaming_images;
  if ( !DCONST_DVARBOOL_cl_uistreaming_images && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_images") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v0);
  if ( v0->current.enabled )
  {
    Sys_ProfBeginNamedEvent(0xFF808080, "CL_UIStreaming_TouchCachedImages");
    v1 = &s_uiStreamingImageCache;
    v2 = 239i64;
    do
    {
      v3 = v1->indices[0];
      if ( v1->indices[0] )
      {
        v4 = v3 - 1;
        if ( v3 - 1 >= 0x14000 )
        {
          LODWORD(v7) = 81920;
          LODWORD(v6) = v3 - 1;
          if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1622, ASSERT_TYPE_ASSERT, "(unsigned)( imageIndex ) < (unsigned)( IMAGE_POOL_SIZE )", "imageIndex doesn't index IMAGE_POOL_SIZE\n\t%i not in [0, %i)", v6, v7) )
            __debugbreak();
        }
        GfxImageAtIndex = DB_GetGfxImageAtIndex(v4);
        if ( !GfxImageAtIndex && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1625, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
          __debugbreak();
        Stream_TouchImage(GfxImageAtIndex);
      }
      v1 = (UIStreamedImageCache *)((char *)v1 + 4);
      --v2;
    }
    while ( v2 );
    Sys_ProfEndNamedEvent();
  }
}

/*
==============
CL_UIStreaming_TouchFrontendDObj
==============
*/
char CL_UIStreaming_TouchFrontendDObj(const DObj *const obj)
{
  const XModel **models; 
  const char *name; 

  if ( !s_uiStreamingImagesActive && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1378, ASSERT_TYPE_ASSERT, "( s_uiStreamingImagesActive )", "CL_UIStreaming_TouchFrontendDObj called while not in the frontend!\n") )
    __debugbreak();
  if ( !obj && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1381, ASSERT_TYPE_ASSERT, "( ( obj != nullptr ) )", "( obj ) = %p", NULL) )
    __debugbreak();
  if ( Stream_TouchDObjAndCheck(obj, MIP1) )
    return 1;
  if ( ((unsigned __int8)&s_uiStreamingAssetsMissing & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", (const void *)&s_uiStreamingAssetsMissing) )
    __debugbreak();
  _InterlockedIncrement(&s_uiStreamingAssetsMissing);
  if ( s_shouldPrintWarning )
  {
    if ( obj->numModels && (models = obj->models, *models) )
      name = (*models)->name;
    else
      name = (char *)&queryFormat.fmt + 3;
    Com_PrintWarning(35, "CL_UIStreaming_TouchFrontendDObj: waiting for DObj %u: \"%s\"\n", obj->entnum, name);
  }
  return 0;
}

/*
==============
CL_UIStreaming_TouchImage
==============
*/
void CL_UIStreaming_TouchImage(const GfxImage *const image)
{
  if ( !image && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1351, ASSERT_TYPE_ASSERT, "(image)", (const char *)&queryFormat, "image") )
    __debugbreak();
  if ( !Stream_TouchImageAndCheck(image) )
  {
    if ( ((unsigned __int8)&s_uiStreamingAssetsMissing & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", (const void *)&s_uiStreamingAssetsMissing) )
      __debugbreak();
    _InterlockedIncrement(&s_uiStreamingAssetsMissing);
    if ( s_shouldPrintWarning )
      Com_PrintWarning(35, "CL_UIStreaming_TouchImage: waiting for UI image: \"%s\"\n", image->name);
  }
}

/*
==============
CL_UIStreaming_TouchImageIndex
==============
*/
void CL_UIStreaming_TouchImageIndex(const unsigned int imageIndex)
{
  const GfxImage *GfxImageAtIndex; 

  GfxImageAtIndex = DB_GetGfxImageAtIndex(imageIndex);
  if ( !GfxImageAtIndex && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1351, ASSERT_TYPE_ASSERT, "(image)", (const char *)&queryFormat, "image") )
    __debugbreak();
  if ( !Stream_TouchImageAndCheck(GfxImageAtIndex) )
  {
    if ( ((unsigned __int8)&s_uiStreamingAssetsMissing & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", (const void *)&s_uiStreamingAssetsMissing) )
      __debugbreak();
    _InterlockedIncrement(&s_uiStreamingAssetsMissing);
    if ( s_shouldPrintWarning )
      Com_PrintWarning(35, "CL_UIStreaming_TouchImage: waiting for UI image: \"%s\"\n", GfxImageAtIndex->name);
  }
}

/*
==============
CL_UIStreaming_TouchMaterial
==============
*/
void CL_UIStreaming_TouchMaterial(const Material *const material)
{
  if ( !material && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1331, ASSERT_TYPE_ASSERT, "(material)", (const char *)&queryFormat, "material") )
    __debugbreak();
  if ( !Stream_TouchMaterialAndCheck(material) )
  {
    if ( ((unsigned __int8)&s_uiStreamingAssetsMissing & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", (const void *)&s_uiStreamingAssetsMissing) )
      __debugbreak();
    _InterlockedIncrement(&s_uiStreamingAssetsMissing);
    if ( s_shouldPrintWarning )
      Com_PrintWarning(35, "CL_UIStreaming_TouchMaterial: waiting for images for UI material: \"%s\"\n", material->name);
  }
}

/*
==============
CL_UIStreaming_TouchStreamModels
==============
*/

void __fastcall CL_UIStreaming_TouchStreamModels(UIStreamRequestItem *requestItem, const StreamSyncClientType requestType, double _XMM2_8)
{
  bool v5; 
  __int64 i; 
  const XModel *v11; 
  ClStreamingModelList outModelList; 
  Weapon result; 
  Weapon weapon; 

  if ( !requestItem && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 380, ASSERT_TYPE_ASSERT, "(requestItem)", (const char *)&queryFormat, "requestItem") )
    __debugbreak();
  if ( requestType < STREAM_SYNC_CLIENT_TYPE_FIRST_WORLD_MODEL )
    goto LABEL_8;
  if ( requestType <= STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL )
  {
LABEL_26:
    if ( !requestItem->touchImages )
      return;
    v5 = CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 389, ASSERT_TYPE_ASSERT, "(!requestItem->touchImages)", "%s\n\tNot touching characters or their weapons or client models, we're only interested in preventing pops for view weapons. Code should be updated to allow this if we need to.", "!requestItem->touchImages");
    goto LABEL_9;
  }
  if ( requestType != STREAM_SYNC_CLIENT_TYPE_VIEW_WEAPON )
  {
    if ( requestType != STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS )
    {
LABEL_8:
      v5 = CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 416, ASSERT_TYPE_ASSERT, (const char *)&queryFormat.fmt + 3, "Uknown streaming type");
LABEL_9:
      if ( v5 )
        __debugbreak();
      return;
    }
    goto LABEL_26;
  }
  if ( requestItem->touchImages )
  {
    _RAX = CL_UIStreaming_GetWeaponForName(&result, requestItem->requestName);
    __asm
    {
      vmovups ymm2, ymmword ptr [rax]
      vmovups ymmword ptr [rsp+148h+weapon.weaponIdx], ymm2
      vmovups xmm0, xmmword ptr [rax+20h]
      vmovups xmmword ptr [rsp+148h+weapon.attachmentVariationIndices+5], xmm0
      vmovsd  xmm1, qword ptr [rax+30h]
      vmovsd  qword ptr [rsp+148h+weapon.attachmentVariationIndices+15h], xmm1
    }
    *(_DWORD *)&weapon.weaponCamo = *(_DWORD *)&_RAX->weaponCamo;
    __asm { vmovd   eax, xmm2 }
    if ( (_WORD)_RAX )
    {
      CL_Streaming_GetWeaponViewModels(&weapon, &outModelList);
      for ( i = 0i64; (unsigned int)i < outModelList.modelCount; i = (unsigned int)(i + 1) )
      {
        v11 = outModelList.models[i];
        if ( !v11 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 360, ASSERT_TYPE_ASSERT, "(model != nullptr)", (const char *)&queryFormat, "model != nullptr") )
          __debugbreak();
        if ( !Stream_TouchXModelAndCheck(v11, MIP0) )
        {
          if ( ((unsigned __int8)&s_uiStreamingAssetsMissing & 3) != 0 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\qcommon\\threads_interlock_pc.h", 37, ASSERT_TYPE_ASSERT, "( ( IsAligned( addend, sizeof( volatile_int32 ) ) ) )", "( addend ) = %p", (const void *)&s_uiStreamingAssetsMissing) )
            __debugbreak();
          _InterlockedIncrement(&s_uiStreamingAssetsMissing);
          if ( s_shouldPrintWarning )
            Com_PrintWarning(35, "CL_UIStreaming_TouchStreamingModelList: waiting for images for UI xmodel: %s\n", v11->name);
        }
      }
      BG_WeaponIsUsingCamo(&weapon);
    }
  }
}

/*
==============
CL_UIStreaming_TouchedAssetsMissing
==============
*/
__int64 CL_UIStreaming_TouchedAssetsMissing()
{
  return (unsigned int)s_uiStreamingAssetsMissingLastUpdate;
}

/*
==============
CL_UIStreaming_Transients
==============
*/
void CL_UIStreaming_Transients(__int64 a1, __int64 a2, double a3)
{
  bool v3; 
  const dvar_t *v4; 
  StreamSyncWorldType i; 
  UIStreamRequestQueue *v6; 
  unsigned int j; 
  int k; 
  StreamSyncClientType m; 
  UIStreamRequestQueue *ClientRequestQueue; 
  UIStreamRequestQueue *v11; 
  unsigned int v12; 
  UIStreamRequestQueue *v13; 
  UIStreamRequestQueue *v14; 
  unsigned int v15; 

  if ( s_uiStreamingTransientsActive )
  {
    if ( CG_FrontEndScene_ShouldBlockNewTransientRequests() )
    {
      v3 = 0;
    }
    else
    {
      v4 = DVARBOOL_frontEndPrioritizeLevelLoadTransients;
      if ( !DVARBOOL_frontEndPrioritizeLevelLoadTransients && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "frontEndPrioritizeLevelLoadTransients") )
        __debugbreak();
      Dvar_CheckFrontendServerThread(v4);
      v3 = !v4->current.enabled || !CL_UIStreaming_ShouldPrioritizeLevelPreload();
    }
    for ( i = STREAM_SYNC_WORLD_TYPE_HEAD; (unsigned int)i < STREAM_SYNC_WORLD_TYPE_COUNT; ++i )
    {
      if ( v3 )
        CL_UIStreaming_AddWorldStreamingRequests(i);
      v6 = s_uiWorldStreamRequestQueues[i];
      if ( v6 )
      {
        for ( j = 0; j < v6->requestCount; ++j )
          CL_UIStreaming_TouchStreamModels(&v6->requestItem[j], (const StreamSyncClientType)i, a3);
      }
    }
    for ( k = 0; k < 2; ++k )
    {
      if ( CL_IsLocalClientActive((LocalClientNum_t)k) )
      {
        for ( m = STREAM_SYNC_CLIENT_TYPE_FIRST_VIEW_MODEL; (unsigned int)m <= STREAM_SYNC_CLIENT_TYPE_VIEW_WEAPON; ++m )
        {
          if ( v3 )
            CL_UIStreaming_AddClientStreamingRequests((const LocalClientNum_t)k, m);
          ClientRequestQueue = CL_UIStreaming_GetClientRequestQueue((const LocalClientNum_t)k, m);
          v11 = ClientRequestQueue;
          if ( ClientRequestQueue )
          {
            v12 = 0;
            if ( ClientRequestQueue->requestCount )
            {
              do
                CL_UIStreaming_TouchStreamModels(&v11->requestItem[v12++], m, a3);
              while ( v12 < v11->requestCount );
            }
          }
        }
        if ( v3 )
          CL_UIStreaming_AddClientStreamingRequests((const LocalClientNum_t)k, STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS);
        v13 = CL_UIStreaming_GetClientRequestQueue((const LocalClientNum_t)k, STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS);
        v14 = v13;
        if ( v13 )
        {
          v15 = 0;
          if ( v13->requestCount )
          {
            do
              CL_UIStreaming_TouchStreamModels(&v14->requestItem[v15++], STREAM_SYNC_CLIENT_TYPE_CLIENT_MODELS, a3);
            while ( v15 < v14->requestCount );
          }
        }
      }
      else
      {
        CL_UIStreaming_ClearClientRequests((const LocalClientNum_t)k);
      }
    }
  }
}

/*
==============
CL_UIStreaming_Update
==============
*/
void CL_UIStreaming_Update(__int64 a1, __int64 a2, double a3)
{
  __int64 v3; 
  __int64 v4; 
  const dvar_t *v5; 
  UIStreamedImageCache *v6; 
  __int64 v7; 
  unsigned int v8; 
  unsigned int v9; 
  const GfxImage *GfxImageAtIndex; 
  __int64 v11; 
  __int64 v12; 

  if ( s_uiStreamingInitialized )
  {
    CL_UIStreaming_UpdateRequestCounts();
    CL_UIStreaming_Transients(v4, v3, a3);
    v5 = DCONST_DVARBOOL_cl_uistreaming_images;
    if ( !DCONST_DVARBOOL_cl_uistreaming_images && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "cl_uistreaming_images") )
      __debugbreak();
    Dvar_CheckFrontendServerThread(v5);
    if ( v5->current.enabled )
    {
      Sys_ProfBeginNamedEvent(0xFF808080, "CL_UIStreaming_TouchCachedImages");
      v6 = &s_uiStreamingImageCache;
      v7 = 239i64;
      do
      {
        v8 = v6->indices[0];
        if ( v6->indices[0] )
        {
          v9 = v8 - 1;
          if ( v8 - 1 >= 0x14000 )
          {
            LODWORD(v12) = 81920;
            LODWORD(v11) = v8 - 1;
            if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1622, ASSERT_TYPE_ASSERT, "(unsigned)( imageIndex ) < (unsigned)( IMAGE_POOL_SIZE )", "imageIndex doesn't index IMAGE_POOL_SIZE\n\t%i not in [0, %i)", v11, v12) )
              __debugbreak();
          }
          GfxImageAtIndex = DB_GetGfxImageAtIndex(v9);
          if ( !GfxImageAtIndex && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1625, ASSERT_TYPE_ASSERT, "( ( image != nullptr ) )", "( image ) = %p", NULL) )
            __debugbreak();
          Stream_TouchImage(GfxImageAtIndex);
        }
        v6 = (UIStreamedImageCache *)((char *)v6 + 4);
        --v7;
      }
      while ( v7 );
      Sys_ProfEndNamedEvent();
    }
  }
}

/*
==============
CL_UIStreaming_UpdateClientRequestCount
==============
*/
void CL_UIStreaming_UpdateClientRequestCount(const LocalClientNum_t localClientNum, const unsigned int requestTypeIndex)
{
  unsigned int ActiveClients; 
  unsigned int v5; 
  UIStreamRequestQueue *ClientRequestQueue; 
  unsigned int MaxRequestCount; 
  unsigned int v8; 
  int v9; 
  int v10; 

  ActiveClients = CL_UIStreaming_GetActiveClients();
  v5 = ActiveClients;
  if ( ActiveClients - 1 > 1 )
  {
    v10 = 2;
    v9 = 1;
    v8 = ActiveClients;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1106, ASSERT_TYPE_ASSERT, "( 1 ) <= ( activeClientCount ) && ( activeClientCount ) <= ( 2 )", "activeClientCount not in [1, STATIC_MAX_LOCAL_CLIENTS]\n\t%i not in [%i, %i]", v8, v9, v10) )
      __debugbreak();
  }
  ClientRequestQueue = CL_UIStreaming_GetClientRequestQueue(localClientNum, (const StreamSyncClientType)requestTypeIndex);
  if ( localClientNum >= v5 )
    MaxRequestCount = 0;
  else
    MaxRequestCount = CL_UIStreaming_GetMaxRequestCount((const StreamSyncClientType)requestTypeIndex, v5);
  CL_UIStreaming_SetMaxRequestCount(ClientRequestQueue, MaxRequestCount);
  CL_Streaming_SetMaxClientRequestCount(localClientNum, (const StreamSyncClientType)requestTypeIndex, MaxRequestCount);
}

/*
==============
CL_UIStreaming_UpdateImages
==============
*/

_BOOL8 __fastcall CL_UIStreaming_UpdateImages(double _XMM0_8)
{
  bool v2; 
  bool v3; 
  bool v4; 
  char v8; 
  const dvar_t *v9; 
  bool v10; 
  int v11; 
  unsigned int outImageCount; 
  unsigned int outModelCount; 

  if ( !Sys_IsUpdateScreenThread() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1722, ASSERT_TYPE_ASSERT, "(Sys_IsUpdateScreenThread())", (const char *)&queryFormat, "Sys_IsUpdateScreenThread()") )
    __debugbreak();
  CL_Streaming_GetPendingRequestedAssets(&outModelCount, &outImageCount);
  v2 = s_uiStreamingImagesMissing && s_uiStreamingImagesMissingTime != dword_150B56FBC;
  s_shouldPrintWarning = v2;
  dword_150B56FBC = s_uiStreamingImagesMissingTime;
  v3 = !s_uiStreamingAssetsMissing && outImageCount == s_uiStreamingAssetsMissing;
  s_uiStreamingAssetsMissingLastUpdate = s_uiStreamingAssetsMissing;
  s_uiStreamingAssetsMissing = 0;
  v4 = 1;
  if ( Stream_CanStreamMore() )
  {
    if ( Stream_LevelInit_IsDone() )
    {
      _RDI = DVARFLT_stream_syncFrontend_imageQuality;
      __asm { vmovaps [rsp+78h+var_38], xmm6 }
      if ( !DVARFLT_stream_syncFrontend_imageQuality && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 720, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "stream_syncFrontend_imageQuality") )
        __debugbreak();
      Dvar_CheckFrontendServerThread(_RDI);
      __asm { vmovss  xmm6, dword ptr [rdi+28h] }
      _XMM0_8 = Stream_LoadQuality_Image();
      __asm
      {
        vcomiss xmm0, xmm6
        vmovaps xmm6, [rsp+78h+var_38]
      }
      v4 = !v8;
    }
    v4 = v3 && v4;
  }
  if ( !Sys_IsUpdateScreenThread() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1672, ASSERT_TYPE_ASSERT, "(Sys_IsUpdateScreenThread())", (const char *)&queryFormat, "Sys_IsUpdateScreenThread()") )
    __debugbreak();
  if ( !s_uiStreamingImagesActive )
  {
    Com_FrontEndScene_SetImageStreamingComplete(0);
    Com_FrontEndScene_SetImageStreamingRequestDisabled(0);
    s_uiStreamingImagesRequestDisabled = 0;
    goto LABEL_40;
  }
  v9 = DVARBOOL_frontEndPrioritizeLevelLoadImages;
  if ( !DVARBOOL_frontEndPrioritizeLevelLoadImages && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\universal\\dvar.h", 692, ASSERT_TYPE_ASSERT, "(dvar)", "%s\n\tDvar %s accessed after deregistration", "dvar", "frontEndPrioritizeLevelLoadImages") )
    __debugbreak();
  Dvar_CheckFrontendServerThread(v9);
  v10 = v9->current.enabled && CL_UIStreaming_ShouldPrioritizeLevelPreload();
  s_uiStreamingImagesRequestDisabled = v10;
  if ( Com_FrontEndScene_IsActive() )
  {
    Com_FrontEndScene_SetImageStreamingComplete(v4);
    Com_FrontEndScene_SetImageStreamingRequestDisabled(v10);
LABEL_40:
    s_uiStreamingImagesMissing = 0;
    return s_uiStreamingImagesActive;
  }
  v11 = Sys_Milliseconds();
  if ( s_uiStreamingImagesMissingTime <= v11 )
  {
    if ( v4 )
    {
      s_uiStreamingImagesMissing = 0;
      s_uiStreamingImagesMissingTime = v11 + Dvar_GetInt_Internal_DebugName(DCONST_DVARINT_frontEndFastfilesMinTime, "frontEndFastfilesMinTime");
    }
    else
    {
      s_uiStreamingImagesMissing = 1;
      s_uiStreamingImagesMissingTime = v11 + Dvar_GetInt_Internal_DebugName(DCONST_DVARINT_frontEndStreamingMinTime, "frontEndStreamingMinTime");
      _XMM0_8 = Stream_LoadQuality_Image();
      __asm
      {
        vcvtss2sd xmm2, xmm0, xmm0
        vmovq   r8, xmm2
      }
      Com_PrintWarning(35, "CL_UIStreaming_UpdateImages_CheckRequiredImages: waiting for the required UI images. Current StreamingQuality is %.4f\n", _R8);
    }
  }
  return s_uiStreamingImagesActive;
}

/*
==============
CL_UIStreaming_UpdateRequestCounts
==============
*/
void CL_UIStreaming_UpdateRequestCounts()
{
  StreamSyncWorldType i; 
  unsigned int v1; 
  PartyData *PartyData; 
  UIStreamRequestQueue *v3; 
  unsigned int MaxRequestCount; 
  unsigned int v5; 
  int j; 
  unsigned int k; 
  __int64 v8; 
  __int64 v9; 

  if ( !s_uiStreamingTransientsActive )
    return;
  if ( CL_StreamSync_IsRunning() && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1128, ASSERT_TYPE_ASSERT, "(!CL_StreamSync_IsRunning())", (const char *)&queryFormat, "!CL_StreamSync_IsRunning()") )
    __debugbreak();
  for ( i = STREAM_SYNC_WORLD_TYPE_HEAD; (unsigned int)i < STREAM_SYNC_WORLD_TYPE_COUNT; ++i )
  {
    v1 = 1;
    if ( Lobby_IsInRunningLobby() )
    {
      PartyData = Lobby_GetPartyData();
      if ( !PartyData )
        goto LABEL_13;
    }
    else
    {
      if ( !Party_InParty(&g_partyData) )
        goto LABEL_13;
      PartyData = &g_partyData;
    }
    if ( PartyData->splitscreenData.otherClientActive )
      v1 = 2;
LABEL_13:
    v3 = s_uiWorldStreamRequestQueues[i];
    MaxRequestCount = CL_UIStreaming_GetMaxRequestCount((const StreamSyncClientType)i, v1);
    if ( MaxRequestCount > v3->maxRequestCount )
    {
      LODWORD(v9) = v3->maxRequestCount;
      LODWORD(v8) = MaxRequestCount;
      if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\client\\cl_ui_streaming.cpp", 1096, ASSERT_TYPE_ASSERT, "( maxRequestCount ) <= ( requestQueue->maxRequestCount )", "maxRequestCount not in [0, requestQueue->maxRequestCount]\n\t%u not in [0, %u]", v8, v9) )
        __debugbreak();
    }
    if ( v3->requestCount > MaxRequestCount )
    {
      do
      {
        DebugWipe(&v3->requestItem[v3->requestCount], 0x244ui64);
        v5 = v3->requestCount - 1;
        v3->requestCount = v5;
      }
      while ( v5 > MaxRequestCount );
    }
    v3->maxRequestCount = MaxRequestCount;
    CL_Streaming_SetMaxWorldRequestCount(i, MaxRequestCount);
  }
  for ( j = 0; j < 2; ++j )
  {
    for ( k = 3; k <= 4; ++k )
      CL_UIStreaming_UpdateClientRequestCount((const LocalClientNum_t)j, k);
    CL_UIStreaming_UpdateClientRequestCount((const LocalClientNum_t)j, 5u);
  }
}

