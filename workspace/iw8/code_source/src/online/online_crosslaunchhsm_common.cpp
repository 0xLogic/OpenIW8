/*
==============
CrosslaunchHSM::HandleHSMCallback_WaitForControllerToBeActive
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_WaitForControllerToBeActive(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_WaitForControllerToBeActive@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_DeterminingControllerTimeout
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_DeterminingControllerTimeout(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_DeterminingControllerTimeout@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::CleanupCrosslaunch
==============
*/

void __fastcall CrosslaunchHSM::CleanupCrosslaunch(CrosslaunchHSM *this)
{
  ?CleanupCrosslaunch@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_WaitForTargetMenu
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_WaitForTargetMenu(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_WaitForTargetMenu@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::TriggerEvent
==============
*/

void __fastcall CrosslaunchHSM::TriggerEvent(CrosslaunchHSM *this, CrosslaunchHSM_base::eHSMEvents event)
{
  ?TriggerEvent@CrosslaunchHSM@@AEAAXW4eHSMEvents@CrosslaunchHSM_base@@@Z(this, event);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_CrosslaunchCancelledByUser
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_CrosslaunchCancelledByUser(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_CrosslaunchCancelledByUser@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::~CrosslaunchHSM
==============
*/

void __fastcall CrosslaunchHSM::~CrosslaunchHSM(CrosslaunchHSM *this)
{
  ??1CrosslaunchHSM@@UEAA@XZ(this);
}

/*
==============
CrosslaunchHSM::Initialize
==============
*/

void __fastcall CrosslaunchHSM::Initialize(CrosslaunchHSM *this)
{
  ?Initialize@CrosslaunchHSM@@QEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::IsHandlingCrosslaunch
==============
*/

bool __fastcall CrosslaunchHSM::IsHandlingCrosslaunch(CrosslaunchHSM *this)
{
  return ?IsHandlingCrosslaunch@CrosslaunchHSM@@QEAA_NXZ(this);
}

/*
==============
CrosslaunchHSM::StartCrosslaunchAsHostToWarzone
==============
*/

bool __fastcall CrosslaunchHSM::StartCrosslaunchAsHostToWarzone(CrosslaunchHSM *this, XUID xuid)
{
  return ?StartCrosslaunchAsHostToWarzone@CrosslaunchHSM@@QEAA_NUXUID@@@Z(this, xuid);
}

/*
==============
CrosslaunchHSM::HSM_PrintDebugInfo
==============
*/

void __fastcall CrosslaunchHSM::HSM_PrintDebugInfo(CrosslaunchHSM *this, const char *pDebugString)
{
  ?HSM_PrintDebugInfo@CrosslaunchHSM@@EEAAXPEBD@Z(this, pDebugString);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_ActivateController
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_ActivateController(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_ActivateController@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_DetermineCrosslaunchControllerStart
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_DetermineCrosslaunchControllerStart(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_DetermineCrosslaunchControllerStart@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_MovingToTargetMenuTimeout
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_MovingToTargetMenuTimeout(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_MovingToTargetMenuTimeout@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::UserCancelCrosslaunch
==============
*/

void __fastcall CrosslaunchHSM::UserCancelCrosslaunch(CrosslaunchHSM *this)
{
  ?UserCancelCrosslaunch@CrosslaunchHSM@@QEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_StartMovingToTargetMenu
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_StartMovingToTargetMenu(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_StartMovingToTargetMenu@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::CleanupForCrosslaunchFailures
==============
*/

void __fastcall CrosslaunchHSM::CleanupForCrosslaunchFailures(CrosslaunchHSM *this)
{
  ?CleanupForCrosslaunchFailures@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_WaitForDeterminingCrosslaunchController
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_WaitForDeterminingCrosslaunchController(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_WaitForDeterminingCrosslaunchController@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::CrosslaunchHSM
==============
*/

void __fastcall CrosslaunchHSM::CrosslaunchHSM(CrosslaunchHSM *this)
{
  ??0CrosslaunchHSM@@QEAA@XZ(this);
}

/*
==============
CrosslaunchHSM::CrosslauncHSMUpdate
==============
*/

void __fastcall CrosslaunchHSM::CrosslauncHSMUpdate(CrosslaunchHSM *this, int dt)
{
  ?CrosslauncHSMUpdate@CrosslaunchHSM@@QEAAXH@Z(this, dt);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_ActivateControllerTimeout
==============
*/

void __fastcall CrosslaunchHSM::HandleHSMCallback_ActivateControllerTimeout(CrosslaunchHSM *this)
{
  ?HandleHSMCallback_ActivateControllerTimeout@CrosslaunchHSM@@EEAAXXZ(this);
}

/*
==============
CrosslaunchHSM::ShouldShowCrosslaunchingPopup
==============
*/

bool __fastcall CrosslaunchHSM::ShouldShowCrosslaunchingPopup(CrosslaunchHSM *this)
{
  return ?ShouldShowCrosslaunchingPopup@CrosslaunchHSM@@QEAA_NXZ(this);
}

/*
==============
CrosslaunchHSM::CrosslaunchHSM
==============
*/
void CrosslaunchHSM::CrosslaunchHSM(CrosslaunchHSM *this)
{
  const XUID *v2; 
  XUID result; 

  CrosslaunchHSM_base::CrosslaunchHSM_base(this);
  this->__vftable = (CrosslaunchHSM_vtbl *)&CrosslaunchHSM::`vftable';
  XUID::XUID(&this->m_pendingCrosslaunchXuid);
  this->m_pendingCrosslaunchController = -1;
  v2 = XUID::NullXUID(&result);
  XUID::operator=(&this->m_pendingCrosslaunchXuid, v2);
  *(_WORD *)&this->m_hasBeenInitialized = 0;
  this->m_HSMVerboseDebug = 1;
  this->m_didWeComErrorDuringUpdate = 0;
}

/*
==============
CrosslaunchHSM::~CrosslaunchHSM
==============
*/
void CrosslaunchHSM::~CrosslaunchHSM(CrosslaunchHSM *this)
{
  this->__vftable = (CrosslaunchHSM_vtbl *)&CrosslaunchHSM::`vftable';
  this->m_hasBeenInitialized = 0;
  this->m_HSMVerboseDebug = 0;
  CrosslaunchHSM_base::HSM_Shutdown(this);
  CrosslaunchHSM_base::~CrosslaunchHSM_base(this);
}

/*
==============
CrosslaunchHSM::CleanupCrosslaunch
==============
*/
void CrosslaunchHSM::CleanupCrosslaunch(CrosslaunchHSM *this)
{
  const XUID *v2; 
  XUID result; 

  Com_Printf(25, ">>>>> CleanupCrosslaunch()\n");
  this->m_pendingCrosslaunchController = -1;
  v2 = XUID::NullXUID(&result);
  XUID::operator=(&this->m_pendingCrosslaunchXuid, v2);
  this->m_targetMenu = SPECTATOR;
}

/*
==============
CrosslaunchHSM::CleanupForCrosslaunchFailures
==============
*/
void CrosslaunchHSM::CleanupForCrosslaunchFailures(CrosslaunchHSM *this)
{
  Com_Printf(25, ">>>>> CleanupForCrosslaunchFailures()\n");
  this->CleanupCrosslaunch(this);
}

/*
==============
CrosslaunchHSM::CrosslauncHSMUpdate
==============
*/
void CrosslaunchHSM::CrosslauncHSMUpdate(CrosslaunchHSM *this, int dt)
{
  if ( this->m_didWeComErrorDuringUpdate && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\online_crosslaunchhsm_common.cpp", 112, ASSERT_TYPE_ASSERT, "(!m_didWeComErrorDuringUpdate)", (const char *)&queryFormat, "!m_didWeComErrorDuringUpdate") )
    __debugbreak();
  this->m_didWeComErrorDuringUpdate = 1;
  if ( CrosslaunchHSM_base::HSM_GetCurrentState(this) == st_generic_com_error_next_frame_with_msg )
  {
    CrosslaunchHSM_base::HSM_TriggerEvent(this, INVITE_RECEIVED);
    CrosslaunchHSM_base::HSM_Update(this, dt);
    this->m_didWeComErrorDuringUpdate = 0;
    Live_ThrowError(ERR_DROP, (const char *)&stru_143DD5890);
  }
  else
  {
    CrosslaunchHSM_base::HSM_Update(this, dt);
    this->m_didWeComErrorDuringUpdate = 0;
  }
}

/*
==============
CrosslaunchHSM::HSM_PrintDebugInfo
==============
*/
void CrosslaunchHSM::HSM_PrintDebugInfo(CrosslaunchHSM *this, const char *pDebugString)
{
  Com_Printf(16, "CrosslaunchHSM DEBUG: controller id %d : %s", (unsigned int)this->m_pendingCrosslaunchController, pDebugString);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_ActivateController
==============
*/
void CrosslaunchHSM::HandleHSMCallback_ActivateController(CrosslaunchHSM *this)
{
  int m_pendingCrosslaunchController; 
  int v3; 

  if ( this->m_pendingCrosslaunchController >= 8u )
  {
    v3 = 8;
    m_pendingCrosslaunchController = this->m_pendingCrosslaunchController;
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\online_crosslaunchhsm_common.cpp", 231, ASSERT_TYPE_ASSERT, "(unsigned)( m_pendingCrosslaunchController ) < (unsigned)( 8 )", "m_pendingCrosslaunchController doesn't index MAX_GPAD_COUNT\n\t%i not in [0, %i)", m_pendingCrosslaunchController, v3) )
      __debugbreak();
  }
  CL_Mgr_ActivateClient(LOCAL_CLIENT_0, this->m_pendingCrosslaunchController);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_ActivateControllerTimeout
==============
*/
void CrosslaunchHSM::HandleHSMCallback_ActivateControllerTimeout(CrosslaunchHSM *this)
{
  OnlineErrorManager::SetLastRecordedErrorCode(&g_onlineMgr.m_errorManager, COUNT, NULL);
  Com_SetErrorMessage((const char *)&stru_143DD5890);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_CrosslaunchCancelledByUser
==============
*/
void CrosslaunchHSM::HandleHSMCallback_CrosslaunchCancelledByUser(CrosslaunchHSM *this)
{
  Com_Printf(25, "CrosslaunchHSM::HandleHSMCallback_CrosslaunchCancelledByUser\n");
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_DetermineCrosslaunchControllerStart
==============
*/
void CrosslaunchHSM::HandleHSMCallback_DetermineCrosslaunchControllerStart(CrosslaunchHSM *this)
{
  ;
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_DeterminingControllerTimeout
==============
*/
void CrosslaunchHSM::HandleHSMCallback_DeterminingControllerTimeout(CrosslaunchHSM *this)
{
  OnlineErrorManager::SetLastRecordedErrorCode(&g_onlineMgr.m_errorManager, DODGE, NULL);
  Com_SetErrorMessage((const char *)&stru_143DD5890);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_MovingToTargetMenuTimeout
==============
*/
void CrosslaunchHSM::HandleHSMCallback_MovingToTargetMenuTimeout(CrosslaunchHSM *this)
{
  OnlineErrorManager::SetLastRecordedErrorCode(&g_onlineMgr.m_errorManager, (Online_Error_CAT_CROSSLAUNCH_t)4, NULL);
  Com_SetErrorMessage((const char *)&stru_143DD5890);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_StartMovingToTargetMenu
==============
*/
void CrosslaunchHSM::HandleHSMCallback_StartMovingToTargetMenu(CrosslaunchHSM *this)
{
  PartyUI_OpenMenu(LOCAL_CLIENT_0, AERIAL|FREE|0x10, 1);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_WaitForControllerToBeActive
==============
*/
void CrosslaunchHSM::HandleHSMCallback_WaitForControllerToBeActive(CrosslaunchHSM *this)
{
  if ( CL_Mgr_IsControllerActive(this->m_pendingCrosslaunchController) )
    CrosslaunchHSM_base::HSM_TriggerEvent(this, INVITE_CANT_DETERMINE_CONTROLLER_PAIRING);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_WaitForDeterminingCrosslaunchController
==============
*/
void CrosslaunchHSM::HandleHSMCallback_WaitForDeterminingCrosslaunchController(CrosslaunchHSM *this)
{
  int v2; 
  const XUID *Xuid; 
  XUID result; 

  if ( !XUID::IsValid(&this->m_pendingCrosslaunchXuid) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\online_crosslaunchhsm_common.cpp", 211, ASSERT_TYPE_ASSERT, "(m_pendingCrosslaunchXuid.IsValid())", (const char *)&queryFormat, "m_pendingCrosslaunchXuid.IsValid()") )
    __debugbreak();
  if ( this->m_pendingCrosslaunchController != -1 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\online_crosslaunchhsm_common.cpp", 212, ASSERT_TYPE_ASSERT, "(m_pendingCrosslaunchController == (-1))", (const char *)&queryFormat, "m_pendingCrosslaunchController == INVALID_CONTROLLER_PORT") )
    __debugbreak();
  v2 = 0;
  while ( 1 )
  {
    if ( Live_IsUserSignedInToLive(v2) )
    {
      Xuid = Live_GetXuid(&result, v2);
      if ( XUID::operator==(&this->m_pendingCrosslaunchXuid, Xuid) )
        break;
    }
    if ( ++v2 >= 8 )
      return;
  }
  this->m_pendingCrosslaunchController = v2;
  CrosslaunchHSM_base::HSM_TriggerEvent(this, START_JOINING_LOBBY);
}

/*
==============
CrosslaunchHSM::HandleHSMCallback_WaitForTargetMenu
==============
*/
void CrosslaunchHSM::HandleHSMCallback_WaitForTargetMenu(CrosslaunchHSM *this)
{
  LocalClientNum_t ClientFromController; 
  const char *menuName; 
  const TargetMenuInfo *v4; 
  int v5; 

  ClientFromController = CL_Mgr_GetClientFromController(this->m_pendingCrosslaunchController);
  if ( CL_Mgr_IsClientActive(ClientFromController) )
  {
    menuName = NULL;
    v4 = s_targetMenuInfo;
    v5 = 0;
    while ( v4->uiRoot != this->m_targetMenu )
    {
      ++v5;
      ++v4;
      if ( v5 )
        goto LABEL_7;
    }
    menuName = s_targetMenuInfo[v5].menuName;
LABEL_7:
    if ( LUI_IsMenuOpenAndVisible(ClientFromController, menuName) )
      CrosslaunchHSM_base::HSM_TriggerEvent(this, EULA_VERIFIED);
  }
}

/*
==============
CrosslaunchHSM::Initialize
==============
*/
void CrosslaunchHSM::Initialize(CrosslaunchHSM *this)
{
  if ( !this->m_hasBeenInitialized )
  {
    CrosslaunchHSM_base::HSM_Init(this);
    this->m_hasBeenInitialized = 1;
    if ( XUID::IsValid(&this->m_pendingCrosslaunchXuid) )
      CrosslaunchHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_ERROR_NO_MSG);
  }
}

/*
==============
CrosslaunchHSM::IsHandlingCrosslaunch
==============
*/
bool CrosslaunchHSM::IsHandlingCrosslaunch(CrosslaunchHSM *this)
{
  bool result; 

  if ( CrosslaunchHSM_base::HSM_IsInState(this, st_atomic_join_fence_timeout) )
    return 1;
  result = CrosslaunchHSM_base::HSM_IsInState(this, st_session_search_timeout);
  if ( result )
    return 1;
  return result;
}

/*
==============
CrosslaunchHSM::ShouldShowCrosslaunchingPopup
==============
*/
bool CrosslaunchHSM::ShouldShowCrosslaunchingPopup(CrosslaunchHSM *this)
{
  bool result; 

  if ( CrosslaunchHSM_base::HSM_IsInState(this, st_atomic_join_fence_timeout) )
    return 1;
  result = CrosslaunchHSM_base::HSM_IsInState(this, st_session_search_timeout);
  if ( result )
    return 1;
  return result;
}

/*
==============
CrosslaunchHSM::StartCrosslaunchAsHostToWarzone
==============
*/
char CrosslaunchHSM::StartCrosslaunchAsHostToWarzone(CrosslaunchHSM *this, XUID xuid)
{
  const XUID *v3; 
  const TargetMenuInfo *v4; 
  int v5; 
  XUID xuida; 
  XUID result; 

  xuida.m_id = xuid.m_id;
  if ( CrosslaunchHSM_base::HSM_IsInState(this, st_atomic_join_fence_timeout) || CrosslaunchHSM_base::HSM_IsInState(this, st_session_search_timeout) )
  {
    Com_Printf(25, "CrosslaunchHSM::StartCrosslaunchAsHostToWarzone, ignoring because are already crosslaunching\n");
    return 0;
  }
  else
  {
    if ( this->m_pendingCrosslaunchController != -1 && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\online_crosslaunchhsm_common.cpp", 172, ASSERT_TYPE_ASSERT, "(m_pendingCrosslaunchController == (-1))", (const char *)&queryFormat, "m_pendingCrosslaunchController == INVALID_CONTROLLER_PORT") )
      __debugbreak();
    v3 = XUID::NullXUID(&result);
    if ( !XUID::operator==(&this->m_pendingCrosslaunchXuid, v3) && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\online_crosslaunchhsm_common.cpp", 173, ASSERT_TYPE_ASSERT, "(m_pendingCrosslaunchXuid == XUID::NullXUID())", (const char *)&queryFormat, "m_pendingCrosslaunchXuid == XUID::NullXUID()") )
      __debugbreak();
    if ( this->m_targetMenu && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\online_crosslaunchhsm_common.cpp", 174, ASSERT_TYPE_ASSERT, "(m_targetMenu == PartyUIRoot::FREE)", (const char *)&queryFormat, "m_targetMenu == PartyUIRoot::FREE") )
      __debugbreak();
    XUID::operator=(&this->m_pendingCrosslaunchXuid, &xuida);
    v4 = s_targetMenuInfo;
    this->m_targetMenu = AERIAL|FREE|0x10;
    v5 = 0;
    while ( v4->uiRoot != (AERIAL|FREE|0x10) )
    {
      ++v5;
      ++v4;
      if ( v5 )
        goto LABEL_17;
    }
    if ( s_targetMenuInfo[v5].menuName )
      goto LABEL_19;
LABEL_17:
    if ( CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\online_crosslaunchhsm_common.cpp", 180, ASSERT_TYPE_ASSERT, "(GetTargetMenuNameForUIRoot( m_targetMenu ) != nullptr)", (const char *)&queryFormat, "GetTargetMenuNameForUIRoot( m_targetMenu ) != nullptr") )
      __debugbreak();
LABEL_19:
    if ( this->m_hasBeenInitialized )
      CrosslaunchHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_ERROR_NO_MSG);
    return 1;
  }
}

/*
==============
CrosslaunchHSM::TriggerEvent
==============
*/

void __fastcall CrosslaunchHSM::TriggerEvent(CrosslaunchHSM *this, CrosslaunchHSM_base::eHSMEvents event)
{
  CrosslaunchHSM_base::HSM_TriggerEvent(this, event);
}

/*
==============
CrosslaunchHSM::UserCancelCrosslaunch
==============
*/
void CrosslaunchHSM::UserCancelCrosslaunch(CrosslaunchHSM *this)
{
  if ( CrosslaunchHSM_base::HSM_IsInState(this, st_atomic_join_fence_timeout) || CrosslaunchHSM_base::HSM_IsInState(this, st_session_search_timeout) )
    CrosslaunchHSM_base::HSM_TriggerEvent(this, START_JOINING_USER_WITH_XUID);
}

