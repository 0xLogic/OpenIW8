/*
==============
dwLogonHSM_xb3::StartCrossAuthentication
==============
*/

void __fastcall dwLogonHSM_xb3::StartCrossAuthentication(dwLogonHSM_xb3 *this)
{
  ?StartCrossAuthentication@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::LogOnStart
==============
*/

void __fastcall dwLogonHSM_xb3::LogOnStart(dwLogonHSM_xb3 *this)
{
  ?LogOnStart@dwLogonHSM_xb3@@QEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::LogonHSMUpdate
==============
*/

void __fastcall dwLogonHSM_xb3::LogonHSMUpdate(dwLogonHSM_xb3 *this, int dt)
{
  ?LogonHSMUpdate@dwLogonHSM_xb3@@QEAAXH@Z(this, dt);
}

/*
==============
dwLogonHSM_xb3::dwLogonHSM_xb3
==============
*/

void __fastcall dwLogonHSM_xb3::dwLogonHSM_xb3(dwLogonHSM_xb3 *this)
{
  ??0dwLogonHSM_xb3@@QEAA@XZ(this);
}

/*
==============
dwLogonHSM_xb3::IsAnotherUserAuthenticating
==============
*/

bool __fastcall dwLogonHSM_xb3::IsAnotherUserAuthenticating(dwLogonHSM_xb3 *this)
{
  return ?IsAnotherUserAuthenticating@dwLogonHSM_xb3@@AEAA_NXZ(this);
}

/*
==============
dwLogonHSM_xb3::Initialize
==============
*/

void __fastcall dwLogonHSM_xb3::Initialize(dwLogonHSM_xb3 *this, int controllerIndex)
{
  ?Initialize@dwLogonHSM_xb3@@QEAAXH@Z(this, controllerIndex);
}

/*
==============
dwLogonHSM_xb3::ClearLogonAttemptCount
==============
*/

void __fastcall dwLogonHSM_xb3::ClearLogonAttemptCount(dwLogonHSM_xb3 *this)
{
  ?ClearLogonAttemptCount@dwLogonHSM_xb3@@QEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::HandleAuthError
==============
*/

void __fastcall dwLogonHSM_xb3::HandleAuthError(dwLogonHSM_xb3 *this)
{
  ?HandleAuthError@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::PumpRegionInfo
==============
*/

void __fastcall dwLogonHSM_xb3::PumpRegionInfo(dwLogonHSM_xb3 *this)
{
  ?PumpRegionInfo@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::PumpAntiCheat
==============
*/

void __fastcall dwLogonHSM_xb3::PumpAntiCheat(dwLogonHSM_xb3 *this)
{
  ?PumpAntiCheat@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::Shutdown
==============
*/

void __fastcall dwLogonHSM_xb3::Shutdown(dwLogonHSM_xb3 *this)
{
  ?Shutdown@dwLogonHSM_xb3@@QEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::UpdateLobbyConnectStart
==============
*/

void __fastcall dwLogonHSM_xb3::UpdateLobbyConnectStart(dwLogonHSM_xb3 *this)
{
  ?UpdateLobbyConnectStart@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::DetermineStartOrWait
==============
*/

void __fastcall dwLogonHSM_xb3::DetermineStartOrWait(dwLogonHSM_xb3 *this)
{
  ?DetermineStartOrWait@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::UpdateConsoleWaitForAuthReply
==============
*/

void __fastcall dwLogonHSM_xb3::UpdateConsoleWaitForAuthReply(dwLogonHSM_xb3 *this)
{
  ?UpdateConsoleWaitForAuthReply@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::PumpAuthTicketRefresh
==============
*/

void __fastcall dwLogonHSM_xb3::PumpAuthTicketRefresh(dwLogonHSM_xb3 *this)
{
  ?PumpAuthTicketRefresh@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::UpdateQueueStatus
==============
*/

void __fastcall dwLogonHSM_xb3::UpdateQueueStatus(dwLogonHSM_xb3 *this)
{
  ?UpdateQueueStatus@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::~dwLogonHSM_xb3
==============
*/

void __fastcall dwLogonHSM_xb3::~dwLogonHSM_xb3(dwLogonHSM_xb3 *this)
{
  ??1dwLogonHSM_xb3@@UEAA@XZ(this);
}

/*
==============
dwLogonHSM_xb3::CheckForDemonwareDisconnect
==============
*/

void __fastcall dwLogonHSM_xb3::CheckForDemonwareDisconnect(dwLogonHSM_xb3 *this)
{
  ?CheckForDemonwareDisconnect@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::OnExitUserAuthenticated
==============
*/

void __fastcall dwLogonHSM_xb3::OnExitUserAuthenticated(dwLogonHSM_xb3 *this)
{
  ?OnExitUserAuthenticated@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::HSM_PrintDebugInfo
==============
*/

void __fastcall dwLogonHSM_xb3::HSM_PrintDebugInfo(dwLogonHSM_xb3 *this, const char *pDebugString)
{
  ?HSM_PrintDebugInfo@dwLogonHSM_xb3@@UEAAXPEBD@Z(this, pDebugString);
}

/*
==============
dwLogonHSM_xb3::ClearConnectInterval
==============
*/

void __fastcall dwLogonHSM_xb3::ClearConnectInterval(dwLogonHSM_xb3 *this)
{
  ?ClearConnectInterval@dwLogonHSM_xb3@@QEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::UpdateLobbyConnect
==============
*/

void __fastcall dwLogonHSM_xb3::UpdateLobbyConnect(dwLogonHSM_xb3 *this)
{
  ?UpdateLobbyConnect@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::UpdateResolveAuthService
==============
*/

void __fastcall dwLogonHSM_xb3::UpdateResolveAuthService(dwLogonHSM_xb3 *this)
{
  ?UpdateResolveAuthService@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::LobbyServiceCleanup
==============
*/

void __fastcall dwLogonHSM_xb3::LobbyServiceCleanup(dwLogonHSM_xb3 *this)
{
  ?LobbyServiceCleanup@dwLogonHSM_xb3@@QEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::OnEnterUserAuthenticated
==============
*/

void __fastcall dwLogonHSM_xb3::OnEnterUserAuthenticated(dwLogonHSM_xb3 *this)
{
  ?OnEnterUserAuthenticated@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::UpdateConsoleStartAuthorize
==============
*/

void __fastcall dwLogonHSM_xb3::UpdateConsoleStartAuthorize(dwLogonHSM_xb3 *this)
{
  ?UpdateConsoleStartAuthorize@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::UpdateWaitForAccountRegistration
==============
*/

void __fastcall dwLogonHSM_xb3::UpdateWaitForAccountRegistration(dwLogonHSM_xb3 *this)
{
  ?UpdateWaitForAccountRegistration@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::dwDNSCleanup
==============
*/

void __fastcall dwLogonHSM_xb3::dwDNSCleanup(dwLogonHSM_xb3 *this)
{
  ?dwDNSCleanup@dwLogonHSM_xb3@@AEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::OnUserSignout
==============
*/

void __fastcall dwLogonHSM_xb3::OnUserSignout(dwLogonHSM_xb3 *this)
{
  ?OnUserSignout@dwLogonHSM_xb3@@QEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::OnEnterAuthTicketRefresh
==============
*/

void __fastcall dwLogonHSM_xb3::OnEnterAuthTicketRefresh(dwLogonHSM_xb3 *this)
{
  ?OnEnterAuthTicketRefresh@dwLogonHSM_xb3@@UEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::Dev_FakeError
==============
*/

void __fastcall dwLogonHSM_xb3::Dev_FakeError(dwLogonHSM_xb3 *this)
{
  ?Dev_FakeError@dwLogonHSM_xb3@@QEAAXXZ(this);
}

/*
==============
dwLogonHSM_xb3::dwLogonHSM_xb3
==============
*/
void dwLogonHSM_xb3::dwLogonHSM_xb3(dwLogonHSM_xb3 *this)
{
  dwLogOnHSM_base::dwLogOnHSM_base(this);
  this->__vftable = (dwLogonHSM_xb3_vtbl *)&dwLogonHSM_xb3::`vftable';
  bdSockAddr::bdSockAddr(&this->m_lsgAddr);
  this->m_controllerIndex = -1;
  this->m_lsgGetHostByName = NULL;
  *(_QWORD *)&this->m_connectInterval = 0i64;
  this->m_lastLogOnAttemptTime = 0;
  this->m_authTicketReauthorizeTime_s = 0i64;
}

/*
==============
dwLogonHSM_xb3::~dwLogonHSM_xb3
==============
*/
void dwLogonHSM_xb3::~dwLogonHSM_xb3(dwLogonHSM_xb3 *this)
{
  bdGetHostByName *m_lsgGetHostByName; 

  this->__vftable = (dwLogonHSM_xb3_vtbl *)&dwLogonHSM_xb3::`vftable';
  m_lsgGetHostByName = this->m_lsgGetHostByName;
  if ( m_lsgGetHostByName )
  {
    ((void (__fastcall *)(bdGetHostByName *, __int64))m_lsgGetHostByName->~bdRunnable)(m_lsgGetHostByName, 1i64);
    this->m_lsgGetHostByName = NULL;
  }
  dwLogOnHSM_base::HSM_Shutdown(this);
  dwLogOnHSM_base::~dwLogOnHSM_base(this);
}

/*
==============
dwLogonHSM_xb3::CheckForDemonwareDisconnect
==============
*/
void dwLogonHSM_xb3::CheckForDemonwareDisconnect(dwLogonHSM_xb3 *this)
{
  DWServicesAccess *Instance; 
  DWLobbyService *DWLobbyService; 

  Instance = DWServicesAccess::GetInstance();
  DWLobbyService = DWServicesAccess::GetDWLobbyService(Instance, this->m_controllerIndex);
  if ( (unsigned int)(DWLobbyService::getStatus(DWLobbyService) - 2) > 2 )
  {
    Live_DemonwareDisconnected(this->m_controllerIndex);
    dwLogOnHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_COM_ERROR);
  }
}

/*
==============
dwLogonHSM_xb3::ClearConnectInterval
==============
*/
void dwLogonHSM_xb3::ClearConnectInterval(dwLogonHSM_xb3 *this)
{
  this->m_connectInterval = 0;
}

/*
==============
dwLogonHSM_xb3::ClearLogonAttemptCount
==============
*/
void dwLogonHSM_xb3::ClearLogonAttemptCount(dwLogonHSM_xb3 *this)
{
  this->m_numLogOnAttempts = 0;
}

/*
==============
dwLogonHSM_xb3::DetermineStartOrWait
==============
*/
void dwLogonHSM_xb3::DetermineStartOrWait(dwLogonHSM_xb3 *this)
{
  int v2; 
  int m_controllerIndex; 
  __int64 v4; 
  bool v5; 

  v2 = 0;
  while ( 1 )
  {
    m_controllerIndex = this->m_controllerIndex;
    v4 = v2;
    v5 = v2 == m_controllerIndex;
    if ( v2 < m_controllerIndex )
    {
      if ( dwLogOnHSM_base::HSM_IsInState(&g_dwLogonHSMs[v4], st_generic_com_error_next_frame_with_msg) )
        return;
      v5 = v2 == this->m_controllerIndex;
    }
    if ( !v5 && dwLogOnHSM_base::HSM_IsInState(&g_dwLogonHSMs[v4], st_invitee_permissions_timeout) )
      break;
    if ( ++v2 >= 8 )
    {
      if ( Live_ShouldControllerStartLogon(this->m_controllerIndex) )
        dwLogOnHSM_base::HSM_TriggerEvent(this, START_JOINING_USER_WITH_PLATFORM_ID);
      return;
    }
  }
}

/*
==============
dwLogonHSM_xb3::Dev_FakeError
==============
*/
void dwLogonHSM_xb3::Dev_FakeError(dwLogonHSM_xb3 *this)
{
  dwLogOnHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_COM_ERROR);
}

/*
==============
dwLogonHSM_xb3::HSM_PrintDebugInfo
==============
*/
void dwLogonHSM_xb3::HSM_PrintDebugInfo(dwLogonHSM_xb3 *this, const char *pDebugString)
{
  Com_Printf(16, "HSM DEBUG: controller id %d : %s", (unsigned int)this->m_controllerIndex, pDebugString);
}

/*
==============
dwLogonHSM_xb3::HandleAuthError
==============
*/
void dwLogonHSM_xb3::HandleAuthError(dwLogonHSM_xb3 *this)
{
  bdGetHostByName *m_lsgGetHostByName; 
  DWServicesAccess *Instance; 
  DWServicesAccess *v4; 
  DWLobbyService *DWLobbyService; 

  m_lsgGetHostByName = this->m_lsgGetHostByName;
  if ( m_lsgGetHostByName )
  {
    ((void (__fastcall *)(bdGetHostByName *, __int64))m_lsgGetHostByName->~bdRunnable)(m_lsgGetHostByName, 1i64);
    this->m_lsgGetHostByName = NULL;
  }
  Instance = DWServicesAccess::GetInstance();
  DWServicesAccess::AuthServiceCleanup(Instance, this->m_controllerIndex);
  v4 = DWServicesAccess::GetInstance();
  DWLobbyService = DWServicesAccess::GetDWLobbyService(v4, this->m_controllerIndex);
  DWLobbyService::disconnect(DWLobbyService);
}

/*
==============
dwLogonHSM_xb3::Initialize
==============
*/
void dwLogonHSM_xb3::Initialize(dwLogonHSM_xb3 *this, int controllerIndex)
{
  this->m_controllerIndex = controllerIndex;
  *(_QWORD *)&this->m_connectInterval = 0i64;
  this->m_lastLogOnAttemptTime = 0;
  dwLogOnHSM_base::HSM_Init(this);
}

/*
==============
dwLogonHSM_xb3::IsAnotherUserAuthenticating
==============
*/
char dwLogonHSM_xb3::IsAnotherUserAuthenticating(dwLogonHSM_xb3 *this)
{
  int v2; 
  int m_controllerIndex; 
  __int64 v4; 
  bool v5; 

  v2 = 0;
  while ( 1 )
  {
    m_controllerIndex = this->m_controllerIndex;
    v4 = v2;
    v5 = v2 == m_controllerIndex;
    if ( v2 < m_controllerIndex )
    {
      if ( dwLogOnHSM_base::HSM_IsInState(&g_dwLogonHSMs[v4], st_generic_com_error_next_frame_with_msg) )
        return 1;
      v5 = v2 == this->m_controllerIndex;
    }
    if ( !v5 && dwLogOnHSM_base::HSM_IsInState(&g_dwLogonHSMs[v4], st_invitee_permissions_timeout) )
      break;
    if ( ++v2 >= 8 )
      return 0;
  }
  return 1;
}

/*
==============
dwLogonHSM_xb3::LobbyServiceCleanup
==============
*/
void dwLogonHSM_xb3::LobbyServiceCleanup(dwLogonHSM_xb3 *this)
{
  dwLogOnHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_COM_ERROR);
}

/*
==============
dwLogonHSM_xb3::LogOnStart
==============
*/
void dwLogonHSM_xb3::LogOnStart(dwLogonHSM_xb3 *this)
{
  int v2; 
  int m_numLogOnAttempts; 
  int v4; 
  int v5; 
  signed int m_connectInterval; 
  __int64 v7; 

  if ( Live_IsUserSignedInToLive(this->m_controllerIndex) && !Live_UserIsGuest(this->m_controllerIndex) && !dwAllDemonWareReconnectsDisabled() )
  {
    v2 = Sys_Milliseconds();
    m_numLogOnAttempts = this->m_numLogOnAttempts;
    v4 = v2;
    v5 = (v2 - this->m_lastLogOnAttemptTime) / 1000;
    if ( !m_numLogOnAttempts )
    {
LABEL_11:
      v7 = (unsigned int)(m_numLogOnAttempts + 1);
      this->m_connectInterval = 0;
      this->m_numLogOnAttempts = v7;
      this->m_lastLogOnAttemptTime = v4;
      Com_Printf(16, "Starting DW connect: attempt %u, time since last connect %us. Skipping enumeration step.\n", v7, (unsigned int)v5);
      dwLogOnHSM_base::HSM_TriggerEvent(this, INVITE_RECEIVED);
      return;
    }
    if ( v5 > 120 )
    {
      m_numLogOnAttempts = 0;
      goto LABEL_11;
    }
    m_connectInterval = this->m_connectInterval;
    if ( !m_connectInterval )
    {
      m_connectInterval = Live_GenerateRandomTimeToRetryInSeconds(m_numLogOnAttempts, 0x3Cu);
      this->m_connectInterval = m_connectInterval;
    }
    if ( v5 >= m_connectInterval )
    {
      m_numLogOnAttempts = this->m_numLogOnAttempts;
      goto LABEL_11;
    }
  }
}

/*
==============
dwLogonHSM_xb3::LogonHSMUpdate
==============
*/

void __fastcall dwLogonHSM_xb3::LogonHSMUpdate(dwLogonHSM_xb3 *this, int dt)
{
  dwLogOnHSM_base::HSM_Update(this, dt);
}

/*
==============
dwLogonHSM_xb3::OnEnterAuthTicketRefresh
==============
*/
void dwLogonHSM_xb3::OnEnterAuthTicketRefresh(dwLogonHSM_xb3 *this)
{
  bool started; 
  __int64 m_controllerIndex; 

  started = StartLogin(this->m_controllerIndex);
  m_controllerIndex = (unsigned int)this->m_controllerIndex;
  if ( started )
  {
    Com_Printf(25, "dwLogonHSM_xb3::OnEnterAuthTicketRefresh. Controller id = %d\n", m_controllerIndex);
  }
  else
  {
    Com_PrintError(25, "dwLogonHSM_xb3::OnEnterAuthTicketRefresh : authorizeXB3Token returned failure for controller %d. See output above for more errors.\n", m_controllerIndex);
    dwLogOnHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_COM_ERROR);
  }
}

/*
==============
dwLogonHSM_xb3::OnEnterUserAuthenticated
==============
*/
void dwLogonHSM_xb3::OnEnterUserAuthenticated(dwLogonHSM_xb3 *this)
{
  bdGetHostByName *m_lsgGetHostByName; 

  m_lsgGetHostByName = this->m_lsgGetHostByName;
  if ( m_lsgGetHostByName )
  {
    ((void (__fastcall *)(bdGetHostByName *, __int64))m_lsgGetHostByName->~bdRunnable)(m_lsgGetHostByName, 1i64);
    this->m_lsgGetHostByName = NULL;
  }
}

/*
==============
dwLogonHSM_xb3::OnExitUserAuthenticated
==============
*/
void dwLogonHSM_xb3::OnExitUserAuthenticated(dwLogonHSM_xb3 *this)
{
  ;
}

/*
==============
dwLogonHSM_xb3::OnUserSignout
==============
*/
void dwLogonHSM_xb3::OnUserSignout(dwLogonHSM_xb3 *this)
{
  bdGetHostByName *m_lsgGetHostByName; 
  DWServicesAccess *Instance; 

  m_lsgGetHostByName = this->m_lsgGetHostByName;
  if ( m_lsgGetHostByName )
  {
    ((void (__fastcall *)(bdGetHostByName *, __int64))m_lsgGetHostByName->~bdRunnable)(m_lsgGetHostByName, 1i64);
    this->m_lsgGetHostByName = NULL;
  }
  Instance = DWServicesAccess::GetInstance();
  DWServicesAccess::AuthServiceCleanup(Instance, this->m_controllerIndex);
  dwLogOnHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_ERROR_NO_MSG);
}

/*
==============
dwLogonHSM_xb3::PumpAntiCheat
==============
*/
void dwLogonHSM_xb3::PumpAntiCheat(dwLogonHSM_xb3 *this)
{
  DWServicesAccess *Instance; 
  DWLobbyService *DWLobbyService; 
  DWLobbyService::LobbyStatus Status; 

  Instance = DWServicesAccess::GetInstance();
  DWLobbyService = DWServicesAccess::GetDWLobbyService(Instance, this->m_controllerIndex);
  Status = DWLobbyService::getStatus(DWLobbyService);
  if ( (unsigned int)(Status - 2) <= 2 && (unsigned int)(Status - 3) <= 1 )
    LiveAntiCheat_Pump(this->m_controllerIndex);
}

/*
==============
dwLogonHSM_xb3::PumpAuthTicketRefresh
==============
*/
void dwLogonHSM_xb3::PumpAuthTicketRefresh(dwLogonHSM_xb3 *this)
{
  ;
}

/*
==============
dwLogonHSM_xb3::PumpRegionInfo
==============
*/
void dwLogonHSM_xb3::PumpRegionInfo(dwLogonHSM_xb3 *this)
{
  DWServicesAccess *Instance; 
  DWLobbyService *DWLobbyService; 
  DWLobbyService::LobbyStatus Status; 

  Instance = DWServicesAccess::GetInstance();
  DWLobbyService = DWServicesAccess::GetDWLobbyService(Instance, this->m_controllerIndex);
  Status = DWLobbyService::getStatus(DWLobbyService);
  if ( (unsigned int)(Status - 2) <= 2 && Status == CONNECTED )
    LiveRegionInfo_Pump(this->m_controllerIndex);
}

/*
==============
dwLogonHSM_xb3::Shutdown
==============
*/
void dwLogonHSM_xb3::Shutdown(dwLogonHSM_xb3 *this)
{
  bdGetHostByName *m_lsgGetHostByName; 

  m_lsgGetHostByName = this->m_lsgGetHostByName;
  if ( m_lsgGetHostByName )
  {
    ((void (__fastcall *)(bdGetHostByName *, __int64))m_lsgGetHostByName->~bdRunnable)(m_lsgGetHostByName, 1i64);
    this->m_lsgGetHostByName = NULL;
  }
}

/*
==============
dwLogonHSM_xb3::StartCrossAuthentication
==============
*/
void dwLogonHSM_xb3::StartCrossAuthentication(dwLogonHSM_xb3 *this)
{
  dwLogOnHSM_base::HSM_TriggerEvent(this, COM_ERROR_TRIGGERED);
}

/*
==============
StartLogin
==============
*/
_BOOL8 StartLogin(const int controllerIndex)
{
  char v2; 
  DWServicesAccess *Instance; 
  DWLogin *Login; 
  unsigned __int64 PlatformUserId; 
  bdWinRTPtr *v6; 
  bdWinRTPtr *UserByPlatformId; 
  bdWinRTPtr *v8; 
  bdWinRTPtr *v9; 
  bool v10; 
  signed __int32 v11; 
  bdPlatformUser platformUser; 
  __int64 v14; 
  bdWinRTPtr *v15; 
  char v16; 
  bdPlatformUser v17; 
  bdReference<bdWinRTPtr> v18; 

  v14 = -2i64;
  v2 = 0;
  v16 = 0;
  Instance = DWServicesAccess::GetInstance();
  Login = DWServicesAccess::GetLogin(Instance, controllerIndex);
  DWLogin::reset(Login);
  PlatformUserId = Live_GetPlatformUserId(controllerIndex);
  v6 = (bdWinRTPtr *)bdMemory::allocate(0x18ui64);
  platformUser.m_user.m_ptr = v6;
  if ( v6 )
  {
    UserByPlatformId = (bdWinRTPtr *)Users_GetUserByPlatformId(PlatformUserId);
    v18.m_ptr = UserByPlatformId;
    v2 = 1;
    v16 = 1;
    bdWinRTPtr::bdWinRTPtr(v6, (IUnknown *)UserByPlatformId);
    v9 = v8;
  }
  else
  {
    v9 = NULL;
    UserByPlatformId = v18.m_ptr;
  }
  v15 = v9;
  if ( v9 )
  {
    _InterlockedExchangeAdd((volatile signed __int32 *)&v9->m_refCount, 1u);
    v2 = v16;
  }
  if ( (v2 & 1) != 0 && UserByPlatformId )
    UserByPlatformId->__vftable[2].~bdReferencable(UserByPlatformId);
  if ( bdWinRTPtr::isNull(v9) )
  {
    v10 = 0;
  }
  else
  {
    v18.m_ptr = v9;
    if ( v9 )
      _InterlockedExchangeAdd((volatile signed __int32 *)&v9->m_refCount, 1u);
    bdPlatformUser::bdPlatformUser(&v17, (bdReference<bdWinRTPtr>)&v18);
    platformUser.m_user.m_ptr = v17.m_user.m_ptr;
    if ( v17.m_user.m_ptr )
      _InterlockedExchangeAdd((volatile signed __int32 *)&v17.m_user.m_ptr->m_refCount, 1u);
    v10 = DWLogin::initLogin(Login, controllerIndex, (bdPlatformUser)&platformUser) && DWLogin::start(Login);
    if ( v17.m_user.m_ptr && _InterlockedExchangeAdd((volatile signed __int32 *)&v17.m_user.m_ptr->m_refCount, 0xFFFFFFFF) == 1 )
    {
      if ( v17.m_user.m_ptr )
        ((void (__fastcall *)(bdWinRTPtr *, __int64))v17.m_user.m_ptr->~bdReferencable)(v17.m_user.m_ptr, 1i64);
      v17.m_user.m_ptr = NULL;
    }
  }
  if ( v9 )
  {
    v11 = _InterlockedExchangeAdd((volatile signed __int32 *)&v9->m_refCount, 0xFFFFFFFF);
    if ( v11 == 1 )
      ((void (__fastcall *)(bdWinRTPtr *, __int64))v9->~bdReferencable)(v9, 1i64);
  }
  return v10;
}

/*
==============
dwLogonHSM_xb3::UpdateConsoleStartAuthorize
==============
*/
void dwLogonHSM_xb3::UpdateConsoleStartAuthorize(dwLogonHSM_xb3 *this)
{
  bool started; 
  unsigned int m_controllerIndex; 
  bool v4; 
  const char *LocalClientName; 
  dwLogOnHSM_base::eHSMEvents v6; 

  started = StartLogin(this->m_controllerIndex);
  m_controllerIndex = this->m_controllerIndex;
  v4 = started;
  LocalClientName = Live_GetLocalClientName(m_controllerIndex);
  if ( v4 )
  {
    Com_Printf(25, "Microsoft-Demonware attempting to cross-authenticate account for %s controller %d\n", LocalClientName, m_controllerIndex);
    v6 = USER_CANCEL_INVITATION;
  }
  else
  {
    Com_PrintError(25, "Microsoft-Demonware attempt to cross-authenticate account for %s failed \n", LocalClientName);
    v6 = INVITE_GENERIC_COM_ERROR;
  }
  dwLogOnHSM_base::HSM_TriggerEvent(this, v6);
}

/*
==============
dwLogonHSM_xb3::UpdateConsoleWaitForAuthReply
==============
*/
void dwLogonHSM_xb3::UpdateConsoleWaitForAuthReply(dwLogonHSM_xb3 *this)
{
  DWServicesAccess *Instance; 
  DWLogin *Login; 
  DWServicesAccess *v4; 
  bdLoginResult *Result; 
  const bdAuthTicket *AuthTicket; 
  const bdLoginFailure *Failure; 
  __int64 v10; 
  Online_AccountRegistration *v19; 
  const char *LoginFailureMessage; 
  bdLoginFailure::bdLoginFailureCode LoginFailureCode; 
  bdLoginResult *v22; 
  unsigned int TaskErrorCode; 
  bdLoginResult *v24; 
  bdLobbyErrorCode v25; 
  bdLoginFailure v26; 

  Instance = DWServicesAccess::GetInstance();
  Login = DWServicesAccess::GetLogin(Instance, this->m_controllerIndex);
  if ( DWLogin::succeeded(Login) )
  {
    v4 = DWServicesAccess::GetInstance();
    DWServicesAccess::initLobby(v4, this->m_controllerIndex);
    Live_DWLoginComplete(this->m_controllerIndex);
    Result = (bdLoginResult *)DWLogin::getResult(Login);
    AuthTicket = bdLoginResult::getAuthTicket(Result);
    Online_SetAuthTicketCreationTime(AuthTicket->m_timeIssued);
    dwLogOnHSM_base::HSM_TriggerEvent(this, START_JOINING_LOBBY);
  }
  else if ( !DWLogin::isPending(Login) )
  {
    Failure = DWLogin::getFailure(Login);
    v26.__vftable = (bdLoginFailure_vtbl *)&bdLoginFailure::`vftable';
    v26.m_loginFailureCode = Failure->m_loginFailureCode;
    _RCX = Failure->m_loginFailureMessage;
    _RAX = v26.m_loginFailureMessage;
    v10 = 4i64;
    do
    {
      __asm
      {
        vmovups xmm0, xmmword ptr [rcx]
        vmovups xmmword ptr [rax], xmm0
        vmovups xmm1, xmmword ptr [rcx+10h]
        vmovups xmmword ptr [rax+10h], xmm1
        vmovups xmm0, xmmword ptr [rcx+20h]
        vmovups xmmword ptr [rax+20h], xmm0
        vmovups xmm1, xmmword ptr [rcx+30h]
        vmovups xmmword ptr [rax+30h], xmm1
        vmovups xmm0, xmmword ptr [rcx+40h]
        vmovups xmmword ptr [rax+40h], xmm0
        vmovups xmm1, xmmword ptr [rcx+50h]
        vmovups xmmword ptr [rax+50h], xmm1
        vmovups xmm0, xmmword ptr [rcx+60h]
        vmovups xmmword ptr [rax+60h], xmm0
      }
      _RAX += 128;
      __asm
      {
        vmovups xmm1, xmmword ptr [rcx+70h]
        vmovups xmmword ptr [rax-10h], xmm1
      }
      _RCX += 128;
      --v10;
    }
    while ( v10 );
    if ( bdLoginFailure::getLoginFailureCode(&v26) == NO_CROSSPLAY_ACCOUNT_FOUND )
    {
      v19 = Online_AccountRegistration::GetInstance();
      if ( Online_AccountRegistration::StartRegistration(v19, this->m_controllerIndex) )
        dwLogOnHSM_base::HSM_TriggerEvent(this, USER_DECLINE_INVITATION);
      else
        dwLogOnHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_COM_ERROR);
    }
    else
    {
      Com_PrintError(25, "**************\n**************\n**************\n");
      LoginFailureMessage = bdLoginFailure::getLoginFailureMessage(&v26);
      LoginFailureCode = bdLoginFailure::getLoginFailureCode(&v26);
      Com_PrintError(25, "Demonware login failed with error %d (%s)\n", (unsigned int)LoginFailureCode, LoginFailureMessage);
      Com_PrintError(25, "**************\n**************\n**************\n");
      dwLogOnHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_COM_ERROR);
      v22 = (bdLoginResult *)DWLogin::getResult(Login);
      TaskErrorCode = bdLoginResult::getTaskErrorCode(v22);
      if ( Live_HandleDWLoginError(this->m_controllerIndex, TaskErrorCode) )
      {
        v24 = (bdLoginResult *)DWLogin::getResult(Login);
        v25 = bdLoginResult::getTaskErrorCode(v24);
        Com_PrintError(25, "Demonware login failed with handled task error (%u)\n", (unsigned int)v25);
      }
    }
    bdLoginFailure::~bdLoginFailure(&v26);
  }
}

/*
==============
dwLogonHSM_xb3::UpdateLobbyConnect
==============
*/
void dwLogonHSM_xb3::UpdateLobbyConnect(dwLogonHSM_xb3 *this)
{
  DWServicesAccess *Instance; 
  DWLobbyService *DWLobbyService; 
  DWLobbyService::LobbyStatus Status; 

  Instance = DWServicesAccess::GetInstance();
  DWLobbyService = DWServicesAccess::GetDWLobbyService(Instance, this->m_controllerIndex);
  Status = DWLobbyService::getStatus(DWLobbyService);
  if ( (unsigned int)(Status - 2) <= 2 && Status == CONNECTED )
  {
    Live_DemonwareConnected(this->m_controllerIndex);
    dwLogOnHSM_base::HSM_TriggerEvent(this, RESOLVE_INVITER_UNIVERSAL_ID);
  }
}

/*
==============
dwLogonHSM_xb3::UpdateLobbyConnectStart
==============
*/
void dwLogonHSM_xb3::UpdateLobbyConnectStart(dwLogonHSM_xb3 *this)
{
  ;
}

/*
==============
dwLogonHSM_xb3::UpdateQueueStatus
==============
*/
void dwLogonHSM_xb3::UpdateQueueStatus(dwLogonHSM_xb3 *this)
{
  ;
}

/*
==============
dwLogonHSM_xb3::UpdateResolveAuthService
==============
*/
void dwLogonHSM_xb3::UpdateResolveAuthService(dwLogonHSM_xb3 *this)
{
  ;
}

/*
==============
dwLogonHSM_xb3::UpdateWaitForAccountRegistration
==============
*/
void dwLogonHSM_xb3::UpdateWaitForAccountRegistration(dwLogonHSM_xb3 *this)
{
  Online_AccountRegistration *Instance; 

  Instance = Online_AccountRegistration::GetInstance();
  if ( !Online_AccountRegistration::IsRegistering(Instance) )
    dwLogOnHSM_base::HSM_TriggerEvent(this, USER_CANCEL_INVITATION);
}

/*
==============
dwLogonHSM_xb3::dwDNSCleanup
==============
*/
void dwLogonHSM_xb3::dwDNSCleanup(dwLogonHSM_xb3 *this)
{
  bdGetHostByName *m_lsgGetHostByName; 

  m_lsgGetHostByName = this->m_lsgGetHostByName;
  if ( m_lsgGetHostByName )
  {
    ((void (__fastcall *)(bdGetHostByName *, __int64))m_lsgGetHostByName->~bdRunnable)(m_lsgGetHostByName, 1i64);
    this->m_lsgGetHostByName = NULL;
  }
}

