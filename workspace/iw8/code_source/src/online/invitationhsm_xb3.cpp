/*
==============
InviteJoinHSM_xb3::StartJoiningUser
==============
*/

bool __fastcall InviteJoinHSM_xb3::StartJoiningUser(InviteJoinHSM_xb3 *this, const int controllerIndex, XUID xuid, unsigned __int64 platformId)
{
  return ?StartJoiningUser@InviteJoinHSM_xb3@@QEAA_NHUXUID@@_K@Z(this, controllerIndex, xuid, platformId);
}

/*
==============
InviteJoinHSM_xb3::HandleIncomingInvitation
==============
*/

void __fastcall InviteJoinHSM_xb3::HandleIncomingInvitation(InviteJoinHSM_xb3 *this, XB3LaunchData *launchData, Windows::ApplicationModel::Activation::IProtocolActivatedEventArgs *args)
{
  ?HandleIncomingInvitation@InviteJoinHSM_xb3@@QEAAXAEAUXB3LaunchData@@PE$AAUIProtocolActivatedEventArgs@Activation@ApplicationModel@Windows@@@Z(this, launchData, args);
}

/*
==============
InviteJoinHSM_xb3::JoinFromOnlineInvitation
==============
*/

bool __fastcall InviteJoinHSM_xb3::JoinFromOnlineInvitation(InviteJoinHSM_xb3 *this, const int controllerIndex, const Online_Invitation *inviteData)
{
  return ?JoinFromOnlineInvitation@InviteJoinHSM_xb3@@QEAA_NHPEBUOnline_Invitation@@@Z(this, controllerIndex, inviteData);
}

/*
==============
InviteJoinHSM_xb3::HandleIncomingBootInvitation
==============
*/

void __fastcall InviteJoinHSM_xb3::HandleIncomingBootInvitation(InviteJoinHSM_xb3 *this)
{
  ?HandleIncomingBootInvitation@InviteJoinHSM_xb3@@AEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::HandleMPPermissionRequiredError
==============
*/

void __fastcall InviteJoinHSM_xb3::HandleMPPermissionRequiredError(InviteJoinHSM_xb3 *this)
{
  ?HandleMPPermissionRequiredError@InviteJoinHSM_xb3@@UEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::AtomicJoinBeginFenceUpdate
==============
*/

void __fastcall InviteJoinHSM_xb3::AtomicJoinBeginFenceUpdate(InviteJoinHSM_xb3 *this)
{
  ?AtomicJoinBeginFenceUpdate@InviteJoinHSM_xb3@@UEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::HandleInvalidFirstPartySessionReferenceInActivity
==============
*/

void __fastcall InviteJoinHSM_xb3::HandleInvalidFirstPartySessionReferenceInActivity(InviteJoinHSM_xb3 *this)
{
  ?HandleInvalidFirstPartySessionReferenceInActivity@InviteJoinHSM_xb3@@QEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::CleanupInvitation
==============
*/

void __fastcall InviteJoinHSM_xb3::CleanupInvitation(InviteJoinHSM_xb3 *this)
{
  ?CleanupInvitation@InviteJoinHSM_xb3@@UEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::HandleHSMCallback_VerifyInvitablePrivilege
==============
*/

void __fastcall InviteJoinHSM_xb3::HandleHSMCallback_VerifyInvitablePrivilege(InviteJoinHSM_xb3 *this)
{
  ?HandleHSMCallback_VerifyInvitablePrivilege@InviteJoinHSM_xb3@@UEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::~InviteJoinHSM_xb3
==============
*/

void __fastcall InviteJoinHSM_xb3::~InviteJoinHSM_xb3(InviteJoinHSM_xb3 *this)
{
  ??1InviteJoinHSM_xb3@@UEAA@XZ(this);
}

/*
==============
InviteJoinHSM_xb3::VerifyInvitationController
==============
*/

void __fastcall InviteJoinHSM_xb3::VerifyInvitationController(InviteJoinHSM_xb3 *this)
{
  ?VerifyInvitationController@InviteJoinHSM_xb3@@UEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::InviteJoinHSM_xb3
==============
*/

void __fastcall InviteJoinHSM_xb3::InviteJoinHSM_xb3(InviteJoinHSM_xb3 *this)
{
  ??0InviteJoinHSM_xb3@@QEAA@XZ(this);
}

/*
==============
InviteJoinHSM_xb3::HandleNoActivityFound
==============
*/

void __fastcall InviteJoinHSM_xb3::HandleNoActivityFound(InviteJoinHSM_xb3 *this)
{
  ?HandleNoActivityFound@InviteJoinHSM_xb3@@QEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::CleanupForInviteFailures
==============
*/

void __fastcall InviteJoinHSM_xb3::CleanupForInviteFailures(InviteJoinHSM_xb3 *this)
{
  ?CleanupForInviteFailures@InviteJoinHSM_xb3@@UEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::HandleInvalidControllerPairing
==============
*/

void __fastcall InviteJoinHSM_xb3::HandleInvalidControllerPairing(InviteJoinHSM_xb3 *this)
{
  ?HandleInvalidControllerPairing@InviteJoinHSM_xb3@@UEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::InviteePermissionsCheckUpdate
==============
*/

void __fastcall InviteJoinHSM_xb3::InviteePermissionsCheckUpdate(InviteJoinHSM_xb3 *this)
{
  ?InviteePermissionsCheckUpdate@InviteJoinHSM_xb3@@UEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::Initialize
==============
*/

void __fastcall InviteJoinHSM_xb3::Initialize(InviteJoinHSM_xb3 *this)
{
  ?Initialize@InviteJoinHSM_xb3@@QEAAXXZ(this);
}

/*
==============
InviteJoinHSM_xb3::InviteJoinHSM_xb3
==============
*/
void InviteJoinHSM_xb3::InviteJoinHSM_xb3(InviteJoinHSM_xb3 *this)
{
  InviteJoinHSM::InviteJoinHSM(this);
  this->m_bootInvitePendingInit = 0;
  this->__vftable = (InviteJoinHSM_xb3_vtbl *)&InviteJoinHSM_xb3::`vftable';
}

/*
==============
InviteJoinHSM_xb3::~InviteJoinHSM_xb3
==============
*/
void InviteJoinHSM_xb3::~InviteJoinHSM_xb3(InviteJoinHSM_xb3 *this)
{
  this->__vftable = (InviteJoinHSM_xb3_vtbl *)&InviteJoinHSM_xb3::`vftable';
  InviteJoinHSM::~InviteJoinHSM(this);
}

/*
==============
InviteJoinHSM_xb3::AtomicJoinBeginFenceUpdate
==============
*/
void InviteJoinHSM_xb3::AtomicJoinBeginFenceUpdate(InviteJoinHSM_xb3 *this)
{
  if ( Live_InviteProcessingSessionSearchAndGameModeCheckFencePassedFrame(this->m_pendingInvitationController) )
  {
    if ( Com_FastFile_CheckInstallInProgress(NULL, NULL) )
    {
      Live_ConfirmAcceptInvitation_ErrorNoParty("@XBOXLIVE/CANTJOINSESSION_INSTALL");
      InvitationHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_ERROR_NO_MSG);
      InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
      InviteJoinHSM::StoreLastEventTriggered(this, INVITE_GENERIC_ERROR_NO_MSG);
    }
    else if ( !Content_MountingContentPacksInProgress() )
    {
      InvitationHSM_base::HSM_TriggerEvent(this, FENCES_PASSED_BEGIN_ATOMIC_JOIN);
      InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
      InviteJoinHSM::StoreLastEventTriggered(this, FENCES_PASSED_BEGIN_ATOMIC_JOIN);
    }
  }
}

/*
==============
InviteJoinHSM_xb3::CleanupForInviteFailures
==============
*/
void InviteJoinHSM_xb3::CleanupForInviteFailures(InviteJoinHSM_xb3 *this)
{
  PartyDisconnectReason v2; 
  PrivatePartySessionHSM *Instance; 

  Com_Printf(25, ">>>>> CleanupForInviteFailures()\n");
  LOBYTE(v2) = 25;
  PartyAtomic_AbortJoinAttempt(&g_partyJoinInfo, v2);
  this->CleanupInvitation(this);
  Instance = PrivatePartySessionHSM::GetInstance();
  PrivatePartySessionHSM::InviteJoinFailed(Instance);
}

/*
==============
InviteJoinHSM_xb3::CleanupInvitation
==============
*/
void InviteJoinHSM_xb3::CleanupInvitation(InviteJoinHSM_xb3 *this)
{
  std::wstring *p_sessionHandleId; 

  Com_Printf(25, ">>>>>InvitationHSM_xb3::CleanupInvitation()\n");
  InviteJoinHSM::CleanupInvitation(this);
  p_sessionHandleId = &g_launchData.sessionHandleId;
  g_launchData.pendingJoinInvite = 0;
  if ( g_launchData.sessionHandleId._Mypair._Myval2._Myres >= 8 )
    p_sessionHandleId = (std::wstring *)g_launchData.sessionHandleId._Mypair._Myval2._Bx._Ptr;
  g_launchData.sessionHandleId._Mypair._Myval2._Mysize = 0i64;
  p_sessionHandleId->_Mypair._Myval2._Bx._Buf[0] = 0;
}

/*
==============
InviteJoinHSM_xb3::HandleHSMCallback_VerifyInvitablePrivilege
==============
*/
void InviteJoinHSM_xb3::HandleHSMCallback_VerifyInvitablePrivilege(InviteJoinHSM_xb3 *this)
{
  int v2; 

  if ( this->m_joinInfoOfTheCurrentInviteJoinInProgress.clientPlatform[0] == (unsigned __int8)GetClientPlatform() || !this->m_commonInviteData.fromGameInvite )
    v2 = 45;
  else
    v2 = 46 - Live_GetDoesUserHaveCrossplayPrivilege(this->m_pendingInvitationController);
  InvitationHSM_base::HSM_TriggerEvent(this, (InvitationHSM_base::eHSMEvents)v2);
  InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
  InviteJoinHSM::StoreLastEventTriggered(this, (InvitationHSM_base::eHSMEvents)v2);
}

/*
==============
InviteJoinHSM_xb3::HandleIncomingBootInvitation
==============
*/
void InviteJoinHSM_xb3::HandleIncomingBootInvitation(InviteJoinHSM_xb3 *this)
{
  if ( !this->m_bootInvitePendingInit && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\invitationhsm_xb3.cpp", 135, ASSERT_TYPE_ASSERT, "(m_bootInvitePendingInit)", (const char *)&queryFormat, "m_bootInvitePendingInit") )
    __debugbreak();
  if ( InviteJoinHSM::IsHSMHandlingInvitation(this) )
  {
    BootPrintf("Ignoring system service invite event because one is already being handled.\n");
  }
  else
  {
    BootPrintf(">>>>> HandleIncomingBootInvitation()\n");
    if ( !this->m_pendingInvitationController && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\invitationhsm_xb3.cpp", 142, ASSERT_TYPE_ASSERT, "(m_pendingInvitationController)", (const char *)&queryFormat, "m_pendingInvitationController") )
      __debugbreak();
    if ( !this->m_commonInviteData.m_platformIdOfUserBeingJoinedOn && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\invitationhsm_xb3.cpp", 143, ASSERT_TYPE_ASSERT, "(m_commonInviteData.m_platformIdOfUserBeingJoinedOn != (0))", (const char *)&queryFormat, "m_commonInviteData.m_platformIdOfUserBeingJoinedOn != INVALID_PLATFORM_ID") )
      __debugbreak();
    if ( !this->m_commonInviteData.m_platformIdOfUserJoining && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\invitationhsm_xb3.cpp", 144, ASSERT_TYPE_ASSERT, "(m_commonInviteData.m_platformIdOfUserJoining != (0))", (const char *)&queryFormat, "m_commonInviteData.m_platformIdOfUserJoining != INVALID_PLATFORM_ID") )
      __debugbreak();
    InvitationHSM_base::HSM_TriggerEvent(this, INVITE_RECEIVED);
    InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
    InviteJoinHSM::StoreLastEventTriggered(this, INVITE_RECEIVED);
  }
}

/*
==============
InviteJoinHSM_xb3::HandleIncomingInvitation
==============
*/
void InviteJoinHSM_xb3::HandleIncomingInvitation(InviteJoinHSM_xb3 *this, XB3LaunchData *launchData, Windows::ApplicationModel::Activation::IProtocolActivatedEventArgs *args)
{
  Windows::ApplicationModel::Activation::IProtocolActivatedEventArgs *v5; 
  PrivatePartySessionHSM *Instance; 
  PlatformInviteJoinAcceptData joinData; 
  Windows::ApplicationModel::Activation::IProtocolActivatedEventArgs *v8; 

  this->m_pendingInvitationController = -1;
  this->m_commonInviteData.fromGameInvite = launchData->fromInviteToActivitySession;
  this->m_commonInviteData.m_platformIdOfUserBeingJoinedOn = launchData->theirXuid;
  this->m_commonInviteData.m_platformIdOfUserJoining = launchData->myXuid;
  if ( this->m_hasBeenInitialized )
  {
    if ( InviteJoinHSM::IsHSMHandlingInvitation(this) )
    {
      Com_PrintWarning(25, "Ignoring system service invite event because one is already being handled.\n");
      return;
    }
    if ( this->m_initialDataTypeForJoining && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\invitationhsm_xb3.cpp", 96, ASSERT_TYPE_ASSERT, "(m_initialDataTypeForJoining == InitialDataTypeForJoining::UNIVERSAL_ID)", (const char *)&queryFormat, "m_initialDataTypeForJoining == InitialDataTypeForJoining::UNIVERSAL_ID", -2i64) )
      __debugbreak();
    if ( this->m_applicationDidSuspendResume )
      this->m_shouldCheckIfExeIsReadyToProcessInviteJoinBeforeCheckOnlineServices = 1;
    Com_Printf(25, ">>>>> HandleIncomingInvitation()\n");
    InvitationHSM_base::HSM_TriggerEvent(this, INVITE_RECEIVED);
    InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
    InviteJoinHSM::StoreLastEventTriggered(this, INVITE_RECEIVED);
  }
  else
  {
    this->m_bootInvitePendingInit = 1;
  }
  v5 = NULL;
  v8 = NULL;
  if ( args )
  {
    args->__abi_AddRef(args);
    v5 = args;
    v8 = args;
  }
  Instance = PrivatePartySessionHSM::GetInstance();
  if ( v5 )
    v5->__abi_AddRef(v5);
  joinData.m_sessionJoinProtocolArgs = v5;
  PrivatePartySessionHSM::NewInviteJoinInitiated(Instance, (PlatformInviteJoinAcceptData)&joinData);
  if ( v5 )
    v5->__abi_Release(v5);
}

/*
==============
InviteJoinHSM_xb3::HandleInvalidControllerPairing
==============
*/
void InviteJoinHSM_xb3::HandleInvalidControllerPairing(InviteJoinHSM_xb3 *this)
{
  Com_Printf(16, "HandleInvalidControllerPairing\n");
  OnlineErrorManager::SetLastRecordedErrorCode(&g_onlineMgr.m_errorManager, (Online_Error_CAT_INVITE_t)0x2000000, NULL);
  Com_SetErrorMessage("XBOXLIVE/CANT_DETERMINE_CONTROLLER");
  InviteJoinHSM::CopyLocalizedErrorCodeFromErrorManager(this);
}

/*
==============
InviteJoinHSM_xb3::HandleInvalidFirstPartySessionReferenceInActivity
==============
*/
void InviteJoinHSM_xb3::HandleInvalidFirstPartySessionReferenceInActivity(InviteJoinHSM_xb3 *this)
{
  OnlineErrorManager::SetLastRecordedErrorCode(&g_onlineMgr.m_errorManager, MOVEMENT, NULL);
  Com_SetErrorMessage("MENU/JOIN_SESSION_INVALID");
  InvitationHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_ERROR_NO_MSG);
  InviteJoinHSM::CopyLocalizedErrorCodeFromErrorManager(this);
  InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
  InviteJoinHSM::StoreLastEventTriggered(this, INVITE_GENERIC_ERROR_NO_MSG);
}

/*
==============
InviteJoinHSM_xb3::HandleMPPermissionRequiredError
==============
*/
void InviteJoinHSM_xb3::HandleMPPermissionRequiredError(InviteJoinHSM_xb3 *this)
{
  OnlineErrorManager::SetLastRecordedErrorCode(&g_onlineMgr.m_errorManager, MOVEMENT, NULL);
  Com_SetErrorMessage("XBOXLIVE/MPNOTALLOWED");
  InviteJoinHSM::CopyLocalizedErrorCodeFromErrorManager(this);
}

/*
==============
InviteJoinHSM_xb3::HandleNoActivityFound
==============
*/
void InviteJoinHSM_xb3::HandleNoActivityFound(InviteJoinHSM_xb3 *this)
{
  OnlineErrorManager::SetLastRecordedErrorCode(&g_onlineMgr.m_errorManager, MOVEMENT, NULL);
  Com_SetErrorMessage("MENU/JOIN_SESSION_INVALID");
  InvitationHSM_base::HSM_TriggerEvent(this, INVITE_GENERIC_ERROR_NO_MSG);
  InviteJoinHSM::CopyLocalizedErrorCodeFromErrorManager(this);
  InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
  InviteJoinHSM::StoreLastEventTriggered(this, INVITE_GENERIC_ERROR_NO_MSG);
}

/*
==============
InviteJoinHSM_xb3::Initialize
==============
*/
void InviteJoinHSM_xb3::Initialize(InviteJoinHSM_xb3 *this)
{
  bool v2; 

  if ( !this->m_hasBeenInitialized )
  {
    InvitationHSM_base::HSM_Init(this);
    v2 = !this->m_bootInvitePendingInit;
    this->m_hasBeenInitialized = 1;
    if ( !v2 )
    {
      if ( InviteJoinHSM::IsHSMHandlingInvitation(this) )
      {
        BootPrintf("Ignoring system service invite event because one is already being handled.\n");
        this->m_bootInvitePendingInit = 0;
      }
      else
      {
        BootPrintf(">>>>> HandleIncomingBootInvitation()\n");
        if ( !this->m_pendingInvitationController && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\invitationhsm_xb3.cpp", 142, ASSERT_TYPE_ASSERT, "(m_pendingInvitationController)", (const char *)&queryFormat, "m_pendingInvitationController") )
          __debugbreak();
        if ( !this->m_commonInviteData.m_platformIdOfUserBeingJoinedOn && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\invitationhsm_xb3.cpp", 143, ASSERT_TYPE_ASSERT, "(m_commonInviteData.m_platformIdOfUserBeingJoinedOn != (0))", (const char *)&queryFormat, "m_commonInviteData.m_platformIdOfUserBeingJoinedOn != INVALID_PLATFORM_ID") )
          __debugbreak();
        if ( !this->m_commonInviteData.m_platformIdOfUserJoining && CoreAssert_Handler("c:\\workspace\\iw8\\code_source\\src\\online\\invitationhsm_xb3.cpp", 144, ASSERT_TYPE_ASSERT, "(m_commonInviteData.m_platformIdOfUserJoining != (0))", (const char *)&queryFormat, "m_commonInviteData.m_platformIdOfUserJoining != INVALID_PLATFORM_ID") )
          __debugbreak();
        InvitationHSM_base::HSM_TriggerEvent(this, INVITE_RECEIVED);
        InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
        InviteJoinHSM::StoreLastEventTriggered(this, INVITE_RECEIVED);
        this->m_bootInvitePendingInit = 0;
      }
    }
  }
}

/*
==============
InviteJoinHSM_xb3::InviteePermissionsCheckUpdate
==============
*/
void InviteJoinHSM_xb3::InviteePermissionsCheckUpdate(InviteJoinHSM_xb3 *this)
{
  InvitationHSM_base::eHSMEvents v2; 
  std::wstring *p_sessionHandleId; 

  if ( Live_GetPrivilegeCheckState(this->m_pendingInvitationController, 2) == CHECKED )
  {
    if ( Live_HasOnlinePlayPrivilege(this->m_pendingInvitationController) )
    {
      v2 = INVITE_PERMISSIONS_PASSED;
    }
    else
    {
      v2 = INVITE_MP_PERM_REQUIRED;
      Com_Printf(16, "WaitForDemonwareAuthenticationUpdate controller %d doesn't have MP permissions!\n", (unsigned int)this->m_pendingInvitationController);
      p_sessionHandleId = &g_launchData.sessionHandleId;
      g_launchData.pendingJoinInvite = 0;
      if ( g_launchData.sessionHandleId._Mypair._Myval2._Myres >= 8 )
        p_sessionHandleId = (std::wstring *)g_launchData.sessionHandleId._Mypair._Myval2._Bx._Ptr;
      g_launchData.sessionHandleId._Mypair._Myval2._Mysize = 0i64;
      p_sessionHandleId->_Mypair._Myval2._Bx._Buf[0] = 0;
      Live_TryGoldUpsell(this->m_pendingInvitationController);
    }
    InvitationHSM_base::HSM_TriggerEvent(this, v2);
    InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
    InviteJoinHSM::StoreLastEventTriggered(this, v2);
  }
  else
  {
    Com_Printf(25, "WaitForDemonwareAuthenticationUpdate\n");
    Live_UpdateOnlinePlayPrivilege(this->m_pendingInvitationController);
  }
}

/*
==============
InviteJoinHSM_xb3::JoinFromOnlineInvitation
==============
*/
char InviteJoinHSM_xb3::JoinFromOnlineInvitation(InviteJoinHSM_xb3 *this, const int controllerIndex, const Online_Invitation *inviteData)
{
  PrivatePartySessionHSM *Instance; 
  PlatformInviteJoinAcceptData joinData; 

  if ( !InviteJoinHSM::JoinFromOnlineInvitation(this, controllerIndex, inviteData) )
    return 0;
  Instance = PrivatePartySessionHSM::GetInstance();
  joinData.m_sessionJoinProtocolArgs = NULL;
  PrivatePartySessionHSM::NewInviteJoinInitiated(Instance, (PlatformInviteJoinAcceptData)&joinData);
  return 1;
}

/*
==============
InviteJoinHSM_xb3::StartJoiningUser
==============
*/
char InviteJoinHSM_xb3::StartJoiningUser(InviteJoinHSM_xb3 *this, const int controllerIndex, XUID xuid, unsigned __int64 platformId)
{
  PrivatePartySessionHSM *Instance; 
  PlatformInviteJoinAcceptData joinData; 
  __int64 v7; 
  __int64 v8; 

  v7 = -2i64;
  if ( !InviteJoinHSM::StartJoiningUser(this, controllerIndex, xuid, platformId) )
    return 0;
  v8 = 0i64;
  Instance = PrivatePartySessionHSM::GetInstance();
  joinData.m_sessionJoinProtocolArgs = NULL;
  PrivatePartySessionHSM::NewInviteJoinInitiated(Instance, (PlatformInviteJoinAcceptData)&joinData);
  return 1;
}

/*
==============
InviteJoinHSM_xb3::VerifyInvitationController
==============
*/
void InviteJoinHSM_xb3::VerifyInvitationController(InviteJoinHSM_xb3 *this)
{
  int v2; 
  int v3; 
  LocalClientNum_t v4; 
  int ControllerFromClient; 
  unsigned __int64 PlatformUserId; 
  __int64 m_pendingInvitationController; 
  unsigned __int64 v8; 
  unsigned __int64 m_id; 
  __int64 v10; 

  Live_AutoSigninUsersWhoAreSignedIntoPlatformIfRequired();
  v2 = 0;
  v3 = 0;
  if ( this->m_pendingInvitationController == -1 )
  {
    v4 = LOCAL_CLIENT_0;
    while ( 1 )
    {
      if ( CL_IsLocalClientActive(v4) )
      {
        ++v3;
        ControllerFromClient = CL_Mgr_GetControllerFromClient(v4);
        if ( !Live_UserIsGuest(ControllerFromClient) && Live_IsUserSignedInToLive(ControllerFromClient) && this->m_commonInviteData.m_platformIdOfUserJoining && Live_GetPlatformUserId(ControllerFromClient) == this->m_commonInviteData.m_platformIdOfUserJoining )
          break;
      }
      if ( ++v4 >= LOCAL_CLIENT_COUNT )
        goto LABEL_13;
    }
    this->m_pendingInvitationController = ControllerFromClient;
    PlatformUserId = Live_GetPlatformUserId(ControllerFromClient);
    m_pendingInvitationController = (unsigned int)this->m_pendingInvitationController;
    this->m_commonInviteData.m_platformIdOfUserJoining = PlatformUserId;
    Com_Printf(25, "Active controller %d found bound to the user specified in the invitation PlatformID [%llu]!\n", m_pendingInvitationController, PlatformUserId);
  }
  else
  {
    Com_Printf(25, "InvitationHSM_xb3::VerifyInvitationController : Already have a pending invitation controller\n");
  }
  InvitationHSM_base::HSM_TriggerEvent(this, INVITE_CHECK_PERMISSIONS);
  InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
  InviteJoinHSM::StoreLastEventTriggered(this, INVITE_CHECK_PERMISSIONS);
LABEL_13:
  if ( this->m_pendingInvitationController == -1 && !v3 )
  {
    while ( Live_UserIsGuest(v2) || !Live_IsUserSignedInToLive(v2) || !this->m_commonInviteData.m_platformIdOfUserJoining || Live_GetPlatformUserId(v2) != this->m_commonInviteData.m_platformIdOfUserJoining )
    {
      if ( ++v2 >= 8 )
        goto LABEL_22;
    }
    this->m_pendingInvitationController = v2;
    v8 = Live_GetPlatformUserId(v2);
    m_id = this->m_commonInviteData.m_xuidOfUserJoining.m_id;
    v10 = (unsigned int)this->m_pendingInvitationController;
    this->m_commonInviteData.m_platformIdOfUserJoining = v8;
    Com_Printf(25, "Inactive controller %d found bound to the user specified in the invitation XUID [%llu]!\n", v10, m_id);
    InvitationHSM_base::HSM_TriggerEvent(this, INVITE_CHECK_PERMISSIONS);
    InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
    InviteJoinHSM::StoreLastEventTriggered(this, INVITE_CHECK_PERMISSIONS);
  }
LABEL_22:
  if ( this->m_pendingInvitationController == -1 )
  {
    Com_PrintError(25, "Received invite but no controller could be found bound to the user specified in the invitation - XUID [%llu]!\n", this->m_commonInviteData.m_xuidOfUserJoining.m_id);
    InvitationHSM_base::HSM_TriggerEvent(this, INVITE_CANT_DETERMINE_CONTROLLER_PAIRING);
    InviteJoinHSM::CopyCurrentStateFromHSMToMemberVariable(this);
    InviteJoinHSM::StoreLastEventTriggered(this, INVITE_CANT_DETERMINE_CONTROLLER_PAIRING);
  }
}

